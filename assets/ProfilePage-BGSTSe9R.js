import{r as e,j as i,B as l,u as n,x as o,A as s,b as r,n as a,v as t,h as c,D as d,i as x,l as g,f as u,m,Y as p}from"./vendor-VLBVWaDG.js";import{b as f,u as h,a as j,L as y,az as b,aW as v,a$ as C,E as w,b0 as S,c as D}from"./main-mWCWJs1P.js";import{T as I,G as T}from"./GoogleButton-BBMpEVb4.js";import"./index-LWfQEWTZ.js";const k=()=>{const{t:k}=f(),{user:G,isLoading:_,fetchUserData:E,logout:z}=h(),{showErrorToast:W,showToast:A}=j(),[F,O]=e.useState(!1),[B,M]=e.useState(!1),N=h().telegramWebApp,[U,L]=e.useState(!1),[P,R]=e.useState(!1),[Y,$]=e.useState(!1),[q,H]=e.useState(!1),[J,K]=e.useState(""),[Q,V]=e.useState(""),[X,Z]=e.useState(!1);return G||_?i.jsxs(l,{sx:{display:"flex",flexDirection:"column",height:"100%",bgcolor:"background.default"},children:[_?i.jsx(y,{message:k("common.loading")}):i.jsx(l,{sx:{display:"flex",flexDirection:"column",mx:"auto",width:"100%",maxWidth:"800px",p:2},children:i.jsxs(o,{sx:{display:"flex",flexDirection:"column",p:0,borderRadius:2},children:[i.jsx(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:3},children:i.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[i.jsx(s,{src:(null==G?void 0:G.photo_url)||void 0,sx:{width:60,height:60,mr:2,bgcolor:"primary.light",fontSize:"1.5rem"},children:b(G)}),i.jsxs(l,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(null==G?void 0:G.first_name)&&i.jsx(l,{children:i.jsx(r,{variant:"h6",sx:{color:"inherit",fontWeight:600},children:null==G?void 0:G.first_name})}),(null==G?void 0:G.last_name)&&i.jsx(l,{children:i.jsx(r,{variant:"h6",sx:{color:"inherit",fontWeight:600},children:null==G?void 0:G.last_name})})]})]})}),i.jsxs(l,{sx:{p:3,pt:0},children:[i.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1},children:[i.jsx(l,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:i.jsx(r,{variant:"body1",children:k("profile.username","Username")})}),i.jsx(l,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:i.jsx(a,{variant:"text",endIcon:i.jsx(v,{}),onClick:async()=>{try{await navigator.clipboard.writeText((null==G?void 0:G.username)||""),A(k("profile.usernameCopied","Username copied to clipboard"),"success")}catch(e){W(k("profile.usernameCopyError","Failed to copy username"))}},sx:{color:"primary.main"},children:null==G?void 0:G.username})})]}),i.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:2,borderBottom:"1px solid",borderColor:"divider"},children:[i.jsx(l,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:i.jsx(r,{variant:"body1",children:k("profile.role","Role")})}),i.jsx(l,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:i.jsx(t,{color:"admin"===(null==G?void 0:G.role)?"error":"teacher"===(null==G?void 0:G.role)?"primary":"success",label:null==G?void 0:G.role})})]}),N&&!N.initData&&i.jsxs(i.Fragment,{children:[i.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:2,borderBottom:"1px solid",borderColor:"divider"},children:[i.jsx(l,{sx:{display:"flex",alignItems:"center"},children:i.jsx(r,{variant:"body1",children:k("profile.telegram","Telegram")})}),(null==G?void 0:G.telegram_user_id)?i.jsxs(l,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:[i.jsxs(r,{variant:"body1",children:["@",G.username]}),(null==G?void 0:G.email)&&i.jsx(c,{size:"small",onClick:()=>R(!0),children:i.jsx(C,{fontSize:"small"})})]}):i.jsx(l,{children:F?i.jsx(r,{variant:"body2",color:"text.secondary",children:k("profile.connecting","Connecting...")}):i.jsx(I,{botName:"teachair_bot",onAuth:async e=>{if(e&&e.id){O(!0);try{await D.users.connectTelegram(e)?(await E(),A(k("profile.telegramConnectSuccess","Telegram account connected successfully"),"success")):W(k("profile.telegramConnectError","Failed to connect Telegram account"))}catch(i){let e=k("profile.telegramConnectError","Failed to connect Telegram account");(null==i?void 0:i.message.includes("409"))?e=k("profile.telegramAlreadyConnected","This Telegram account is already connected to another user"):i.message&&(e=i.message),W(e)}finally{O(!1)}}else W(k("profile.invalidTelegramData","Invalid Telegram user data"))}})})]}),i.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:2,borderBottom:"1px solid",borderColor:"divider"},children:[i.jsx(l,{sx:{display:"flex",alignItems:"center"},children:i.jsx(r,{variant:"body1",children:k("profile.google","Google")})}),(null==G?void 0:G.email)?i.jsxs(l,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:[i.jsx(r,{variant:"body1",children:G.email}),(null==G?void 0:G.telegram_user_id)&&i.jsx(c,{size:"small",onClick:()=>$(!0),children:i.jsx(C,{fontSize:"small"})})]}):i.jsx(l,{children:B?i.jsx(r,{variant:"body2",color:"text.secondary",children:k("profile.connecting","Connecting...")}):i.jsx(T,{text:k("profile.connectGoogle","Connect Google"),size:"small",onSuccess:async e=>{if(e&&""!==e.trim()){M(!0);try{const i={access_token:e};await D.users.connectGoogle(i)?(await E(),A(k("profile.googleConnectSuccess","Google account connected successfully"),"success")):W(k("profile.googleConnectError","Failed to connect Google account"))}catch(i){let e=k("profile.googleConnectError","Failed to connect Google account");(null==i?void 0:i.message.includes("409"))?e=k("profile.googleAlreadyConnected","This Google account is already connected to another user"):i.message&&(e=i.message),W(e)}finally{M(!1)}}else W(k("profile.invalidGoogleToken","Invalid Google access token"))}})})]})]}),(null==G?void 0:G.created_at)&&i.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:2,borderBottom:"1px solid",borderColor:"divider"},children:[i.jsx(r,{variant:"body1",children:k("profile.memberSince","Member since")}),i.jsx(r,{variant:"body2",color:"text.secondary",children:new Date(G.created_at).toLocaleDateString(k("locale"),{dateStyle:"medium"})})]})]}),i.jsxs(l,{sx:{p:3,pt:0,display:"flex",justifyContent:"space-between",alignItems:"center",gap:2},children:[i.jsx(a,{variant:"outlined",startIcon:i.jsx(w,{}),onClick:()=>{K((null==G?void 0:G.first_name)||""),V((null==G?void 0:G.last_name)||""),H(!0)},size:"small",children:k("profile.edit","Edit")}),i.jsx(a,{variant:"outlined",startIcon:i.jsx(S,{}),onClick:()=>L(!0),color:"error",size:"small",children:k("auth.signOut","Sign Out")})]})]})}),i.jsxs(d,{open:q,onClose:()=>!X&&H(!1),"aria-labelledby":"edit-dialog-title",maxWidth:"sm",fullWidth:!0,children:[i.jsx(x,{id:"edit-dialog-title",children:k("profile.editProfile","Edit Profile")}),i.jsx(g,{children:i.jsxs(l,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[i.jsx(u,{label:k("profile.firstName","First Name"),value:J,onChange:e=>K(e.target.value),fullWidth:!0,disabled:X}),i.jsx(u,{label:k("profile.lastName","Last Name"),value:Q,onChange:e=>V(e.target.value),fullWidth:!0,disabled:X})]})}),i.jsxs(m,{children:[i.jsx(a,{onClick:()=>H(!1),disabled:X,children:k("profile.cancel","Cancel")}),i.jsx(a,{onClick:async()=>{Z(!0);try{const e={first_name:J.trim()||null,last_name:Q.trim()||null};await D.users.updateMe(e),await E(),H(!1),A(k("profile.updateSuccess","Profile updated successfully"),"success")}catch(e){W(k("profile.updateError","Failed to update profile"))}finally{Z(!1)}},variant:"contained",disabled:X,children:X?k("profile.saving","Saving..."):k("profile.save","Save")})]})]}),i.jsxs(d,{open:U,onClose:()=>L(!1),"aria-labelledby":"logout-dialog-title","aria-describedby":"logout-dialog-description",children:[i.jsx(x,{id:"logout-dialog-title",children:k("auth.confirmSignOut","Confirm Sign Out")}),i.jsx(g,{children:i.jsx(p,{id:"logout-dialog-description",children:k("auth.confirmSignOutMessage","Are you sure you want to sign out?")})}),i.jsxs(m,{children:[i.jsx(a,{onClick:()=>L(!1),color:"primary",children:k("auth.cancel","Cancel")}),i.jsx(a,{onClick:()=>{L(!1),z()},color:"error",variant:"contained",children:k("auth.signOut","Sign Out")})]})]}),i.jsxs(d,{open:P,onClose:()=>R(!1),"aria-labelledby":"telegram-disconnect-dialog-title","aria-describedby":"telegram-disconnect-dialog-description",children:[i.jsx(x,{id:"telegram-disconnect-dialog-title",children:k("profile.confirmTelegramDisconnect","Confirm Telegram Disconnect")}),i.jsx(g,{children:i.jsx(p,{id:"telegram-disconnect-dialog-description",children:k("profile.confirmTelegramDisconnectMessage","Are you sure you want to disconnect your Telegram account?")})}),i.jsxs(m,{children:[i.jsx(a,{onClick:()=>R(!1),color:"primary",children:k("profile.cancel","Cancel")}),i.jsx(a,{onClick:async()=>{R(!1),await(async()=>{await D.users.disconnectTelegram(),await E()})()},color:"error",variant:"contained",children:k("profile.disconnect","Disconnect")})]})]}),i.jsxs(d,{open:Y,onClose:()=>$(!1),"aria-labelledby":"google-disconnect-dialog-title","aria-describedby":"google-disconnect-dialog-description",children:[i.jsx(x,{id:"google-disconnect-dialog-title",children:k("profile.confirmGoogleDisconnect","Confirm Google Disconnect")}),i.jsx(g,{children:i.jsx(p,{id:"google-disconnect-dialog-description",children:k("profile.confirmGoogleDisconnectMessage","Are you sure you want to disconnect your Google account?")})}),i.jsxs(m,{children:[i.jsx(a,{onClick:()=>$(!1),color:"primary",children:k("profile.cancel","Cancel")}),i.jsx(a,{onClick:async()=>{$(!1),await(async()=>{await D.users.disconnectGoogle(),await E()})()},color:"error",variant:"contained",children:k("profile.disconnect","Disconnect")})]})]})]}):i.jsx(l,{sx:{p:3},children:i.jsx(n,{severity:"error",children:k("profile.noUser","User not found")})})};export{k as default};
