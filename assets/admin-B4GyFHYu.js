import{r as e,j as s,B as a,u as l,n as r,ao as t,x as n,ap as i,aq as c,ar as o,as as d,at as u,v as h,h as x,H as j,D as m,i as f,l as g,b as y,V as p,an as S,W as v,d as b,m as C}from"./vendor-CLrGhTW1.js";import{u as E,a as R,U as T,c as A,h as U,P as w,L as D,ax as N,E as k}from"./main-C0pfxit8.js";const z=()=>{const{user:z}=E(),{showErrorToast:I}=R(),[L,W]=e.useState([]),[H,B]=e.useState(!0),[F,M]=e.useState(!1),[P,_]=e.useState(null),[q,O]=e.useState(0),[V,G]=e.useState(null),[J,K]=e.useState(!1),[Q,X]=e.useState(""),[Y,Z]=e.useState(!1),[$,ee]=e.useState({username:"",first_name:"",last_name:"",role:T.STUDENT}),[se,ae]=e.useState(0),[le,re]=e.useState(!0),te=e.useRef(null);e.useEffect((()=>{(async()=>{B(!0),_(null);try{const e=await A.users.getAll(0,20);W(e),ae(0),re(20===e.length),_(null)}catch(e){const s=U(e);_(s),I(s)}finally{B(!1)}})()}),[q]),e.useEffect((()=>{const e=new IntersectionObserver((e=>{const[s]=e;s.isIntersecting&&le&&!H&&!F&&ne()}),{threshold:.5}),s=te.current;return s&&e.observe(s),()=>{s&&e.unobserve(s)}}),[le,H,F]);const ne=async()=>{if(!le||F)return;M(!0);const e=se+1;try{const s=await A.users.getAll(20*e,20);s.length>0?(W((e=>[...e,...s])),ae(e),re(20===s.length)):re(!1)}catch(s){const e=U(s);I(e)}finally{M(!1)}},ie=e.useCallback((()=>{O((e=>e+1))}),[]),ce=()=>{K(!1),G(null)},oe=e=>{switch(e){case T.ADMIN:return"error";case T.TEACHER:return"primary";case T.STUDENT:return"success";default:return"default"}};return s.jsxs(a,{children:[s.jsx(w,{title:"Users"}),P&&s.jsx(l,{severity:"error",sx:{mb:2,mx:"auto",maxWidth:"1200px"},action:s.jsx(r,{color:"inherit",size:"small",onClick:ie,disabled:H,children:H?"Loading...":"Retry"}),children:P}),H?s.jsx(a,{sx:{display:"flex",justifyContent:"center",py:4},children:s.jsx(D,{message:H&&P?"Loading...":"Loading users..."})}):!P&&s.jsxs(s.Fragment,{children:[s.jsx(t,{component:n,sx:{mt:3,mx:"auto",maxWidth:"1200px"},children:s.jsxs(i,{children:[s.jsx(c,{children:s.jsxs(o,{children:[s.jsx(d,{children:"Name"}),s.jsx(d,{children:"Username"}),s.jsx(d,{children:"Role"}),s.jsx(d,{align:"right",children:"Actions"})]})}),s.jsx(u,{children:L.map((e=>s.jsxs(o,{hover:!0,children:[s.jsx(d,{children:N(e)}),s.jsx(d,{children:e.username}),s.jsx(d,{children:s.jsx(h,{label:e.role,color:oe(e.role),size:"small"})}),s.jsx(d,{align:"right",children:s.jsx(x,{size:"small",onClick:()=>(e=>{G(e),X(e.role),K(!0)})(e),children:s.jsx(k,{fontSize:"small"})})})]},e.id)))})]})}),s.jsx(a,{ref:te,sx:{display:"flex",justifyContent:"center",p:2,visibility:le?"visible":"hidden"},children:F&&s.jsx(j,{size:24})}),s.jsxs(m,{open:J,onClose:ce,children:[s.jsx(f,{children:"Edit User Role"}),s.jsxs(g,{children:[s.jsxs(y,{variant:"body1",gutterBottom:!0,children:["Change role for ",N(V)]}),s.jsxs(p,{fullWidth:!0,sx:{mt:2},children:[s.jsx(S,{id:"role-label",children:"Role"}),s.jsxs(v,{labelId:"role-label",id:"role",value:Q,label:"Role",onChange:e=>{X(e.target.value)},children:[s.jsx(b,{value:T.STUDENT,children:"Student"}),s.jsx(b,{value:T.TEACHER,children:"Teacher"}),s.jsx(b,{value:T.ADMIN,children:"Admin"})]})]})]}),s.jsxs(C,{children:[s.jsx(r,{onClick:ce,children:"Cancel"}),s.jsx(r,{onClick:async()=>{if(V)try{await A.users.updateRole(V.id,{role:Q}),W((e=>e.map((e=>e.id===V.id?{...e,role:Q}:e)))),ce()}catch(e){const s=e instanceof Error?e.message:"Failed to update user role. Please try again.";I(s)}},color:"primary",variant:"contained",children:"Update Role"})]})]})]})]})};export{z as default};
