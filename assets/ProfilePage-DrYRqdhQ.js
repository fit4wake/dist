import{r as e,j as l,B as i,v as s,y as o,A as n,b as r,o as a,i as t,w as c,D as d,l as x,m as g,h as p,n as m,Z as u}from"./vendor-EJ2UFF3P.js";import{b as h,u as f,a as j,L as y,aw as b,E as v,bm as C,bh as w,bn as S,bo as D,bg as I,c as k,bp as T,g as G}from"./main-BnhaBm3Q.js";import{T as _,G as z}from"./GoogleButton-mzoCuln5.js";import"./index-DA3w4ZnQ.js";const W=()=>{const{t:W}=h(),{user:E,isLoading:F,fetchUserData:A,logout:B}=f(),{showErrorToast:U,showToast:M}=j(),[O,R]=e.useState(!1),[L,N]=e.useState(!1),P=f().telegramWebApp,[q,Z]=e.useState(!1),[$,H]=e.useState(!1),[J,K]=e.useState(!1),[Q,V]=e.useState(!1),[X,Y]=e.useState(!1),[ee,le]=e.useState(!1),[ie,se]=e.useState(""),[oe,ne]=e.useState(""),[re,ae]=e.useState(!1),[te,ce]=e.useState(""),[de,xe]=e.useState(!1),ge=async()=>{xe(!0);try{await k.users.createRequest({type:T.UPGRADE,description:te}),await A(),le(!1),V(!1),ce(""),M(W("home.upgrade.success"),"success")}catch(e){const l=G(e);U(l)}finally{xe(!1)}};return E||F?l.jsxs(i,{sx:{display:"flex",flexDirection:"column",height:"100%",bgcolor:"background.default"},children:[F?l.jsx(y,{message:W("common.loading")}):l.jsx(i,{sx:{display:"flex",flexDirection:"column",mx:"auto",width:"100%",maxWidth:"800px",p:2},children:l.jsxs(o,{sx:{display:"flex",flexDirection:"column",p:0,borderRadius:2},children:[l.jsxs(i,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",p:3},children:[l.jsxs(i,{sx:{display:"flex",alignItems:"center"},children:[l.jsx(n,{src:(null==E?void 0:E.photo_url)||void 0,sx:{width:48,height:48,mr:2,bgcolor:"primary.light",fontSize:"1.5rem"},children:b(E)}),l.jsx(i,{sx:{display:"flex",flexDirection:"column",gap:1},children:l.jsxs(r,{variant:"h6",sx:{color:"inherit",fontWeight:600},children:[null==E?void 0:E.first_name,"  ",null==E?void 0:E.last_name]})})]}),l.jsxs(i,{sx:{display:"flex",alignItems:{xs:"flex-start",sm:"center"},gap:1,mt:2,flexDirection:{xs:"column",sm:"row"}},children:[l.jsx(a,{variant:"text",startIcon:l.jsx(v,{}),onClick:()=>{se((null==E?void 0:E.first_name)||""),ne((null==E?void 0:E.last_name)||""),Y(!0)},size:"small",children:W("profile.edit")}),l.jsx(a,{variant:"text",size:"small",startIcon:l.jsx(C,{}),onClick:()=>{"teacher"===(null==E?void 0:E.role)?V(!0):le(!0)},children:W("profile.switchRole")})]})]}),l.jsxs(i,{sx:{p:3,pt:0},children:[l.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:2,borderBottom:"1px solid",borderTop:"1px solid",borderColor:"divider"},children:[l.jsx(i,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:l.jsx(r,{variant:"body1",children:W("profile.username","Username")})}),l.jsxs(i,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:[l.jsx(r,{variant:"body1",color:"primary.main",sx:{fontWeight:600},children:null==E?void 0:E.username}),l.jsx(t,{size:"small",color:"primary",onClick:async()=>{try{await navigator.clipboard.writeText((null==E?void 0:E.username)||""),M(W("profile.usernameCopied","Username copied to clipboard"),"success")}catch(e){U(W("profile.usernameCopyError","Failed to copy username"))}},children:l.jsx(w,{fontSize:"small"})})]})]}),l.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:2,borderBottom:"1px solid",borderColor:"divider"},children:[l.jsx(i,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:l.jsx(r,{variant:"body1",children:W("profile.role")})}),l.jsx(i,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:l.jsx(c,{color:"admin"===(null==E?void 0:E.role)?"error":"teacher"===(null==E?void 0:E.role)?"primary":"success",label:W(`roles.${null==E?void 0:E.role}`)})})]}),P&&!P.initData&&l.jsxs(l.Fragment,{children:[l.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:2,borderBottom:"1px solid",borderColor:"divider"},children:[l.jsx(i,{sx:{display:"flex",alignItems:"center"},children:l.jsx(r,{variant:"body1",children:W("profile.telegram","Telegram")})}),(null==E?void 0:E.telegram_user_id)?l.jsxs(i,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:[l.jsxs(r,{variant:"body1",children:["@",E.username]}),(null==E?void 0:E.email)&&l.jsx(t,{size:"small",onClick:()=>H(!0),children:l.jsx(S,{fontSize:"small"})})]}):l.jsx(i,{children:O?l.jsx(r,{variant:"body2",color:"text.secondary",children:W("profile.connecting","Connecting...")}):l.jsx(_,{botName:"teachair_bot",onAuth:async e=>{if(e&&e.id){R(!0);try{await k.users.connectTelegram(e)?(await A(),M(W("profile.telegramConnectSuccess","Telegram account connected successfully"),"success")):U(W("profile.telegramConnectError","Failed to connect Telegram account"))}catch(l){let e=W("profile.telegramConnectError","Failed to connect Telegram account");(null==l?void 0:l.message.includes("409"))?e=W("profile.telegramAlreadyConnected","This Telegram account is already connected to another user"):l.message&&(e=l.message),U(e)}finally{R(!1)}}else U(W("profile.invalidTelegramData","Invalid Telegram user data"))}})})]}),l.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:2,borderBottom:"1px solid",borderColor:"divider"},children:[l.jsx(i,{sx:{display:"flex",alignItems:"center"},children:l.jsx(r,{variant:"body1",children:W("profile.google","Google")})}),(null==E?void 0:E.email)?l.jsxs(i,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:[l.jsx(r,{variant:"body1",children:E.email}),(null==E?void 0:E.telegram_user_id)&&l.jsx(t,{size:"small",onClick:()=>K(!0),children:l.jsx(S,{fontSize:"small"})})]}):l.jsx(i,{children:L?l.jsx(r,{variant:"body2",color:"text.secondary",children:W("profile.connecting","Connecting...")}):l.jsx(z,{text:W("profile.connectGoogle","Connect Google"),size:"small",onSuccess:async e=>{if(e&&""!==e.trim()){N(!0);try{const l={access_token:e};await k.users.connectGoogle(l)?(await A(),M(W("profile.googleConnectSuccess","Google account connected successfully"),"success")):U(W("profile.googleConnectError","Failed to connect Google account"))}catch(l){let e=W("profile.googleConnectError","Failed to connect Google account");(null==l?void 0:l.message.includes("409"))?e=W("profile.googleAlreadyConnected","This Google account is already connected to another user"):l.message&&(e=l.message),U(e)}finally{N(!1)}}else U(W("profile.invalidGoogleToken","Invalid Google access token"))}})})]})]}),(null==E?void 0:E.created_at)&&l.jsx(i,{sx:{display:"flex",justifyContent:"flex-start",alignItems:"left",pt:2},children:l.jsxs(r,{variant:"body2",color:"text.secondary",children:[W("profile.memberSince")," ",new Date(E.created_at).toLocaleDateString(W("locale"),{dateStyle:"short"})]})})]}),l.jsx(i,{sx:{p:3,pt:0,display:"flex",justifyContent:"space-between",alignItems:"center",gap:2},children:l.jsx(a,{variant:"text",startIcon:l.jsx(D,{}),onClick:()=>Z(!0),color:"error",size:"small",children:W("auth.signOut","Sign Out")})})]})}),l.jsxs(d,{open:X,onClose:()=>!re&&Y(!1),"aria-labelledby":"edit-dialog-title",maxWidth:"sm",fullWidth:!0,children:[l.jsx(x,{id:"edit-dialog-title",children:W("profile.editProfile")}),l.jsx(g,{children:l.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[l.jsx(p,{label:W("profile.firstName"),value:ie,onChange:e=>se(e.target.value),fullWidth:!0,disabled:re}),l.jsx(p,{label:W("profile.lastName"),value:oe,onChange:e=>ne(e.target.value),fullWidth:!0,disabled:re})]})}),l.jsxs(m,{children:[l.jsx(a,{onClick:()=>Y(!1),disabled:re,children:W("profile.cancel")}),l.jsx(a,{onClick:async()=>{ae(!0);try{const e={first_name:ie.trim()||null,last_name:oe.trim()||null};await k.users.updateMe(e),await A(),Y(!1),M(W("profile.updateSuccess","Profile updated successfully"),"success")}catch(e){U(W("profile.updateError","Failed to update profile"))}finally{ae(!1)}},variant:"contained",disabled:re,children:W(re?"profile.saving":"profile.save")})]})]}),l.jsxs(d,{open:q,onClose:()=>Z(!1),"aria-labelledby":"logout-dialog-title","aria-describedby":"logout-dialog-description",children:[l.jsx(x,{id:"logout-dialog-title",children:W("auth.confirmSignOut")}),l.jsx(g,{children:l.jsx(u,{id:"logout-dialog-description",children:W("auth.confirmSignOutMessage")})}),l.jsxs(m,{children:[l.jsx(a,{onClick:()=>Z(!1),color:"primary",children:W("auth.cancel")}),l.jsx(a,{onClick:()=>{Z(!1),B()},color:"error",variant:"contained",children:W("auth.signOut")})]})]}),l.jsxs(d,{open:$,onClose:()=>H(!1),"aria-labelledby":"telegram-disconnect-dialog-title","aria-describedby":"telegram-disconnect-dialog-description",children:[l.jsx(x,{id:"telegram-disconnect-dialog-title",children:W("profile.confirmTelegramDisconnect")}),l.jsx(g,{children:l.jsx(u,{id:"telegram-disconnect-dialog-description",children:W("profile.confirmTelegramDisconnectMessage")})}),l.jsxs(m,{children:[l.jsx(a,{onClick:()=>H(!1),color:"primary",children:W("profile.cancel")}),l.jsx(a,{onClick:async()=>{H(!1),await(async()=>{await k.users.disconnectTelegram(),await A()})()},color:"error",variant:"contained",children:W("profile.disconnect")})]})]}),l.jsxs(d,{open:J,onClose:()=>K(!1),"aria-labelledby":"google-disconnect-dialog-title","aria-describedby":"google-disconnect-dialog-description",children:[l.jsx(x,{id:"google-disconnect-dialog-title",children:W("profile.confirmGoogleDisconnect")}),l.jsx(g,{children:l.jsx(u,{id:"google-disconnect-dialog-description",children:W("profile.confirmGoogleDisconnectMessage")})}),l.jsxs(m,{children:[l.jsx(a,{onClick:()=>K(!1),color:"primary",children:W("profile.cancel")}),l.jsx(a,{onClick:async()=>{K(!1),await(async()=>{await k.users.disconnectGoogle(),await A()})()},color:"error",variant:"contained",children:W("profile.disconnect")})]})]}),l.jsxs(d,{open:Q,onClose:()=>V(!1),"aria-labelledby":"to-student-dialog-title","aria-describedby":"to-student-dialog-description",children:[l.jsx(x,{id:"to-student-dialog-title",children:W("profile.confirmToStudent")}),l.jsx(g,{children:l.jsx(u,{id:"to-student-dialog-description",children:W("profile.confirmToStudentMessage")})}),l.jsxs(m,{children:[l.jsx(a,{onClick:()=>V(!1),color:"primary",children:W("profile.cancel")}),l.jsx(a,{onClick:ge,color:"error",variant:"contained",children:W("profile.switchRole")})]})]}),l.jsxs(d,{open:ee,onClose:()=>!de&&le(!1),maxWidth:"sm",fullWidth:!0,children:[l.jsx(x,{children:W("home.upgrade.title")}),l.jsx(g,{children:l.jsx(p,{autoFocus:!0,margin:"dense",label:W("home.upgrade.description"),type:"text",fullWidth:!0,multiline:!0,rows:3,value:te,onChange:e=>ce(e.target.value),disabled:de})}),l.jsxs(m,{children:[l.jsx(a,{onClick:()=>le(!1),disabled:de,children:W("common.actions.cancel")}),l.jsx(a,{onClick:()=>{ge()},startIcon:l.jsx(I,{}),variant:"contained",disabled:de,children:W(de?"common.loading":"common.actions.send")})]})]})]}):l.jsx(i,{sx:{p:3},children:l.jsx(s,{severity:"error",children:W("profile.noUser","User not found")})})};export{W as default};
