const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./markdownExport-CMeO6xSy.js","./main-GnUV1Kn9.js","./vendor-5I4LDDhx.js","./main-Uetmd9Uh.css","./dayjs.min-DyaA-rH1.js"])))=>i.map(i=>d[i]);
import{u as e,a as t,b as s,U as a,c as n,S as r,C as i,F as o,D as l,P as c,A as d,d as u,e as m,f as h,L as p,E as f,M as x,T as g,g as y,_ as v,h as _,i as j,j as b,I as k,k as w,R as C,l as S,m as T,n as I,o as Z,B as A,W as E,p as O,q as F,r as P,O as N,s as R,t as z,v as $,w as D,x as M,y as L,z as W,G as B,H as U,J as V,K,N as q,Q as H,V as G,X as J,Y,Z as Q,$ as X,a0 as ee,a1 as te,a2 as se,a3 as ae,a4 as ne,a5 as re,a6 as ie,a7 as oe,a8 as le,a9 as ce,aa as de,ab as ue,ac as me,ad as he,ae as pe,af as fe,ag as xe,ah as ge,ai as ye,aj as ve,ak as _e,al as je,am as be,an as ke,ao as we,ap as Ce,aq as Se,ar as Te,as as Ie,at as Ze,au as Ae,av as Ee,aw as Oe,ax as Fe,ay as Pe}from"./main-GnUV1Kn9.js";import{a5 as Ne,ad as Re,r as ze,j as $e,d as De,e as Me,L as Le,H as We,B as Be,u as Ue,n as Ve,x as Ke,w as qe,$ as He,v as Ge,f as Je,I as Ye,h as Qe,ag as Xe,ah as et,C as tt,b as st,a0 as at,a1 as nt,a3 as rt,M as it,D as ot,i as lt,l as ct,m as dt,X as ut,Y as mt,N as ht,ac as pt,G as ft,J as xt,ai as gt,ab as yt,aj as vt,z as _t,E as jt,K as bt,ak as kt,al as wt,A as Ct,y as St,V as Tt,am as It,W as Zt}from"./vendor-5I4LDDhx.js";var At,Et,Ot;(Et=At||(At={})).assertEqual=e=>e,Et.assertIs=function(e){},Et.assertNever=function(e){throw new Error},Et.arrayToEnum=e=>{const t={};for(const s of e)t[s]=s;return t},Et.getValidEnumValues=e=>{const t=Et.objectKeys(e).filter((t=>"number"!=typeof e[e[t]])),s={};for(const a of t)s[a]=e[a];return Et.objectValues(s)},Et.objectValues=e=>Et.objectKeys(e).map((function(t){return e[t]})),Et.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.push(s);return t},Et.find=(e,t)=>{for(const s of e)if(t(s))return s},Et.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,Et.joinValues=function(e,t=" | "){return e.map((e=>"string"==typeof e?`'${e}'`:e)).join(t)},Et.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t,(Ot||(Ot={})).mergeShapes=(e,t)=>({...e,...t});const Ft=At.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Pt=e=>{switch(typeof e){case"undefined":return Ft.undefined;case"string":return Ft.string;case"number":return isNaN(e)?Ft.nan:Ft.number;case"boolean":return Ft.boolean;case"function":return Ft.function;case"bigint":return Ft.bigint;case"symbol":return Ft.symbol;case"object":return Array.isArray(e)?Ft.array:null===e?Ft.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?Ft.promise:"undefined"!=typeof Map&&e instanceof Map?Ft.map:"undefined"!=typeof Set&&e instanceof Set?Ft.set:"undefined"!=typeof Date&&e instanceof Date?Ft.date:Ft.object;default:return Ft.unknown}},Nt=At.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Rt extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(e){return e.message},s={_errors:[]},a=e=>{for(const n of e.issues)if("invalid_union"===n.code)n.unionErrors.map(a);else if("invalid_return_type"===n.code)a(n.returnTypeError);else if("invalid_arguments"===n.code)a(n.argumentsError);else if(0===n.path.length)s._errors.push(t(n));else{let e=s,a=0;for(;a<n.path.length;){const s=n.path[a];a===n.path.length-1?(e[s]=e[s]||{_errors:[]},e[s]._errors.push(t(n))):e[s]=e[s]||{_errors:[]},e=e[s],a++}}};return a(this),s}static assert(e){if(!(e instanceof Rt))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,At.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){const t={},s=[];for(const a of this.issues)a.path.length>0?(t[a.path[0]]=t[a.path[0]]||[],t[a.path[0]].push(e(a))):s.push(e(a));return{formErrors:s,fieldErrors:t}}get formErrors(){return this.flatten()}}Rt.create=e=>new Rt(e);const zt=(e,t)=>{let s;switch(e.code){case Nt.invalid_type:s=e.received===Ft.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case Nt.invalid_literal:s=`Invalid literal value, expected ${JSON.stringify(e.expected,At.jsonStringifyReplacer)}`;break;case Nt.unrecognized_keys:s=`Unrecognized key(s) in object: ${At.joinValues(e.keys,", ")}`;break;case Nt.invalid_union:s="Invalid input";break;case Nt.invalid_union_discriminator:s=`Invalid discriminator value. Expected ${At.joinValues(e.options)}`;break;case Nt.invalid_enum_value:s=`Invalid enum value. Expected ${At.joinValues(e.options)}, received '${e.received}'`;break;case Nt.invalid_arguments:s="Invalid function arguments";break;case Nt.invalid_return_type:s="Invalid function return type";break;case Nt.invalid_date:s="Invalid date";break;case Nt.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(s=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(s=`${s} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?s=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?s=`Invalid input: must end with "${e.validation.endsWith}"`:At.assertNever(e.validation):s="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case Nt.too_small:s="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case Nt.too_big:s="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case Nt.custom:s="Invalid input";break;case Nt.invalid_intersection_types:s="Intersection results could not be merged";break;case Nt.not_multiple_of:s=`Number must be a multiple of ${e.multipleOf}`;break;case Nt.not_finite:s="Number must be finite";break;default:s=t.defaultError,At.assertNever(e)}return{message:s}};let $t=zt;function Dt(){return $t}const Mt=e=>{const{data:t,path:s,errorMaps:a,issueData:n}=e,r=[...s,...n.path||[]],i={...n,path:r};if(void 0!==n.message)return{...n,path:r,message:n.message};let o="";const l=a.filter((e=>!!e)).slice().reverse();for(const c of l)o=c(i,{data:t,defaultError:o}).message;return{...n,path:r,message:o}};function Lt(e,t){const s=Dt(),a=Mt({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,s,s===zt?void 0:zt].filter((e=>!!e))});e.common.issues.push(a)}class Wt{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const s=[];for(const a of t){if("aborted"===a.status)return Bt;"dirty"===a.status&&e.dirty(),s.push(a.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,t){const s=[];for(const a of t){const e=await a.key,t=await a.value;s.push({key:e,value:t})}return Wt.mergeObjectSync(e,s)}static mergeObjectSync(e,t){const s={};for(const a of t){const{key:t,value:n}=a;if("aborted"===t.status)return Bt;if("aborted"===n.status)return Bt;"dirty"===t.status&&e.dirty(),"dirty"===n.status&&e.dirty(),"__proto__"===t.value||void 0===n.value&&!a.alwaysSet||(s[t.value]=n.value)}return{status:e.value,value:s}}}const Bt=Object.freeze({status:"aborted"}),Ut=e=>({status:"dirty",value:e}),Vt=e=>({status:"valid",value:e}),Kt=e=>"aborted"===e.status,qt=e=>"dirty"===e.status,Ht=e=>"valid"===e.status,Gt=e=>"undefined"!=typeof Promise&&e instanceof Promise;function Jt(e,t,s,a){if("function"==typeof t||!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t.get(e)}function Yt(e,t,s,a,n){if("function"==typeof t||!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,s),s}var Qt,Xt,es,ts;"function"==typeof SuppressedError&&SuppressedError,(Xt=Qt||(Qt={})).errToObj=e=>"string"==typeof e?{message:e}:e||{},Xt.toString=e=>"string"==typeof e?e:null==e?void 0:e.message;class ss{constructor(e,t,s,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=s,this._key=a}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const as=(e,t)=>{if(Ht(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Rt(e.common.issues);return this._error=t,this._error}}};function ns(e){if(!e)return{};const{errorMap:t,invalid_type_error:s,required_error:a,description:n}=e;if(t&&(s||a))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');if(t)return{errorMap:t,description:n};return{errorMap:(t,n)=>{var r,i;const{message:o}=e;return"invalid_enum_value"===t.code?{message:null!=o?o:n.defaultError}:void 0===n.data?{message:null!==(r=null!=o?o:a)&&void 0!==r?r:n.defaultError}:"invalid_type"!==t.code?{message:n.defaultError}:{message:null!==(i=null!=o?o:s)&&void 0!==i?i:n.defaultError}},description:n}}class rs{get description(){return this._def.description}_getType(e){return Pt(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Pt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Wt,ctx:{common:e.parent.common,data:e.data,parsedType:Pt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Gt(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const s=this.safeParse(e,t);if(s.success)return s.data;throw s.error}safeParse(e,t){var s;const a={common:{issues:[],async:null!==(s=null==t?void 0:t.async)&&void 0!==s&&s,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pt(e)},n=this._parseSync({data:e,path:a.path,parent:a});return as(a,n)}"~validate"(e){var t,s;const a={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pt(e)};if(!this["~standard"].async)try{const t=this._parseSync({data:e,path:[],parent:a});return Ht(t)?{value:t.value}:{issues:a.common.issues}}catch(n){(null===(s=null===(t=null==n?void 0:n.message)||void 0===t?void 0:t.toLowerCase())||void 0===s?void 0:s.includes("encountered"))&&(this["~standard"].async=!0),a.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:a}).then((e=>Ht(e)?{value:e.value}:{issues:a.common.issues}))}async parseAsync(e,t){const s=await this.safeParseAsync(e,t);if(s.success)return s.data;throw s.error}async safeParseAsync(e,t){const s={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pt(e)},a=this._parse({data:e,path:s.path,parent:s}),n=await(Gt(a)?a:Promise.resolve(a));return as(s,n)}refine(e,t){const s=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement(((t,a)=>{const n=e(t),r=()=>a.addIssue({code:Nt.custom,...s(t)});return"undefined"!=typeof Promise&&n instanceof Promise?n.then((e=>!!e||(r(),!1))):!!n||(r(),!1)}))}refinement(e,t){return this._refinement(((s,a)=>!!e(s)||(a.addIssue("function"==typeof t?t(s,a):t),!1)))}_refinement(e){return new ra({schema:this,typeName:ya.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return ia.create(this,this._def)}nullable(){return oa.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ms.create(this)}promise(){return na.create(this,this._def)}or(e){return Bs.create([this,e],this._def)}and(e){return qs.create(this,e,this._def)}transform(e){return new ra({...ns(this._def),schema:this,typeName:ya.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new la({...ns(this._def),innerType:this,defaultValue:t,typeName:ya.ZodDefault})}brand(){return new ma({typeName:ya.ZodBranded,type:this,...ns(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new ca({...ns(this._def),innerType:this,catchValue:t,typeName:ya.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return ha.create(this,e)}readonly(){return pa.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const is=/^c[^\s-]{8,}$/i,os=/^[0-9a-z]+$/,ls=/^[0-9A-HJKMNP-TV-Z]{26}$/i,cs=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,ds=/^[a-z0-9_-]{21}$/i,us=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,ms=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,hs=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let ps;const fs=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,xs=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,gs=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,ys=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,vs=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,_s=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,js="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",bs=new RegExp(`^${js}$`);function ks(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${e.precision?"+":"?"}`}function ws(e){let t=`${js}T${ks(e)}`;const s=[];return s.push(e.local?"Z?":"Z"),e.offset&&s.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${s.join("|")})`,new RegExp(`^${t}$`)}function Cs(e,t){if(!us.test(e))return!1;try{const[s]=e.split("."),a=s.replace(/-/g,"+").replace(/_/g,"/").padEnd(s.length+(4-s.length%4)%4,"="),n=JSON.parse(atob(a));return"object"==typeof n&&null!==n&&(!(!n.typ||!n.alg)&&(!t||n.alg===t))}catch(s){return!1}}function Ss(e,t){return!("v4"!==t&&t||!xs.test(e))||!("v6"!==t&&t||!ys.test(e))}class Ts extends rs{_parse(e){this._def.coerce&&(e.data=String(e.data));if(this._getType(e)!==Ft.string){const t=this._getOrReturnCtx(e);return Lt(t,{code:Nt.invalid_type,expected:Ft.string,received:t.parsedType}),Bt}const t=new Wt;let s;for(const i of this._def.checks)if("min"===i.kind)e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),Lt(s,{code:Nt.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),t.dirty());else if("max"===i.kind)e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),Lt(s,{code:Nt.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),t.dirty());else if("length"===i.kind){const a=e.data.length>i.value,n=e.data.length<i.value;(a||n)&&(s=this._getOrReturnCtx(e,s),a?Lt(s,{code:Nt.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):n&&Lt(s,{code:Nt.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),t.dirty())}else if("email"===i.kind)hs.test(e.data)||(s=this._getOrReturnCtx(e,s),Lt(s,{validation:"email",code:Nt.invalid_string,message:i.message}),t.dirty());else if("emoji"===i.kind)ps||(ps=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),ps.test(e.data)||(s=this._getOrReturnCtx(e,s),Lt(s,{validation:"emoji",code:Nt.invalid_string,message:i.message}),t.dirty());else if("uuid"===i.kind)cs.test(e.data)||(s=this._getOrReturnCtx(e,s),Lt(s,{validation:"uuid",code:Nt.invalid_string,message:i.message}),t.dirty());else if("nanoid"===i.kind)ds.test(e.data)||(s=this._getOrReturnCtx(e,s),Lt(s,{validation:"nanoid",code:Nt.invalid_string,message:i.message}),t.dirty());else if("cuid"===i.kind)is.test(e.data)||(s=this._getOrReturnCtx(e,s),Lt(s,{validation:"cuid",code:Nt.invalid_string,message:i.message}),t.dirty());else if("cuid2"===i.kind)os.test(e.data)||(s=this._getOrReturnCtx(e,s),Lt(s,{validation:"cuid2",code:Nt.invalid_string,message:i.message}),t.dirty());else if("ulid"===i.kind)ls.test(e.data)||(s=this._getOrReturnCtx(e,s),Lt(s,{validation:"ulid",code:Nt.invalid_string,message:i.message}),t.dirty());else if("url"===i.kind)try{new URL(e.data)}catch(r){s=this._getOrReturnCtx(e,s),Lt(s,{validation:"url",code:Nt.invalid_string,message:i.message}),t.dirty()}else if("regex"===i.kind){i.regex.lastIndex=0;i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),Lt(s,{validation:"regex",code:Nt.invalid_string,message:i.message}),t.dirty())}else if("trim"===i.kind)e.data=e.data.trim();else if("includes"===i.kind)e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),Lt(s,{code:Nt.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),t.dirty());else if("toLowerCase"===i.kind)e.data=e.data.toLowerCase();else if("toUpperCase"===i.kind)e.data=e.data.toUpperCase();else if("startsWith"===i.kind)e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),Lt(s,{code:Nt.invalid_string,validation:{startsWith:i.value},message:i.message}),t.dirty());else if("endsWith"===i.kind)e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),Lt(s,{code:Nt.invalid_string,validation:{endsWith:i.value},message:i.message}),t.dirty());else if("datetime"===i.kind){ws(i).test(e.data)||(s=this._getOrReturnCtx(e,s),Lt(s,{code:Nt.invalid_string,validation:"datetime",message:i.message}),t.dirty())}else if("date"===i.kind){bs.test(e.data)||(s=this._getOrReturnCtx(e,s),Lt(s,{code:Nt.invalid_string,validation:"date",message:i.message}),t.dirty())}else if("time"===i.kind){new RegExp(`^${ks(i)}$`).test(e.data)||(s=this._getOrReturnCtx(e,s),Lt(s,{code:Nt.invalid_string,validation:"time",message:i.message}),t.dirty())}else"duration"===i.kind?ms.test(e.data)||(s=this._getOrReturnCtx(e,s),Lt(s,{validation:"duration",code:Nt.invalid_string,message:i.message}),t.dirty()):"ip"===i.kind?(a=e.data,("v4"!==(n=i.version)&&n||!fs.test(a))&&("v6"!==n&&n||!gs.test(a))&&(s=this._getOrReturnCtx(e,s),Lt(s,{validation:"ip",code:Nt.invalid_string,message:i.message}),t.dirty())):"jwt"===i.kind?Cs(e.data,i.alg)||(s=this._getOrReturnCtx(e,s),Lt(s,{validation:"jwt",code:Nt.invalid_string,message:i.message}),t.dirty()):"cidr"===i.kind?Ss(e.data,i.version)||(s=this._getOrReturnCtx(e,s),Lt(s,{validation:"cidr",code:Nt.invalid_string,message:i.message}),t.dirty()):"base64"===i.kind?vs.test(e.data)||(s=this._getOrReturnCtx(e,s),Lt(s,{validation:"base64",code:Nt.invalid_string,message:i.message}),t.dirty()):"base64url"===i.kind?_s.test(e.data)||(s=this._getOrReturnCtx(e,s),Lt(s,{validation:"base64url",code:Nt.invalid_string,message:i.message}),t.dirty()):At.assertNever(i);var a,n;return{status:t.value,value:e.data}}_regex(e,t,s){return this.refinement((t=>e.test(t)),{validation:t,code:Nt.invalid_string,...Qt.errToObj(s)})}_addCheck(e){return new Ts({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Qt.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Qt.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Qt.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Qt.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...Qt.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Qt.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Qt.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Qt.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...Qt.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...Qt.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...Qt.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Qt.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...Qt.errToObj(e)})}datetime(e){var t,s;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,local:null!==(s=null==e?void 0:e.local)&&void 0!==s&&s,...Qt.errToObj(null==e?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,...Qt.errToObj(null==e?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...Qt.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...Qt.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...Qt.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...Qt.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...Qt.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...Qt.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...Qt.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...Qt.errToObj(t)})}nonempty(e){return this.min(1,Qt.errToObj(e))}trim(){return new Ts({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Ts({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Ts({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((e=>"datetime"===e.kind))}get isDate(){return!!this._def.checks.find((e=>"date"===e.kind))}get isTime(){return!!this._def.checks.find((e=>"time"===e.kind))}get isDuration(){return!!this._def.checks.find((e=>"duration"===e.kind))}get isEmail(){return!!this._def.checks.find((e=>"email"===e.kind))}get isURL(){return!!this._def.checks.find((e=>"url"===e.kind))}get isEmoji(){return!!this._def.checks.find((e=>"emoji"===e.kind))}get isUUID(){return!!this._def.checks.find((e=>"uuid"===e.kind))}get isNANOID(){return!!this._def.checks.find((e=>"nanoid"===e.kind))}get isCUID(){return!!this._def.checks.find((e=>"cuid"===e.kind))}get isCUID2(){return!!this._def.checks.find((e=>"cuid2"===e.kind))}get isULID(){return!!this._def.checks.find((e=>"ulid"===e.kind))}get isIP(){return!!this._def.checks.find((e=>"ip"===e.kind))}get isCIDR(){return!!this._def.checks.find((e=>"cidr"===e.kind))}get isBase64(){return!!this._def.checks.find((e=>"base64"===e.kind))}get isBase64url(){return!!this._def.checks.find((e=>"base64url"===e.kind))}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function Is(e,t){const s=(e.toString().split(".")[1]||"").length,a=(t.toString().split(".")[1]||"").length,n=s>a?s:a;return parseInt(e.toFixed(n).replace(".",""))%parseInt(t.toFixed(n).replace(".",""))/Math.pow(10,n)}Ts.create=e=>{var t;return new Ts({checks:[],typeName:ya.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...ns(e)})};class Zs extends rs{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){this._def.coerce&&(e.data=Number(e.data));if(this._getType(e)!==Ft.number){const t=this._getOrReturnCtx(e);return Lt(t,{code:Nt.invalid_type,expected:Ft.number,received:t.parsedType}),Bt}let t;const s=new Wt;for(const a of this._def.checks)if("int"===a.kind)At.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),Lt(t,{code:Nt.invalid_type,expected:"integer",received:"float",message:a.message}),s.dirty());else if("min"===a.kind){(a.inclusive?e.data<a.value:e.data<=a.value)&&(t=this._getOrReturnCtx(e,t),Lt(t,{code:Nt.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty())}else if("max"===a.kind){(a.inclusive?e.data>a.value:e.data>=a.value)&&(t=this._getOrReturnCtx(e,t),Lt(t,{code:Nt.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty())}else"multipleOf"===a.kind?0!==Is(e.data,a.value)&&(t=this._getOrReturnCtx(e,t),Lt(t,{code:Nt.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):"finite"===a.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),Lt(t,{code:Nt.not_finite,message:a.message}),s.dirty()):At.assertNever(a);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Qt.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Qt.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Qt.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Qt.toString(t))}setLimit(e,t,s,a){return new Zs({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:Qt.toString(a)}]})}_addCheck(e){return new Zs({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Qt.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Qt.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Qt.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Qt.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Qt.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Qt.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:Qt.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Qt.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Qt.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find((e=>"int"===e.kind||"multipleOf"===e.kind&&At.isInteger(e.value)))}get isFinite(){let e=null,t=null;for(const s of this._def.checks){if("finite"===s.kind||"int"===s.kind||"multipleOf"===s.kind)return!0;"min"===s.kind?(null===t||s.value>t)&&(t=s.value):"max"===s.kind&&(null===e||s.value<e)&&(e=s.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Zs.create=e=>new Zs({checks:[],typeName:ya.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...ns(e)});class As extends rs{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch(a){return this._getInvalidInput(e)}if(this._getType(e)!==Ft.bigint)return this._getInvalidInput(e);let t;const s=new Wt;for(const n of this._def.checks)if("min"===n.kind){(n.inclusive?e.data<n.value:e.data<=n.value)&&(t=this._getOrReturnCtx(e,t),Lt(t,{code:Nt.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),s.dirty())}else if("max"===n.kind){(n.inclusive?e.data>n.value:e.data>=n.value)&&(t=this._getOrReturnCtx(e,t),Lt(t,{code:Nt.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),s.dirty())}else"multipleOf"===n.kind?e.data%n.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),Lt(t,{code:Nt.not_multiple_of,multipleOf:n.value,message:n.message}),s.dirty()):At.assertNever(n);return{status:s.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return Lt(t,{code:Nt.invalid_type,expected:Ft.bigint,received:t.parsedType}),Bt}gte(e,t){return this.setLimit("min",e,!0,Qt.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Qt.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Qt.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Qt.toString(t))}setLimit(e,t,s,a){return new As({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:Qt.toString(a)}]})}_addCheck(e){return new As({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Qt.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Qt.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Qt.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Qt.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Qt.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}As.create=e=>{var t;return new As({checks:[],typeName:ya.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...ns(e)})};class Es extends rs{_parse(e){this._def.coerce&&(e.data=Boolean(e.data));if(this._getType(e)!==Ft.boolean){const t=this._getOrReturnCtx(e);return Lt(t,{code:Nt.invalid_type,expected:Ft.boolean,received:t.parsedType}),Bt}return Vt(e.data)}}Es.create=e=>new Es({typeName:ya.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...ns(e)});class Os extends rs{_parse(e){this._def.coerce&&(e.data=new Date(e.data));if(this._getType(e)!==Ft.date){const t=this._getOrReturnCtx(e);return Lt(t,{code:Nt.invalid_type,expected:Ft.date,received:t.parsedType}),Bt}if(isNaN(e.data.getTime())){return Lt(this._getOrReturnCtx(e),{code:Nt.invalid_date}),Bt}const t=new Wt;let s;for(const a of this._def.checks)"min"===a.kind?e.data.getTime()<a.value&&(s=this._getOrReturnCtx(e,s),Lt(s,{code:Nt.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),t.dirty()):"max"===a.kind?e.data.getTime()>a.value&&(s=this._getOrReturnCtx(e,s),Lt(s,{code:Nt.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),t.dirty()):At.assertNever(a);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Os({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:Qt.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:Qt.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}Os.create=e=>new Os({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:ya.ZodDate,...ns(e)});class Fs extends rs{_parse(e){if(this._getType(e)!==Ft.symbol){const t=this._getOrReturnCtx(e);return Lt(t,{code:Nt.invalid_type,expected:Ft.symbol,received:t.parsedType}),Bt}return Vt(e.data)}}Fs.create=e=>new Fs({typeName:ya.ZodSymbol,...ns(e)});class Ps extends rs{_parse(e){if(this._getType(e)!==Ft.undefined){const t=this._getOrReturnCtx(e);return Lt(t,{code:Nt.invalid_type,expected:Ft.undefined,received:t.parsedType}),Bt}return Vt(e.data)}}Ps.create=e=>new Ps({typeName:ya.ZodUndefined,...ns(e)});class Ns extends rs{_parse(e){if(this._getType(e)!==Ft.null){const t=this._getOrReturnCtx(e);return Lt(t,{code:Nt.invalid_type,expected:Ft.null,received:t.parsedType}),Bt}return Vt(e.data)}}Ns.create=e=>new Ns({typeName:ya.ZodNull,...ns(e)});class Rs extends rs{constructor(){super(...arguments),this._any=!0}_parse(e){return Vt(e.data)}}Rs.create=e=>new Rs({typeName:ya.ZodAny,...ns(e)});class zs extends rs{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Vt(e.data)}}zs.create=e=>new zs({typeName:ya.ZodUnknown,...ns(e)});class $s extends rs{_parse(e){const t=this._getOrReturnCtx(e);return Lt(t,{code:Nt.invalid_type,expected:Ft.never,received:t.parsedType}),Bt}}$s.create=e=>new $s({typeName:ya.ZodNever,...ns(e)});class Ds extends rs{_parse(e){if(this._getType(e)!==Ft.undefined){const t=this._getOrReturnCtx(e);return Lt(t,{code:Nt.invalid_type,expected:Ft.void,received:t.parsedType}),Bt}return Vt(e.data)}}Ds.create=e=>new Ds({typeName:ya.ZodVoid,...ns(e)});class Ms extends rs{_parse(e){const{ctx:t,status:s}=this._processInputParams(e),a=this._def;if(t.parsedType!==Ft.array)return Lt(t,{code:Nt.invalid_type,expected:Ft.array,received:t.parsedType}),Bt;if(null!==a.exactLength){const e=t.data.length>a.exactLength.value,n=t.data.length<a.exactLength.value;(e||n)&&(Lt(t,{code:e?Nt.too_big:Nt.too_small,minimum:n?a.exactLength.value:void 0,maximum:e?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),s.dirty())}if(null!==a.minLength&&t.data.length<a.minLength.value&&(Lt(t,{code:Nt.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),s.dirty()),null!==a.maxLength&&t.data.length>a.maxLength.value&&(Lt(t,{code:Nt.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),s.dirty()),t.common.async)return Promise.all([...t.data].map(((e,s)=>a.type._parseAsync(new ss(t,e,t.path,s))))).then((e=>Wt.mergeArray(s,e)));const n=[...t.data].map(((e,s)=>a.type._parseSync(new ss(t,e,t.path,s))));return Wt.mergeArray(s,n)}get element(){return this._def.type}min(e,t){return new Ms({...this._def,minLength:{value:e,message:Qt.toString(t)}})}max(e,t){return new Ms({...this._def,maxLength:{value:e,message:Qt.toString(t)}})}length(e,t){return new Ms({...this._def,exactLength:{value:e,message:Qt.toString(t)}})}nonempty(e){return this.min(1,e)}}function Ls(e){if(e instanceof Ws){const t={};for(const s in e.shape){const a=e.shape[s];t[s]=ia.create(Ls(a))}return new Ws({...e._def,shape:()=>t})}return e instanceof Ms?new Ms({...e._def,type:Ls(e.element)}):e instanceof ia?ia.create(Ls(e.unwrap())):e instanceof oa?oa.create(Ls(e.unwrap())):e instanceof Hs?Hs.create(e.items.map((e=>Ls(e)))):e}Ms.create=(e,t)=>new Ms({type:e,minLength:null,maxLength:null,exactLength:null,typeName:ya.ZodArray,...ns(t)});class Ws extends rs{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=At.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==Ft.object){const t=this._getOrReturnCtx(e);return Lt(t,{code:Nt.invalid_type,expected:Ft.object,received:t.parsedType}),Bt}const{status:t,ctx:s}=this._processInputParams(e),{shape:a,keys:n}=this._getCached(),r=[];if(!(this._def.catchall instanceof $s&&"strip"===this._def.unknownKeys))for(const o in s.data)n.includes(o)||r.push(o);const i=[];for(const o of n){const e=a[o],t=s.data[o];i.push({key:{status:"valid",value:o},value:e._parse(new ss(s,t,s.path,o)),alwaysSet:o in s.data})}if(this._def.catchall instanceof $s){const e=this._def.unknownKeys;if("passthrough"===e)for(const t of r)i.push({key:{status:"valid",value:t},value:{status:"valid",value:s.data[t]}});else if("strict"===e)r.length>0&&(Lt(s,{code:Nt.unrecognized_keys,keys:r}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of r){const a=s.data[t];i.push({key:{status:"valid",value:t},value:e._parse(new ss(s,a,s.path,t)),alwaysSet:t in s.data})}}return s.common.async?Promise.resolve().then((async()=>{const e=[];for(const t of i){const s=await t.key,a=await t.value;e.push({key:s,value:a,alwaysSet:t.alwaysSet})}return e})).then((e=>Wt.mergeObjectSync(t,e))):Wt.mergeObjectSync(t,i)}get shape(){return this._def.shape()}strict(e){return Qt.errToObj,new Ws({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,s)=>{var a,n,r,i;const o=null!==(r=null===(n=(a=this._def).errorMap)||void 0===n?void 0:n.call(a,t,s).message)&&void 0!==r?r:s.defaultError;return"unrecognized_keys"===t.code?{message:null!==(i=Qt.errToObj(e).message)&&void 0!==i?i:o}:{message:o}}}:{}})}strip(){return new Ws({...this._def,unknownKeys:"strip"})}passthrough(){return new Ws({...this._def,unknownKeys:"passthrough"})}extend(e){return new Ws({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Ws({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:ya.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Ws({...this._def,catchall:e})}pick(e){const t={};return At.objectKeys(e).forEach((s=>{e[s]&&this.shape[s]&&(t[s]=this.shape[s])})),new Ws({...this._def,shape:()=>t})}omit(e){const t={};return At.objectKeys(this.shape).forEach((s=>{e[s]||(t[s]=this.shape[s])})),new Ws({...this._def,shape:()=>t})}deepPartial(){return Ls(this)}partial(e){const t={};return At.objectKeys(this.shape).forEach((s=>{const a=this.shape[s];e&&!e[s]?t[s]=a:t[s]=a.optional()})),new Ws({...this._def,shape:()=>t})}required(e){const t={};return At.objectKeys(this.shape).forEach((s=>{if(e&&!e[s])t[s]=this.shape[s];else{let e=this.shape[s];for(;e instanceof ia;)e=e._def.innerType;t[s]=e}})),new Ws({...this._def,shape:()=>t})}keyof(){return ta(At.objectKeys(this.shape))}}Ws.create=(e,t)=>new Ws({shape:()=>e,unknownKeys:"strip",catchall:$s.create(),typeName:ya.ZodObject,...ns(t)}),Ws.strictCreate=(e,t)=>new Ws({shape:()=>e,unknownKeys:"strict",catchall:$s.create(),typeName:ya.ZodObject,...ns(t)}),Ws.lazycreate=(e,t)=>new Ws({shape:e,unknownKeys:"strip",catchall:$s.create(),typeName:ya.ZodObject,...ns(t)});class Bs extends rs{_parse(e){const{ctx:t}=this._processInputParams(e),s=this._def.options;if(t.common.async)return Promise.all(s.map((async e=>{const s={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:s}),ctx:s}}))).then((function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const a of e)if("dirty"===a.result.status)return t.common.issues.push(...a.ctx.common.issues),a.result;const s=e.map((e=>new Rt(e.ctx.common.issues)));return Lt(t,{code:Nt.invalid_union,unionErrors:s}),Bt}));{let e;const a=[];for(const r of s){const s={...t,common:{...t.common,issues:[]},parent:null},n=r._parseSync({data:t.data,path:t.path,parent:s});if("valid"===n.status)return n;"dirty"!==n.status||e||(e={result:n,ctx:s}),s.common.issues.length&&a.push(s.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const n=a.map((e=>new Rt(e)));return Lt(t,{code:Nt.invalid_union,unionErrors:n}),Bt}}get options(){return this._def.options}}Bs.create=(e,t)=>new Bs({options:e,typeName:ya.ZodUnion,...ns(t)});const Us=e=>e instanceof Xs?Us(e.schema):e instanceof ra?Us(e.innerType()):e instanceof ea?[e.value]:e instanceof sa?e.options:e instanceof aa?At.objectValues(e.enum):e instanceof la?Us(e._def.innerType):e instanceof Ps?[void 0]:e instanceof Ns?[null]:e instanceof ia?[void 0,...Us(e.unwrap())]:e instanceof oa?[null,...Us(e.unwrap())]:e instanceof ma||e instanceof pa?Us(e.unwrap()):e instanceof ca?Us(e._def.innerType):[];class Vs extends rs{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Ft.object)return Lt(t,{code:Nt.invalid_type,expected:Ft.object,received:t.parsedType}),Bt;const s=this.discriminator,a=t.data[s],n=this.optionsMap.get(a);return n?t.common.async?n._parseAsync({data:t.data,path:t.path,parent:t}):n._parseSync({data:t.data,path:t.path,parent:t}):(Lt(t,{code:Nt.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),Bt)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,s){const a=new Map;for(const n of t){const t=Us(n.shape[e]);if(!t.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const s of t){if(a.has(s))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(s)}`);a.set(s,n)}}return new Vs({typeName:ya.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:a,...ns(s)})}}function Ks(e,t){const s=Pt(e),a=Pt(t);if(e===t)return{valid:!0,data:e};if(s===Ft.object&&a===Ft.object){const s=At.objectKeys(t),a=At.objectKeys(e).filter((e=>-1!==s.indexOf(e))),n={...e,...t};for(const r of a){const s=Ks(e[r],t[r]);if(!s.valid)return{valid:!1};n[r]=s.data}return{valid:!0,data:n}}if(s===Ft.array&&a===Ft.array){if(e.length!==t.length)return{valid:!1};const s=[];for(let a=0;a<e.length;a++){const n=Ks(e[a],t[a]);if(!n.valid)return{valid:!1};s.push(n.data)}return{valid:!0,data:s}}return s===Ft.date&&a===Ft.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class qs extends rs{_parse(e){const{status:t,ctx:s}=this._processInputParams(e),a=(e,a)=>{if(Kt(e)||Kt(a))return Bt;const n=Ks(e.value,a.value);return n.valid?((qt(e)||qt(a))&&t.dirty(),{status:t.value,value:n.data}):(Lt(s,{code:Nt.invalid_intersection_types}),Bt)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then((([e,t])=>a(e,t))):a(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}}qs.create=(e,t,s)=>new qs({left:e,right:t,typeName:ya.ZodIntersection,...ns(s)});class Hs extends rs{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==Ft.array)return Lt(s,{code:Nt.invalid_type,expected:Ft.array,received:s.parsedType}),Bt;if(s.data.length<this._def.items.length)return Lt(s,{code:Nt.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Bt;!this._def.rest&&s.data.length>this._def.items.length&&(Lt(s,{code:Nt.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const a=[...s.data].map(((e,t)=>{const a=this._def.items[t]||this._def.rest;return a?a._parse(new ss(s,e,s.path,t)):null})).filter((e=>!!e));return s.common.async?Promise.all(a).then((e=>Wt.mergeArray(t,e))):Wt.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new Hs({...this._def,rest:e})}}Hs.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Hs({items:e,typeName:ya.ZodTuple,rest:null,...ns(t)})};class Gs extends rs{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==Ft.object)return Lt(s,{code:Nt.invalid_type,expected:Ft.object,received:s.parsedType}),Bt;const a=[],n=this._def.keyType,r=this._def.valueType;for(const i in s.data)a.push({key:n._parse(new ss(s,i,s.path,i)),value:r._parse(new ss(s,s.data[i],s.path,i)),alwaysSet:i in s.data});return s.common.async?Wt.mergeObjectAsync(t,a):Wt.mergeObjectSync(t,a)}get element(){return this._def.valueType}static create(e,t,s){return new Gs(t instanceof rs?{keyType:e,valueType:t,typeName:ya.ZodRecord,...ns(s)}:{keyType:Ts.create(),valueType:e,typeName:ya.ZodRecord,...ns(t)})}}class Js extends rs{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==Ft.map)return Lt(s,{code:Nt.invalid_type,expected:Ft.map,received:s.parsedType}),Bt;const a=this._def.keyType,n=this._def.valueType,r=[...s.data.entries()].map((([e,t],r)=>({key:a._parse(new ss(s,e,s.path,[r,"key"])),value:n._parse(new ss(s,t,s.path,[r,"value"]))})));if(s.common.async){const e=new Map;return Promise.resolve().then((async()=>{for(const s of r){const a=await s.key,n=await s.value;if("aborted"===a.status||"aborted"===n.status)return Bt;"dirty"!==a.status&&"dirty"!==n.status||t.dirty(),e.set(a.value,n.value)}return{status:t.value,value:e}}))}{const e=new Map;for(const s of r){const a=s.key,n=s.value;if("aborted"===a.status||"aborted"===n.status)return Bt;"dirty"!==a.status&&"dirty"!==n.status||t.dirty(),e.set(a.value,n.value)}return{status:t.value,value:e}}}}Js.create=(e,t,s)=>new Js({valueType:t,keyType:e,typeName:ya.ZodMap,...ns(s)});class Ys extends rs{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==Ft.set)return Lt(s,{code:Nt.invalid_type,expected:Ft.set,received:s.parsedType}),Bt;const a=this._def;null!==a.minSize&&s.data.size<a.minSize.value&&(Lt(s,{code:Nt.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),null!==a.maxSize&&s.data.size>a.maxSize.value&&(Lt(s,{code:Nt.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());const n=this._def.valueType;function r(e){const s=new Set;for(const a of e){if("aborted"===a.status)return Bt;"dirty"===a.status&&t.dirty(),s.add(a.value)}return{status:t.value,value:s}}const i=[...s.data.values()].map(((e,t)=>n._parse(new ss(s,e,s.path,t))));return s.common.async?Promise.all(i).then((e=>r(e))):r(i)}min(e,t){return new Ys({...this._def,minSize:{value:e,message:Qt.toString(t)}})}max(e,t){return new Ys({...this._def,maxSize:{value:e,message:Qt.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Ys.create=(e,t)=>new Ys({valueType:e,minSize:null,maxSize:null,typeName:ya.ZodSet,...ns(t)});class Qs extends rs{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Ft.function)return Lt(t,{code:Nt.invalid_type,expected:Ft.function,received:t.parsedType}),Bt;function s(e,s){return Mt({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Dt(),zt].filter((e=>!!e)),issueData:{code:Nt.invalid_arguments,argumentsError:s}})}function a(e,s){return Mt({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Dt(),zt].filter((e=>!!e)),issueData:{code:Nt.invalid_return_type,returnTypeError:s}})}const n={errorMap:t.common.contextualErrorMap},r=t.data;if(this._def.returns instanceof na){const e=this;return Vt((async function(...t){const i=new Rt([]),o=await e._def.args.parseAsync(t,n).catch((e=>{throw i.addIssue(s(t,e)),i})),l=await Reflect.apply(r,this,o);return await e._def.returns._def.type.parseAsync(l,n).catch((e=>{throw i.addIssue(a(l,e)),i}))}))}{const e=this;return Vt((function(...t){const i=e._def.args.safeParse(t,n);if(!i.success)throw new Rt([s(t,i.error)]);const o=Reflect.apply(r,this,i.data),l=e._def.returns.safeParse(o,n);if(!l.success)throw new Rt([a(o,l.error)]);return l.data}))}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Qs({...this._def,args:Hs.create(e).rest(zs.create())})}returns(e){return new Qs({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,s){return new Qs({args:e||Hs.create([]).rest(zs.create()),returns:t||zs.create(),typeName:ya.ZodFunction,...ns(s)})}}class Xs extends rs{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Xs.create=(e,t)=>new Xs({getter:e,typeName:ya.ZodLazy,...ns(t)});class ea extends rs{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return Lt(t,{received:t.data,code:Nt.invalid_literal,expected:this._def.value}),Bt}return{status:"valid",value:e.data}}get value(){return this._def.value}}function ta(e,t){return new sa({values:e,typeName:ya.ZodEnum,...ns(t)})}ea.create=(e,t)=>new ea({value:e,typeName:ya.ZodLiteral,...ns(t)});class sa extends rs{constructor(){super(...arguments),es.set(this,void 0)}_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),s=this._def.values;return Lt(t,{expected:At.joinValues(s),received:t.parsedType,code:Nt.invalid_type}),Bt}if(Jt(this,es)||Yt(this,es,new Set(this._def.values)),!Jt(this,es).has(e.data)){const t=this._getOrReturnCtx(e),s=this._def.values;return Lt(t,{received:t.data,code:Nt.invalid_enum_value,options:s}),Bt}return Vt(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return sa.create(e,{...this._def,...t})}exclude(e,t=this._def){return sa.create(this.options.filter((t=>!e.includes(t))),{...this._def,...t})}}es=new WeakMap,sa.create=ta;class aa extends rs{constructor(){super(...arguments),ts.set(this,void 0)}_parse(e){const t=At.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==Ft.string&&s.parsedType!==Ft.number){const e=At.objectValues(t);return Lt(s,{expected:At.joinValues(e),received:s.parsedType,code:Nt.invalid_type}),Bt}if(Jt(this,ts)||Yt(this,ts,new Set(At.getValidEnumValues(this._def.values))),!Jt(this,ts).has(e.data)){const e=At.objectValues(t);return Lt(s,{received:s.data,code:Nt.invalid_enum_value,options:e}),Bt}return Vt(e.data)}get enum(){return this._def.values}}ts=new WeakMap,aa.create=(e,t)=>new aa({values:e,typeName:ya.ZodNativeEnum,...ns(t)});class na extends rs{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Ft.promise&&!1===t.common.async)return Lt(t,{code:Nt.invalid_type,expected:Ft.promise,received:t.parsedType}),Bt;const s=t.parsedType===Ft.promise?t.data:Promise.resolve(t.data);return Vt(s.then((e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap}))))}}na.create=(e,t)=>new na({type:e,typeName:ya.ZodPromise,...ns(t)});class ra extends rs{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ya.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:s}=this._processInputParams(e),a=this._def.effect||null,n={addIssue:e=>{Lt(s,e),e.fatal?t.abort():t.dirty()},get path(){return s.path}};if(n.addIssue=n.addIssue.bind(n),"preprocess"===a.type){const e=a.transform(s.data,n);if(s.common.async)return Promise.resolve(e).then((async e=>{if("aborted"===t.value)return Bt;const a=await this._def.schema._parseAsync({data:e,path:s.path,parent:s});return"aborted"===a.status?Bt:"dirty"===a.status||"dirty"===t.value?Ut(a.value):a}));{if("aborted"===t.value)return Bt;const a=this._def.schema._parseSync({data:e,path:s.path,parent:s});return"aborted"===a.status?Bt:"dirty"===a.status||"dirty"===t.value?Ut(a.value):a}}if("refinement"===a.type){const e=e=>{const t=a.refinement(e,n);if(s.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===s.common.async){const a=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return"aborted"===a.status?Bt:("dirty"===a.status&&t.dirty(),e(a.value),{status:t.value,value:a.value})}return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then((s=>"aborted"===s.status?Bt:("dirty"===s.status&&t.dirty(),e(s.value).then((()=>({status:t.value,value:s.value}))))))}if("transform"===a.type){if(!1===s.common.async){const e=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!Ht(e))return e;const r=a.transform(e.value,n);if(r instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:r}}return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then((e=>Ht(e)?Promise.resolve(a.transform(e.value,n)).then((e=>({status:t.value,value:e}))):e))}At.assertNever(a)}}ra.create=(e,t,s)=>new ra({schema:e,typeName:ya.ZodEffects,effect:t,...ns(s)}),ra.createWithPreprocess=(e,t,s)=>new ra({schema:t,effect:{type:"preprocess",transform:e},typeName:ya.ZodEffects,...ns(s)});class ia extends rs{_parse(e){return this._getType(e)===Ft.undefined?Vt(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ia.create=(e,t)=>new ia({innerType:e,typeName:ya.ZodOptional,...ns(t)});class oa extends rs{_parse(e){return this._getType(e)===Ft.null?Vt(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}oa.create=(e,t)=>new oa({innerType:e,typeName:ya.ZodNullable,...ns(t)});class la extends rs{_parse(e){const{ctx:t}=this._processInputParams(e);let s=t.data;return t.parsedType===Ft.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}la.create=(e,t)=>new la({innerType:e,typeName:ya.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...ns(t)});class ca extends rs{_parse(e){const{ctx:t}=this._processInputParams(e),s={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return Gt(a)?a.then((e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new Rt(s.common.issues)},input:s.data})}))):{status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new Rt(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}}ca.create=(e,t)=>new ca({innerType:e,typeName:ya.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...ns(t)});class da extends rs{_parse(e){if(this._getType(e)!==Ft.nan){const t=this._getOrReturnCtx(e);return Lt(t,{code:Nt.invalid_type,expected:Ft.nan,received:t.parsedType}),Bt}return{status:"valid",value:e.data}}}da.create=e=>new da({typeName:ya.ZodNaN,...ns(e)});const ua=Symbol("zod_brand");class ma extends rs{_parse(e){const{ctx:t}=this._processInputParams(e),s=t.data;return this._def.type._parse({data:s,path:t.path,parent:t})}unwrap(){return this._def.type}}class ha extends rs{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.common.async){return(async()=>{const e=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return"aborted"===e.status?Bt:"dirty"===e.status?(t.dirty(),Ut(e.value)):this._def.out._parseAsync({data:e.value,path:s.path,parent:s})})()}{const e=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return"aborted"===e.status?Bt:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:s.path,parent:s})}}static create(e,t){return new ha({in:e,out:t,typeName:ya.ZodPipeline})}}class pa extends rs{_parse(e){const t=this._def.innerType._parse(e),s=e=>(Ht(e)&&(e.value=Object.freeze(e.value)),e);return Gt(t)?t.then((e=>s(e))):s(t)}unwrap(){return this._def.innerType}}function fa(e,t){const s="function"==typeof e?e(t):"string"==typeof e?{message:e}:e;return"string"==typeof s?{message:s}:s}function xa(e,t={},s){return e?Rs.create().superRefine(((a,n)=>{var r,i;const o=e(a);if(o instanceof Promise)return o.then((e=>{var r,i;if(!e){const e=fa(t,a),o=null===(i=null!==(r=e.fatal)&&void 0!==r?r:s)||void 0===i||i;n.addIssue({code:"custom",...e,fatal:o})}}));if(!o){const e=fa(t,a),o=null===(i=null!==(r=e.fatal)&&void 0!==r?r:s)||void 0===i||i;n.addIssue({code:"custom",...e,fatal:o})}})):Rs.create()}pa.create=(e,t)=>new pa({innerType:e,typeName:ya.ZodReadonly,...ns(t)});const ga={object:Ws.lazycreate};var ya,va;(va=ya||(ya={})).ZodString="ZodString",va.ZodNumber="ZodNumber",va.ZodNaN="ZodNaN",va.ZodBigInt="ZodBigInt",va.ZodBoolean="ZodBoolean",va.ZodDate="ZodDate",va.ZodSymbol="ZodSymbol",va.ZodUndefined="ZodUndefined",va.ZodNull="ZodNull",va.ZodAny="ZodAny",va.ZodUnknown="ZodUnknown",va.ZodNever="ZodNever",va.ZodVoid="ZodVoid",va.ZodArray="ZodArray",va.ZodObject="ZodObject",va.ZodUnion="ZodUnion",va.ZodDiscriminatedUnion="ZodDiscriminatedUnion",va.ZodIntersection="ZodIntersection",va.ZodTuple="ZodTuple",va.ZodRecord="ZodRecord",va.ZodMap="ZodMap",va.ZodSet="ZodSet",va.ZodFunction="ZodFunction",va.ZodLazy="ZodLazy",va.ZodLiteral="ZodLiteral",va.ZodEnum="ZodEnum",va.ZodEffects="ZodEffects",va.ZodNativeEnum="ZodNativeEnum",va.ZodOptional="ZodOptional",va.ZodNullable="ZodNullable",va.ZodDefault="ZodDefault",va.ZodCatch="ZodCatch",va.ZodPromise="ZodPromise",va.ZodBranded="ZodBranded",va.ZodPipeline="ZodPipeline",va.ZodReadonly="ZodReadonly";const _a=Ts.create,ja=Zs.create,ba=da.create,ka=As.create,wa=Es.create,Ca=Os.create,Sa=Fs.create,Ta=Ps.create,Ia=Ns.create,Za=Rs.create,Aa=zs.create,Ea=$s.create,Oa=Ds.create,Fa=Ms.create,Pa=Ws.create,Na=Ws.strictCreate,Ra=Bs.create,za=Vs.create,$a=qs.create,Da=Hs.create,Ma=Gs.create,La=Js.create,Wa=Ys.create,Ba=Qs.create,Ua=Xs.create,Va=ea.create,Ka=sa.create,qa=aa.create,Ha=na.create,Ga=ra.create,Ja=ia.create,Ya=oa.create,Qa=ra.createWithPreprocess,Xa=ha.create,en={string:e=>Ts.create({...e,coerce:!0}),number:e=>Zs.create({...e,coerce:!0}),boolean:e=>Es.create({...e,coerce:!0}),bigint:e=>As.create({...e,coerce:!0}),date:e=>Os.create({...e,coerce:!0})},tn=Bt;var sn=Object.freeze({__proto__:null,defaultErrorMap:zt,setErrorMap:function(e){$t=e},getErrorMap:Dt,makeIssue:Mt,EMPTY_PATH:[],addIssueToContext:Lt,ParseStatus:Wt,INVALID:Bt,DIRTY:Ut,OK:Vt,isAborted:Kt,isDirty:qt,isValid:Ht,isAsync:Gt,get util(){return At},get objectUtil(){return Ot},ZodParsedType:Ft,getParsedType:Pt,ZodType:rs,datetimeRegex:ws,ZodString:Ts,ZodNumber:Zs,ZodBigInt:As,ZodBoolean:Es,ZodDate:Os,ZodSymbol:Fs,ZodUndefined:Ps,ZodNull:Ns,ZodAny:Rs,ZodUnknown:zs,ZodNever:$s,ZodVoid:Ds,ZodArray:Ms,ZodObject:Ws,ZodUnion:Bs,ZodDiscriminatedUnion:Vs,ZodIntersection:qs,ZodTuple:Hs,ZodRecord:Gs,ZodMap:Js,ZodSet:Ys,ZodFunction:Qs,ZodLazy:Xs,ZodLiteral:ea,ZodEnum:sa,ZodNativeEnum:aa,ZodPromise:na,ZodEffects:ra,ZodTransformer:ra,ZodOptional:ia,ZodNullable:oa,ZodDefault:la,ZodCatch:ca,ZodNaN:da,BRAND:ua,ZodBranded:ma,ZodPipeline:ha,ZodReadonly:pa,custom:xa,Schema:rs,ZodSchema:rs,late:ga,get ZodFirstPartyTypeKind(){return ya},coerce:en,any:Za,array:Fa,bigint:ka,boolean:wa,date:Ca,discriminatedUnion:za,effect:Ga,enum:Ka,function:Ba,instanceof:(e,t={message:`Input not instance of ${e.name}`})=>xa((t=>t instanceof e),t),intersection:$a,lazy:Ua,literal:Va,map:La,nan:ba,nativeEnum:qa,never:Ea,null:Ia,nullable:Ya,number:ja,object:Pa,oboolean:()=>wa().optional(),onumber:()=>ja().optional(),optional:Ja,ostring:()=>_a().optional(),pipeline:Xa,preprocess:Qa,promise:Ha,record:Ma,set:Wa,strictObject:Na,string:_a,symbol:Sa,transformer:Ga,tuple:Da,undefined:Ta,union:Ra,unknown:Aa,void:Oa,NEVER:tn,ZodIssueCode:Nt,quotelessJson:e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:Rt});const an=sn.object({name:sn.string().min(1,"Tag name is required").max(25,"Tag name must be at most 25 characters")}),nn=sn.object({title:sn.string().min(3,"Title must be at least 3 characters").max(100,"Title must be at most 100 characters"),text:sn.union([sn.string().max(1e5,"Description must be at most 100000 characters"),sn.null()]).optional(),url:sn.union([sn.string().url("Please enter a valid URL").max(500,"URL must be at most 500 characters"),sn.null(),sn.string().max(0)]).optional().transform((e=>""===e?null:e)),tags:sn.array(sn.string().uuid("Invalid tag ID")).default([])}),rn=sn.object({username:sn.string().min(3,"Username must be at least 3 characters").max(50,"Username must be at most 50 characters"),price:sn.number().int("Price must be a whole number").min(0,"Price must be non-negative"),currency:sn.string().min(1,"Currency is required"),balance:sn.number().int("Balance must be a whole number").min(0,"Balance must be non-negative").optional().nullable(),description:sn.union([sn.string().max(1e3,"Description must be at most 1000 characters"),sn.null()]).optional()}),on=sn.object({price:sn.number().int("Price must be a whole number").min(0,"Price must be non-negative"),currency:sn.string().min(1,"Currency is required"),balance:sn.number().int("Balance must be a whole number").min(0,"Balance must be non-negative").optional().nullable(),description:sn.union([sn.string().max(1e3,"Description must be at most 1000 characters"),sn.null()]).optional()}),ln=sn.object({name:sn.string().min(3,"Name must be at least 3 characters").max(100,"Name must be at most 100 characters"),student_id:sn.string().uuid("Invalid student ID"),task_ids:sn.array(sn.string().uuid("Invalid task ID")),redeem_lesson:sn.boolean().optional()});sn.object({status:sn.enum(["todo","done"],{errorMap:()=>({message:'Status must be either "todo" or "done"'})}).optional(),note:sn.union([sn.string().max(1e3,"Note must be at most 1000 characters"),sn.null()]).optional(),order:sn.number().int("Order must be a whole number").min(0,"Order must be non-negative").optional()});const cn=sn.object({title:sn.string().min(1,"Title is required").max(100,"Title must be at most 100 characters"),description:sn.union([sn.string().max(1e3,"Description must be at most 1000 characters"),sn.null()]).optional(),cover:sn.union([sn.string().url("Please enter a valid URL"),sn.null()]).optional(),parent_id:sn.union([sn.string().uuid("Invalid parent folder ID"),sn.null()]).optional()});function dn(e,t){try{return{isValid:!0,errors:{},validatedData:e.parse(t)}}catch(s){if(s instanceof sn.ZodError){const e={};return s.errors.forEach((t=>{const s=t.path.join(".");e[s]=t.message})),{isValid:!1,errors:e}}return{isValid:!1,errors:{form:"Invalid form data"}}}}const un="tasksPageFilters",mn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const _=Ne(),[j]=Re(),{user:b}=e(),{showErrorToast:k}=t(),[w,C]=ze.useState([]),[S,T]=ze.useState([]),[I,Z]=ze.useState(!0),[A,E]=ze.useState(!1),[O,F]=ze.useState(null),[P,N]=ze.useState(0),[R,z]=ze.useState([]),[$,D]=ze.useState(""),[M,L]=ze.useState(""),[W,B]=ze.useState(null),[U,V]=ze.useState(!1),[K,q]=ze.useState(null),[H,G]=ze.useState(null),[J,Y]=ze.useState(!1),[Q,X]=ze.useState(new Set),[ee,te]=ze.useState(!1),[se,ae]=ze.useState(!1),[ne,re]=ze.useState(!1),ie=ze.useRef(!0),oe=Boolean(K),[le,ce]=ze.useState(0),[de,ue]=ze.useState(!0),me=15,he=ze.useRef(null),{t:pe}=s(),fe=(null==b?void 0:b.role)===a.ADMIN,xe=(null==b?void 0:b.role)===a.TEACHER||fe,ge=ze.useCallback((()=>{try{const e=localStorage.getItem(un);if(e){return JSON.parse(e)}}catch(e){}return{searchTerm:"",filterTagIds:[]}}),[]),ye=ze.useCallback((()=>{const e={searchTerm:$,filterTagIds:R.map((e=>e.id))};localStorage.setItem(un,JSON.stringify(e))}),[$,R]);ze.useEffect((()=>{const e=setTimeout((()=>{D(M)}),500);return()=>clearTimeout(e)}),[M]),ze.useEffect((()=>{ie.current||ye()}),[$,R,ye]),ze.useEffect((()=>{(async()=>{if(ie.current){Z(!0),F(null);try{const e=ge(),t=j.get("tag_id"),s=await n.tags.getAll();T(s);let a=[];if(t){const e=s.find((e=>e.id===t));e&&(z([e]),a=[t])}else if(e.filterTagIds.length>0){const t=e.filterTagIds.map((e=>s.find((t=>t.id===e)))).filter((e=>void 0!==e));t.length>0&&(z(t),a=e.filterTagIds)}e.searchTerm&&(D(e.searchTerm),L(e.searchTerm));const r=e.searchTerm||"",i=await n.tasks.getAll(0,me,r,a.join(","));C(i),ce(0),ue(i.length===me),ie.current=!1,F(null)}catch(e){const t=y(e);F(t),k(t)}finally{Z(!1)}}})()}),[P,j,ge]),ze.useEffect((()=>{if(ie.current)return;(async()=>{Z(!0),F(null);try{const e=await n.tasks.getAll(0,me,$,R.map((e=>e.id)).join(","));C(e),ce(0),ue(e.length===me)}catch(e){F("Failed to search tasks. Please try again.")}finally{Z(!1)}})()}),[$,R]),ze.useEffect((()=>{const e=new IntersectionObserver((e=>{const[t]=e;t.isIntersecting&&de&&!I&&!A&&ve()}),{threshold:.5}),t=he.current;return t&&e.observe(t),()=>{t&&e.unobserve(t)}}),[de,I,A]);const ve=async()=>{if(!de||A)return;E(!0);const e=le+1;try{const t=await n.tasks.getAll(e*me,me,$,R.map((e=>e.id)).join(","));if(t.length>0){const s=t.filter((e=>!w.some((t=>t.id===e.id))));C((e=>[...e,...s])),ce(e),ue(t.length===me)}else ue(!1)}catch(t){k("Failed to load more tasks. Please try again.")}finally{E(!1)}},_e=ze.useCallback((()=>{N((e=>e+1))}),[]),je=()=>{localStorage.removeItem(un),D(""),L(""),z([])},be=()=>{V(!1)},ke=(e,t)=>{e.stopPropagation(),q(e.currentTarget),G(t)},we=()=>{q(null)},Ce=()=>{Y(!1),G(null)},Se=e=>{X((t=>{const s=new Set(t);return s.has(e.id)?s.delete(e.id):s.add(e.id),s})),te(!0),V(!1)},Te=()=>{ae(!1)},Ie=[$e.jsxs(De,{onClick:e=>{e.stopPropagation(),Se(H),we()},children:[$e.jsx(Me,{children:$e.jsx(r,{fontSize:"small"})}),$e.jsx(Le,{children:pe("common.actions.select")})]},"select"),$e.jsxs(De,{onClick:()=>{H&&(_(`/tasks/new?copy_task_id=${H.id}`),we())},children:[$e.jsx(Me,{children:$e.jsx(i,{fontSize:"small"})}),$e.jsx(Le,{children:pe("common.actions.copy")})]},"copy"),$e.jsxs(De,{onClick:async()=>{if(H){re(!0);try{const{exportToDocx:e}=await v((async()=>{const{exportToDocx:e}=await import("./markdownExport-CMeO6xSy.js").then((e=>e.bx));return{exportToDocx:e}}),__vite__mapDeps([0,1,2,3,4]),import.meta.url),t=await e(H),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`${H.title}.docx`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s)}catch(e){k("Failed to export task to DOCX. Please try again.")}finally{re(!1),we()}}},disabled:ne,children:[$e.jsx(Me,{children:ne?$e.jsx(We,{size:20}):$e.jsx(o,{fontSize:"small"})}),$e.jsx(Le,{children:pe("common.actions.export")})]},"export"),$e.jsxs(De,{onClick:()=>{we(),Y(!0)},sx:{color:"error.main"},children:[$e.jsx(Me,{children:$e.jsx(l,{fontSize:"small",color:"error"})}),$e.jsx(Le,{children:pe("common.actions.delete")})]},"delete")];return $e.jsxs(Be,{children:[$e.jsx(c,{title:pe("tasks.title"),actionButton:xe?[{label:pe("tasks.actions.createTask"),icon:$e.jsx(d,{}),onClick:()=>_("/tasks/new")}]:void 0}),O&&$e.jsx(Ue,{severity:"error",sx:{mb:2},action:$e.jsx(Ve,{color:"inherit",size:"small",onClick:_e,disabled:I,children:I?"Loading...":"Retry"}),children:O}),$e.jsx(Ke,{sx:{p:2,mb:2},children:$e.jsxs(qe,{spacing:2,children:[$e.jsxs(Be,{sx:{display:"flex",flexDirection:"column",gap:2},children:[$e.jsx(He,{multiple:!0,size:"small",options:S,getOptionLabel:e=>e.name,value:R,onChange:(e,t)=>z(t),renderInput:e=>$e.jsx(Je,{...e,label:pe("tasks.actions.filterByTags"),placeholder:pe("filters.selectTags"),variant:"outlined",InputProps:{...e.InputProps,startAdornment:$e.jsxs($e.Fragment,{children:[$e.jsx(u,{sx:{mr:1,color:"text.secondary"}}),e.InputProps.startAdornment]})}}),renderTags:(e,t)=>e.map(((e,s)=>ze.createElement(Ge,{color:"primary",label:e.name,...t({index:s}),key:e.id})))}),$e.jsx(Be,{sx:{display:"flex",gap:2},children:$e.jsx(Je,{label:pe("tasks.actions.searchByTitle"),placeholder:pe("filters.enterTitle"),variant:"outlined",fullWidth:!0,size:"small",value:M,onChange:e=>{const t=e.target.value;L(t)},InputProps:{startAdornment:$e.jsx(h,{sx:{mr:1,color:"text.secondary"}}),endAdornment:M?$e.jsx(Ye,{position:"end",children:$e.jsx(Qe,{"aria-label":"clear search",onClick:()=>{L(""),D("")},edge:"end",size:"small",children:$e.jsx(m,{fontSize:"small"})})}):null}})})]}),(R.length>0||M)&&$e.jsx(Be,{sx:{display:"flex",justifyContent:"center"},children:$e.jsx(Ve,{variant:"outlined",startIcon:$e.jsx(u,{}),onClick:je,children:pe("common.actions.clear")})})]})}),ee&&$e.jsx(Xe,{position:"static",color:"default",elevation:1,sx:{mb:2},children:$e.jsxs(et,{variant:"dense",children:[$e.jsxs(Be,{sx:{display:"flex",alignItems:"center",gap:1,flex:1},children:[$e.jsx(tt,{edge:"start",checked:Q.size===w.length,indeterminate:Q.size>0&&Q.size<w.length,onChange:()=>{Q.size===w.length?X(new Set):X(new Set(w.map((e=>e.id))))}}),$e.jsx(st,{variant:"body2",children:pe("tasks.selection.selected",{count:Q.size})})]}),$e.jsxs(Be,{sx:{display:"flex"},children:[xe&&$e.jsx(Ve,{color:"error",startIcon:$e.jsx(l,{}),onClick:()=>{ae(!0)},disabled:0===Q.size,children:pe("tasks.selection.deleteCount",{count:Q.size||0})}),$e.jsx(Ve,{onClick:()=>{X(new Set),te(!1)},children:pe("common.actions.cancel")})]})]})}),I?$e.jsx(p,{message:pe("common.loading")}):$e.jsxs($e.Fragment,{children:[O||0!==w.length?$e.jsxs($e.Fragment,{children:[$e.jsx(Be,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)",lg:"repeat(3, 1fr)"},gap:2},children:w.map((e=>$e.jsxs(at,{sx:{height:"100%",cursor:"pointer",position:"relative","&:hover":{boxShadow:6}},onClick:()=>!ee&&(e=>{B(e),V(!0)})(e),children:[ee&&$e.jsx(tt,{edge:"start",checked:Q.has(e.id),onChange:t=>{t.stopPropagation(),Se(e)},sx:{position:"absolute",top:8,right:8,zIndex:1}}),$e.jsx(nt,{sx:{p:2,"&:last-child":{paddingBottom:2}},children:$e.jsxs(Be,{sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:1},children:[$e.jsx(st,{sx:{flex:1,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:1.2},children:e.title}),$e.jsx(Be,{sx:{display:"flex",flexDirection:"row",gap:1,flexShrink:0},children:!ee&&$e.jsxs($e.Fragment,{children:[$e.jsx(Qe,{size:"small",onClick:t=>{t.stopPropagation(),_(`/tasks/${e.id}/edit`)},children:$e.jsx(f,{})}),$e.jsx(Qe,{size:"small",onClick:t=>ke(t,e),children:$e.jsx(x,{})})]})})]})}),e.tags.length>0&&$e.jsx(rt,{sx:{pt:0,px:2,pb:2},children:$e.jsx(Be,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.tags.map((e=>$e.jsx(Ge,{label:e.name,size:"small",variant:"outlined",onClick:t=>{t.stopPropagation(),R.some((t=>t.id===e.id))||z([...R,e])},sx:{cursor:"pointer","&:hover":{backgroundColor:"action.hover"}}},e.id)))})})]},e.id)))}),$e.jsx(Be,{ref:he,sx:{display:"flex",justifyContent:"center",p:2,visibility:de?"visible":"hidden"},children:A&&$e.jsx(We,{size:24})})]}):$e.jsxs(Be,{sx:{textAlign:"center",py:4},children:[$e.jsx(st,{variant:"h6",color:"text.secondary",sx:{mb:1},children:$.length<1&&R.length<1?pe(xe?"tasks.empty.teacher":"tasks.empty.student"):pe("tasks.empty.noMatch")}),xe&&$.length<1&&R.length<1&&$e.jsx(Ve,{variant:"outlined",startIcon:$e.jsx(d,{}),onClick:()=>_("/tasks/new"),sx:{mt:2},children:pe("tasks.actions.createFirst")}),($.length>0||R.length>0)&&$e.jsx(Ve,{variant:"outlined",startIcon:$e.jsx(u,{}),onClick:je,sx:{borderRadius:2,textTransform:"none"},children:pe("common.actions.clear")})]}),$e.jsx(g,{open:U,onClose:be,task:W,hasQuizzes:!1,onValidateAnswers:()=>{},actionButtons:$e.jsxs(Be,{sx:{display:"flex",gap:1,width:"100%",justifyContent:"space-between"},children:[$e.jsx(Be,{sx:{display:"flex",gap:1},children:W&&$e.jsxs($e.Fragment,{children:[$e.jsx(Ve,{size:"small",onClick:e=>ke(e,W),startIcon:$e.jsx(x,{}),children:pe("common.actions.actions")}),$e.jsx(Ve,{size:"small",onClick:e=>{e.stopPropagation(),_(`/tasks/${W.id}/edit`)},startIcon:$e.jsx(f,{}),children:pe("common.actions.edit")})]})}),$e.jsx(Ve,{onClick:be,children:pe("common.actions.close")})]})}),$e.jsx(it,{anchorEl:K,open:oe,onClose:we,onClick:e=>e.stopPropagation(),children:Ie}),$e.jsxs(ot,{open:J,onClose:Ce,maxWidth:"xs",fullWidth:!0,children:[$e.jsx(lt,{children:pe("common.dialog.delete.title",{item:"Task"})}),$e.jsx(ct,{children:$e.jsx(st,{children:pe("common.dialog.delete.message",{name:null==H?void 0:H.title})})}),$e.jsxs(dt,{children:[$e.jsx(Ve,{onClick:Ce,children:pe("common.actions.cancel")}),$e.jsx(Ve,{onClick:async()=>{if(H)try{await n.tasks.delete(H.id),C(w.filter((e=>e.id!==H.id)))}catch(e){const t=e instanceof Error?e.message:"Failed to delete task. Please try again.";k(t)}finally{Y(!1),G(null)}},color:"error",variant:"contained",startIcon:$e.jsx(l,{}),children:pe("common.actions.delete")})]})]}),$e.jsxs(ot,{open:se,onClose:Te,maxWidth:"xs",fullWidth:!0,children:[$e.jsx(lt,{children:pe("common.dialog.delete.title",{item:"Tasks"})}),$e.jsx(ct,{children:$e.jsx(st,{children:pe("common.dialog.delete.messageBulk",{count:Q.size,item:1===Q.size?"task":"tasks"})})}),$e.jsxs(dt,{children:[$e.jsx(Ve,{onClick:Te,children:pe("common.actions.cancel")}),$e.jsxs(Ve,{onClick:async()=>{try{await n.tasks.batchDelete(Array.from(Q));C(w.filter((e=>!Q.has(e.id)))),X(new Set),te(!1)}catch(e){const t=e instanceof Error?e.message:"Failed to delete tasks. Please try again.";k(t)}finally{ae(!1)}},color:"error",variant:"contained",startIcon:$e.jsx(l,{}),children:[pe("common.actions.delete")," ",Q.size," ",1===Q.size?"task":"tasks"]})]})]})]})]})}},Symbol.toStringTag,{value:"Module"})),hn=({editorRef:e,formData:a,setFormData:r,setGeneratedImage:i,setInitText:o,onClose:l})=>{const{t:c}=s(),[d,u]=ze.useState(""),[m,h]=ze.useState(!1),[p,f]=ze.useState([]),[g,y]=ze.useState(null),[v,S]=ze.useState(null),[T,I]=ze.useState(!1),[Z,A]=ze.useState("text"),{showErrorToast:E}=t(),O=()=>{y(null),S(null)},F=async(t,s)=>{const n={id:Date.now().toString(),message:"",text:a.text,timestamp:new Date,status:"done",image:s,type:Z};f((e=>[n,...e]));const i=`\n${t}\n`,o=a.text+i;r((e=>({...e,text:o}))),e.current&&(e.current.setMarkdown(o),e.current.focus())};return $e.jsxs(Ke,{sx:{width:"350px",display:"flex",flexDirection:"column",overflow:"hidden",...(m||T)&&{position:"relative","&::before":{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(45deg, transparent 30%, rgba(25, 118, 210, 0.08) 50%, transparent 70%)",backgroundSize:"400% 400%",borderRadius:"inherit",zIndex:1,pointerEvents:"none",animation:"shimmer 2s ease-in-out infinite"},"&::after":{content:'""',position:"absolute",top:-2,left:-2,right:-2,bottom:-2,background:"linear-gradient(45deg, rgba(25, 118, 210, 0.3), rgba(25, 118, 210, 0.1), rgba(25, 118, 210, 0.3))",backgroundSize:"400% 400%",borderRadius:"inherit",zIndex:-1,animation:"shimmer 3s ease-in-out infinite reverse"},animation:"pulse 2s ease-in-out infinite","& > *":{position:"relative",zIndex:2}},"@keyframes shimmer":{"0%":{backgroundPosition:"100% 0%"},"100%":{backgroundPosition:"-100% 0%"}},"@keyframes pulse":{"0%, 100%":{opacity:1,transform:"scale(1)"},"50%":{opacity:.95,transform:"scale(1.005)"}}},children:[$e.jsxs(Be,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2},children:[$e.jsx(st,{variant:"h5",component:"div",children:c("taskForm.ai.title")}),$e.jsx(Be,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:$e.jsx(Qe,{size:"small",onClick:l,children:$e.jsx(_,{})})})]}),$e.jsxs(Be,{sx:{flex:1,overflow:"auto",p:2,pt:0},children:[$e.jsx(st,{variant:"body1",color:"text.secondary",sx:{mb:2},children:c("taskForm.ai.placeholder")}),p.length>0&&$e.jsxs(Be,{sx:{mb:2},children:[$e.jsxs(st,{variant:"subtitle2",sx:{mb:1},children:[c("taskForm.ai.history"),":"]}),$e.jsx(ut,{dense:!0,sx:{bgcolor:"background.paper",borderRadius:1,border:"1px solid",borderColor:"divider"},children:p.map((e=>$e.jsxs(mt,{onClick:t=>((e,t)=>{y(e.currentTarget),S(t)})(t,e),sx:{"&:hover":{bgcolor:"action.hover"}},secondaryAction:$e.jsx($e.Fragment,{children:$e.jsx(Qe,{size:"small",sx:{ml:1},children:$e.jsx(x,{fontSize:"small"})})}),children:[$e.jsxs(Be,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:"50px",height:"50px",mr:1,overflow:"hidden"},children:["processing"===e.status&&$e.jsx(We,{size:16}),"done"===e.status&&!e.image&&$e.jsx(j,{fontSize:"small",color:"success"}),"done"===e.status&&e.image&&$e.jsx("img",{src:e.image,style:{width:"100%"}}),"error"===e.status&&$e.jsx(b,{fontSize:"small",color:"error"})]}),$e.jsx(Le,{primary:e.message||c("taskForm.ai.imageRecognizedText"),secondary:e.timestamp.toLocaleTimeString(c("locale"),{timeStyle:"short"})})]},e.id)))})]}),!1,$e.jsx(Je,{fullWidth:!0,multiline:!0,minRows:3,maxRows:20,variant:"outlined",placeholder:c("taskForm.ai.messageInputPlaceholder"),value:d,onChange:e=>u(e.target.value),disabled:m,onPaste:async e=>{const t=e.clipboardData.items;for(const a of t)if(a.type.startsWith("image/")){e.preventDefault();const t=a.getAsFile();if(t){I(!0);try{const e=await new Promise((e=>{const s=new FileReader;s.onloadend=()=>e(s.result),s.readAsDataURL(t)})),s=await n.files.recognizeText({imageBase64:e,mode:"text"});s&&await F(s,e)}catch(s){E(c("taskForm.ai.errors.imageProcessing"))}finally{I(!1)}}}else if("text/plain"===a.type){const t=await new Promise((e=>a.getAsString(e)));if(t.match(/^https?:\/\/.+\.(jpg|jpeg|png|gif|webp)$/i)){e.preventDefault(),I(!0);try{const e=await fetch(t),s=await e.blob(),a=await new Promise((e=>{const t=new FileReader;t.onloadend=()=>e(t.result),t.readAsDataURL(s)})),r=await n.files.recognizeText({imageBase64:a,mode:"text"});r&&await F(r,a)}catch(s){E(c("taskForm.ai.errors.imageURLProcessing"))}finally{I(!1)}}}},sx:{mb:2}}),$e.jsxs(Be,{sx:{display:"flex",gap:1,mb:2},children:[$e.jsx(Ve,{variant:"outlined",color:"primary",onClick:()=>{var e;return null==(e=document.getElementById("image-input"))?void 0:e.click()},disabled:T,startIcon:$e.jsx(k,{}),children:c(T?"common.loading":"taskForm.ai.image")}),$e.jsx(Ve,{variant:"contained",color:"primary",endIcon:$e.jsx(w,{}),onClick:async()=>{if(!d.trim())return;const t={id:Date.now().toString(),message:d,text:a.text||"",timestamp:new Date,status:"processing",type:Z};f((e=>[t,...e])),u(""),h(!0);try{const s=await n.tasks.chat({text:a.text,message:t.message,type:t.type});f((e=>e.map((e=>e.id===t.id?{...e,status:"done"}:e)))),"text"===Z&&s&&(o(a.text),r((e=>({...e,text:s}))),e.current&&(e.current.setMarkdown(s||""),e.current.focus()))}catch(s){f((e=>e.map((e=>e.id===t.id?{...e,status:"error"}:e)))),E("Failed to get AI response. "+s)}finally{h(!1)}},disabled:m||!d.trim(),sx:{flex:1},children:c(m?"taskForm.ai.sending":"taskForm.ai.send")}),$e.jsx("input",{type:"file",accept:"image/*",style:{display:"none"},id:"image-input",onChange:async e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s){I(!0);try{const e=await new Promise((e=>{const t=new FileReader;t.onloadend=()=>e(t.result),t.readAsDataURL(s)})),t=await n.files.recognizeText({imageBase64:e,mode:"text"});t?await F(t,e):E(c("taskForm.ai.errors.noTextRecognized"))}catch(a){E(c("taskForm.ai.errors.imageProcessing"))}finally{I(!1)}}}})]})]}),$e.jsx(it,{anchorEl:g,open:Boolean(g),onClose:O,children:$e.jsxs(De,{onClick:()=>{v&&(u(v.message),r((e=>({...e,text:v.text}))),e.current&&(e.current.setMarkdown(v.text||""),e.current.focus()),f((e=>{const t=e.findIndex((e=>e.id===v.id));return-1===t?e:e.slice(t+1)}))),O()},children:[$e.jsx(C,{fontSize:"small",sx:{mr:1}}),c("taskForm.ai.rollback")]})})]})},pn=({title:e,text:t,url:a,tagIds:n,tags:r,teacherId:i,onClose:o,onFullscreen:l,onValidateAnswers:c,hasQuizzes:d})=>{const{t:u}=s();return $e.jsxs(Ke,{id:"preview-panel-paper",sx:{width:"350px",display:"flex",flexDirection:"column",height:"100%"},children:[$e.jsx(Be,{sx:{width:"100%",display:"flex",flexDirection:"column",gap:2,p:2,flex:"flex-start"},children:$e.jsxs(Be,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[$e.jsx(st,{variant:"h5",component:"div",children:u("common.dialog.preview.title")}),$e.jsxs(Be,{sx:{display:"flex",gap:1},children:[$e.jsx(Qe,{size:"small",onClick:l,children:$e.jsx(S,{})}),$e.jsx(Qe,{size:"small",onClick:o,children:$e.jsx(_,{})})]})]})}),$e.jsxs(Be,{sx:{overflow:"auto",flex:"flex",px:2,height:"100%"},children:[$e.jsx(Be,{sx:{mb:2},children:$e.jsx(st,{variant:"h3",children:e})}),$e.jsx(T,{task:{id:"preview",title:e,text:t,url:a||"",tags:r.filter((e=>n.includes(e.id))),teacher_id:i},isSaveAnswer:!1,workId:"preview"})]}),d&&$e.jsx(Be,{sx:{p:2,borderTop:1,borderColor:"divider",display:"flex",justifyContent:"center",mt:"auto",flex:"flex-end"},children:$e.jsx(Ve,{variant:"contained",color:"primary",onClick:c,startIcon:$e.jsx(j,{}),children:u("common.actions.checkAnswers")})})]})},fn=()=>{const{t:e}=s(),t=I(Z),[a,n]=ze.useState(null),[r,i]=ze.useState(null),o=()=>{n(null)},l=Boolean(a),c=(e,t)=>{const s=!!r&&((null==r?void 0:r.row)>=e&&(null==r?void 0:r.col)>=t);return{minWidth:"40px",height:"40px",backgroundColor:s?"primary.main":"transparent",color:s?"primary.contrastText":"primary.main","&:hover":{backgroundColor:"primary.main"},transition:"all 0.5s ease"}};return $e.jsxs($e.Fragment,{children:[$e.jsx(A,{title:e("taskForm.table.title"),children:$e.jsx("span",{onClick:e=>{n(e.currentTarget)},children:$e.jsx(E,{})})}),$e.jsx(ht,{open:l,anchorEl:a,onClose:o,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:$e.jsx(Be,{sx:{p:2},children:$e.jsx(Be,{sx:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:1,width:200},children:Array.from({length:4},((e,t)=>t+1)).map((e=>Array.from({length:4},((e,t)=>t+1)).map((s=>$e.jsxs(Ve,{variant:"outlined",size:"small",onClick:()=>(t({rows:e,columns:s}),void o()),onMouseEnter:()=>i({row:e,col:s}),onMouseLeave:()=>i(null),sx:c(e,s),children:[e,"x",s]},`${e}-${s}`)))))})})})]})},xn=({editorRef:e,formData:t,setFormData:a,setInitText:n,setGeneratedImage:r,onClose:i})=>{const{t:o}=s(),l=[{icon:$e.jsx(O,{}),title:o("components.hiddenText.title"),description:o("components.hiddenText.hint"),image:null},{icon:$e.jsx(F,{}),title:o("components.multipleChoice.title"),description:o("components.multipleChoice.hint"),image:null},{icon:$e.jsx(P,{}),title:o("components.draggableAnswers.title"),description:o("components.draggableAnswers.hint"),image:null},{icon:$e.jsx(N,{}),title:o("components.sortingOrdering.title"),description:o("components.sortingOrdering.hint"),image:null},{icon:$e.jsx(R,{}),title:o("components.studentsSection.title"),description:o("components.studentsSection.hint"),image:null},{icon:$e.jsx(k,{}),title:o("components.image.title"),description:o("components.image.hint"),image:null},{icon:$e.jsx(z,{}),title:o("components.audio.title"),description:o("components.audio.hint"),image:null},{icon:$e.jsx($,{}),title:o("components.embed.title"),description:o("components.embed.hint"),image:null}];return $e.jsx(Be,{children:$e.jsx(Be,{sx:{display:"flex",flexWrap:"wrap",gap:2,"& > *":{flex:"1 1 calc(50% - 16px)",minWidth:"200px"}},children:l.map(((e,t)=>$e.jsx(Be,{children:$e.jsx(at,{sx:{height:"100%"},children:$e.jsxs(nt,{children:[$e.jsxs(Be,{sx:{display:"flex",alignItems:"center",mb:2},children:[$e.jsx(Me,{sx:{minWidth:40},children:e.icon}),$e.jsx(Le,{primary:e.title,primaryTypographyProps:{variant:"subtitle1",sx:{fontWeight:500}}})]}),$e.jsx(st,{variant:"body2",color:"text.secondary",children:e.description})]})})},t)))})})},gn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const r=Ne(),{taskId:i}=pt(),[o]=Re(),l=o.get("return_to")||"/tasks",c=o.get("copy_task_id"),d=o.get("work_id"),u=o.get("sharingKey"),{user:m}=e(),{showErrorToast:h}=t(),{mode:f}=D(),x=ze.useRef(null),[y,v]=ze.useState(null),[_,j]=ze.useState(!0),[b,k]=ze.useState(!1),[w,C]=ze.useState([]),[S,T]=ze.useState({title:"",text:"",url:"",tag_ids:[]}),[I,Z]=ze.useState(null),[A,E]=ze.useState({}),[O,F]=ze.useState(!1),[P,N]=ze.useState((()=>localStorage.getItem("taskForm_sidePanelMode")||"live-preview"));ze.useEffect((()=>{P?localStorage.setItem("taskForm_sidePanelMode",P):localStorage.removeItem("taskForm_sidePanelMode")}),[P]);const[R,z]=ze.useState(""),[$,be]=ze.useState(null),[ke,we]=ze.useState(!1),[Ce,Se]=ze.useState(""),[Te,Ie]=ze.useState(!1),[Ze,Ae]=ze.useState(!1),[Ee,Oe]=ze.useState(null),[Fe,Pe]=ze.useState(null),De=(null==m?void 0:m.role)===a.ADMIN,Me=(null==m?void 0:m.role)===a.TEACHER||De,Le=Boolean(i),[We,Ue]=ze.useState(!1),qe=ft(),Ye=xt(qe.breakpoints.down("md")),{t:Qe}=s(),Xe=ze.useRef(S);ze.useEffect((()=>{if(!Ze)return;const e=i?`task_${i}`:"new_task";Se(e);const t=localStorage.getItem(e);t&&(be(t),we(!0))}),[i,Ze]);const et=e=>{if(we(!1),e&&$)try{const e=JSON.parse($);Xe.current={...Xe.current,...e},T({...Xe.current});const t=document.querySelector('input[name="title"]');t&&(t.value=e.title||""),x.current&&(x.current.setMarkdown(e.text||""),x.current.focus())}catch(t){}else localStorage.removeItem(Ce),be(null)},tt=ze.useCallback(gt((()=>{T({...Xe.current}),E((e=>{const t={...e};return Xe.current.title&&t.title&&delete t.title,Xe.current.text&&t.text&&delete t.text,Xe.current.tag_ids.length>0&&t.tag_ids&&delete t.tag_ids,t})),Ce&&localStorage.setItem(Ce,JSON.stringify(Xe.current))}),500),[Ce]),at=e=>{if(!e)return!1;const t=e.includes(":hidden")||e.includes(":essay")||e.includes(":sort")||e.includes(":select"),s=e.includes("[ ]")||e.includes("[x]");return t||s},nt=()=>{window.dispatchEvent(new CustomEvent("validateAllQuizzes",{detail:{taskId:"preview"}}))},rt=e=>{e?(be(null),localStorage.removeItem(Ce),Ie(!1),r(l)):Ie(!1)};if(ze.useEffect((()=>{const e=setTimeout((()=>{x.current&&Ae(!0)}),500);return()=>clearTimeout(e)}),[]),ze.useEffect((()=>{let e=!0;return(async()=>{if(e){j(!0);try{const t=await n.tags.getAll();if(!e)return;if(C(t),i){const t=await n.tasks.getById(i);if(!e)return;v(t),z(t.text||"");const s={title:t.title,text:t.text||"",tag_ids:t.tags.map((e=>e.id))};Xe.current=s,T(s)}else if(c){const t=await n.tasks.getById(c);if(!e)return;v(t),z(t.text||"");const s={title:`Copy of ${t.title}`,text:t.text||"",tag_ids:t.tags.map((e=>e.id))};Xe.current=s,T(s)}else if(u){const t=await n.tasks.getBySharingKey(u);if(!e)return;v(t),z(t.text||"");const s={title:t.title,text:t.text||"",tag_ids:t.tags.map((e=>e.id))};Xe.current=s,T(s)}d&&Z(await n.works.getById(d))}catch(t){const s=t instanceof Error?t.message:"Failed to load data. Please try again.";if(!e)return;h(s),r(l)}finally{if(!e)return;j(!1)}}})(),()=>{e=!1}}),[i,c,r,l]),!Me)return r(l),null;function it(e=!1){return $e.jsxs(Be,{sx:{display:"flex",gap:0,opacity:e?1:.5,pointerEvents:e?"auto":"none"},children:[$e.jsx(ce,{options:["Bold","Italic"]}),$e.jsx(de,{options:["bullet","number"]}),$e.jsx(fn,{}),$e.jsx(ue,{}),$e.jsx(me,{editorRef:x}),$e.jsx(he,{editorRef:x}),$e.jsx(de,{options:["check"]}),$e.jsx(pe,{editorRef:x}),$e.jsx(fe,{editorRef:x}),$e.jsx(xe,{editorRef:x}),$e.jsx(ge,{}),$e.jsx(ye,{}),$e.jsx(ve,{}),$e.jsx(_e,{}),$e.jsx(je,{})]})}return $e.jsxs(Be,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[_?$e.jsx(p,{message:Qe(Le?"taskForm.loading.task":"taskForm.loading.default")}):$e.jsxs(Be,{sx:{display:"flex",gap:2,height:"100%",overflow:"hidden",justifyContent:"center",alignItems:"center"},children:[$e.jsxs(Be,{sx:{display:"flex",flex:"3 1",flexDirection:"column",width:"100%",maxWidth:"800px",height:"100%",position:"relative",overflow:"hidden"},children:[$e.jsx(Be,{sx:{flex:1,overflow:"auto",p:1,pt:0},children:$e.jsx(Be,{width:"100%",sx:{display:"flex",justifyContent:"space-between"},children:$e.jsx(Be,{sx:{flex:1,display:"flex",flexDirection:"column",width:"100%",position:"relative"},children:$e.jsxs(Be,{component:"form",noValidate:!0,sx:{display:"flex",flexDirection:"column",height:"100%",minHeight:0,flex:1},children:[$e.jsxs(Ke,{sx:{p:2,pt:0,pb:1},children:[I&&$e.jsx(Be,{sx:{my:2},children:$e.jsx(Ge,{label:I.name,onDelete:()=>r(l),color:"primary"})}),$e.jsx(Je,{autoFocus:!0,margin:"normal",name:"title",label:Qe("taskForm.title.label"),type:"text",fullWidth:!0,variant:"outlined",defaultValue:S.title,onChange:e=>{Xe.current.title=e.target.value,tt()},error:!!A.title,helperText:A.title,inputProps:{autoComplete:"off",maxLength:100}}),$e.jsx(He,{multiple:!0,options:w,getOptionLabel:e=>e.name,value:w.filter((e=>Xe.current.tag_ids.includes(e.id))),onChange:(e,t)=>{const s=t.map((e=>e.id));Xe.current.tag_ids=s,T({...Xe.current}),tt()},disabled:We,disableCloseOnSelect:!0,renderInput:e=>$e.jsxs(Be,{sx:{position:"relative"},children:[$e.jsx(Je,{...e,label:Qe("taskForm.tags.label"),margin:"normal",error:!!A.tag_ids}),We&&$e.jsx(yt,{sx:{position:"absolute",bottom:0,left:0,right:0,height:2}})]}),filterOptions:(e,{inputValue:t})=>{const s=e.filter((e=>e.name.toLowerCase().includes(t.toLowerCase())));return t&&!s.length?[{id:"new",name:t,creator_id:(null==m?void 0:m.id)||""}]:s},renderOption:(e,t)=>"new"===t.id?$e.jsx("li",{...e,onClick:async e=>{e.stopPropagation(),Ue(!0);try{const e=await n.tags.create({name:t.name});C((t=>[...t,e])),Xe.current.tag_ids=[...Xe.current.tag_ids,e.id],T({...Xe.current})}catch(s){const e=s instanceof Error?s.message:"Failed to create tag. Please try again.";h(e)}finally{Ue(!1)}},children:Qe("taskForm.tags.create",{name:t.name})}):$e.jsx("li",{...e,children:t.name})}),A.tag_ids&&$e.jsx(vt,{error:!0,children:A.tag_ids})]}),$e.jsx(Ke,{sx:{flex:1,display:"flex",flexDirection:"column",minHeight:0,position:"relative",mt:2,mb:2,border:"1px solid",borderColor:"divider"},children:$e.jsx(M,{ref:x,markdown:S.text,autoFocus:!1,onChange:e=>{Xe.current.text=e,tt()},className:"dark"===f?"mdxeditor dark-theme dark-editor":"mdxeditor light-theme light-editor",translation:(e,t,s)=>Qe("editor."+e,{defaultValue:t,...s}),plugins:[L(),W(),B(),U({disableImageResize:!0,disableImageSettingsButton:!0,imageUploadHandler:async e=>{const t=URL.createObjectURL(e);Oe(t);const s=await n.files.uploadImage(e);return s.url?(Oe(null),URL.revokeObjectURL(t),s.url):(h("Failed to upload image. Please try again."),t)},EditImageToolbar:X}),V(),K(),q({disableAutoLink:!0}),H(),G({viewMode:"rich-text",diffMarkdown:R}),J({escapeUnknownTextDirectives:!0,directiveDescriptors:[ee,te,se,ae,ne,re,ie]}),Y(1e5),Q({toolbarClassName:"mdxeditor-toolbar-full ",toolbarContents:()=>$e.jsx(oe,{options:Ye?[]:["source"],children:$e.jsx(le,{options:[{when:e=>{var t;return"root"!==(null==(t=null==e?void 0:e.rootNode)?void 0:t.getType())},contents:()=>it(!1)},{fallback:()=>it(!0)}]})})})]})})]})})})}),$e.jsxs(Be,{sx:{width:"100%",p:1,display:"flex",justifyContent:"space-between",position:"sticky",bottom:0,left:0,zIndex:1},children:[$e.jsx(Be,{sx:{display:"flex-start",gap:2},children:$e.jsx(Ve,{variant:"outlined",color:"inherit",onClick:()=>{null!==localStorage.getItem(Ce)?Ie(!0):r(l)},children:Qe("taskForm.buttons.cancel")})}),$e.jsx(Be,{sx:{display:{xs:"none",lg:"flex",gap:2}},children:$e.jsxs(_t,{color:"primary",value:P,exclusive:!0,onChange:(e,t)=>{N(t)},size:"small",sx:{"& .MuiToggleButtonGroup-firstButton":{borderRadius:"10px 0 0 10px"},"& .MuiToggleButtonGroup-lastButton":{borderRadius:"0 10px 10px 0"}},children:[$e.jsx(jt,{value:"components-help",children:Qe("taskForm.buttons.quickHelp")}),$e.jsx(jt,{value:"live-preview",children:Qe("taskForm.buttons.livePreview")}),$e.jsx(jt,{value:"ai-chat",children:Qe("taskForm.buttons.aiAssistant")})]})}),$e.jsxs(Be,{sx:{display:"flex-end",gap:2},children:[$e.jsx(bt,{title:Qe("taskForm.buttons.preview"),children:$e.jsx(Ve,{variant:"outlined",color:"info",onClick:()=>F(!0),sx:{mr:1,display:{xs:void 0,lg:"none"}},children:Qe("taskForm.buttons.preview")})}),$e.jsx(bt,{title:b?Qe("taskForm.loading.saving"):S.title.trim()?S.text.trim()?"":Qe("taskForm.content.error.required"):Qe("taskForm.title.error.required"),children:$e.jsx("span",{children:$e.jsx(Ve,{variant:"contained",color:"primary",onClick:async()=>{const{isValid:e,errors:t}=dn(nn,S);if(e){k(!0);try{if(Le&&i)await n.tasks.update(i,S);else{const e=await n.tasks.create(S);d&&await n.works.addTask(d,e.id)}be(null),localStorage.removeItem(Ce),r(l)}catch(s){const e=s instanceof Error?s.message:"Failed to save task. Please try again.";h(e)}finally{k(!1)}}else E(t)},disabled:b||!S.title.trim()||!S.text.trim(),children:Qe(b?"taskForm.loading.saving":Le?"common.actions.save":"taskForm.buttons.create")})})})]})]})]}),$e.jsxs(Be,{sx:{display:{xs:"none",lg:P?"flex":"none"},flex:"1",height:"100%",width:"auto",minWidth:"350px",maxWidth:"600px",overflow:"auto",p:2,pt:0,flexDirection:"column",alignItems:"center"},children:["live-preview"===P&&$e.jsx(pn,{title:S.title||"",text:S.text||"",tagIds:S.tag_ids,tags:w,teacherId:(null==m?void 0:m.id)||"",onClose:()=>N(null),onFullscreen:()=>F(!0),onValidateAnswers:nt,hasQuizzes:at(S.text||"")}),"ai-chat"===P&&$e.jsx(hn,{editorRef:x,formData:S,setFormData:T,setInitText:z,setGeneratedImage:Pe,onClose:()=>N(null)}),"components-help"===P&&$e.jsx(xn,{editorRef:x,formData:S,setFormData:T,setInitText:z,setGeneratedImage:Pe,onClose:()=>N(null)})]})]}),$e.jsx(g,{open:O,onClose:()=>F(!1),task:{id:"preview",title:S.title||"",text:S.text||"",tags:w.filter((e=>S.tag_ids.includes(e.id))),teacher_id:(null==m?void 0:m.id)||""},hasQuizzes:at(S.text),onValidateAnswers:nt}),$e.jsxs(ot,{open:ke,onClose:()=>we(!1),children:[$e.jsx(lt,{children:Qe("taskForm.dialog.unsavedChanges.title")}),$e.jsx(ct,{children:$e.jsx(st,{children:Qe("taskForm.dialog.unsavedChanges.message")})}),$e.jsxs(dt,{children:[$e.jsx(Ve,{onClick:()=>et(!1),color:"error",children:Qe("taskForm.dialog.unsavedChanges.discard")}),$e.jsx(Ve,{onClick:()=>et(!0),variant:"contained",children:Qe("taskForm.dialog.unsavedChanges.restore")})]})]}),$e.jsxs(ot,{open:Te,onClose:()=>Ie(!1),children:[$e.jsx(lt,{children:Qe("taskForm.dialog.cancel.title")}),$e.jsx(ct,{children:$e.jsx(st,{children:Qe("taskForm.dialog.cancel.message")})}),$e.jsxs(dt,{children:[$e.jsx(Ve,{onClick:()=>rt(!1),children:Qe("taskForm.dialog.cancel.keep")}),$e.jsx(Ve,{onClick:()=>rt(!0),variant:"contained",color:"error",children:Qe("taskForm.dialog.cancel.confirm")})]})]}),$e.jsxs(ot,{open:!!Ee,onClose:()=>Oe(null),maxWidth:"sm",fullWidth:!0,children:[$e.jsx(lt,{children:Qe("taskForm.dialog.image.title")}),$e.jsxs(ct,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:[$e.jsx(Be,{component:"img",src:Ee||"",alt:"Preview",sx:{maxWidth:"100%",maxHeight:"300px",objectFit:"contain"}}),$e.jsx(p,{message:Qe("taskForm.loading.image")})]})]}),$e.jsxs(ot,{open:!!Fe,onClose:()=>Pe(null),maxWidth:"sm",fullWidth:!0,children:[$e.jsx(lt,{children:Qe("taskForm.dialog.generatedImage.title")}),$e.jsx(ct,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:$e.jsx(Be,{component:"img",src:(ut=Fe,ut?ut.startsWith("data:image")?ut:`data:image/jpeg;base64,${ut}`:""),alt:"Generated",sx:{maxWidth:"100%",maxHeight:"300px",objectFit:"contain"}})}),$e.jsx(dt,{children:$e.jsx(Ve,{onClick:()=>Pe(null),children:Qe("taskForm.dialog.image.close")})})]})]});var ut}},Symbol.toStringTag,{value:"Module"})),yn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{var r;const{t:i}=s(),{user:o}=e(),l=Ne(),[c]=Re(),u=c.get("return_to")||null,h=c.get("studentId"),x=c.get("work_id"),v="true"===c.get("edit"),_="true"===c.get("copy"),j="true"===c.get("template"),b=c.get("folder"),[k,w]=ze.useState([]),[C,S]=ze.useState(null),[T,I]=ze.useState([]),[Z,A]=ze.useState(null),[E,O]=ze.useState(""),[F,P]=ze.useState(!1),[N,z]=ze.useState(null),[$,D]=ze.useState(0),[M,L]=ze.useState([]),[W,B]=ze.useState(!0),[U,V]=ze.useState(!1),[K,q]=ze.useState(null),[H,G]=ze.useState({}),[J,Y]=ze.useState(v||j?1:0),[Q,X]=ze.useState(!1),ee=(null==o?void 0:o.role)===a.TEACHER||(null==o?void 0:o.role)===a.ADMIN,{showErrorToast:te,showToast:se}=t(),[ae,ne]=ze.useState(null),[re,ie]=ze.useState(!1),[oe,le]=ze.useState(0),[ce,de]=ze.useState(0),[ue,me]=ze.useState(null),[he,pe]=ze.useState([]);ze.useEffect((()=>{(async()=>{try{const e=await n.folders.getAll(0,100);if(pe(e),b){const t=e.find((e=>e.id===b));if(t)me(t);else{const e=await n.folders.getById(b);e&&me(e)}}}catch(e){te(y(e))}})()}),[b]);const[fe,xe]=ze.useState(!b);ze.useEffect((()=>{(async()=>{B(!0),q(null);try{const e=await n.contracts.getAll(0,100),t=e.filter((e=>e.status===be.AGREED||e.status===be.PENDING));L(t);const s=new Map;e.forEach((e=>{e.student&&!s.has(e.student_id)&&s.set(e.student_id,e.student)}));const a=Array.from(s.values()).sort(((e,t)=>{const s=`${e.first_name||""} ${e.last_name||""}`.trim().toLowerCase(),a=`${t.first_name||""} ${t.last_name||""}`.trim().toLowerCase();return s.localeCompare(a)}));if(ee&&o){const e={id:o.id,first_name:"Template",last_name:null,photo_url:null};a.unshift(e)}if(w(a),q(null),j&&ee&&o){const e=a.find((e=>e.id===o.id&&"Template"===e.first_name));if(e){S(e);const t=new Date,s=t.getDate().toString().padStart(2,"0"),a=(t.getMonth()+1).toString().padStart(2,"0"),n=t.getFullYear();O(`Template - ${`${s}.${a}.${n}`}`)}}else if(h){const e=a.find((e=>e.id===h));if(e){S(e);const t=new Date,s=t.getDate().toString().padStart(2,"0"),a=(t.getMonth()+1).toString().padStart(2,"0"),n=`${s}.${a}.${t.getFullYear()}`;O(`Work for ${e.first_name||e.last_name||e.id} - ${n}`)}}x&&(v||_)&&await ge(x)}catch(e){const t=y(e);q(t),te(t)}finally{B(!1)}})()}),[h,x,v,_,oe,j]);const ge=async e=>{try{const t=await n.works.getById(e);A(t),O(_?`Copy of ${t.name}`:t.name);const s=(await Promise.all(t.task_states.sort(((e,t)=>(e.order||0)-(t.order||0))).map((async e=>{if(!e.task)try{return await n.tasks.getById(e.task_id)}catch(t){return null}return e.task})))).filter((e=>null!==e));I(s)}catch(t){const e=t instanceof Error?t.message:"Failed to load work data. Please try again.";q(e),te(e)}};ze.useEffect((()=>{if(Z&&k.length>0&&v){const e=k.find((e=>e.id===Z.student_id));e?S(e):te("Student for this work could not be found. Please select a student manually.")}}),[Z,k,v]),ze.useEffect((()=>{if(C&&"Template"!==C.first_name){const e=M.find((e=>e.student_id===C.id&&e.teacher_id===(null==o?void 0:o.id)&&e.status===be.AGREED)),t=M.find((e=>e.student_id===C.id&&e.teacher_id===(null==o?void 0:o.id)&&e.status===be.PENDING)),s=e||t;z(s||null),s?(D(s.balance),s.balance>0?P(!0):P(!1)):(D(0),P(!1))}else z(null),D(0),P(!1)}),[C,M,null==o?void 0:o.id]);const ye=e=>{I((t=>t.some((t=>t.id===e.id))?t.filter((t=>t.id!==e.id)):[...t,e]))},ve=async(e=!0)=>{if(!C)return void q("Please select a student");const t={name:E,student_id:C.id,task_ids:T.map((e=>e.id)),contract_id:F&&N?N.id:void 0,folder_id:null==ue?void 0:ue.id},{isValid:s,errors:a}=dn(ln,t);if(!s)return void G(a);V(!0),q(null);let r=null;try{if(v&&Z){r=(await n.works.update(Z.id,t)).id}else{r=(await n.works.create(t)).id}if(!e)return r;u?l(u):"Template"===(null==C?void 0:C.first_name)?l("/templates"):l("/works")}catch(i){const e=i instanceof Error?i.message:`Failed to ${v?"update":"create"} work. Please try again.`;q(e),te(e),V(!1)}},_e=e=>{ne(e),ie(!0)},je=()=>{ie(!1)},Oe=ze.useCallback((()=>{le((e=>e+1))}),[]),Fe=()=>{X(!1)},[Pe,De]=ze.useState(!1),Me=()=>{De(!1)};return W?$e.jsx(p,{message:i("common.loading")}):$e.jsxs(Be,{sx:{mx:"auto",pb:1,height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",width:"100%",".sortable-list":{position:"relative","& .item":{transition:"background-color 0.2s, box-shadow 0.2s, transform 0.1s","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"},userSelect:"none",cursor:"default"},"& .dragged-item":{backgroundColor:"primary.main!important",color:"white!important",boxShadow:"0 10px 20px rgba(0, 0, 0, 0.3)!important",opacity:.95,zIndex:1e3,transform:"scale(1.03)",borderRadius:"4px",pointerEvents:"none",cursor:"grabbing","& .MuiTypography-root":{color:"white!important"},"& svg":{color:"white!important"}}}},children:[$e.jsx("style",{children:`\n          .dragged-item {\n            background-color: ${ke.palette.primary.main} !important;\n          }\n        `}),K&&$e.jsx(Ue,{severity:"error",sx:{mb:2},action:$e.jsx(Ve,{color:"inherit",size:"small",onClick:Oe,disabled:U,children:i(U?"common.status.loading":"common.actions.retry")}),children:K}),$e.jsx(Be,{sx:{p:0,mx:"auto",width:"100%",maxWidth:"800px",flexShrink:0},children:$e.jsxs(kt,{value:J,onChange:(e,t)=>{C&&Y(t)},centered:!0,variant:"fullWidth",sx:{mx:2},children:[$e.jsx(wt,{label:i(v?"works.tabs.step1.edit":_?"works.tabs.step1.copy":"works.tabs.step1.create"),disabled:v}),$e.jsx(wt,{label:i("works.tabs.step2")})]})}),0===J&&$e.jsx(Be,{sx:{width:"100%",maxWidth:"800px",mx:"auto",flex:1,display:"flex",flexDirection:"column",overflow:"hidden",height:"100%"},children:$e.jsxs(Ke,{sx:{p:2,mb:1,display:"flex",flexDirection:"column",overflow:"hidden",height:"100%"},children:[0===k.length&&$e.jsxs(Be,{sx:{textAlign:"center",py:3},children:[$e.jsx(st,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:i("contracts.empty.noContracts")}),$e.jsx(st,{variant:"body2",color:"text.secondary",sx:{mb:2},children:i("contracts.empty.hint")}),$e.jsx(Ve,{variant:"outlined",color:"primary",startIcon:$e.jsx(d,{}),onClick:()=>l("/contracts/new"),children:i("contracts.actions.create")})]}),$e.jsx(Be,{sx:{mt:1,mb:2},children:$e.jsx(He,{value:C,onChange:(e,t)=>(e=>{if(S(e),e){const t=new Date,s=`${t.getDate().toString().padStart(2,"0")}.${(t.getMonth()+1).toString().padStart(2,"0")}.${t.getFullYear()}`;"Template"===e.first_name?O(`Template Work - ${s}`):O(`Work for ${e.first_name||e.last_name||e.id} - ${s}`)}else O("")})(t),options:k,getOptionLabel:e=>`${e.first_name||""} ${e.last_name||""}`.trim(),renderInput:e=>{var t;return $e.jsx(Je,{...e,label:i("works.creator.forStudent"),placeholder:i("works.creator.selectStudent"),required:!0,error:!!H.student_id,helperText:H.student_id,InputProps:{...e.InputProps,startAdornment:$e.jsxs($e.Fragment,{children:[C&&("Template"===C.first_name?$e.jsx(we,{sx:{mr:1,color:"primary.main"}}):$e.jsx(Ct,{src:C.photo_url||void 0,sx:{width:24,height:24,mr:1},children:((null==(t=C.first_name)?void 0:t[0])||"?").toUpperCase()})),e.InputProps.startAdornment]})}})},renderOption:(e,t)=>{var s;return $e.jsx(Be,{component:"li",...e,children:$e.jsxs(Be,{sx:{display:"flex",alignItems:"center"},children:["Template"===t.first_name?$e.jsx(we,{sx:{mr:1,color:"primary.main"}}):$e.jsx(Ct,{src:t.photo_url||void 0,sx:{width:24,height:24,mr:1},children:((null==(s=t.first_name)?void 0:s[0])||"?").toUpperCase()}),$e.jsxs(st,{sx:{fontWeight:"Template"===t.first_name?500:400,color:"Template"===t.first_name?"primary.main":"inherit"},children:[t.first_name||t.id,t.last_name&&` ${t.last_name}`]})]})})}})}),$e.jsx(Be,{sx:{mt:1,mb:2},children:"Template"===(null==C?void 0:C.first_name)?$e.jsx(st,{variant:"body1",color:"primary",sx:{mt:1},children:i("works.creator.templateHint")}):C&&$e.jsx(st,{variant:"body1",color:"warning",sx:{mt:1},children:i("works.creator.studentHint")})}),"Template"===(null==C?void 0:C.first_name)&&he.length>0&&$e.jsx($e.Fragment,{children:v?$e.jsx($e.Fragment,{children:null==Z?void 0:Z.folders.map((e=>$e.jsx(Je,{fullWidth:!0,disabled:!0,label:i("templates.actions.currentFolder"),placeholder:i("templates.actions.currentFolder"),value:e.title,InputProps:{readOnly:!0,startAdornment:$e.jsx(Ye,{position:"start",children:$e.jsx(Ce,{color:"primary"})})}})))}):$e.jsx($e.Fragment,{children:ue&&!fe?$e.jsx(Je,{fullWidth:!0,label:i("templates.actions.folder"),placeholder:i("templates.actions.selectFolder"),value:ue.title,InputProps:{readOnly:!0,startAdornment:$e.jsx(Ye,{position:"start",children:$e.jsx(Ce,{color:"primary"})}),endAdornment:$e.jsx(Ye,{position:"end",children:$e.jsx(Ve,{variant:"contained",color:"primary",onClick:()=>{me(null),xe(!0)},size:"small",children:i("common.actions.change")})})}}):fe&&$e.jsxs($e.Fragment,{children:[$e.jsxs(st,{variant:"body2",sx:{mb:2},children:[i("templates.actions.selectFolder")," (",i("common.optional"),"):"]}),$e.jsx(Be,{sx:{backgroundColor:"background.paper",flex:1,overflow:"auto",display:"flex",flexDirection:"column",borderRadius:3},children:$e.jsx(Be,{sx:{flex:1,overflow:"auto"},children:$e.jsx(Se,{onFolderSelect:e=>{me(e),xe(!1)}})})})]})})})]})}),1===J&&$e.jsxs(Be,{sx:{width:"100%",maxWidth:"800px",mx:"auto",flex:1,display:"flex",flexDirection:"column",overflow:"hidden",height:"100%"},children:[$e.jsxs(Ke,{sx:{p:2,mb:2,flexShrink:0},children:[$e.jsxs(Be,{sx:{display:"flex",alignItems:"center",gap:1},children:[!v&&$e.jsx(bt,{title:i("common.actions.edit"),children:$e.jsx(Qe,{onClick:()=>Y(0),size:"small",children:$e.jsx(R,{fontSize:"small"})})}),"Template"===(null==C?void 0:C.first_name)?$e.jsx(st,{variant:"body1",color:"primary",children:i("works.creator.templateHint")}):$e.jsxs($e.Fragment,{children:[$e.jsx(Ct,{src:(null==C?void 0:C.photo_url)||void 0,sx:{width:32,height:32,mr:1},children:((null==(r=null==C?void 0:C.first_name)?void 0:r[0])||"?").toUpperCase()}),$e.jsxs(st,{children:[(null==C?void 0:C.first_name)||(null==C?void 0:C.id),(null==C?void 0:C.last_name)&&` ${C.last_name}`]})]})]}),$e.jsx(Je,{fullWidth:!0,label:"Template"===(null==C?void 0:C.first_name)?i("templates.actions.templateName"):i("templates.actions.workName"),value:E,onChange:e=>O(e.target.value),margin:"normal",required:!0,error:!!H.name,helperText:H.name}),"Template"!==(null==C?void 0:C.first_name)&&!v&&$e.jsx(Ke,{elevation:0,variant:"outlined",sx:{p:2,mt:2,borderColor:F?"primary.main":"divider"},children:$e.jsxs(Be,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[$e.jsx(tt,{checked:F,onChange:e=>P(e.target.checked),color:"primary",disabled:!!N&&$<=0||!N}),$e.jsxs(Be,{sx:{flex:1},children:[$e.jsx(st,{variant:"h6",color:"primary",gutterBottom:!0,children:i("works.creator.redeemLesson")}),N&&$e.jsx(st,{variant:"body2",children:i("works.creator.availableLessons",{count:$})}),N&&$<=0&&$e.jsx(st,{variant:"body2",color:"error",children:i("works.creator.noLessonsAvailable")}),!N&&$e.jsx(st,{variant:"body2",color:"error",children:i("works.creator.noActiveContract")})]})]})})]}),$e.jsxs(Ke,{variant:"outlined",sx:{height:"100%",overflow:"auto",mb:1,display:"flex",flexDirection:"column"},children:[0===T.length&&$e.jsx(Be,{sx:{p:2,textAlign:"center"},children:$e.jsx(st,{variant:"body2",color:"text.secondary",children:i("works.empty.noTasks")})}),$e.jsxs(Te,{onSortEnd:(e,t)=>{e<0||t<0||e>=T.length||t>=T.length||e===t||(I((s=>{const a=[...s],[n]=a.splice(e,1);return a.splice(t,0,n),a})),de((e=>e+1)))},lockAxis:"y",className:"sortable-list",draggedItemClassName:"dragged-item",allowDrag:!0,as:"div",style:{overflowY:"auto",overflowX:"hidden",padding:0,minHeight:"100px",position:"relative"},children:[T.map(((e,t)=>$e.jsx(Ie,{children:$e.jsxs(Be,{sx:{display:"flex",alignItems:"center",p:1,borderBottom:1,borderColor:"divider","&:last-child":{borderBottom:0},cursor:"pointer","&:hover":{backgroundColor:"action.hover"}},children:[$e.jsxs(Be,{sx:{display:"flex",alignItems:"center",flex:1},children:[$e.jsx(Ze,{children:$e.jsx(Ae,{sx:{mr:1,color:"primary.main",cursor:"grab"}})}),$e.jsx(Be,{sx:{flex:1},onClick:()=>_e(e),children:$e.jsx(st,{variant:"body1",sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"},children:`${t+1}. ${e.title}`})})]}),$e.jsx(Be,{sx:{display:"flex",alignItems:"center"},children:$e.jsx(bt,{title:i("common.actions.remove"),children:$e.jsx(Qe,{edge:"end",onClick:t=>{t.stopPropagation(),ye(e)},size:"small",children:$e.jsx(m,{})})})})]})},`task-${e.id}-pos-${t}`))),$e.jsxs(Be,{sx:{p:2,display:"flex",justifyContent:"center",gap:2},children:[C&&"Template"===(null==C?void 0:C.first_name)&&$e.jsx(bt,{title:i("works.creator.autoSaveHint"),children:$e.jsx(Ve,{variant:"outlined",color:"primary",onClick:()=>{ve(!1).then((e=>{e&&l(`/tasks/new?work_id=${e}&return_to=/works/assign/%3Fwork_id=${e}%26edit=true%26return_to=${u}`)}))},disabled:U||!C||!E.trim(),sx:{wordWrap:"nowrap"},children:i("tasks.actions.createTask")})}),$e.jsx(Ve,{variant:"contained",color:"primary",onClick:()=>{De(!0)},children:i("works.creator.addExistingTask")})]}),!C||!E.trim()&&$e.jsx(st,{variant:"body2",color:"error.main",sx:{p:2,textAlign:"center"},children:C?E.trim()?"":i("works.creator.enterWorkName"):i("works.creator.selectStudent")})]},`sortable-list-${ce}`)]}),H.task_ids&&$e.jsx(vt,{error:!0,children:H.task_ids})]}),$e.jsxs(Be,{sx:{mt:1,display:"flex",justifyContent:"space-between",mx:"auto",width:"100%",maxWidth:"800px",flexShrink:0},children:[$e.jsx(Ve,{variant:"outlined",color:"inherit",onClick:()=>{J>=1?X(!0):u?l(u):"Template"===(null==C?void 0:C.first_name)?l("/templates"):l("/works")},sx:{mr:2},children:i("common.actions.cancel")}),$e.jsxs(Be,{sx:{display:"flex",gap:2},children:[J>0&&!v&&$e.jsx(Ve,{variant:"outlined",onClick:()=>Y(0),children:i("common.actions.back")}),J<1?$e.jsx(Ve,{variant:"contained",color:"primary",onClick:()=>Y(1),disabled:!C,children:i("common.actions.next")}):$e.jsx(Ve,{variant:"contained",color:"primary",onClick:()=>ve(!0),disabled:U||!C||!E.trim(),sx:{wordWrap:"nowrap"},children:U?i("common.status.saving"):v?i("common.actions.save"):"Template"===(null==C?void 0:C.first_name)?i("templates.actions.createTemplate"):i("templates.actions.sendToStudent")})]})]}),$e.jsx(g,{open:re,onClose:je,task:ae,hasQuizzes:!1,onValidateAnswers:()=>{},actionButtons:$e.jsxs(Be,{sx:{display:"flex",gap:1,width:"100%",justifyContent:"space-between"},children:[$e.jsx(Be,{sx:{display:"flex",gap:1},children:ae&&$e.jsxs($e.Fragment,{children:[$e.jsx(bt,{title:i("works.creator.autoSaveHint"),children:$e.jsx(Ve,{size:"small",variant:"outlined",startIcon:$e.jsx(f,{}),onClick:()=>{ve(!1).then((e=>{e&&(l(`/tasks/${ae.id}/edit?return_to=/works/assign/%3Fwork_id=${e}%26edit=true`),je())}))},children:i("common.actions.edit")})}),$e.jsx(Ve,{size:"small",onClick:e=>{e.stopPropagation(),ye(ae),je()},startIcon:T.some((e=>e.id===ae.id))?$e.jsx(m,{}):$e.jsx(d,{}),children:T.some((e=>e.id===ae.id))?i("common.actions.remove"):i("common.actions.add")})]})}),$e.jsx(Ve,{onClick:je,children:i("common.actions.close")})]})}),$e.jsxs(ot,{open:Q,onClose:Fe,maxWidth:"xs",fullWidth:!0,children:[$e.jsx(lt,{children:i("common.dialog.cancel.title")}),$e.jsx(ct,{children:$e.jsx(st,{children:i("common.dialog.cancel.message")})}),$e.jsxs(dt,{children:[$e.jsx(Ve,{onClick:Fe,children:i("common.actions.no")}),$e.jsx(Ve,{onClick:()=>{X(!1),u?l(u):"Template"===(null==C?void 0:C.first_name)?l("/templates"):l("/works")},color:"error",children:i("common.actions.yes")})]})]}),$e.jsxs(St,{anchor:"right",open:Pe,onClose:Me,sx:{"& .MuiDrawer-paper":{width:"100%",maxWidth:"800px",height:"100%",display:"flex",flexDirection:"column",borderRadius:0}},children:[$e.jsxs(Be,{sx:{px:2,py:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[$e.jsx(st,{variant:"h6",children:i("works.creator.addTasks")}),$e.jsx(Ve,{onClick:Me,size:"small",variant:"contained",color:"primary",children:i("common.actions.done")})]}),$e.jsx(Be,{sx:{flex:1,overflow:"auto",px:2},children:$e.jsx(Ee,{selectedTasks:T,onTaskToggle:ye,onPreviewTask:_e})})]})]})}},Symbol.toStringTag,{value:"Module"})),vn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const{t:r}=s(),{user:i}=e(),{showErrorToast:o}=t(),d=ze.useRef(null),[u,h]=ze.useState([]),[x,g]=ze.useState(!0),[v,_]=ze.useState(null),[j,b]=ze.useState(0),[k,w]=ze.useState(""),[C,S]=ze.useState(!1),[T,I]=ze.useState({}),[Z,A]=ze.useState(null),[E,O]=ze.useState(null),[F,P]=ze.useState(!1),[N,R]=ze.useState(""),[z,$]=ze.useState(!1),D=Ne(),M=(null==i?void 0:i.role)===a.ADMIN,L=(null==i?void 0:i.role)===a.TEACHER||M;ze.useEffect((()=>{(async()=>{g(!0),_(null);try{const e=await n.tags.getAll();h(e),_(null)}catch(e){const t=y(e);_(t),o(t)}finally{g(!1)}})()}),[j]),ze.useCallback((()=>{b((e=>e+1))}),[]);const W=async()=>{var e;const{isValid:t,errors:s}=dn(an,{name:k});if(t){S(!0);try{const t=await n.tags.create({name:k.trim()});h((e=>[t,...e])),w(""),I({}),null==(e=d.current)||e.focus()}catch(a){const e=a instanceof Error?a.message:"Failed to create tag. Please try again.";o(e)}finally{S(!1)}}else I(s)},B=()=>{A(null)},U=()=>{P(!1),R("")},V=()=>{$(!1)};return $e.jsxs(Be,{children:[$e.jsx(c,{title:r("navigation.tags")}),x?$e.jsx(p,{message:r(x?"common.loading":"tags.loading.tags")}):$e.jsxs($e.Fragment,{children:[$e.jsx(Ke,{sx:{p:3,mb:3,mx:"auto",maxWidth:"1200px"},children:$e.jsxs(Be,{sx:{display:"flex",gap:1,alignItems:"center"},children:[$e.jsx(Je,{inputRef:d,fullWidth:!0,autoComplete:"off",autoCapitalize:"off",size:"small",placeholder:r("tags.input.placeholder"),value:k,onChange:e=>{w(e.target.value),T.name&&I((e=>({...e,name:""})))},onKeyPress:e=>{"Enter"===e.key&&k.trim()&&W()},error:!!T.name,helperText:T.name,InputProps:{endAdornment:k?$e.jsx(Ye,{position:"end",children:$e.jsx(Qe,{size:"small",onClick:()=>{w(""),I({})},edge:"end",children:$e.jsx(m,{})})}):null}}),k.trim()&&$e.jsx(Ve,{size:"small",startIcon:$e.jsx(Oe,{}),onClick:W,disabled:C,children:r(C?"common.status.saving":"common.actions.create")})]})}),v||0!==u.length?$e.jsx(Ke,{sx:{p:3,mx:"auto",maxWidth:"1200px"},children:$e.jsx(Be,{sx:{display:"flex",flexWrap:"wrap",gap:1,mt:1},children:u.map((e=>$e.jsx(Be,{children:$e.jsx(Ge,{onClick:t=>((e,t)=>{e.stopPropagation(),O(t),A(e.currentTarget)})(t,e),label:e.name,sx:{m:.5,height:"auto",borderRadius:"16px","& .MuiChip-label":{px:1.5,py:.5}},variant:"outlined"})},e.id)))})}):$e.jsx(Be,{sx:{textAlign:"center",py:4},children:$e.jsx(st,{variant:"h6",color:"text.secondary",sx:{mb:1},children:r(L?"tags.empty.teacher":"tags.empty.default")})})]}),$e.jsxs(it,{anchorEl:Z,open:Boolean(Z),onClose:B,onClick:e=>e.stopPropagation(),children:[$e.jsxs(De,{onClick:()=>{B(),D(`/tasks?tag_id=${null==E?void 0:E.id}`)},children:[$e.jsx(Me,{children:$e.jsx(Fe,{fontSize:"small"})}),$e.jsx(Le,{children:r("tags.actions.showTasks")})]}),$e.jsxs(De,{onClick:()=>{E&&(R(E.name),P(!0)),B()},children:[$e.jsx(Me,{children:$e.jsx(f,{fontSize:"small"})}),$e.jsx(Le,{children:r("common.actions.rename")})]}),$e.jsxs(De,{onClick:()=>{B(),$(!0)},sx:{color:"error.main"},children:[$e.jsx(Me,{sx:{color:"error.main"},children:$e.jsx(l,{fontSize:"small"})}),$e.jsx(Le,{children:r("common.actions.delete")})]})]}),$e.jsxs(ot,{open:F,onClose:U,maxWidth:"xs",fullWidth:!0,children:[$e.jsx(lt,{children:r("tags.dialog.rename.title")}),$e.jsx(ct,{children:$e.jsx(Je,{autoFocus:!0,margin:"dense",label:r("tags.input.label"),type:"text",fullWidth:!0,value:N,onChange:e=>R(e.target.value),variant:"outlined"})}),$e.jsxs(dt,{children:[$e.jsx(Ve,{onClick:U,children:r("common.actions.cancel")}),$e.jsx(Ve,{onClick:async()=>{if(!E||!N.trim())return;const{isValid:e,errors:t}=dn(an,{name:N});if(e)try{const e=await n.tags.update(E.id,{name:N.trim()});h((t=>t.map((t=>t.id===E.id?e:t)))),P(!1),R(""),O(null)}catch(s){const e=s instanceof Error?s.message:"Failed to rename tag. Please try again.";o(e)}else o(t.name)},variant:"contained",disabled:!N.trim()||N===(null==E?void 0:E.name),children:r("common.actions.rename")})]})]}),$e.jsxs(ot,{open:z,onClose:V,maxWidth:"xs",fullWidth:!0,children:[$e.jsx(lt,{children:r("tags.dialog.delete.title")}),$e.jsx(ct,{children:$e.jsx(st,{children:r("tags.dialog.delete.message",{name:null==E?void 0:E.name})})}),$e.jsxs(dt,{children:[$e.jsx(Ve,{onClick:V,children:r("common.actions.cancel")}),$e.jsx(Ve,{onClick:async()=>{E&&(await(async e=>{try{await n.tags.delete(e),h((t=>t.filter((t=>t.id!==e))))}catch(t){const e=t instanceof Error?t.message:"Failed to delete tag. Please try again.";o(e)}})(E.id),$(!1))},color:"error",variant:"contained",children:r("common.actions.delete")})]})]})]})}},Symbol.toStringTag,{value:"Module"})),_n=()=>{var r,i,o,l,c;const{t:d}=s(),u=Ne(),{contractId:m}=pt(),[h]=Re(),f=h.get("return_to")||"/contracts",{user:x}=e(),{showErrorToast:g,showToast:y}=t(),v="true"===h.get("testStudent"),_="teachair_test_student",[j,b]=ze.useState(!0),[k,w]=ze.useState(!1),[C,S]=ze.useState(null),[T,I]=ze.useState([]),[Z,A]=ze.useState({username:"",price:"",currency:null,balance:null,description:""}),[E,O]=ze.useState({}),[F,P]=ze.useState(null),[N,R]=ze.useState(!1),[z,$]=ze.useState(!1),D=(null==x?void 0:x.role)===a.ADMIN,M=(null==x?void 0:x.role)===a.TEACHER||D,L=Boolean(m);ze.useEffect((()=>{(async()=>{b(!0);try{const e=await n.contracts.getCurrencies();I(e);const t=e.find((e=>"RUR"===e.code))||e[0];if(m){const t=await n.contracts.getById(m);S(t);let s=null;t.currency?s=t.currency:e.length>0&&(s=e[0].code),A({username:t.student_id,price:t.price,currency:s,balance:t.balance,description:t.description||""})}else v?A((e=>({...e,username:_||"",price:1e3,currency:"RUR",balance:10,description:d("contracts.form.testStudentDescription")}))):t&&!Z.currency&&A((e=>({...e,currency:t.code})))}catch(e){const t=e instanceof Error?e.message:"Failed to load data. Please try again.";g(t),u("/contracts")}finally{b(!1)}})()}),[m,u,g,v,_,d]);return M?$e.jsxs(Be,{sx:{display:"flex",flexDirection:"column",overflowX:"hidden",overflowY:"auto"},children:[j?$e.jsx(p,{message:d(L?"contracts.status.loadingContract":"common.loading")}):$e.jsx($e.Fragment,{children:$e.jsxs(Be,{sx:{flex:1,display:"flex",flexDirection:"column",mx:"auto",width:"100%",maxWidth:"800px",pb:1},children:[$e.jsxs(Ke,{sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",p:2,py:1},children:[$e.jsx(Be,{sx:{mt:2,mb:3},children:$e.jsx(st,{variant:"h4",children:d(L?"contracts.actions.edit":"contracts.actions.create")})}),$e.jsxs(Be,{component:"form",noValidate:!0,children:[L?$e.jsxs(Be,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[$e.jsx(Ct,{src:(null==(r=null==C?void 0:C.student)?void 0:r.photo_url)||void 0,sx:{width:48,height:48},children:((null==(o=null==(i=null==C?void 0:C.student)?void 0:i.first_name)?void 0:o[0])||"?").toUpperCase()}),$e.jsxs(Be,{children:[$e.jsxs(st,{variant:"h6",children:[null==(l=null==C?void 0:C.student)?void 0:l.first_name," ",null==(c=null==C?void 0:C.student)?void 0:c.last_name]}),$e.jsx(st,{variant:"body2",color:"text.secondary",children:d("common.student.one")})]})]}):$e.jsx(Je,{autoFocus:!0,margin:"normal",name:"username",label:d("contracts.form.studentUsername"),type:"text",fullWidth:!0,variant:"outlined",value:Z.username,onChange:e=>{const t=e.target.value;let s;s=t.includes("@")&&t.indexOf("@")>0?t.split("@")[0]:t.replace(/^@/,""),A((e=>({...e,username:s}))),E.username&&O((e=>{const t={...e};return delete t.username,t}))},error:!!E.username,helperText:E.username||d("contracts.form.telegramUsername"),placeholder:d("contracts.form.usernamePlaceholder"),InputProps:{startAdornment:$e.jsx(st,{sx:{mr:.5},children:"@"})}}),$e.jsxs(Be,{sx:{display:"flex",gap:2,alignItems:"flex-start"},children:[$e.jsx(Je,{margin:"normal",name:"price",label:d("contracts.form.pricePerLesson"),type:"number",sx:{flex:1},variant:"outlined",value:0===Z.price?"":Z.price,onChange:e=>{const t=e.target.value,s=""===t?0:Number(t.replace(/^0+/,""));A((e=>({...e,price:s}))),E.price&&O((e=>{const t={...e};return delete t.price,t}))},error:!!E.price,helperText:E.price}),$e.jsxs(Tt,{margin:"normal",sx:{minWidth:120},error:!!E.currency,children:[$e.jsx(It,{id:"currency-label",children:d("contracts.form.currency")}),$e.jsx(Zt,{labelId:"currency-label",name:"currency",value:Z.currency||"",label:d("contracts.form.currency"),onChange:e=>{const{name:t,value:s}=e.target;A((e=>({...e,[t]:s}))),E[t]&&O((e=>{const s={...e};return delete s[t],s}))},children:T.map((e=>$e.jsxs(De,{value:e.code,children:[e.emoji,"   ",e.code]},e.code)))})]})]}),L?$e.jsxs(st,{variant:"body1",color:"text.secondary",sx:{mt:1},children:[d("contracts.form.currentBalance"),": ",Z.balance]}):$e.jsx(Je,{margin:"normal",name:"balance",label:d("contracts.form.balanceLabel"),type:"number",fullWidth:!0,variant:"outlined",value:null===Z.balance?"":Z.balance,onChange:e=>{const t=e.target.value,s=""===t?null:Number(t.replace(/^0+/,""));A((e=>({...e,balance:s}))),E.balance&&O((e=>{const t={...e};return delete t.balance,t}))},error:!!E.balance,helperText:E.balance||d("contracts.form.balanceHint")}),$e.jsx(Je,{margin:"normal",name:"description",label:d("contracts.form.description"),type:"text",fullWidth:!0,variant:"outlined",value:Z.description,onChange:e=>{const{name:t,value:s}=e.target;A((e=>({...e,[t]:"price"===t||"balance"===t?Number(s):s}))),E[t]&&O((e=>{const s={...e};return delete s[t],s}))},multiline:!0,rows:3,error:!!E.description,helperText:E.description||d("contracts.form.descriptionHint")})]})]}),$e.jsxs(Be,{sx:{mt:2,display:"flex",justifyContent:"space-between",flexShrink:0},children:[$e.jsx(Be,{sx:{display:"flex",alignItems:"center"},children:$e.jsx(Ve,{variant:"outlined",color:"inherit",sx:{mr:2},onClick:()=>u(f),children:d("common.actions.cancel")})}),$e.jsx(Be,{children:$e.jsx(Ve,{variant:"contained",color:"primary",onClick:async()=>{const{isValid:e,errors:t}=dn(L?on:rn,Z);if(e){w(!0);try{if(L&&m)await n.contracts.update(m,{price:Z.price,currency:Z.currency,balance:Z.balance??0,description:Z.description}),u(f);else{const e=await n.contracts.create({...Z,balance:Z.balance??0});"new_user_created"===e.create_code?(P(e.id),R(!0),y(d("contracts.status.contractCreated"),"success")):"already_exists"===e.create_code?(P(e.id),$(!0)):(P(null),R(!1),$(!1),u(f))}}catch(s){const e=s instanceof Error?s.message:d("contracts.status.errorCreating");if(e.includes("student_is_self"))return void g(d("contracts.status.studentIsSelf"));if(e.includes("student_is_teacher"))return void g(d("contracts.status.studentIsTeacher"));g(e)}finally{w(!1)}}else O(t)},disabled:k||!L&&!Z.username.trim(),children:d(k?"common.status.saving":L?"contracts.actions.update":"contracts.actions.create")})})]})]})}),$e.jsx(Pe,{open:N,onClose:()=>R(!1),onCancel:()=>u(f),botUrl:"https://t.me/teachair_bot",cancelButtonText:d("common.actions.done")}),$e.jsxs(ot,{open:z,onClose:()=>$(!1),maxWidth:"xs",fullWidth:!0,children:[$e.jsx(lt,{children:d("contracts.dialog.existingContract.title")}),$e.jsx(ct,{children:$e.jsx(st,{children:d("contracts.dialog.existingContract.message")})}),$e.jsxs(dt,{children:[$e.jsx(Ve,{onClick:()=>$(!1),children:d("common.actions.cancel")}),$e.jsx(Ve,{onClick:()=>{$(!1),F&&u(`/contracts/${F}/edit`)},color:"primary",variant:"contained",children:d("contracts.actions.editExisting")})]})]})]}):(u("/contracts"),null)},jn=Object.freeze(Object.defineProperty({__proto__:null,ContractFormPage:_n,default:_n},Symbol.toStringTag,{value:"Module"}));export{fn as A,jn as C,pn as P,mn as T,gn as a,yn as b,vn as c,cn as f,dn as v,sn as z};
