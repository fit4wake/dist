import{Z as e,a7 as t,r,G as s,J as l,j as a,B as o,x as n,w as i,Q as d,U as c,d as u,f as m,h as x,n as p,u as h,a8 as f,ar as g,as as j,b as v,A as y,H as b,D as w,i as k,v as S,l as C,m as F,M as T,y as D,a3 as I,aa as z,a4 as W,K as _}from"./vendor-BGxxnuh9.js";import{u as E,a as L,b as O,aA as B,U as $,c as A,g as P,P as M,aB as R,A as U,e as H,f as N,d as K,aC as q,E as J,L as G,aD as Q,M as V,aE as Z,aF as X,D as Y,I as ee,aG as te,h as re,ar as se,k as le}from"./main-CvojmzyX.js";import{v as ae,f as oe}from"./teacher-DoM-y89u.js";const ne=e=>{const t=e?`/#/templates?folder=${e}`:"/#/templates";window.history.replaceState({},"",t)};function ie(e){let t,r=0;for(t=0;t<e.length;t+=1)r=e.charCodeAt(t)+((r<<5)-r);let s="#";for(t=0;t<3;t+=1){const e=r>>8*t&255;s+=`00${Math.min(255,Math.floor((e+128)/2)).toString(16)}`.slice(-2)}return s}function de(e){if(!e)return"?";const t=e.split(" ");return 1===t.length?t[0][0].toUpperCase():`${t[0][0]}${t[1][0]}`.toUpperCase()}const ce="templatesPageFilters",ue=({work:t,onClick:s,onDelete:l})=>{const n=e(),[i,d]=r.useState(null),[c,m]=r.useState(!1),[h,f]=r.useState(!1),{showErrorToast:g,showToast:j}=L(),{t:y}=O(),[S]=z(),D="true"===S.get("onboarding"),E=()=>{d(null)},B=()=>{const e=D?"/":"/templates";n(`/works/assign/?work_id=${t.id}&copy=true&return_to=${e}`)};return a.jsxs(a.Fragment,{children:[a.jsx(I,{className:"template-card",draggable:!0,onDragStart:e=>{e.dataTransfer.setData("text/plain",t.id),e.currentTarget.style.opacity="0.5"},onDragEnd:e=>{e.currentTarget.style.opacity="1"},onDragOver:e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget.style.cursor="default"},sx:{height:"100%",cursor:"pointer","&:hover":{boxShadow:6},position:"relative",borderLeft:"4px solid",borderLeftColor:"primary.main",borderRadius:3,borderTopLeftRadius:2,borderBottomLeftRadius:3},onClick:()=>s(t,"view"),children:a.jsx(W,{sx:{p:2,"&:last-child":{paddingBottom:2}},children:a.jsxs(o,{sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:1},children:[a.jsx(v,{sx:{flex:1,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:1.2},children:t.name}),a.jsx(_,{title:y("templates.actions.sendToStudent"),children:a.jsx(x,{size:"small",onClick:B,sx:{flexShrink:0},children:a.jsx(le,{fontSize:"small"})})}),a.jsx(x,{size:"small",onClick:e=>{e.stopPropagation(),d(e.currentTarget)},sx:{flexShrink:0},children:a.jsx(V,{fontSize:"small"})})]})})},t.id),a.jsxs(T,{anchorEl:i,open:Boolean(i),onClose:E,onClick:e=>e.stopPropagation(),children:[a.jsxs(u,{onClick:()=>{n(`/works/assign/?work_id=${t.id}&edit=true&return_to=/templates`)},children:[a.jsx(J,{fontSize:"small",sx:{mr:1}}),y("common.actions.edit")]}),a.jsxs(u,{onClick:B,children:[a.jsx(Z,{fontSize:"small",sx:{mr:1}}),y("common.actions.copy")]}),a.jsxs(u,{onClick:()=>{E(),s(t,"move")},children:[a.jsx(X,{fontSize:"small",sx:{mr:1}}),y("common.actions.moveTo")]}),a.jsxs(u,{onClick:()=>{E(),m(!0)},disabled:h,sx:{color:"error.main"},children:[h?a.jsx(b,{size:20,sx:{mr:1}}):a.jsx(Y,{fontSize:"small",sx:{mr:1}}),y("common.actions.delete")]})]}),a.jsxs(w,{open:c,onClose:()=>!h&&m(!1),maxWidth:"xs",fullWidth:!0,children:[a.jsx(k,{children:y("common.dialog.delete.title",{item:y("templates.titleSingle")})}),a.jsx(C,{children:a.jsx(v,{children:y("common.dialog.delete.message",{name:null==t?void 0:t.name})})}),a.jsxs(F,{children:[a.jsx(p,{onClick:()=>m(!1),disabled:h,children:y("common.actions.cancel")}),a.jsx(p,{onClick:async()=>{f(!0);try{await A.works.delete(t.id),l(t),j(y("templates.status.templateDeleted"),"success")}catch(e){g(P(e))}finally{f(!1),m(!1)}},color:"error",variant:"contained",disabled:h,startIcon:h?a.jsx(b,{size:20}):a.jsx(Y,{}),children:y(h?"common.status.deleting":"common.actions.delete")})]})]})]})},me=({folder:e,onClick:t,onContextMenu:r,onDrop:s,onFolderDrop:l,allWorks:n,isNewFolder:i=!1})=>a.jsxs(o,{sx:{width:120},children:[a.jsx(I,{className:i?"folder-card":"","data-folder-id":e.id,draggable:!0,onDragStart:t=>{t.dataTransfer.setData("folder-id",e.id),t.currentTarget.style.opacity="0.5"},onDragEnd:e=>{e.currentTarget.style.opacity="1"},onDragOver:e=>{e.preventDefault(),e.currentTarget.style.boxShadow="0 0 10px 0 rgba(0, 0, 0, 0.1)",e.currentTarget.style.transform="scale(1.1)",e.currentTarget.style.transition="transform 0.2s ease"},onDragLeave:e=>{e.currentTarget.style.boxShadow="none",e.currentTarget.style.transform="scale(1)"},onDrop:t=>{t.preventDefault(),t.currentTarget.style.boxShadow="none",t.currentTarget.style.transform="scale(1)";const r=t.dataTransfer.getData("text/plain"),a=t.dataTransfer.getData("folder-id");if(r){const t=n.find((e=>e.id===r));t&&s(t,e.id)}else a&&l(a,e.id)},sx:{cursor:"pointer","&:hover":{boxShadow:6,transform:"scale(1.05)",transition:"transform 0.2s ease"},position:"relative",zIndex:0,width:"100%",display:"flex",flexDirection:"column","&.folder-card":{transition:"transform 0.2s ease",animation:"zoomIn 0.3s ease","@keyframes zoomIn":{"0%":{transform:"scale(0)",opacity:0},"80%":{transform:"scale(1.05)",opacity:1},"100%":{transform:"scale(1)",opacity:1}}}},onClick:()=>t(e),onContextMenu:t=>r(t,e),children:a.jsxs(o,{sx:{position:"relative",width:"100%",paddingTop:"150%",overflow:"hidden"},children:[a.jsx(y,{variant:"square",src:e.cover||void 0,sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",bgcolor:e.cover?"primary.main":ie(e.title),fontSize:"300%"},children:!e.cover&&de(e.title)}),a.jsx(x,{size:"small",onClick:t=>{t.stopPropagation(),r(t,e)},sx:{position:"absolute",bottom:4,right:4,bgcolor:"background.paper",opacity:.5,"&:hover":{bgcolor:"background.default",opacity:1}},children:a.jsx(V,{fontSize:"small"})})]})}),a.jsx(v,{sx:{mt:2,width:"100%",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:1.2,textAlign:"center"},children:e.title})]}),xe=()=>{var I,z,W,_,le,de;const{user:xe}=E(),pe=e(),he=t(),{showErrorToast:fe,showToast:ge}=L(),{t:je}=O(),ve=new URLSearchParams(he.search).get("teacher");new URLSearchParams(he.search).get("folder");const ye="true"===new URLSearchParams(he.search).get("clear_filters"),[be,we]=r.useState(null),[ke,Se]=r.useState((()=>{try{if(ye)return localStorage.removeItem(ce),{teacherFilter:"",searchTerm:"",folderState:void 0};const e=localStorage.getItem(ce);if(e){const t=JSON.parse(e);return we(t),t}}catch(e){}return{teacherFilter:"",searchTerm:"",folderState:void 0}})),[Ce,Fe]=r.useState(ke.teacherFilter),[Te,De]=r.useState(ke.searchTerm),[Ie,ze]=r.useState(ke.searchTerm),[We,_e]=r.useState(ke.folderState||{currentFolder:null,breadcrumbs:[]}),[Ee,Le]=r.useState([]),[Oe,Be]=r.useState([]),[$e,Ae]=r.useState([]),[Pe,Me]=r.useState(!0),[Re,Ue]=r.useState(!1),[He,Ne]=r.useState(!0),[Ke,qe]=r.useState(null),[Je,Ge]=r.useState(null),[Qe,Ve]=r.useState(null),[Ze,Xe]=r.useState(!1),[Ye,et]=r.useState(!1),[tt,rt]=r.useState(!1),[st,lt]=r.useState(null),at=Boolean(st),[ot,nt]=r.useState(!1),[it,dt]=r.useState(0),ct=r.useRef(!0),[ut,mt]=r.useState(0),[xt,pt]=r.useState(!0),ht=15,[ft,gt]=r.useState([]),[jt,vt]=r.useState(!0),[yt,bt]=r.useState(!1),[wt,kt]=r.useState({title:"",description:"",type:B.BOOK,cover:void 0}),[St,Ct]=r.useState(!1),[Ft,Tt]=r.useState(null),[Dt,It]=r.useState(null),[zt,Wt]=r.useState(!1),[_t,Et]=r.useState(null),[Lt,Ot]=r.useState(!1),[Bt,$t]=r.useState(!1),[At,Pt]=r.useState(!1),[Mt,Rt]=r.useState([]),[Ut,Ht]=r.useState(!0),[Nt,Kt]=r.useState(0),[qt,Jt]=r.useState(!0),[Gt,Qt]=r.useState(!1),Vt=r.useRef(null),[Zt,Xt]=r.useState(!1),[Yt,er]=r.useState((()=>{try{const e=localStorage.getItem("templatesAccordionState");return e?JSON.parse(e):{folders:!0,allTemplates:!0}}catch{return{folders:!0,allTemplates:!0}}})),[tr,rr]=r.useState(!1),[sr,lr]=r.useState(!1),[ar,or]=r.useState(!1),[nr,ir]=r.useState(null),[dr,cr]=r.useState(!1);r.useEffect((()=>{const e=setTimeout((()=>{Ie!==Te&&De(Ie)}),500);return()=>clearTimeout(e)}),[Ie]);const ur=(null==xe?void 0:xe.role)===$.ADMIN,mr=(null==xe?void 0:xe.role)===$.TEACHER||ur;r.useEffect((()=>{if(!ct.current){const e={teacherFilter:Ce,searchTerm:Te,folderState:We};localStorage.setItem(ce,JSON.stringify(e))}}),[Ce,Te,We]),r.useEffect((()=>{(async()=>{if(!ot){Ne(!0),qe(null);try{if(ve&&Fe(ve),ur){const e=(await A.users.getAll(0,100,void 0,$.TEACHER)).sort(((e,t)=>{const r=`${e.first_name||""} ${e.last_name||""}`.trim().toLowerCase(),s=`${t.first_name||""} ${t.last_name||""}`.trim().toLowerCase();return r.localeCompare(s)}));Ae(e)}ct.current=!1}catch(e){const t=P(e);qe(t),nt(!0),fe(t)}finally{Ne(!1)}}})()}),[ve,ur,ot]),r.useEffect((()=>{(async()=>{if(!He&&!ct.current){vt(!0);try{if(!We.currentFolder){const e=await A.folders.getAll(0,100,void 0,void 0,Ce||(null==xe?void 0:xe.id),Te);gt(e)}}catch(e){fe(P(e))}finally{vt(!1)}}})()}),[Ce,null==xe?void 0:xe.id,Te,We.currentFolder,He]),r.useEffect((()=>{(async()=>{if(!He&&!ct.current){Me(!0),qe(null);try{const e=Ce||(null==xe?void 0:xe.id);let t=[];t=We.currentFolder?(We.currentFolder.works||[]).filter((e=>e.name.toLowerCase().includes(Te.toLowerCase()))):await A.works.getAll(0,ht,void 0,e,e,Te);const r=[...t].sort(((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()));Le(r),mt(0),pt(t.length===ht),qe(null)}catch(e){const t=P(e);qe(t),fe(t)}finally{Me(!1)}}})()}),[Ce,null==xe?void 0:xe.id,We.currentFolder,Te,He]),r.useEffect((()=>{var e,t,r;be&&(null==(e=be.folderState)?void 0:e.currentFolder)&&A.folders.getById(null==(r=null==(t=be.folderState)?void 0:t.currentFolder)?void 0:r.id).then((e=>{_e((t=>({...t,currentFolder:e})))}))}),[be]),r.useEffect((()=>{(async()=>{if(!He&&!ct.current){Ht(!0);try{const e=Ce||(null==xe?void 0:xe.id),t=await A.works.getAll(0,ht,void 0,e,e,Te),r=[...t].sort(((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()));Rt(r),Kt(0),Jt(t.length===ht)}catch(e){fe(P(e))}finally{Ht(!1)}}})()}),[Ce,null==xe?void 0:xe.id,Te,He]);const xr=r.useCallback((async()=>{if(!qt||Gt)return;Qt(!0);const e=Nt+1;try{const t=Ce||(null==xe?void 0:xe.id),r=await A.works.getAll(e*ht,ht,void 0,t,t,Te);if(r.length>0){const t=[...r].sort(((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()));Rt((e=>[...e,...t])),Kt(e),Jt(r.length===ht)}else Jt(!1)}catch(t){fe(P(t))}finally{Qt(!1)}}),[qt,Gt,Nt,Ce,null==xe?void 0:xe.id,Te,ht]);r.useEffect((()=>{const e=new IntersectionObserver((e=>{const[t]=e;t.isIntersecting&&qt&&!Ut&&!Gt&&xr()}),{threshold:.5}),t=Vt.current;return t&&e.observe(t),()=>{t&&e.unobserve(t)}}),[qt,Ut,Gt,xr]);const pr=()=>{localStorage.removeItem(ce),Fe(""),De(""),ze("")},hr=(e,t="view")=>{Ve(e),"move"===t?(ir({type:"template",id:e.id}),or(!0),rt(!1)):rt(!0)},fr=()=>{rt(!1),Ve(null),Ge(null),et(!1)},gr=()=>{lt(null)},jr=r.useCallback((()=>{dt((e=>e+1))}),[]),vr=async e=>{vt(!0);try{const t=await A.folders.getById(e.id);_e((r=>({currentFolder:t,breadcrumbs:[...r.breadcrumbs,e]}))),Le(t.works||[]),ne(e.id)}catch(t){fe(P(t))}finally{vt(!1)}},yr=async()=>{try{_e({currentFolder:null,breadcrumbs:[]});const e=Ce||(null==xe?void 0:xe.id),t=await A.works.getAll(0,ht,void 0,e,e,Te),r=[...t].sort(((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()));Rt(r),Kt(0),Jt(t.length===ht),ne(null)}catch(e){fe(P(e))}},br=(e,t)=>{e.preventDefault(),e.stopPropagation(),It(t),Tt(e.currentTarget)},wr=()=>{Tt(null)},kr=async(e,t)=>{try{t?await A.folders.addWork(t,e.id):null!==We.currentFolder&&await A.folders.removeWork(We.currentFolder.id,e.id),null!==We.currentFolder?Le((t=>t.filter((t=>t.id!==e.id)))):Rt((t=>t.filter((t=>t.id!==e.id)))),ge(je("templates.status.templateMoved"),"success")}catch(r){fe(P(r))}},Sr=e=>{Le((t=>t.filter((t=>t.id!==e.id)))),Rt((t=>t.filter((t=>t.id!==e.id))))},Cr=async(e,t)=>{try{if(e===t)return;await A.folders.update(e,{parent_id:t}),We.currentFolder?_e((t=>({...t,currentFolder:{...t.currentFolder,subfolders:t.currentFolder.subfolders.filter((t=>t.id!==e))}}))):gt((t=>t.filter((t=>t.id!==e)))),ge(je("templates.status.folderMoved"),"success")}catch(r){fe(P(r))}},Fr=s(),Tr=l(Fr.breakpoints.down("md")),Dr=e=>{e.dataTransfer.getData("text/plain")||e.dataTransfer.getData("folder-id")?Xt(!0):e.preventDefault()},Ir=()=>{Xt(!1)};r.useEffect((()=>(document.addEventListener("dragstart",Dr),document.addEventListener("dragend",Ir),document.addEventListener("drop",Ir),()=>{document.removeEventListener("dragstart",Dr),document.removeEventListener("dragend",Ir),document.removeEventListener("drop",Ir)})),[]);return a.jsxs(o,{children:[a.jsx(M,{title:je("templates.title"),actionButton:[{label:je(Tr?"templates.actions.folder":"templates.actions.addFolder"),icon:a.jsx(R,{}),onClick:()=>bt(!0)},{label:je(Tr?"templates.actions.template":"templates.actions.createTemplate"),icon:a.jsx(U,{}),onClick:()=>pe(`/works/assign?template=true${We.currentFolder?`&folder=${We.currentFolder.id}`:""}&return_to=/templates`)}]}),a.jsx(n,{sx:{p:2,mb:2},children:a.jsxs(i,{spacing:2,children:[ur&&a.jsx(o,{sx:{display:"flex",flexDirection:"column",gap:2},children:a.jsx(o,{sx:{display:"flex",gap:2,alignItems:"flex-start"},children:a.jsx(d,{fullWidth:!0,size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:2}},children:a.jsxs(c,{value:Ce,onChange:e=>Fe(e.target.value),displayEmpty:!0,children:[a.jsx(u,{value:null==xe?void 0:xe.id,children:je("templates.filters.onlyMy")}),$e.map((e=>a.jsx(u,{value:e.id,children:`${e.first_name||""} ${e.last_name||""}`.trim()||e.id},e.id)))]})})})}),a.jsx(o,{sx:{display:"flex",gap:2},children:a.jsx(m,{label:je("templates.filters.search"),placeholder:We.currentFolder?je("templates.filters.searchInside"):je("templates.filters.searchGlobal"),variant:"outlined",fullWidth:!0,value:Ie,onChange:e=>ze(e.target.value),InputProps:{startAdornment:a.jsx(N,{sx:{mr:1,color:"text.secondary"}}),endAdornment:Ie?a.jsx(x,{"aria-label":"clear search",onClick:()=>{ze(""),De("")},edge:"end",size:"small",children:a.jsx(H,{fontSize:"small"})}):null}})}),(Ie||Te||Ce)&&a.jsx(o,{sx:{display:"flex",justifyContent:"center"},children:a.jsx(p,{variant:"outlined",startIcon:a.jsx(K,{}),onClick:pr,children:je("common.actions.clear")})})]})}),Ke&&a.jsx(h,{severity:"error",sx:{mb:2},action:a.jsx(p,{color:"inherit",size:"small",onClick:jr,disabled:Pe,children:je(Pe?"common.status.loading":"common.actions.retry")}),children:Ke}),a.jsx(o,{sx:{mb:1,height:"2px"},children:jt&&a.jsx(f,{sx:{height:"2px"}})}),((null==(I=We.currentFolder)?void 0:I.subfolders)||ft.length>0)&&a.jsxs(o,{sx:{mb:3},children:[a.jsxs(g,{sx:{ml:1,mb:2,transform:Zt&&We.breadcrumbs.length>0?"scale(2)":"scale(1)",transformOrigin:"left center",transition:"transform 0.3s ease-in-out"},children:[a.jsx(j,{onDrop:e=>{e.preventDefault();const t=e.dataTransfer.getData("text/plain"),r=e.dataTransfer.getData("folder-id");if(t){const e=Ee.find((e=>e.id===t));e&&kr(e,null)}else r&&Cr(r,null)},onDragOver:e=>{e.preventDefault()},component:"button",variant:"body1",onClick:yr,sx:{textDecoration:"none"},children:je("templates.title")}),We.breadcrumbs.map(((e,t)=>t<We.breadcrumbs.length-1?a.jsx(j,{onDrop:t=>{t.preventDefault();const r=t.dataTransfer.getData("text/plain"),s=t.dataTransfer.getData("folder-id");if(r){const t=Ee.find((e=>e.id===r));t&&kr(t,e.id)}else s&&Cr(s,e.id)},onDragOver:e=>e.preventDefault(),component:"button",variant:"body1",onClick:()=>(async(e,t)=>{vt(!0);try{const r=await A.folders.getById(e.id);_e({currentFolder:r,breadcrumbs:We.breadcrumbs.slice(0,t+1)}),ne(e.id)}catch(r){fe(P(r))}finally{vt(!1)}})(e,t),sx:{textDecoration:"none"},children:e.title},e.id):a.jsx(v,{variant:"body1",children:e.title},e.id)))]}),We.currentFolder&&a.jsxs(n,{sx:{p:2,my:3,display:"flex",gap:3,alignItems:"flex-start",position:"relative"},children:[a.jsx(x,{size:"small",onClick:async()=>{if(We.breadcrumbs.length>1){const t=We.breadcrumbs[We.breadcrumbs.length-2];try{const e=await A.folders.getById(t.id);_e((t=>({currentFolder:e,breadcrumbs:t.breadcrumbs.slice(0,-1)}))),ne(t.id)}catch(e){fe(P(e))}}else yr()},sx:{position:"absolute",top:4,left:4,bgcolor:"background.paper",opacity:.5,zIndex:1e3,"&:hover":{bgcolor:"background.default",opacity:1}},children:a.jsx(q,{fontSize:"small"})}),a.jsx(y,{variant:"square",src:We.currentFolder.cover||void 0,sx:{m:-2,mr:1,width:120,height:180,borderRadius:3,bgcolor:We.currentFolder.cover?"primary.main":ie(We.currentFolder.title),fontSize:"300%"},children:!We.currentFolder.cover&&We.currentFolder.title.split(" ").map((e=>e[0])).join("").toUpperCase()}),a.jsxs(o,{sx:{flex:1},children:[a.jsxs(o,{sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:1,mb:1},children:[a.jsx(v,{variant:"h5",sx:{flex:1,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:1.2,whiteSpace:"pre-wrap",wordBreak:"break-word"},children:We.currentFolder.title}),a.jsx(x,{"aria-label":"edit",onClick:()=>{We.currentFolder&&(It(We.currentFolder),kt({title:We.currentFolder.title,description:We.currentFolder.description||"",type:We.currentFolder.type,cover:We.currentFolder.cover||void 0}),Wt(!0),bt(!0))},children:a.jsx(J,{})})]}),We.currentFolder.description&&a.jsxs(o,{onClick:()=>lr(!sr),children:[a.jsx(v,{variant:"body1",color:"text.secondary",sx:{display:"-webkit-box",WebkitLineClamp:sr?"unset":3,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",transition:"all 0.2s ease-in-out",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:We.currentFolder.description}),We.currentFolder.description.split("\n").length>3&&a.jsx(v,{variant:"caption",color:"primary",sx:{cursor:"pointer",display:"block",mt:1,"&:hover":{opacity:.8}},children:sr?"Show less":"Show more"})]})]})]}),a.jsx(o,{sx:{display:"flex",flexWrap:"wrap",gap:5,my:3,mx:1},children:We.currentFolder?((null==(z=We.currentFolder)?void 0:z.subfolders)||[]).map((e=>a.jsx(me,{folder:e,onClick:vr,onContextMenu:br,onDrop:kr,onFolderDrop:Cr,allWorks:Ee},e.id))):ft.map((e=>a.jsx(me,{folder:e,onClick:vr,onContextMenu:br,onDrop:kr,onFolderDrop:Cr,allWorks:Mt},e.id)))}),We.breadcrumbs.length>0&&a.jsxs(a.Fragment,{children:[a.jsx(o,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)",lg:"repeat(3, 1fr)"},gap:2,position:"relative"},children:Ee.map((e=>a.jsx(ue,{work:e,onClick:hr,onDelete:Sr},e.id)))}),0===Ee.length&&a.jsxs(o,{sx:{textAlign:"center",py:4},children:[a.jsx(v,{variant:"h6",color:"text.secondary",sx:{mb:1},children:je("templates.empty.noTemplatesInFolder")}),a.jsx(p,{variant:"outlined",onClick:()=>pe(`/works/assign?template=true${We.currentFolder?`&folder=${We.currentFolder.id}`:""}&return_to=/templates`),children:je("templates.actions.create")})]})]})]}),null===We.currentFolder&&a.jsx(o,{children:Ut?a.jsx(G,{message:je("common.loading")}):a.jsxs(a.Fragment,{children:[0!==Mt.length||Ke?a.jsx(o,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)",lg:"repeat(3, 1fr)"},gap:2,position:"relative"},children:Mt.map((e=>a.jsx(ue,{work:e,onClick:hr,onDelete:Sr},e.id)))}):a.jsxs(o,{sx:{textAlign:"center",py:4},children:[a.jsx(v,{variant:"h6",color:"text.secondary",sx:{mb:1},children:Ce||Te?je("templates.empty.noMatch"):ft.length>0?je("templates.empty.noFolder"):je("templates.empty.noTemplates")}),a.jsx(v,{variant:"body2",color:"text.secondary",sx:{mb:3},children:Ce||Te?je("templates.hint.adjust"):ft.length>0?"":je("templates.hint.createFirst")}),mr&&0===Mt.length&&!Ce&&!Te&&a.jsx(p,{variant:"outlined",onClick:()=>pe(`/works/assign?template=true${We.currentFolder?`&folder=${We.currentFolder.id}`:""}&return_to=/templates`),sx:{borderRadius:2,textTransform:"none",fontWeight:500},children:je("templates.actions.create")}),0===Mt.length&&(Ce||Te)&&a.jsx(p,{variant:"outlined",startIcon:a.jsx(K,{}),onClick:pr,sx:{borderRadius:2,textTransform:"none"},children:je("common.actions.clear")})]}),a.jsx(o,{ref:Vt,sx:{display:"flex",justifyContent:"center",p:2,visibility:qt?"visible":"hidden"},children:Gt&&a.jsx(b,{size:24})})]})}),a.jsxs(w,{open:tt,onClose:fr,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[a.jsx(k,{children:a.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsx(v,{variant:"h6",children:null==Qe?void 0:Qe.name}),Qe&&a.jsx(S,{label:"Template",color:"primary",size:"small"})]})}),a.jsxs(C,{children:[Je&&a.jsx(h,{severity:"error",sx:{mb:2},children:Je}),Qe&&a.jsx(a.Fragment,{children:a.jsx(Q,{work:Qe,isStudent:!1,error:Je,onTaskClick:e=>{Qe&&pe(`/works/${Qe.id}?task_number=${e}&return_to=/templates`)},hideButtons:!0})})]}),a.jsxs(F,{sx:{display:"flex",justifyContent:"space-between",px:2,pb:2},children:[a.jsx(o,{sx:{display:"flex",gap:1},children:mr&&a.jsxs(a.Fragment,{children:[a.jsx(p,{color:"primary",onClick:e=>{e.stopPropagation(),lt(e.currentTarget)},"aria-label":"actions","aria-controls":at?"actions-menu":void 0,"aria-haspopup":"true","aria-expanded":at?"true":void 0,startIcon:a.jsx(V,{}),children:je("common.actions.actions")}),a.jsxs(T,{id:"actions-menu",anchorEl:st,open:at,onClose:gr,MenuListProps:{"aria-labelledby":"actions-button"},children:[a.jsxs(u,{onClick:()=>{var e;e=Qe.id,pe(`/works/assign/?work_id=${e}&edit=true&return_to=/templates`)},children:[a.jsx(J,{fontSize:"small",sx:{mr:1}}),je("works.actions.edit")]}),a.jsxs(u,{onClick:()=>{Qe&&pe(`/works/assign/?work_id=${Qe.id}&copy=true&return_to=/templates`)},children:[a.jsx(Z,{fontSize:"small",sx:{mr:1}}),je("common.actions.copy")]}),a.jsxs(u,{onClick:()=>{gr(),fr(),Qe&&(ir({type:"template",id:Qe.id}),or(!0)),gr()},children:[a.jsx(X,{fontSize:"small",sx:{mr:1}}),je("common.actions.moveTo")]}),a.jsxs(u,{onClick:()=>{gr(),et(!0)},disabled:Ze,sx:{color:"error.main"},children:[Ze?a.jsx(b,{size:20,sx:{mr:1}}):a.jsx(Y,{fontSize:"small",sx:{mr:1}}),je("common.actions.delete")]})]})]})}),a.jsx(o,{children:a.jsx(p,{onClick:fr,children:je("common.actions.close")})})]})]}),a.jsxs(w,{open:Ye,onClose:()=>et(!1),maxWidth:"xs",fullWidth:!0,children:[a.jsx(k,{children:je("common.dialog.delete.title",{item:je("templates.titleSingle")})}),a.jsx(C,{children:a.jsx(v,{children:je("common.dialog.delete.message",{name:null==Qe?void 0:Qe.name})})}),a.jsxs(F,{children:[a.jsx(p,{onClick:()=>et(!1),disabled:Ze,children:je("common.actions.cancel")}),a.jsx(p,{onClick:async()=>{if(Qe){Xe(!0),Ge(null);try{await A.works.delete(Qe.id),Le((e=>e.filter((e=>e.id!==Qe.id)))),Rt((e=>e.filter((e=>e.id!==Qe.id)))),fr(),ge(je("templates.status.templateDeleted"),"success")}catch(e){const t=e instanceof Error?e.message:"Failed to delete work. Please try again.";fe(t)}finally{Xe(!1),et(!1)}}},color:"error",variant:"contained",disabled:Ze,startIcon:Ze?a.jsx(b,{size:20}):a.jsx(Y,{}),children:je(Ze?"common.status.deleting":"common.actions.delete")})]})]}),a.jsxs(w,{open:yt,onClose:()=>!St&&bt(!1),maxWidth:"sm",fullWidth:!0,children:[a.jsx(k,{children:je(zt?"common.actions.edit":"common.actions.create")}),a.jsx(C,{children:a.jsxs(i,{spacing:2,sx:{mt:1},children:[a.jsx(o,{sx:{display:"flex",justifyContent:"center",mb:2},children:At?a.jsx(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:180,width:120},children:a.jsx(b,{})}):a.jsx(y,{variant:"square",src:wt.cover||void 0,sx:{width:120,height:180,borderRadius:3,bgcolor:"primary.main",cursor:"pointer","&:hover":{opacity:.8}},onClick:()=>{rr(!0),Pt(!1)},children:!wt.cover&&a.jsx(ee,{})})}),a.jsx(m,{label:je("templates.dialog.createFolder.name"),value:wt.title,onChange:e=>kt((t=>({...t,title:e.target.value}))),fullWidth:!0,required:!0,disabled:St,error:wt.title.length>100,helperText:wt.title.length>100?je("templates.validation.titleLength"):""}),a.jsx(m,{label:je("templates.dialog.createFolder.description"),value:wt.description,onChange:e=>kt((t=>({...t,description:e.target.value}))),fullWidth:!0,multiline:!0,rows:2,disabled:St,error:(null==(W=wt.description)?void 0:W.length)>1e3,helperText:(null==(_=wt.description)?void 0:_.length)>1e3?je("templates.validation.descriptionLength"):""})]})}),a.jsxs(F,{children:[a.jsx(p,{onClick:()=>{bt(!1),Wt(!1),kt({title:"",description:"",type:B.BOOK,cover:void 0})},disabled:St,children:je("common.actions.cancel")}),a.jsx(p,{onClick:async()=>{var e;if(!wt.title.trim())return;const t=ae(oe,{...wt,type:B.BOOK});if(t.isValid){Ct(!0);try{if(zt&&Dt){const e=await A.folders.update(Dt.id,{...wt});We.currentFolder?We.currentFolder.id===Dt.id?_e((t=>({...t,currentFolder:{...t.currentFolder,...e,subfolders:t.currentFolder.subfolders,works:t.currentFolder.works},breadcrumbs:t.breadcrumbs.map((t=>t.id===Dt.id?{...t,...e}:t))}))):_e((t=>({...t,currentFolder:{...t.currentFolder,subfolders:t.currentFolder.subfolders.map((t=>t.id===Dt.id?e:t))}}))):gt((t=>t.map((t=>t.id===Dt.id?e:t)))),ge(je("folders.status.updated"),"success")}else{const t=await A.folders.create({...wt,parent_id:(null==(e=We.currentFolder)?void 0:e.id)||null});We.currentFolder?_e((e=>({...e,currentFolder:{...e.currentFolder,subfolders:[t,...e.currentFolder.subfolders]}}))):gt((e=>[t,...e])),ge(je("templates.status.folderCreated"),"success")}kt({title:"",description:"",type:B.BOOK,cover:void 0}),bt(!1),Wt(!1)}catch(r){fe(P(r))}finally{Ct(!1)}}else{const e=Object.values(t.errors)[0];fe(e)}},variant:"contained",disabled:St||!wt.title.trim()||wt.title.length>100||((null==(le=wt.description)?void 0:le.length)||0)>1e3,startIcon:St?a.jsx(b,{size:20}):null,children:je(St?"common.loading":zt?"common.actions.save":"common.actions.create")})]})]}),a.jsxs(w,{open:tr,onClose:()=>rr(!1),maxWidth:"sm",fullWidth:!0,children:[a.jsx(k,{children:je("templates.dialog.createFolder.cover.title")}),a.jsx(C,{children:At?a.jsx(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:200},children:a.jsx(b,{})}):a.jsxs(a.Fragment,{children:[a.jsx(te,{onLoading:e=>{kt((e=>({...e,cover:void 0}))),Pt(e),rr(!1)},onImageUpload:e=>{kt((t=>({...t,cover:e}))),rr(!1),Pt(!1)},onClose:()=>{rr(!1),Pt(!1)}}),wt.cover&&a.jsx(o,{sx:{display:"flex",justifyContent:"center",mt:2},children:a.jsx(p,{variant:"outlined",color:"error",startIcon:a.jsx(Y,{}),onClick:()=>{kt((e=>({...e,cover:void 0}))),rr(!1)},children:je("templates.dialog.createFolder.cover.delete")})})]})})]}),a.jsxs(T,{anchorEl:Ft,open:Boolean(Ft),onClose:wr,children:[a.jsxs(u,{onClick:()=>{Dt&&(kt({title:Dt.title,description:Dt.description||"",type:Dt.type,cover:Dt.cover||void 0}),Wt(!0),bt(!0)),wr()},children:[a.jsx(J,{fontSize:"small",sx:{mr:1}}),je("common.actions.edit")]}),a.jsxs(u,{onClick:()=>{Dt&&(ir({type:"folder",id:Dt.id}),or(!0)),wr()},children:[a.jsx(X,{fontSize:"small",sx:{mr:1}}),je("common.actions.moveTo")]}),a.jsxs(u,{onClick:()=>{wr(),Et(Dt),$t(!0)},sx:{color:"error.main"},children:[a.jsx(Y,{fontSize:"small",sx:{mr:1}}),je("common.actions.delete")]})]}),a.jsxs(w,{open:Bt,onClose:()=>!Lt&&$t(!1),maxWidth:"xs",fullWidth:!0,children:[a.jsx(k,{children:je("common.dialog.delete.title",{item:je("templates.dialog.move.folder")})}),a.jsxs(C,{children:[a.jsx(v,{children:je("templates.dialog.delete.folder.message")}),a.jsx(v,{children:je("templates.dialog.delete.folder.moveTemplates")}),a.jsx(v,{children:je("templates.dialog.delete.folder.deleteSubfolders")})]}),a.jsxs(F,{children:[a.jsx(p,{onClick:()=>$t(!1),disabled:Lt,children:je("common.actions.cancel")}),a.jsx(p,{onClick:async()=>{if(_t){Ot(!0);try{await A.folders.delete(_t.id),We.currentFolder?_e((e=>({...e,currentFolder:{...e.currentFolder,subfolders:e.currentFolder.subfolders.filter((e=>e.id!==_t.id))}}))):(gt((e=>e.filter((e=>e.id!==_t.id)))),await yr()),$t(!1),Et(null),ge(je("templates.status.folderDeleted"),"success")}catch(e){fe(P(e))}finally{Ot(!1)}}},color:"error",variant:"contained",disabled:Lt,startIcon:Lt?a.jsx(b,{size:20}):a.jsx(Y,{}),children:je(Lt?"common.status.deleting":"common.actions.delete")})]})]}),a.jsx(D,{anchor:"right",open:ar,onClose:()=>{or(!1),ir(null)},PaperProps:{sx:{width:{xs:"100%",sm:400},p:2}},children:a.jsxs(o,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[a.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[a.jsx(v,{variant:"h6",children:je("templates.dialog.move.title",{type:"folder"===(null==nr?void 0:nr.type)?je("templates.dialog.move.folder"):je("templates.dialog.move.template")})}),a.jsx(x,{onClick:()=>{or(!1),ir(null)},children:a.jsx(re,{})})]}),a.jsx(o,{sx:{flex:1,overflow:"auto"},children:a.jsx(se,{onFolderSelect:async e=>{if(nr){cr(!0);try{"template"===nr.type?(e?await A.folders.addWork(e.id,nr.id):await A.folders.removeWork(We.currentFolder.id,nr.id),We.currentFolder?Le((e=>e.filter((e=>e.id!==nr.id)))):Rt((e=>e.filter((e=>e.id!==nr.id)))),ge(je("templates.status.templateMoved"),"success")):(await A.folders.update(nr.id,{parent_id:(null==e?void 0:e.id)||null}),We.currentFolder?_e((e=>({...e,currentFolder:{...e.currentFolder,subfolders:e.currentFolder.subfolders.filter((e=>e.id!==nr.id))}}))):gt((e=>e.filter((e=>e.id!==nr.id)))),ge(je("templates.status.folderMoved"),"success")),or(!1),ir(null)}catch(t){fe(P(t))}finally{cr(!1)}}},isShowRoot:!0,currentFolder:null==(de=We.currentFolder)?void 0:de.id,movingFolder:"folder"===(null==nr?void 0:nr.type)?nr.id:void 0})})]})})]})};export{xe as default};
