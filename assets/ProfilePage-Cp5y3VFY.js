import{r as e,j as i,B as l,u as n,x as o,A as s,b as r,n as a,v as t,h as c,D as d,i as x,l as u,f as g,m,aw as p}from"./vendor-5I4LDDhx.js";import{b as f,u as h,a as j,L as y,aE as v,aH as b,E as C,aI as w,c as S}from"./main-CRXzfybP.js";import{T as D,G as I}from"./GoogleButton-Cxq8Yd2C.js";import"./index-CZex1ZYF.js";const T=()=>{var T;const{t:_}=f(),{user:k,isLoading:G,fetchUserData:E,logout:A}=h(),{showErrorToast:z,showToast:F}=j(),[W,O]=e.useState(!1),[B,U]=e.useState(!1),M=h().telegramWebApp,[N,L]=e.useState(!1),[P,R]=e.useState(!1),[H,q]=e.useState(!1),[J,K]=e.useState(!1),[Q,V]=e.useState(""),[X,Y]=e.useState(""),[Z,$]=e.useState(!1);return k||G?i.jsxs(l,{sx:{display:"flex",flexDirection:"column",height:"100%",bgcolor:"background.default"},children:[G?i.jsx(y,{message:_("common.loading")}):i.jsx(l,{sx:{display:"flex",flexDirection:"column",mx:"auto",width:"100%",maxWidth:"800px",p:2},children:i.jsxs(o,{sx:{display:"flex",flexDirection:"column",p:0,borderRadius:2},children:[i.jsx(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:3},children:i.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[i.jsx(s,{src:(null==k?void 0:k.photo_url)||void 0,sx:{width:60,height:60,mr:2,bgcolor:"primary.light",fontSize:"1.5rem"},children:null==(T=null==k?void 0:k.first_name)?void 0:T.charAt(0).toUpperCase()}),i.jsxs(l,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(null==k?void 0:k.first_name)&&i.jsx(l,{children:i.jsx(r,{variant:"h6",sx:{color:"inherit",fontWeight:600},children:null==k?void 0:k.first_name})}),(null==k?void 0:k.last_name)&&i.jsx(l,{children:i.jsx(r,{variant:"h6",sx:{color:"inherit",fontWeight:600},children:null==k?void 0:k.last_name})})]})]})}),i.jsxs(l,{sx:{p:3,pt:0},children:[i.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1},children:[i.jsx(l,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:i.jsx(r,{variant:"body1",children:_("profile.username","Username")})}),i.jsx(l,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:i.jsx(a,{variant:"text",endIcon:i.jsx(v,{}),onClick:async()=>{try{await navigator.clipboard.writeText((null==k?void 0:k.username)||""),F(_("profile.usernameCopied","Username copied to clipboard"),"success")}catch(e){z(_("profile.usernameCopyError","Failed to copy username"))}},sx:{color:"primary.main"},children:null==k?void 0:k.username})})]}),i.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:2,borderBottom:"1px solid",borderColor:"divider"},children:[i.jsx(l,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:i.jsx(r,{variant:"body1",children:_("profile.role","Role")})}),i.jsx(l,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:i.jsx(t,{color:"admin"===(null==k?void 0:k.role)?"error":"teacher"===(null==k?void 0:k.role)?"primary":"success",label:null==k?void 0:k.role})})]}),M&&!M.initData&&i.jsxs(i.Fragment,{children:[i.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:2,borderBottom:"1px solid",borderColor:"divider"},children:[i.jsx(l,{sx:{display:"flex",alignItems:"center"},children:i.jsx(r,{variant:"body1",children:_("profile.telegram","Telegram")})}),(null==k?void 0:k.telegram_user_id)?i.jsxs(l,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:[i.jsxs(r,{variant:"body1",children:["@",k.username]}),(null==k?void 0:k.email)&&i.jsx(c,{size:"small",onClick:()=>R(!0),children:i.jsx(b,{fontSize:"small"})})]}):i.jsx(l,{children:W?i.jsx(r,{variant:"body2",color:"text.secondary",children:_("profile.connecting","Connecting...")}):i.jsx(D,{botName:"teachair_bot",onAuth:async e=>{if(e&&e.id){O(!0);try{await S.users.connectTelegram(e)?(await E(),F(_("profile.telegramConnectSuccess","Telegram account connected successfully"),"success")):z(_("profile.telegramConnectError","Failed to connect Telegram account"))}catch(i){let e=_("profile.telegramConnectError","Failed to connect Telegram account");(null==i?void 0:i.message.includes("409"))?e=_("profile.telegramAlreadyConnected","This Telegram account is already connected to another user"):i.message&&(e=i.message),z(e)}finally{O(!1)}}else z(_("profile.invalidTelegramData","Invalid Telegram user data"))}})})]}),i.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:2,borderBottom:"1px solid",borderColor:"divider"},children:[i.jsx(l,{sx:{display:"flex",alignItems:"center"},children:i.jsx(r,{variant:"body1",children:_("profile.google","Google")})}),(null==k?void 0:k.email)?i.jsxs(l,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:[i.jsx(r,{variant:"body1",children:k.email}),(null==k?void 0:k.telegram_user_id)&&i.jsx(c,{size:"small",onClick:()=>q(!0),children:i.jsx(b,{fontSize:"small"})})]}):i.jsx(l,{children:B?i.jsx(r,{variant:"body2",color:"text.secondary",children:_("profile.connecting","Connecting...")}):i.jsx(I,{text:_("profile.connectGoogle","Connect Google"),size:"small",onSuccess:async e=>{if(e&&""!==e.trim()){U(!0);try{const i={access_token:e};await S.users.connectGoogle(i)?(await E(),F(_("profile.googleConnectSuccess","Google account connected successfully"),"success")):z(_("profile.googleConnectError","Failed to connect Google account"))}catch(i){let e=_("profile.googleConnectError","Failed to connect Google account");(null==i?void 0:i.message.includes("409"))?e=_("profile.googleAlreadyConnected","This Google account is already connected to another user"):i.message&&(e=i.message),z(e)}finally{U(!1)}}else z(_("profile.invalidGoogleToken","Invalid Google access token"))}})})]})]}),(null==k?void 0:k.created_at)&&i.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:2,borderBottom:"1px solid",borderColor:"divider"},children:[i.jsx(r,{variant:"body1",children:_("profile.memberSince","Member since")}),i.jsx(r,{variant:"body2",color:"text.secondary",children:new Date(k.created_at).toLocaleDateString(_("locale"),{dateStyle:"medium"})})]})]}),i.jsxs(l,{sx:{p:3,pt:0,display:"flex",justifyContent:"space-between",alignItems:"center",gap:2},children:[i.jsx(a,{variant:"outlined",startIcon:i.jsx(C,{}),onClick:()=>{V((null==k?void 0:k.first_name)||""),Y((null==k?void 0:k.last_name)||""),K(!0)},size:"small",children:_("profile.edit","Edit")}),i.jsx(a,{variant:"outlined",startIcon:i.jsx(w,{}),onClick:()=>L(!0),color:"error",size:"small",children:_("auth.signOut","Sign Out")})]})]})}),i.jsxs(d,{open:J,onClose:()=>!Z&&K(!1),"aria-labelledby":"edit-dialog-title",maxWidth:"sm",fullWidth:!0,children:[i.jsx(x,{id:"edit-dialog-title",children:_("profile.editProfile","Edit Profile")}),i.jsx(u,{children:i.jsxs(l,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[i.jsx(g,{label:_("profile.firstName","First Name"),value:Q,onChange:e=>V(e.target.value),fullWidth:!0,disabled:Z}),i.jsx(g,{label:_("profile.lastName","Last Name"),value:X,onChange:e=>Y(e.target.value),fullWidth:!0,disabled:Z})]})}),i.jsxs(m,{children:[i.jsx(a,{onClick:()=>K(!1),disabled:Z,children:_("profile.cancel","Cancel")}),i.jsx(a,{onClick:async()=>{$(!0);try{const e={first_name:Q.trim()||null,last_name:X.trim()||null};await S.users.updateMe(e),await E(),K(!1),F(_("profile.updateSuccess","Profile updated successfully"),"success")}catch(e){z(_("profile.updateError","Failed to update profile"))}finally{$(!1)}},variant:"contained",disabled:Z,children:Z?_("profile.saving","Saving..."):_("profile.save","Save")})]})]}),i.jsxs(d,{open:N,onClose:()=>L(!1),"aria-labelledby":"logout-dialog-title","aria-describedby":"logout-dialog-description",children:[i.jsx(x,{id:"logout-dialog-title",children:_("auth.confirmSignOut","Confirm Sign Out")}),i.jsx(u,{children:i.jsx(p,{id:"logout-dialog-description",children:_("auth.confirmSignOutMessage","Are you sure you want to sign out?")})}),i.jsxs(m,{children:[i.jsx(a,{onClick:()=>L(!1),color:"primary",children:_("auth.cancel","Cancel")}),i.jsx(a,{onClick:()=>{L(!1),A()},color:"error",variant:"contained",children:_("auth.signOut","Sign Out")})]})]}),i.jsxs(d,{open:P,onClose:()=>R(!1),"aria-labelledby":"telegram-disconnect-dialog-title","aria-describedby":"telegram-disconnect-dialog-description",children:[i.jsx(x,{id:"telegram-disconnect-dialog-title",children:_("profile.confirmTelegramDisconnect","Confirm Telegram Disconnect")}),i.jsx(u,{children:i.jsx(p,{id:"telegram-disconnect-dialog-description",children:_("profile.confirmTelegramDisconnectMessage","Are you sure you want to disconnect your Telegram account?")})}),i.jsxs(m,{children:[i.jsx(a,{onClick:()=>R(!1),color:"primary",children:_("profile.cancel","Cancel")}),i.jsx(a,{onClick:async()=>{R(!1),await(async()=>{await S.users.disconnectTelegram(),await E()})()},color:"error",variant:"contained",children:_("profile.disconnect","Disconnect")})]})]}),i.jsxs(d,{open:H,onClose:()=>q(!1),"aria-labelledby":"google-disconnect-dialog-title","aria-describedby":"google-disconnect-dialog-description",children:[i.jsx(x,{id:"google-disconnect-dialog-title",children:_("profile.confirmGoogleDisconnect","Confirm Google Disconnect")}),i.jsx(u,{children:i.jsx(p,{id:"google-disconnect-dialog-description",children:_("profile.confirmGoogleDisconnectMessage","Are you sure you want to disconnect your Google account?")})}),i.jsxs(m,{children:[i.jsx(a,{onClick:()=>q(!1),color:"primary",children:_("profile.cancel","Cancel")}),i.jsx(a,{onClick:async()=>{q(!1),await(async()=>{await S.users.disconnectGoogle(),await E()})()},color:"error",variant:"contained",children:_("profile.disconnect","Disconnect")})]})]})]}):i.jsx(l,{sx:{p:3},children:i.jsx(n,{severity:"error",children:_("profile.noUser","User not found")})})};export{T as default};
