const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./markdownExport-P5Faunep.js","./main-DsOJO4w3.js","./vendor-BGxxnuh9.js","./main-Cnwgr159.css","./dayjs.min-BsrIx3F8.js"])))=>i.map(i=>d[i]);
import{u as e,a as t,b as s,U as a,c as n,S as r,C as i,F as o,D as l,P as d,A as c,d as u,e as m,f as h,L as p,E as f,M as x,T as g,g as y,_ as v,h as _,i as j,j as k,I as b,k as w,R as C,l as S,m as T,n as I,o as Z,B as A,W as E,p as O,q as F,r as P,O as N,s as R,t as z,v as $,w as D,x as M,y as L,z as W,G as B,H as U,J as V,K,N as q,Q as H,V as G,X as J,Y,Z as Q,$ as X,a0 as ee,a1 as te,a2 as se,a3 as ae,a4 as ne,a5 as re,a6 as ie,a7 as oe,a8 as le,a9 as de,aa as ce,ab as ue,ac as me,ad as he,ae as pe,af as fe,ag as xe,ah as ge,ai as ye,aj as ve,ak as _e,al as je,am as ke,an as be,ao as we,ap as Ce,aq as Se,ar as Te,as as Ie,at as Ze,au as Ae,av as Ee,aw as Oe,ax as Fe,ay as Pe,az as Ne}from"./main-DsOJO4w3.js";import{Z as Re,aa as ze,r as $e,j as De,d as Me,e as Le,L as We,H as Be,B as Ue,u as Ve,n as Ke,x as qe,w as He,Y as Ge,v as Je,f as Ye,I as Qe,h as Xe,ae as et,af as tt,C as st,b as at,a3 as nt,a4 as rt,a5 as it,M as ot,D as lt,i as dt,l as ct,m as ut,V as mt,W as ht,N as pt,a9 as ft,G as xt,J as gt,ag as yt,a8 as vt,ah as _t,z as jt,E as kt,K as bt,ai as wt,aj as Ct,A as St,y as Tt,Q as It,ak as Zt,U as At}from"./vendor-BGxxnuh9.js";var Et,Ot,Ft;(Ot=Et||(Et={})).assertEqual=e=>e,Ot.assertIs=function(e){},Ot.assertNever=function(e){throw new Error},Ot.arrayToEnum=e=>{const t={};for(const s of e)t[s]=s;return t},Ot.getValidEnumValues=e=>{const t=Ot.objectKeys(e).filter((t=>"number"!=typeof e[e[t]])),s={};for(const a of t)s[a]=e[a];return Ot.objectValues(s)},Ot.objectValues=e=>Ot.objectKeys(e).map((function(t){return e[t]})),Ot.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.push(s);return t},Ot.find=(e,t)=>{for(const s of e)if(t(s))return s},Ot.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,Ot.joinValues=function(e,t=" | "){return e.map((e=>"string"==typeof e?`'${e}'`:e)).join(t)},Ot.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t,(Ft||(Ft={})).mergeShapes=(e,t)=>({...e,...t});const Pt=Et.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Nt=e=>{switch(typeof e){case"undefined":return Pt.undefined;case"string":return Pt.string;case"number":return isNaN(e)?Pt.nan:Pt.number;case"boolean":return Pt.boolean;case"function":return Pt.function;case"bigint":return Pt.bigint;case"symbol":return Pt.symbol;case"object":return Array.isArray(e)?Pt.array:null===e?Pt.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?Pt.promise:"undefined"!=typeof Map&&e instanceof Map?Pt.map:"undefined"!=typeof Set&&e instanceof Set?Pt.set:"undefined"!=typeof Date&&e instanceof Date?Pt.date:Pt.object;default:return Pt.unknown}},Rt=Et.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class zt extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(e){return e.message},s={_errors:[]},a=e=>{for(const n of e.issues)if("invalid_union"===n.code)n.unionErrors.map(a);else if("invalid_return_type"===n.code)a(n.returnTypeError);else if("invalid_arguments"===n.code)a(n.argumentsError);else if(0===n.path.length)s._errors.push(t(n));else{let e=s,a=0;for(;a<n.path.length;){const s=n.path[a];a===n.path.length-1?(e[s]=e[s]||{_errors:[]},e[s]._errors.push(t(n))):e[s]=e[s]||{_errors:[]},e=e[s],a++}}};return a(this),s}static assert(e){if(!(e instanceof zt))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Et.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){const t={},s=[];for(const a of this.issues)a.path.length>0?(t[a.path[0]]=t[a.path[0]]||[],t[a.path[0]].push(e(a))):s.push(e(a));return{formErrors:s,fieldErrors:t}}get formErrors(){return this.flatten()}}zt.create=e=>new zt(e);const $t=(e,t)=>{let s;switch(e.code){case Rt.invalid_type:s=e.received===Pt.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case Rt.invalid_literal:s=`Invalid literal value, expected ${JSON.stringify(e.expected,Et.jsonStringifyReplacer)}`;break;case Rt.unrecognized_keys:s=`Unrecognized key(s) in object: ${Et.joinValues(e.keys,", ")}`;break;case Rt.invalid_union:s="Invalid input";break;case Rt.invalid_union_discriminator:s=`Invalid discriminator value. Expected ${Et.joinValues(e.options)}`;break;case Rt.invalid_enum_value:s=`Invalid enum value. Expected ${Et.joinValues(e.options)}, received '${e.received}'`;break;case Rt.invalid_arguments:s="Invalid function arguments";break;case Rt.invalid_return_type:s="Invalid function return type";break;case Rt.invalid_date:s="Invalid date";break;case Rt.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(s=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(s=`${s} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?s=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?s=`Invalid input: must end with "${e.validation.endsWith}"`:Et.assertNever(e.validation):s="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case Rt.too_small:s="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case Rt.too_big:s="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case Rt.custom:s="Invalid input";break;case Rt.invalid_intersection_types:s="Intersection results could not be merged";break;case Rt.not_multiple_of:s=`Number must be a multiple of ${e.multipleOf}`;break;case Rt.not_finite:s="Number must be finite";break;default:s=t.defaultError,Et.assertNever(e)}return{message:s}};let Dt=$t;function Mt(){return Dt}const Lt=e=>{const{data:t,path:s,errorMaps:a,issueData:n}=e,r=[...s,...n.path||[]],i={...n,path:r};if(void 0!==n.message)return{...n,path:r,message:n.message};let o="";const l=a.filter((e=>!!e)).slice().reverse();for(const d of l)o=d(i,{data:t,defaultError:o}).message;return{...n,path:r,message:o}};function Wt(e,t){const s=Mt(),a=Lt({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,s,s===$t?void 0:$t].filter((e=>!!e))});e.common.issues.push(a)}class Bt{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const s=[];for(const a of t){if("aborted"===a.status)return Ut;"dirty"===a.status&&e.dirty(),s.push(a.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,t){const s=[];for(const a of t){const e=await a.key,t=await a.value;s.push({key:e,value:t})}return Bt.mergeObjectSync(e,s)}static mergeObjectSync(e,t){const s={};for(const a of t){const{key:t,value:n}=a;if("aborted"===t.status)return Ut;if("aborted"===n.status)return Ut;"dirty"===t.status&&e.dirty(),"dirty"===n.status&&e.dirty(),"__proto__"===t.value||void 0===n.value&&!a.alwaysSet||(s[t.value]=n.value)}return{status:e.value,value:s}}}const Ut=Object.freeze({status:"aborted"}),Vt=e=>({status:"dirty",value:e}),Kt=e=>({status:"valid",value:e}),qt=e=>"aborted"===e.status,Ht=e=>"dirty"===e.status,Gt=e=>"valid"===e.status,Jt=e=>"undefined"!=typeof Promise&&e instanceof Promise;function Yt(e,t,s,a){if("function"==typeof t||!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t.get(e)}function Qt(e,t,s,a,n){if("function"==typeof t||!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,s),s}var Xt,es,ts,ss;"function"==typeof SuppressedError&&SuppressedError,(es=Xt||(Xt={})).errToObj=e=>"string"==typeof e?{message:e}:e||{},es.toString=e=>"string"==typeof e?e:null==e?void 0:e.message;class as{constructor(e,t,s,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=s,this._key=a}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const ns=(e,t)=>{if(Gt(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new zt(e.common.issues);return this._error=t,this._error}}};function rs(e){if(!e)return{};const{errorMap:t,invalid_type_error:s,required_error:a,description:n}=e;if(t&&(s||a))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');if(t)return{errorMap:t,description:n};return{errorMap:(t,n)=>{var r,i;const{message:o}=e;return"invalid_enum_value"===t.code?{message:null!=o?o:n.defaultError}:void 0===n.data?{message:null!==(r=null!=o?o:a)&&void 0!==r?r:n.defaultError}:"invalid_type"!==t.code?{message:n.defaultError}:{message:null!==(i=null!=o?o:s)&&void 0!==i?i:n.defaultError}},description:n}}class is{get description(){return this._def.description}_getType(e){return Nt(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Nt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Bt,ctx:{common:e.parent.common,data:e.data,parsedType:Nt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Jt(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const s=this.safeParse(e,t);if(s.success)return s.data;throw s.error}safeParse(e,t){var s;const a={common:{issues:[],async:null!==(s=null==t?void 0:t.async)&&void 0!==s&&s,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Nt(e)},n=this._parseSync({data:e,path:a.path,parent:a});return ns(a,n)}"~validate"(e){var t,s;const a={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Nt(e)};if(!this["~standard"].async)try{const t=this._parseSync({data:e,path:[],parent:a});return Gt(t)?{value:t.value}:{issues:a.common.issues}}catch(n){(null===(s=null===(t=null==n?void 0:n.message)||void 0===t?void 0:t.toLowerCase())||void 0===s?void 0:s.includes("encountered"))&&(this["~standard"].async=!0),a.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:a}).then((e=>Gt(e)?{value:e.value}:{issues:a.common.issues}))}async parseAsync(e,t){const s=await this.safeParseAsync(e,t);if(s.success)return s.data;throw s.error}async safeParseAsync(e,t){const s={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Nt(e)},a=this._parse({data:e,path:s.path,parent:s}),n=await(Jt(a)?a:Promise.resolve(a));return ns(s,n)}refine(e,t){const s=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement(((t,a)=>{const n=e(t),r=()=>a.addIssue({code:Rt.custom,...s(t)});return"undefined"!=typeof Promise&&n instanceof Promise?n.then((e=>!!e||(r(),!1))):!!n||(r(),!1)}))}refinement(e,t){return this._refinement(((s,a)=>!!e(s)||(a.addIssue("function"==typeof t?t(s,a):t),!1)))}_refinement(e){return new ia({schema:this,typeName:va.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return oa.create(this,this._def)}nullable(){return la.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ls.create(this)}promise(){return ra.create(this,this._def)}or(e){return Us.create([this,e],this._def)}and(e){return Hs.create(this,e,this._def)}transform(e){return new ia({...rs(this._def),schema:this,typeName:va.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new da({...rs(this._def),innerType:this,defaultValue:t,typeName:va.ZodDefault})}brand(){return new ha({typeName:va.ZodBranded,type:this,...rs(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new ca({...rs(this._def),innerType:this,catchValue:t,typeName:va.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return pa.create(this,e)}readonly(){return fa.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const os=/^c[^\s-]{8,}$/i,ls=/^[0-9a-z]+$/,ds=/^[0-9A-HJKMNP-TV-Z]{26}$/i,cs=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,us=/^[a-z0-9_-]{21}$/i,ms=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,hs=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,ps=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let fs;const xs=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,gs=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ys=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,vs=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,_s=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,js=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ks="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",bs=new RegExp(`^${ks}$`);function ws(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${e.precision?"+":"?"}`}function Cs(e){let t=`${ks}T${ws(e)}`;const s=[];return s.push(e.local?"Z?":"Z"),e.offset&&s.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${s.join("|")})`,new RegExp(`^${t}$`)}function Ss(e,t){if(!ms.test(e))return!1;try{const[s]=e.split("."),a=s.replace(/-/g,"+").replace(/_/g,"/").padEnd(s.length+(4-s.length%4)%4,"="),n=JSON.parse(atob(a));return"object"==typeof n&&null!==n&&(!(!n.typ||!n.alg)&&(!t||n.alg===t))}catch(s){return!1}}function Ts(e,t){return!("v4"!==t&&t||!gs.test(e))||!("v6"!==t&&t||!vs.test(e))}class Is extends is{_parse(e){this._def.coerce&&(e.data=String(e.data));if(this._getType(e)!==Pt.string){const t=this._getOrReturnCtx(e);return Wt(t,{code:Rt.invalid_type,expected:Pt.string,received:t.parsedType}),Ut}const t=new Bt;let s;for(const i of this._def.checks)if("min"===i.kind)e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),Wt(s,{code:Rt.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),t.dirty());else if("max"===i.kind)e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),Wt(s,{code:Rt.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),t.dirty());else if("length"===i.kind){const a=e.data.length>i.value,n=e.data.length<i.value;(a||n)&&(s=this._getOrReturnCtx(e,s),a?Wt(s,{code:Rt.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):n&&Wt(s,{code:Rt.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),t.dirty())}else if("email"===i.kind)ps.test(e.data)||(s=this._getOrReturnCtx(e,s),Wt(s,{validation:"email",code:Rt.invalid_string,message:i.message}),t.dirty());else if("emoji"===i.kind)fs||(fs=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),fs.test(e.data)||(s=this._getOrReturnCtx(e,s),Wt(s,{validation:"emoji",code:Rt.invalid_string,message:i.message}),t.dirty());else if("uuid"===i.kind)cs.test(e.data)||(s=this._getOrReturnCtx(e,s),Wt(s,{validation:"uuid",code:Rt.invalid_string,message:i.message}),t.dirty());else if("nanoid"===i.kind)us.test(e.data)||(s=this._getOrReturnCtx(e,s),Wt(s,{validation:"nanoid",code:Rt.invalid_string,message:i.message}),t.dirty());else if("cuid"===i.kind)os.test(e.data)||(s=this._getOrReturnCtx(e,s),Wt(s,{validation:"cuid",code:Rt.invalid_string,message:i.message}),t.dirty());else if("cuid2"===i.kind)ls.test(e.data)||(s=this._getOrReturnCtx(e,s),Wt(s,{validation:"cuid2",code:Rt.invalid_string,message:i.message}),t.dirty());else if("ulid"===i.kind)ds.test(e.data)||(s=this._getOrReturnCtx(e,s),Wt(s,{validation:"ulid",code:Rt.invalid_string,message:i.message}),t.dirty());else if("url"===i.kind)try{new URL(e.data)}catch(r){s=this._getOrReturnCtx(e,s),Wt(s,{validation:"url",code:Rt.invalid_string,message:i.message}),t.dirty()}else if("regex"===i.kind){i.regex.lastIndex=0;i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),Wt(s,{validation:"regex",code:Rt.invalid_string,message:i.message}),t.dirty())}else if("trim"===i.kind)e.data=e.data.trim();else if("includes"===i.kind)e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),Wt(s,{code:Rt.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),t.dirty());else if("toLowerCase"===i.kind)e.data=e.data.toLowerCase();else if("toUpperCase"===i.kind)e.data=e.data.toUpperCase();else if("startsWith"===i.kind)e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),Wt(s,{code:Rt.invalid_string,validation:{startsWith:i.value},message:i.message}),t.dirty());else if("endsWith"===i.kind)e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),Wt(s,{code:Rt.invalid_string,validation:{endsWith:i.value},message:i.message}),t.dirty());else if("datetime"===i.kind){Cs(i).test(e.data)||(s=this._getOrReturnCtx(e,s),Wt(s,{code:Rt.invalid_string,validation:"datetime",message:i.message}),t.dirty())}else if("date"===i.kind){bs.test(e.data)||(s=this._getOrReturnCtx(e,s),Wt(s,{code:Rt.invalid_string,validation:"date",message:i.message}),t.dirty())}else if("time"===i.kind){new RegExp(`^${ws(i)}$`).test(e.data)||(s=this._getOrReturnCtx(e,s),Wt(s,{code:Rt.invalid_string,validation:"time",message:i.message}),t.dirty())}else"duration"===i.kind?hs.test(e.data)||(s=this._getOrReturnCtx(e,s),Wt(s,{validation:"duration",code:Rt.invalid_string,message:i.message}),t.dirty()):"ip"===i.kind?(a=e.data,("v4"!==(n=i.version)&&n||!xs.test(a))&&("v6"!==n&&n||!ys.test(a))&&(s=this._getOrReturnCtx(e,s),Wt(s,{validation:"ip",code:Rt.invalid_string,message:i.message}),t.dirty())):"jwt"===i.kind?Ss(e.data,i.alg)||(s=this._getOrReturnCtx(e,s),Wt(s,{validation:"jwt",code:Rt.invalid_string,message:i.message}),t.dirty()):"cidr"===i.kind?Ts(e.data,i.version)||(s=this._getOrReturnCtx(e,s),Wt(s,{validation:"cidr",code:Rt.invalid_string,message:i.message}),t.dirty()):"base64"===i.kind?_s.test(e.data)||(s=this._getOrReturnCtx(e,s),Wt(s,{validation:"base64",code:Rt.invalid_string,message:i.message}),t.dirty()):"base64url"===i.kind?js.test(e.data)||(s=this._getOrReturnCtx(e,s),Wt(s,{validation:"base64url",code:Rt.invalid_string,message:i.message}),t.dirty()):Et.assertNever(i);var a,n;return{status:t.value,value:e.data}}_regex(e,t,s){return this.refinement((t=>e.test(t)),{validation:t,code:Rt.invalid_string,...Xt.errToObj(s)})}_addCheck(e){return new Is({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Xt.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Xt.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Xt.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Xt.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...Xt.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Xt.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Xt.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Xt.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...Xt.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...Xt.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...Xt.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Xt.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...Xt.errToObj(e)})}datetime(e){var t,s;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,local:null!==(s=null==e?void 0:e.local)&&void 0!==s&&s,...Xt.errToObj(null==e?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,...Xt.errToObj(null==e?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...Xt.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...Xt.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...Xt.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...Xt.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...Xt.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...Xt.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...Xt.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...Xt.errToObj(t)})}nonempty(e){return this.min(1,Xt.errToObj(e))}trim(){return new Is({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Is({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Is({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((e=>"datetime"===e.kind))}get isDate(){return!!this._def.checks.find((e=>"date"===e.kind))}get isTime(){return!!this._def.checks.find((e=>"time"===e.kind))}get isDuration(){return!!this._def.checks.find((e=>"duration"===e.kind))}get isEmail(){return!!this._def.checks.find((e=>"email"===e.kind))}get isURL(){return!!this._def.checks.find((e=>"url"===e.kind))}get isEmoji(){return!!this._def.checks.find((e=>"emoji"===e.kind))}get isUUID(){return!!this._def.checks.find((e=>"uuid"===e.kind))}get isNANOID(){return!!this._def.checks.find((e=>"nanoid"===e.kind))}get isCUID(){return!!this._def.checks.find((e=>"cuid"===e.kind))}get isCUID2(){return!!this._def.checks.find((e=>"cuid2"===e.kind))}get isULID(){return!!this._def.checks.find((e=>"ulid"===e.kind))}get isIP(){return!!this._def.checks.find((e=>"ip"===e.kind))}get isCIDR(){return!!this._def.checks.find((e=>"cidr"===e.kind))}get isBase64(){return!!this._def.checks.find((e=>"base64"===e.kind))}get isBase64url(){return!!this._def.checks.find((e=>"base64url"===e.kind))}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function Zs(e,t){const s=(e.toString().split(".")[1]||"").length,a=(t.toString().split(".")[1]||"").length,n=s>a?s:a;return parseInt(e.toFixed(n).replace(".",""))%parseInt(t.toFixed(n).replace(".",""))/Math.pow(10,n)}Is.create=e=>{var t;return new Is({checks:[],typeName:va.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...rs(e)})};class As extends is{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){this._def.coerce&&(e.data=Number(e.data));if(this._getType(e)!==Pt.number){const t=this._getOrReturnCtx(e);return Wt(t,{code:Rt.invalid_type,expected:Pt.number,received:t.parsedType}),Ut}let t;const s=new Bt;for(const a of this._def.checks)if("int"===a.kind)Et.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),Wt(t,{code:Rt.invalid_type,expected:"integer",received:"float",message:a.message}),s.dirty());else if("min"===a.kind){(a.inclusive?e.data<a.value:e.data<=a.value)&&(t=this._getOrReturnCtx(e,t),Wt(t,{code:Rt.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty())}else if("max"===a.kind){(a.inclusive?e.data>a.value:e.data>=a.value)&&(t=this._getOrReturnCtx(e,t),Wt(t,{code:Rt.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty())}else"multipleOf"===a.kind?0!==Zs(e.data,a.value)&&(t=this._getOrReturnCtx(e,t),Wt(t,{code:Rt.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):"finite"===a.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),Wt(t,{code:Rt.not_finite,message:a.message}),s.dirty()):Et.assertNever(a);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Xt.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Xt.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Xt.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Xt.toString(t))}setLimit(e,t,s,a){return new As({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:Xt.toString(a)}]})}_addCheck(e){return new As({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Xt.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Xt.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Xt.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Xt.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Xt.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Xt.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:Xt.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Xt.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Xt.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find((e=>"int"===e.kind||"multipleOf"===e.kind&&Et.isInteger(e.value)))}get isFinite(){let e=null,t=null;for(const s of this._def.checks){if("finite"===s.kind||"int"===s.kind||"multipleOf"===s.kind)return!0;"min"===s.kind?(null===t||s.value>t)&&(t=s.value):"max"===s.kind&&(null===e||s.value<e)&&(e=s.value)}return Number.isFinite(t)&&Number.isFinite(e)}}As.create=e=>new As({checks:[],typeName:va.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...rs(e)});class Es extends is{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch(a){return this._getInvalidInput(e)}if(this._getType(e)!==Pt.bigint)return this._getInvalidInput(e);let t;const s=new Bt;for(const n of this._def.checks)if("min"===n.kind){(n.inclusive?e.data<n.value:e.data<=n.value)&&(t=this._getOrReturnCtx(e,t),Wt(t,{code:Rt.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),s.dirty())}else if("max"===n.kind){(n.inclusive?e.data>n.value:e.data>=n.value)&&(t=this._getOrReturnCtx(e,t),Wt(t,{code:Rt.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),s.dirty())}else"multipleOf"===n.kind?e.data%n.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),Wt(t,{code:Rt.not_multiple_of,multipleOf:n.value,message:n.message}),s.dirty()):Et.assertNever(n);return{status:s.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return Wt(t,{code:Rt.invalid_type,expected:Pt.bigint,received:t.parsedType}),Ut}gte(e,t){return this.setLimit("min",e,!0,Xt.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Xt.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Xt.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Xt.toString(t))}setLimit(e,t,s,a){return new Es({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:Xt.toString(a)}]})}_addCheck(e){return new Es({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Xt.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Xt.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Xt.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Xt.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Xt.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}Es.create=e=>{var t;return new Es({checks:[],typeName:va.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...rs(e)})};class Os extends is{_parse(e){this._def.coerce&&(e.data=Boolean(e.data));if(this._getType(e)!==Pt.boolean){const t=this._getOrReturnCtx(e);return Wt(t,{code:Rt.invalid_type,expected:Pt.boolean,received:t.parsedType}),Ut}return Kt(e.data)}}Os.create=e=>new Os({typeName:va.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...rs(e)});class Fs extends is{_parse(e){this._def.coerce&&(e.data=new Date(e.data));if(this._getType(e)!==Pt.date){const t=this._getOrReturnCtx(e);return Wt(t,{code:Rt.invalid_type,expected:Pt.date,received:t.parsedType}),Ut}if(isNaN(e.data.getTime())){return Wt(this._getOrReturnCtx(e),{code:Rt.invalid_date}),Ut}const t=new Bt;let s;for(const a of this._def.checks)"min"===a.kind?e.data.getTime()<a.value&&(s=this._getOrReturnCtx(e,s),Wt(s,{code:Rt.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),t.dirty()):"max"===a.kind?e.data.getTime()>a.value&&(s=this._getOrReturnCtx(e,s),Wt(s,{code:Rt.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),t.dirty()):Et.assertNever(a);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Fs({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:Xt.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:Xt.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}Fs.create=e=>new Fs({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:va.ZodDate,...rs(e)});class Ps extends is{_parse(e){if(this._getType(e)!==Pt.symbol){const t=this._getOrReturnCtx(e);return Wt(t,{code:Rt.invalid_type,expected:Pt.symbol,received:t.parsedType}),Ut}return Kt(e.data)}}Ps.create=e=>new Ps({typeName:va.ZodSymbol,...rs(e)});class Ns extends is{_parse(e){if(this._getType(e)!==Pt.undefined){const t=this._getOrReturnCtx(e);return Wt(t,{code:Rt.invalid_type,expected:Pt.undefined,received:t.parsedType}),Ut}return Kt(e.data)}}Ns.create=e=>new Ns({typeName:va.ZodUndefined,...rs(e)});class Rs extends is{_parse(e){if(this._getType(e)!==Pt.null){const t=this._getOrReturnCtx(e);return Wt(t,{code:Rt.invalid_type,expected:Pt.null,received:t.parsedType}),Ut}return Kt(e.data)}}Rs.create=e=>new Rs({typeName:va.ZodNull,...rs(e)});class zs extends is{constructor(){super(...arguments),this._any=!0}_parse(e){return Kt(e.data)}}zs.create=e=>new zs({typeName:va.ZodAny,...rs(e)});class $s extends is{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Kt(e.data)}}$s.create=e=>new $s({typeName:va.ZodUnknown,...rs(e)});class Ds extends is{_parse(e){const t=this._getOrReturnCtx(e);return Wt(t,{code:Rt.invalid_type,expected:Pt.never,received:t.parsedType}),Ut}}Ds.create=e=>new Ds({typeName:va.ZodNever,...rs(e)});class Ms extends is{_parse(e){if(this._getType(e)!==Pt.undefined){const t=this._getOrReturnCtx(e);return Wt(t,{code:Rt.invalid_type,expected:Pt.void,received:t.parsedType}),Ut}return Kt(e.data)}}Ms.create=e=>new Ms({typeName:va.ZodVoid,...rs(e)});class Ls extends is{_parse(e){const{ctx:t,status:s}=this._processInputParams(e),a=this._def;if(t.parsedType!==Pt.array)return Wt(t,{code:Rt.invalid_type,expected:Pt.array,received:t.parsedType}),Ut;if(null!==a.exactLength){const e=t.data.length>a.exactLength.value,n=t.data.length<a.exactLength.value;(e||n)&&(Wt(t,{code:e?Rt.too_big:Rt.too_small,minimum:n?a.exactLength.value:void 0,maximum:e?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),s.dirty())}if(null!==a.minLength&&t.data.length<a.minLength.value&&(Wt(t,{code:Rt.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),s.dirty()),null!==a.maxLength&&t.data.length>a.maxLength.value&&(Wt(t,{code:Rt.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),s.dirty()),t.common.async)return Promise.all([...t.data].map(((e,s)=>a.type._parseAsync(new as(t,e,t.path,s))))).then((e=>Bt.mergeArray(s,e)));const n=[...t.data].map(((e,s)=>a.type._parseSync(new as(t,e,t.path,s))));return Bt.mergeArray(s,n)}get element(){return this._def.type}min(e,t){return new Ls({...this._def,minLength:{value:e,message:Xt.toString(t)}})}max(e,t){return new Ls({...this._def,maxLength:{value:e,message:Xt.toString(t)}})}length(e,t){return new Ls({...this._def,exactLength:{value:e,message:Xt.toString(t)}})}nonempty(e){return this.min(1,e)}}function Ws(e){if(e instanceof Bs){const t={};for(const s in e.shape){const a=e.shape[s];t[s]=oa.create(Ws(a))}return new Bs({...e._def,shape:()=>t})}return e instanceof Ls?new Ls({...e._def,type:Ws(e.element)}):e instanceof oa?oa.create(Ws(e.unwrap())):e instanceof la?la.create(Ws(e.unwrap())):e instanceof Gs?Gs.create(e.items.map((e=>Ws(e)))):e}Ls.create=(e,t)=>new Ls({type:e,minLength:null,maxLength:null,exactLength:null,typeName:va.ZodArray,...rs(t)});class Bs extends is{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=Et.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==Pt.object){const t=this._getOrReturnCtx(e);return Wt(t,{code:Rt.invalid_type,expected:Pt.object,received:t.parsedType}),Ut}const{status:t,ctx:s}=this._processInputParams(e),{shape:a,keys:n}=this._getCached(),r=[];if(!(this._def.catchall instanceof Ds&&"strip"===this._def.unknownKeys))for(const o in s.data)n.includes(o)||r.push(o);const i=[];for(const o of n){const e=a[o],t=s.data[o];i.push({key:{status:"valid",value:o},value:e._parse(new as(s,t,s.path,o)),alwaysSet:o in s.data})}if(this._def.catchall instanceof Ds){const e=this._def.unknownKeys;if("passthrough"===e)for(const t of r)i.push({key:{status:"valid",value:t},value:{status:"valid",value:s.data[t]}});else if("strict"===e)r.length>0&&(Wt(s,{code:Rt.unrecognized_keys,keys:r}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of r){const a=s.data[t];i.push({key:{status:"valid",value:t},value:e._parse(new as(s,a,s.path,t)),alwaysSet:t in s.data})}}return s.common.async?Promise.resolve().then((async()=>{const e=[];for(const t of i){const s=await t.key,a=await t.value;e.push({key:s,value:a,alwaysSet:t.alwaysSet})}return e})).then((e=>Bt.mergeObjectSync(t,e))):Bt.mergeObjectSync(t,i)}get shape(){return this._def.shape()}strict(e){return Xt.errToObj,new Bs({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,s)=>{var a,n,r,i;const o=null!==(r=null===(n=(a=this._def).errorMap)||void 0===n?void 0:n.call(a,t,s).message)&&void 0!==r?r:s.defaultError;return"unrecognized_keys"===t.code?{message:null!==(i=Xt.errToObj(e).message)&&void 0!==i?i:o}:{message:o}}}:{}})}strip(){return new Bs({...this._def,unknownKeys:"strip"})}passthrough(){return new Bs({...this._def,unknownKeys:"passthrough"})}extend(e){return new Bs({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Bs({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:va.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Bs({...this._def,catchall:e})}pick(e){const t={};return Et.objectKeys(e).forEach((s=>{e[s]&&this.shape[s]&&(t[s]=this.shape[s])})),new Bs({...this._def,shape:()=>t})}omit(e){const t={};return Et.objectKeys(this.shape).forEach((s=>{e[s]||(t[s]=this.shape[s])})),new Bs({...this._def,shape:()=>t})}deepPartial(){return Ws(this)}partial(e){const t={};return Et.objectKeys(this.shape).forEach((s=>{const a=this.shape[s];e&&!e[s]?t[s]=a:t[s]=a.optional()})),new Bs({...this._def,shape:()=>t})}required(e){const t={};return Et.objectKeys(this.shape).forEach((s=>{if(e&&!e[s])t[s]=this.shape[s];else{let e=this.shape[s];for(;e instanceof oa;)e=e._def.innerType;t[s]=e}})),new Bs({...this._def,shape:()=>t})}keyof(){return sa(Et.objectKeys(this.shape))}}Bs.create=(e,t)=>new Bs({shape:()=>e,unknownKeys:"strip",catchall:Ds.create(),typeName:va.ZodObject,...rs(t)}),Bs.strictCreate=(e,t)=>new Bs({shape:()=>e,unknownKeys:"strict",catchall:Ds.create(),typeName:va.ZodObject,...rs(t)}),Bs.lazycreate=(e,t)=>new Bs({shape:e,unknownKeys:"strip",catchall:Ds.create(),typeName:va.ZodObject,...rs(t)});class Us extends is{_parse(e){const{ctx:t}=this._processInputParams(e),s=this._def.options;if(t.common.async)return Promise.all(s.map((async e=>{const s={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:s}),ctx:s}}))).then((function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const a of e)if("dirty"===a.result.status)return t.common.issues.push(...a.ctx.common.issues),a.result;const s=e.map((e=>new zt(e.ctx.common.issues)));return Wt(t,{code:Rt.invalid_union,unionErrors:s}),Ut}));{let e;const a=[];for(const r of s){const s={...t,common:{...t.common,issues:[]},parent:null},n=r._parseSync({data:t.data,path:t.path,parent:s});if("valid"===n.status)return n;"dirty"!==n.status||e||(e={result:n,ctx:s}),s.common.issues.length&&a.push(s.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const n=a.map((e=>new zt(e)));return Wt(t,{code:Rt.invalid_union,unionErrors:n}),Ut}}get options(){return this._def.options}}Us.create=(e,t)=>new Us({options:e,typeName:va.ZodUnion,...rs(t)});const Vs=e=>e instanceof ea?Vs(e.schema):e instanceof ia?Vs(e.innerType()):e instanceof ta?[e.value]:e instanceof aa?e.options:e instanceof na?Et.objectValues(e.enum):e instanceof da?Vs(e._def.innerType):e instanceof Ns?[void 0]:e instanceof Rs?[null]:e instanceof oa?[void 0,...Vs(e.unwrap())]:e instanceof la?[null,...Vs(e.unwrap())]:e instanceof ha||e instanceof fa?Vs(e.unwrap()):e instanceof ca?Vs(e._def.innerType):[];class Ks extends is{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Pt.object)return Wt(t,{code:Rt.invalid_type,expected:Pt.object,received:t.parsedType}),Ut;const s=this.discriminator,a=t.data[s],n=this.optionsMap.get(a);return n?t.common.async?n._parseAsync({data:t.data,path:t.path,parent:t}):n._parseSync({data:t.data,path:t.path,parent:t}):(Wt(t,{code:Rt.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),Ut)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,s){const a=new Map;for(const n of t){const t=Vs(n.shape[e]);if(!t.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const s of t){if(a.has(s))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(s)}`);a.set(s,n)}}return new Ks({typeName:va.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:a,...rs(s)})}}function qs(e,t){const s=Nt(e),a=Nt(t);if(e===t)return{valid:!0,data:e};if(s===Pt.object&&a===Pt.object){const s=Et.objectKeys(t),a=Et.objectKeys(e).filter((e=>-1!==s.indexOf(e))),n={...e,...t};for(const r of a){const s=qs(e[r],t[r]);if(!s.valid)return{valid:!1};n[r]=s.data}return{valid:!0,data:n}}if(s===Pt.array&&a===Pt.array){if(e.length!==t.length)return{valid:!1};const s=[];for(let a=0;a<e.length;a++){const n=qs(e[a],t[a]);if(!n.valid)return{valid:!1};s.push(n.data)}return{valid:!0,data:s}}return s===Pt.date&&a===Pt.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class Hs extends is{_parse(e){const{status:t,ctx:s}=this._processInputParams(e),a=(e,a)=>{if(qt(e)||qt(a))return Ut;const n=qs(e.value,a.value);return n.valid?((Ht(e)||Ht(a))&&t.dirty(),{status:t.value,value:n.data}):(Wt(s,{code:Rt.invalid_intersection_types}),Ut)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then((([e,t])=>a(e,t))):a(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}}Hs.create=(e,t,s)=>new Hs({left:e,right:t,typeName:va.ZodIntersection,...rs(s)});class Gs extends is{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==Pt.array)return Wt(s,{code:Rt.invalid_type,expected:Pt.array,received:s.parsedType}),Ut;if(s.data.length<this._def.items.length)return Wt(s,{code:Rt.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Ut;!this._def.rest&&s.data.length>this._def.items.length&&(Wt(s,{code:Rt.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const a=[...s.data].map(((e,t)=>{const a=this._def.items[t]||this._def.rest;return a?a._parse(new as(s,e,s.path,t)):null})).filter((e=>!!e));return s.common.async?Promise.all(a).then((e=>Bt.mergeArray(t,e))):Bt.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new Gs({...this._def,rest:e})}}Gs.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Gs({items:e,typeName:va.ZodTuple,rest:null,...rs(t)})};class Js extends is{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==Pt.object)return Wt(s,{code:Rt.invalid_type,expected:Pt.object,received:s.parsedType}),Ut;const a=[],n=this._def.keyType,r=this._def.valueType;for(const i in s.data)a.push({key:n._parse(new as(s,i,s.path,i)),value:r._parse(new as(s,s.data[i],s.path,i)),alwaysSet:i in s.data});return s.common.async?Bt.mergeObjectAsync(t,a):Bt.mergeObjectSync(t,a)}get element(){return this._def.valueType}static create(e,t,s){return new Js(t instanceof is?{keyType:e,valueType:t,typeName:va.ZodRecord,...rs(s)}:{keyType:Is.create(),valueType:e,typeName:va.ZodRecord,...rs(t)})}}class Ys extends is{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==Pt.map)return Wt(s,{code:Rt.invalid_type,expected:Pt.map,received:s.parsedType}),Ut;const a=this._def.keyType,n=this._def.valueType,r=[...s.data.entries()].map((([e,t],r)=>({key:a._parse(new as(s,e,s.path,[r,"key"])),value:n._parse(new as(s,t,s.path,[r,"value"]))})));if(s.common.async){const e=new Map;return Promise.resolve().then((async()=>{for(const s of r){const a=await s.key,n=await s.value;if("aborted"===a.status||"aborted"===n.status)return Ut;"dirty"!==a.status&&"dirty"!==n.status||t.dirty(),e.set(a.value,n.value)}return{status:t.value,value:e}}))}{const e=new Map;for(const s of r){const a=s.key,n=s.value;if("aborted"===a.status||"aborted"===n.status)return Ut;"dirty"!==a.status&&"dirty"!==n.status||t.dirty(),e.set(a.value,n.value)}return{status:t.value,value:e}}}}Ys.create=(e,t,s)=>new Ys({valueType:t,keyType:e,typeName:va.ZodMap,...rs(s)});class Qs extends is{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==Pt.set)return Wt(s,{code:Rt.invalid_type,expected:Pt.set,received:s.parsedType}),Ut;const a=this._def;null!==a.minSize&&s.data.size<a.minSize.value&&(Wt(s,{code:Rt.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),null!==a.maxSize&&s.data.size>a.maxSize.value&&(Wt(s,{code:Rt.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());const n=this._def.valueType;function r(e){const s=new Set;for(const a of e){if("aborted"===a.status)return Ut;"dirty"===a.status&&t.dirty(),s.add(a.value)}return{status:t.value,value:s}}const i=[...s.data.values()].map(((e,t)=>n._parse(new as(s,e,s.path,t))));return s.common.async?Promise.all(i).then((e=>r(e))):r(i)}min(e,t){return new Qs({...this._def,minSize:{value:e,message:Xt.toString(t)}})}max(e,t){return new Qs({...this._def,maxSize:{value:e,message:Xt.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Qs.create=(e,t)=>new Qs({valueType:e,minSize:null,maxSize:null,typeName:va.ZodSet,...rs(t)});class Xs extends is{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Pt.function)return Wt(t,{code:Rt.invalid_type,expected:Pt.function,received:t.parsedType}),Ut;function s(e,s){return Lt({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Mt(),$t].filter((e=>!!e)),issueData:{code:Rt.invalid_arguments,argumentsError:s}})}function a(e,s){return Lt({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Mt(),$t].filter((e=>!!e)),issueData:{code:Rt.invalid_return_type,returnTypeError:s}})}const n={errorMap:t.common.contextualErrorMap},r=t.data;if(this._def.returns instanceof ra){const e=this;return Kt((async function(...t){const i=new zt([]),o=await e._def.args.parseAsync(t,n).catch((e=>{throw i.addIssue(s(t,e)),i})),l=await Reflect.apply(r,this,o);return await e._def.returns._def.type.parseAsync(l,n).catch((e=>{throw i.addIssue(a(l,e)),i}))}))}{const e=this;return Kt((function(...t){const i=e._def.args.safeParse(t,n);if(!i.success)throw new zt([s(t,i.error)]);const o=Reflect.apply(r,this,i.data),l=e._def.returns.safeParse(o,n);if(!l.success)throw new zt([a(o,l.error)]);return l.data}))}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Xs({...this._def,args:Gs.create(e).rest($s.create())})}returns(e){return new Xs({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,s){return new Xs({args:e||Gs.create([]).rest($s.create()),returns:t||$s.create(),typeName:va.ZodFunction,...rs(s)})}}class ea extends is{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}ea.create=(e,t)=>new ea({getter:e,typeName:va.ZodLazy,...rs(t)});class ta extends is{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return Wt(t,{received:t.data,code:Rt.invalid_literal,expected:this._def.value}),Ut}return{status:"valid",value:e.data}}get value(){return this._def.value}}function sa(e,t){return new aa({values:e,typeName:va.ZodEnum,...rs(t)})}ta.create=(e,t)=>new ta({value:e,typeName:va.ZodLiteral,...rs(t)});class aa extends is{constructor(){super(...arguments),ts.set(this,void 0)}_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),s=this._def.values;return Wt(t,{expected:Et.joinValues(s),received:t.parsedType,code:Rt.invalid_type}),Ut}if(Yt(this,ts)||Qt(this,ts,new Set(this._def.values)),!Yt(this,ts).has(e.data)){const t=this._getOrReturnCtx(e),s=this._def.values;return Wt(t,{received:t.data,code:Rt.invalid_enum_value,options:s}),Ut}return Kt(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return aa.create(e,{...this._def,...t})}exclude(e,t=this._def){return aa.create(this.options.filter((t=>!e.includes(t))),{...this._def,...t})}}ts=new WeakMap,aa.create=sa;class na extends is{constructor(){super(...arguments),ss.set(this,void 0)}_parse(e){const t=Et.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==Pt.string&&s.parsedType!==Pt.number){const e=Et.objectValues(t);return Wt(s,{expected:Et.joinValues(e),received:s.parsedType,code:Rt.invalid_type}),Ut}if(Yt(this,ss)||Qt(this,ss,new Set(Et.getValidEnumValues(this._def.values))),!Yt(this,ss).has(e.data)){const e=Et.objectValues(t);return Wt(s,{received:s.data,code:Rt.invalid_enum_value,options:e}),Ut}return Kt(e.data)}get enum(){return this._def.values}}ss=new WeakMap,na.create=(e,t)=>new na({values:e,typeName:va.ZodNativeEnum,...rs(t)});class ra extends is{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Pt.promise&&!1===t.common.async)return Wt(t,{code:Rt.invalid_type,expected:Pt.promise,received:t.parsedType}),Ut;const s=t.parsedType===Pt.promise?t.data:Promise.resolve(t.data);return Kt(s.then((e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap}))))}}ra.create=(e,t)=>new ra({type:e,typeName:va.ZodPromise,...rs(t)});class ia extends is{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===va.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:s}=this._processInputParams(e),a=this._def.effect||null,n={addIssue:e=>{Wt(s,e),e.fatal?t.abort():t.dirty()},get path(){return s.path}};if(n.addIssue=n.addIssue.bind(n),"preprocess"===a.type){const e=a.transform(s.data,n);if(s.common.async)return Promise.resolve(e).then((async e=>{if("aborted"===t.value)return Ut;const a=await this._def.schema._parseAsync({data:e,path:s.path,parent:s});return"aborted"===a.status?Ut:"dirty"===a.status||"dirty"===t.value?Vt(a.value):a}));{if("aborted"===t.value)return Ut;const a=this._def.schema._parseSync({data:e,path:s.path,parent:s});return"aborted"===a.status?Ut:"dirty"===a.status||"dirty"===t.value?Vt(a.value):a}}if("refinement"===a.type){const e=e=>{const t=a.refinement(e,n);if(s.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===s.common.async){const a=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return"aborted"===a.status?Ut:("dirty"===a.status&&t.dirty(),e(a.value),{status:t.value,value:a.value})}return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then((s=>"aborted"===s.status?Ut:("dirty"===s.status&&t.dirty(),e(s.value).then((()=>({status:t.value,value:s.value}))))))}if("transform"===a.type){if(!1===s.common.async){const e=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!Gt(e))return e;const r=a.transform(e.value,n);if(r instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:r}}return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then((e=>Gt(e)?Promise.resolve(a.transform(e.value,n)).then((e=>({status:t.value,value:e}))):e))}Et.assertNever(a)}}ia.create=(e,t,s)=>new ia({schema:e,typeName:va.ZodEffects,effect:t,...rs(s)}),ia.createWithPreprocess=(e,t,s)=>new ia({schema:t,effect:{type:"preprocess",transform:e},typeName:va.ZodEffects,...rs(s)});class oa extends is{_parse(e){return this._getType(e)===Pt.undefined?Kt(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}oa.create=(e,t)=>new oa({innerType:e,typeName:va.ZodOptional,...rs(t)});class la extends is{_parse(e){return this._getType(e)===Pt.null?Kt(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}la.create=(e,t)=>new la({innerType:e,typeName:va.ZodNullable,...rs(t)});class da extends is{_parse(e){const{ctx:t}=this._processInputParams(e);let s=t.data;return t.parsedType===Pt.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}da.create=(e,t)=>new da({innerType:e,typeName:va.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...rs(t)});class ca extends is{_parse(e){const{ctx:t}=this._processInputParams(e),s={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return Jt(a)?a.then((e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new zt(s.common.issues)},input:s.data})}))):{status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new zt(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}}ca.create=(e,t)=>new ca({innerType:e,typeName:va.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...rs(t)});class ua extends is{_parse(e){if(this._getType(e)!==Pt.nan){const t=this._getOrReturnCtx(e);return Wt(t,{code:Rt.invalid_type,expected:Pt.nan,received:t.parsedType}),Ut}return{status:"valid",value:e.data}}}ua.create=e=>new ua({typeName:va.ZodNaN,...rs(e)});const ma=Symbol("zod_brand");class ha extends is{_parse(e){const{ctx:t}=this._processInputParams(e),s=t.data;return this._def.type._parse({data:s,path:t.path,parent:t})}unwrap(){return this._def.type}}class pa extends is{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.common.async){return(async()=>{const e=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return"aborted"===e.status?Ut:"dirty"===e.status?(t.dirty(),Vt(e.value)):this._def.out._parseAsync({data:e.value,path:s.path,parent:s})})()}{const e=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return"aborted"===e.status?Ut:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:s.path,parent:s})}}static create(e,t){return new pa({in:e,out:t,typeName:va.ZodPipeline})}}class fa extends is{_parse(e){const t=this._def.innerType._parse(e),s=e=>(Gt(e)&&(e.value=Object.freeze(e.value)),e);return Jt(t)?t.then((e=>s(e))):s(t)}unwrap(){return this._def.innerType}}function xa(e,t){const s="function"==typeof e?e(t):"string"==typeof e?{message:e}:e;return"string"==typeof s?{message:s}:s}function ga(e,t={},s){return e?zs.create().superRefine(((a,n)=>{var r,i;const o=e(a);if(o instanceof Promise)return o.then((e=>{var r,i;if(!e){const e=xa(t,a),o=null===(i=null!==(r=e.fatal)&&void 0!==r?r:s)||void 0===i||i;n.addIssue({code:"custom",...e,fatal:o})}}));if(!o){const e=xa(t,a),o=null===(i=null!==(r=e.fatal)&&void 0!==r?r:s)||void 0===i||i;n.addIssue({code:"custom",...e,fatal:o})}})):zs.create()}fa.create=(e,t)=>new fa({innerType:e,typeName:va.ZodReadonly,...rs(t)});const ya={object:Bs.lazycreate};var va,_a;(_a=va||(va={})).ZodString="ZodString",_a.ZodNumber="ZodNumber",_a.ZodNaN="ZodNaN",_a.ZodBigInt="ZodBigInt",_a.ZodBoolean="ZodBoolean",_a.ZodDate="ZodDate",_a.ZodSymbol="ZodSymbol",_a.ZodUndefined="ZodUndefined",_a.ZodNull="ZodNull",_a.ZodAny="ZodAny",_a.ZodUnknown="ZodUnknown",_a.ZodNever="ZodNever",_a.ZodVoid="ZodVoid",_a.ZodArray="ZodArray",_a.ZodObject="ZodObject",_a.ZodUnion="ZodUnion",_a.ZodDiscriminatedUnion="ZodDiscriminatedUnion",_a.ZodIntersection="ZodIntersection",_a.ZodTuple="ZodTuple",_a.ZodRecord="ZodRecord",_a.ZodMap="ZodMap",_a.ZodSet="ZodSet",_a.ZodFunction="ZodFunction",_a.ZodLazy="ZodLazy",_a.ZodLiteral="ZodLiteral",_a.ZodEnum="ZodEnum",_a.ZodEffects="ZodEffects",_a.ZodNativeEnum="ZodNativeEnum",_a.ZodOptional="ZodOptional",_a.ZodNullable="ZodNullable",_a.ZodDefault="ZodDefault",_a.ZodCatch="ZodCatch",_a.ZodPromise="ZodPromise",_a.ZodBranded="ZodBranded",_a.ZodPipeline="ZodPipeline",_a.ZodReadonly="ZodReadonly";const ja=Is.create,ka=As.create,ba=ua.create,wa=Es.create,Ca=Os.create,Sa=Fs.create,Ta=Ps.create,Ia=Ns.create,Za=Rs.create,Aa=zs.create,Ea=$s.create,Oa=Ds.create,Fa=Ms.create,Pa=Ls.create,Na=Bs.create,Ra=Bs.strictCreate,za=Us.create,$a=Ks.create,Da=Hs.create,Ma=Gs.create,La=Js.create,Wa=Ys.create,Ba=Qs.create,Ua=Xs.create,Va=ea.create,Ka=ta.create,qa=aa.create,Ha=na.create,Ga=ra.create,Ja=ia.create,Ya=oa.create,Qa=la.create,Xa=ia.createWithPreprocess,en=pa.create,tn={string:e=>Is.create({...e,coerce:!0}),number:e=>As.create({...e,coerce:!0}),boolean:e=>Os.create({...e,coerce:!0}),bigint:e=>Es.create({...e,coerce:!0}),date:e=>Fs.create({...e,coerce:!0})},sn=Ut;var an=Object.freeze({__proto__:null,defaultErrorMap:$t,setErrorMap:function(e){Dt=e},getErrorMap:Mt,makeIssue:Lt,EMPTY_PATH:[],addIssueToContext:Wt,ParseStatus:Bt,INVALID:Ut,DIRTY:Vt,OK:Kt,isAborted:qt,isDirty:Ht,isValid:Gt,isAsync:Jt,get util(){return Et},get objectUtil(){return Ft},ZodParsedType:Pt,getParsedType:Nt,ZodType:is,datetimeRegex:Cs,ZodString:Is,ZodNumber:As,ZodBigInt:Es,ZodBoolean:Os,ZodDate:Fs,ZodSymbol:Ps,ZodUndefined:Ns,ZodNull:Rs,ZodAny:zs,ZodUnknown:$s,ZodNever:Ds,ZodVoid:Ms,ZodArray:Ls,ZodObject:Bs,ZodUnion:Us,ZodDiscriminatedUnion:Ks,ZodIntersection:Hs,ZodTuple:Gs,ZodRecord:Js,ZodMap:Ys,ZodSet:Qs,ZodFunction:Xs,ZodLazy:ea,ZodLiteral:ta,ZodEnum:aa,ZodNativeEnum:na,ZodPromise:ra,ZodEffects:ia,ZodTransformer:ia,ZodOptional:oa,ZodNullable:la,ZodDefault:da,ZodCatch:ca,ZodNaN:ua,BRAND:ma,ZodBranded:ha,ZodPipeline:pa,ZodReadonly:fa,custom:ga,Schema:is,ZodSchema:is,late:ya,get ZodFirstPartyTypeKind(){return va},coerce:tn,any:Aa,array:Pa,bigint:wa,boolean:Ca,date:Sa,discriminatedUnion:$a,effect:Ja,enum:qa,function:Ua,instanceof:(e,t={message:`Input not instance of ${e.name}`})=>ga((t=>t instanceof e),t),intersection:Da,lazy:Va,literal:Ka,map:Wa,nan:ba,nativeEnum:Ha,never:Oa,null:Za,nullable:Qa,number:ka,object:Na,oboolean:()=>Ca().optional(),onumber:()=>ka().optional(),optional:Ya,ostring:()=>ja().optional(),pipeline:en,preprocess:Xa,promise:Ga,record:La,set:Ba,strictObject:Ra,string:ja,symbol:Ta,transformer:Ja,tuple:Ma,undefined:Ia,union:za,unknown:Ea,void:Fa,NEVER:sn,ZodIssueCode:Rt,quotelessJson:e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:zt});const nn=an.object({name:an.string().min(1,"Tag name is required").max(25,"Tag name must be at most 25 characters")}),rn=an.object({title:an.string().min(3,"Title must be at least 3 characters").max(100,"Title must be at most 100 characters"),text:an.union([an.string().max(1e5,"Description must be at most 100000 characters"),an.null()]).optional(),url:an.union([an.string().url("Please enter a valid URL").max(500,"URL must be at most 500 characters"),an.null(),an.string().max(0)]).optional().transform((e=>""===e?null:e)),tags:an.array(an.string().uuid("Invalid tag ID")).default([])}),on=an.object({username:an.string().min(3,"Username must be at least 3 characters").max(50,"Username must be at most 50 characters"),price:an.number().int("Price must be a whole number").min(0,"Price must be non-negative"),currency:an.string().min(1,"Currency is required"),balance:an.number().int("Balance must be a whole number").min(0,"Balance must be non-negative").optional().nullable(),description:an.union([an.string().max(1e3,"Description must be at most 1000 characters"),an.null()]).optional()}),ln=an.object({price:an.number().int("Price must be a whole number").min(0,"Price must be non-negative"),currency:an.string().min(1,"Currency is required"),balance:an.number().int("Balance must be a whole number").min(0,"Balance must be non-negative").optional().nullable(),description:an.union([an.string().max(1e3,"Description must be at most 1000 characters"),an.null()]).optional()}),dn=an.object({name:an.string().min(3,"Name must be at least 3 characters").max(100,"Name must be at most 100 characters"),student_id:an.string().uuid("Invalid student ID"),task_ids:an.array(an.string().uuid("Invalid task ID")),redeem_lesson:an.boolean().optional()});an.object({status:an.enum(["todo","done"],{errorMap:()=>({message:'Status must be either "todo" or "done"'})}).optional(),note:an.union([an.string().max(1e3,"Note must be at most 1000 characters"),an.null()]).optional(),order:an.number().int("Order must be a whole number").min(0,"Order must be non-negative").optional()});const cn=an.object({title:an.string().min(1,"Title is required").max(100,"Title must be at most 100 characters"),description:an.union([an.string().max(1e3,"Description must be at most 1000 characters"),an.null()]).optional(),cover:an.union([an.string().url("Please enter a valid URL"),an.null()]).optional(),parent_id:an.union([an.string().uuid("Invalid parent folder ID"),an.null()]).optional()});function un(e,t){try{return{isValid:!0,errors:{},validatedData:e.parse(t)}}catch(s){if(s instanceof an.ZodError){const e={};return s.errors.forEach((t=>{const s=t.path.join(".");e[s]=t.message})),{isValid:!1,errors:e}}return{isValid:!1,errors:{form:"Invalid form data"}}}}const mn="tasksPageFilters",hn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const _=Re(),[j]=ze(),{user:k}=e(),{showErrorToast:b}=t(),[w,C]=$e.useState([]),[S,T]=$e.useState([]),[I,Z]=$e.useState(!0),[A,E]=$e.useState(!1),[O,F]=$e.useState(null),[P,N]=$e.useState(0),[R,z]=$e.useState([]),[$,D]=$e.useState(""),[M,L]=$e.useState(""),[W,B]=$e.useState(null),[U,V]=$e.useState(!1),[K,q]=$e.useState(null),[H,G]=$e.useState(null),[J,Y]=$e.useState(!1),[Q,X]=$e.useState(new Set),[ee,te]=$e.useState(!1),[se,ae]=$e.useState(!1),[ne,re]=$e.useState(!1),ie=$e.useRef(!0),oe=Boolean(K),[le,de]=$e.useState(0),[ce,ue]=$e.useState(!0),me=15,he=$e.useRef(null),{t:pe}=s(),fe=(null==k?void 0:k.role)===a.ADMIN,xe=(null==k?void 0:k.role)===a.TEACHER||fe,ge=$e.useCallback((()=>{try{const e=localStorage.getItem(mn);if(e){return JSON.parse(e)}}catch(e){}return{searchTerm:"",filterTagIds:[]}}),[]),ye=$e.useCallback((()=>{const e={searchTerm:$,filterTagIds:R.map((e=>e.id))};localStorage.setItem(mn,JSON.stringify(e))}),[$,R]);$e.useEffect((()=>{const e=setTimeout((()=>{D(M)}),500);return()=>clearTimeout(e)}),[M]),$e.useEffect((()=>{ie.current||ye()}),[$,R,ye]),$e.useEffect((()=>{(async()=>{if(ie.current){Z(!0),F(null);try{const e=ge(),t=j.get("tag_id"),s=await n.tags.getAll();T(s);let a=[];if(t){const e=s.find((e=>e.id===t));e&&(z([e]),a=[t])}else if(e.filterTagIds.length>0){const t=e.filterTagIds.map((e=>s.find((t=>t.id===e)))).filter((e=>void 0!==e));t.length>0&&(z(t),a=e.filterTagIds)}e.searchTerm&&(D(e.searchTerm),L(e.searchTerm));const r=e.searchTerm||"",i=await n.tasks.getAll(0,me,r,a.join(","));C(i),de(0),ue(i.length===me),ie.current=!1,F(null)}catch(e){const t=y(e);F(t),b(t)}finally{Z(!1)}}})()}),[P,j,ge]),$e.useEffect((()=>{if(ie.current)return;(async()=>{Z(!0),F(null);try{const e=await n.tasks.getAll(0,me,$,R.map((e=>e.id)).join(","));C(e),de(0),ue(e.length===me)}catch(e){F("Failed to search tasks. Please try again.")}finally{Z(!1)}})()}),[$,R]),$e.useEffect((()=>{const e=new IntersectionObserver((e=>{const[t]=e;t.isIntersecting&&ce&&!I&&!A&&ve()}),{threshold:.5}),t=he.current;return t&&e.observe(t),()=>{t&&e.unobserve(t)}}),[ce,I,A]);const ve=async()=>{if(!ce||A)return;E(!0);const e=le+1;try{const t=await n.tasks.getAll(e*me,me,$,R.map((e=>e.id)).join(","));if(t.length>0){const s=t.filter((e=>!w.some((t=>t.id===e.id))));C((e=>[...e,...s])),de(e),ue(t.length===me)}else ue(!1)}catch(t){b("Failed to load more tasks. Please try again.")}finally{E(!1)}},_e=$e.useCallback((()=>{N((e=>e+1))}),[]),je=()=>{localStorage.removeItem(mn),D(""),L(""),z([])},ke=()=>{V(!1)},be=(e,t)=>{e.stopPropagation(),q(e.currentTarget),G(t)},we=()=>{q(null)},Ce=()=>{Y(!1),G(null)},Se=e=>{X((t=>{const s=new Set(t);return s.has(e.id)?s.delete(e.id):s.add(e.id),s})),te(!0),V(!1)},Te=()=>{ae(!1)},Ie=[De.jsxs(Me,{onClick:e=>{e.stopPropagation(),Se(H),we()},children:[De.jsx(Le,{children:De.jsx(r,{fontSize:"small"})}),De.jsx(We,{children:pe("common.actions.select")})]},"select"),De.jsxs(Me,{onClick:()=>{H&&(_(`/tasks/new?copy_task_id=${H.id}`),we())},children:[De.jsx(Le,{children:De.jsx(i,{fontSize:"small"})}),De.jsx(We,{children:pe("common.actions.copy")})]},"copy"),De.jsxs(Me,{onClick:async()=>{if(H){re(!0);try{const{exportToDocx:e}=await v((async()=>{const{exportToDocx:e}=await import("./markdownExport-P5Faunep.js").then((e=>e.bx));return{exportToDocx:e}}),__vite__mapDeps([0,1,2,3,4]),import.meta.url),t=await e(H),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`${H.title}.docx`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s)}catch(e){b("Failed to export task to DOCX. Please try again.")}finally{re(!1),we()}}},disabled:ne,children:[De.jsx(Le,{children:ne?De.jsx(Be,{size:20}):De.jsx(o,{fontSize:"small"})}),De.jsx(We,{children:pe("common.actions.export")})]},"export"),De.jsxs(Me,{onClick:()=>{we(),Y(!0)},sx:{color:"error.main"},children:[De.jsx(Le,{children:De.jsx(l,{fontSize:"small",color:"error"})}),De.jsx(We,{children:pe("common.actions.delete")})]},"delete")];return De.jsxs(Ue,{children:[De.jsx(d,{title:pe("tasks.title"),actionButton:xe?[{label:pe("tasks.actions.createTask"),icon:De.jsx(c,{}),onClick:()=>_("/tasks/new")}]:void 0}),O&&De.jsx(Ve,{severity:"error",sx:{mb:2},action:De.jsx(Ke,{color:"inherit",size:"small",onClick:_e,disabled:I,children:I?"Loading...":"Retry"}),children:O}),De.jsx(qe,{sx:{p:2,mb:2},children:De.jsxs(He,{spacing:2,children:[De.jsxs(Ue,{sx:{display:"flex",flexDirection:"column",gap:2},children:[De.jsx(Ge,{multiple:!0,options:S,getOptionLabel:e=>e.name,value:R,onChange:(e,t)=>z(t),renderInput:e=>De.jsx(Ye,{...e,label:pe("tasks.actions.filterByTags"),placeholder:pe("filters.selectTags"),variant:"outlined",InputProps:{...e.InputProps,startAdornment:De.jsxs(De.Fragment,{children:[De.jsx(u,{sx:{mr:1,color:"text.secondary"}}),e.InputProps.startAdornment]})}}),renderTags:(e,t)=>e.map(((e,s)=>$e.createElement(Je,{color:"primary",label:e.name,...t({index:s}),key:e.id})))}),De.jsx(Ue,{sx:{display:"flex",gap:2},children:De.jsx(Ye,{label:pe("tasks.actions.searchByTitle"),placeholder:pe("filters.enterTitle"),variant:"outlined",fullWidth:!0,value:M,onChange:e=>{const t=e.target.value;L(t)},InputProps:{startAdornment:De.jsx(h,{sx:{mr:1,color:"text.secondary"}}),endAdornment:M?De.jsx(Qe,{position:"end",children:De.jsx(Xe,{"aria-label":"clear search",onClick:()=>{L(""),D("")},edge:"end",size:"small",children:De.jsx(m,{fontSize:"small"})})}):null}})})]}),(R.length>0||M)&&De.jsx(Ue,{sx:{display:"flex",justifyContent:"center"},children:De.jsx(Ke,{variant:"outlined",startIcon:De.jsx(u,{}),onClick:je,children:pe("common.actions.clear")})})]})}),ee&&De.jsx(et,{position:"static",color:"default",elevation:1,sx:{mb:2},children:De.jsxs(tt,{variant:"dense",children:[De.jsxs(Ue,{sx:{display:"flex",alignItems:"center",gap:1,flex:1},children:[De.jsx(st,{edge:"start",checked:Q.size===w.length,indeterminate:Q.size>0&&Q.size<w.length,onChange:()=>{Q.size===w.length?X(new Set):X(new Set(w.map((e=>e.id))))}}),De.jsx(at,{variant:"body2",children:pe("tasks.selection.selected",{count:Q.size})})]}),De.jsxs(Ue,{sx:{display:"flex"},children:[xe&&De.jsx(Ke,{color:"error",startIcon:De.jsx(l,{}),onClick:()=>{ae(!0)},disabled:0===Q.size,children:pe("tasks.selection.deleteCount",{count:Q.size||0})}),De.jsx(Ke,{onClick:()=>{X(new Set),te(!1)},children:pe("common.actions.cancel")})]})]})}),I?De.jsx(p,{message:pe("common.loading")}):De.jsxs(De.Fragment,{children:[O||0!==w.length?De.jsxs(De.Fragment,{children:[De.jsx(Ue,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)",lg:"repeat(3, 1fr)"},gap:2},children:w.map((e=>De.jsxs(nt,{sx:{height:"100%",cursor:"pointer",position:"relative","&:hover":{boxShadow:6}},onClick:()=>!ee&&(e=>{B(e),V(!0)})(e),children:[ee&&De.jsx(st,{edge:"start",checked:Q.has(e.id),onChange:t=>{t.stopPropagation(),Se(e)},sx:{position:"absolute",top:8,right:8,zIndex:1}}),De.jsx(rt,{sx:{p:2,"&:last-child":{paddingBottom:2}},children:De.jsxs(Ue,{sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:1},children:[De.jsx(at,{sx:{flex:1,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:1.2},children:e.title}),De.jsx(Ue,{sx:{display:"flex",flexDirection:"row",gap:1,flexShrink:0},children:!ee&&De.jsxs(De.Fragment,{children:[De.jsx(Xe,{size:"small",onClick:t=>{t.stopPropagation(),_(`/tasks/${e.id}/edit`)},children:De.jsx(f,{})}),De.jsx(Xe,{size:"small",onClick:t=>be(t,e),children:De.jsx(x,{})})]})})]})}),e.tags.length>0&&De.jsx(it,{sx:{pt:0,px:2,pb:2},children:De.jsx(Ue,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.tags.map((e=>De.jsx(Je,{label:e.name,size:"small",variant:"outlined",onClick:t=>{t.stopPropagation(),R.some((t=>t.id===e.id))||z([...R,e])},sx:{cursor:"pointer","&:hover":{backgroundColor:"action.hover"}}},e.id)))})})]},e.id)))}),De.jsx(Ue,{ref:he,sx:{display:"flex",justifyContent:"center",p:2,visibility:ce?"visible":"hidden"},children:A&&De.jsx(Be,{size:24})})]}):De.jsxs(Ue,{sx:{textAlign:"center",py:4},children:[De.jsx(at,{variant:"h6",color:"text.secondary",sx:{mb:1},children:$.length<1&&R.length<1?pe(xe?"tasks.empty.teacher":"tasks.empty.student"):pe("tasks.empty.noMatch")}),xe&&$.length<1&&R.length<1&&De.jsx(Ke,{variant:"outlined",startIcon:De.jsx(c,{}),onClick:()=>_("/tasks/new"),sx:{mt:2},children:pe("tasks.actions.createFirst")}),($.length>0||R.length>0)&&De.jsx(Ke,{variant:"outlined",startIcon:De.jsx(u,{}),onClick:je,sx:{borderRadius:2,textTransform:"none"},children:pe("common.actions.clear")})]}),De.jsx(g,{open:U,onClose:ke,task:W,hasQuizzes:!1,onValidateAnswers:()=>{},actionButtons:De.jsxs(Ue,{sx:{display:"flex",gap:1,width:"100%",justifyContent:"space-between"},children:[De.jsx(Ue,{sx:{display:"flex",gap:1},children:W&&De.jsxs(De.Fragment,{children:[De.jsx(Ke,{size:"small",onClick:e=>be(e,W),startIcon:De.jsx(x,{}),children:pe("common.actions.actions")}),De.jsx(Ke,{size:"small",onClick:e=>{e.stopPropagation(),_(`/tasks/${W.id}/edit`)},startIcon:De.jsx(f,{}),children:pe("common.actions.edit")})]})}),De.jsx(Ke,{onClick:ke,children:pe("common.actions.close")})]})}),De.jsx(ot,{anchorEl:K,open:oe,onClose:we,onClick:e=>e.stopPropagation(),children:Ie}),De.jsxs(lt,{open:J,onClose:Ce,maxWidth:"xs",fullWidth:!0,children:[De.jsx(dt,{children:pe("common.dialog.delete.title",{item:"Task"})}),De.jsx(ct,{children:De.jsx(at,{children:pe("common.dialog.delete.message",{name:null==H?void 0:H.title})})}),De.jsxs(ut,{children:[De.jsx(Ke,{onClick:Ce,children:pe("common.actions.cancel")}),De.jsx(Ke,{onClick:async()=>{if(H)try{await n.tasks.delete(H.id),C(w.filter((e=>e.id!==H.id)))}catch(e){const t=e instanceof Error?e.message:"Failed to delete task. Please try again.";b(t)}finally{Y(!1),G(null)}},color:"error",variant:"contained",startIcon:De.jsx(l,{}),children:pe("common.actions.delete")})]})]}),De.jsxs(lt,{open:se,onClose:Te,maxWidth:"xs",fullWidth:!0,children:[De.jsx(dt,{children:pe("common.dialog.delete.title",{item:"Tasks"})}),De.jsx(ct,{children:De.jsx(at,{children:pe("common.dialog.delete.messageBulk",{count:Q.size,item:1===Q.size?"task":"tasks"})})}),De.jsxs(ut,{children:[De.jsx(Ke,{onClick:Te,children:pe("common.actions.cancel")}),De.jsxs(Ke,{onClick:async()=>{try{await n.tasks.batchDelete(Array.from(Q));C(w.filter((e=>!Q.has(e.id)))),X(new Set),te(!1)}catch(e){const t=e instanceof Error?e.message:"Failed to delete tasks. Please try again.";b(t)}finally{ae(!1)}},color:"error",variant:"contained",startIcon:De.jsx(l,{}),children:[pe("common.actions.delete")," ",Q.size," ",1===Q.size?"task":"tasks"]})]})]})]})]})}},Symbol.toStringTag,{value:"Module"})),pn=({editorRef:e,formData:a,setFormData:r,setGeneratedImage:i,setInitText:o,onClose:l})=>{const{t:d}=s(),[c,u]=$e.useState(""),[m,h]=$e.useState(!1),[p,f]=$e.useState([]),[g,y]=$e.useState(null),[v,S]=$e.useState(null),[T,I]=$e.useState(!1),[Z,A]=$e.useState("text"),{showErrorToast:E}=t(),O=()=>{y(null),S(null)},F=async(t,s)=>{const n={id:Date.now().toString(),message:"",text:a.text,timestamp:new Date,status:"done",image:s,type:Z};f((e=>[n,...e]));const i=`\n${t}\n`,o=a.text+i;r((e=>({...e,text:o}))),e.current&&(e.current.setMarkdown(o),e.current.focus())};return De.jsxs(qe,{sx:{width:"350px",display:"flex",flexDirection:"column",overflow:"hidden"},children:[De.jsxs(Ue,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2},children:[De.jsx(at,{variant:"h5",component:"div",children:d("taskForm.ai.title")}),De.jsx(Ue,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:De.jsx(Xe,{size:"small",onClick:l,children:De.jsx(_,{})})})]}),De.jsxs(Ue,{sx:{flex:1,overflow:"auto",p:2,pt:0},children:[De.jsx(at,{variant:"body1",color:"text.secondary",sx:{mb:2},children:d("taskForm.ai.placeholder")}),p.length>0&&De.jsxs(Ue,{sx:{mb:2},children:[De.jsxs(at,{variant:"subtitle2",sx:{mb:1},children:[d("taskForm.ai.history"),":"]}),De.jsx(mt,{dense:!0,sx:{bgcolor:"background.paper",borderRadius:1,border:"1px solid",borderColor:"divider"},children:p.map((e=>De.jsxs(ht,{onClick:t=>((e,t)=>{y(e.currentTarget),S(t)})(t,e),sx:{"&:hover":{bgcolor:"action.hover"}},secondaryAction:De.jsx(De.Fragment,{children:De.jsx(Xe,{size:"small",sx:{ml:1},children:De.jsx(x,{fontSize:"small"})})}),children:[De.jsxs(Ue,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:"50px",height:"50px",mr:1},children:["processing"===e.status&&De.jsx(Be,{size:16}),"done"===e.status&&!e.image&&De.jsx(j,{fontSize:"small",color:"success"}),"done"===e.status&&e.image&&De.jsx("img",{src:e.image,style:{width:"100%"}}),"error"===e.status&&De.jsx(k,{fontSize:"small",color:"error"})]}),De.jsx(We,{primary:e.message||d("taskForm.ai.imageRecognizedText"),secondary:e.timestamp.toLocaleTimeString(d("locale"),{timeStyle:"short"})})]},e.id)))})]}),!1,De.jsx(Ye,{fullWidth:!0,multiline:!0,minRows:3,maxRows:20,variant:"outlined",placeholder:d("taskForm.ai.messageInputPlaceholder"),value:c,onChange:e=>u(e.target.value),disabled:m,onPaste:async e=>{e.preventDefault();const t=e.clipboardData.items;for(const a of t)if(a.type.startsWith("image/")){const e=a.getAsFile();if(e){I(!0);try{const t=await new Promise((t=>{const s=new FileReader;s.onloadend=()=>t(s.result),s.readAsDataURL(e)})),s=await n.files.recognizeText({imageBase64:t,mode:"text"});s&&await F(s,t)}catch(s){E(d("taskForm.ai.errors.imageProcessing"))}finally{I(!1)}}}else if("text/plain"===a.type){const e=await new Promise((e=>a.getAsString(e)));if(e.match(/^https?:\/\/.+\.(jpg|jpeg|png|gif|webp)$/i)){I(!0);try{const t=await fetch(e),s=await t.blob(),a=await new Promise((e=>{const t=new FileReader;t.onloadend=()=>e(t.result),t.readAsDataURL(s)})),r=await n.files.recognizeText({imageBase64:a,mode:"text"});r&&await F(r,a)}catch(s){E(d("taskForm.ai.errors.imageURLProcessing"))}finally{I(!1)}}}},sx:{mb:2}}),De.jsxs(Ue,{sx:{display:"flex",gap:1,mb:2},children:[De.jsx(Ke,{variant:"outlined",color:"primary",onClick:()=>{var e;return null==(e=document.getElementById("image-input"))?void 0:e.click()},disabled:T,startIcon:De.jsx(b,{}),children:d(T?"common.loading":"taskForm.ai.image")}),De.jsx(Ke,{variant:"contained",color:"primary",endIcon:De.jsx(w,{}),onClick:async()=>{if(!c.trim())return;const t={id:Date.now().toString(),message:c,text:a.text||"",timestamp:new Date,status:"processing",type:Z};f((e=>[t,...e])),u(""),h(!0);try{const s=await n.tasks.chat({text:a.text,message:t.message,type:t.type});f((e=>e.map((e=>e.id===t.id?{...e,status:"done",text:s}:e)))),"text"===Z&&s&&(o(a.text),r((e=>({...e,text:s}))),e.current&&(e.current.setMarkdown(s||""),e.current.focus()))}catch(s){f((e=>e.map((e=>e.id===t.id?{...e,status:"error"}:e)))),E("Failed to get AI response. "+s)}finally{h(!1)}},disabled:m||!c.trim(),sx:{flex:1},children:d(m?"taskForm.ai.sending":"taskForm.ai.send")}),De.jsx("input",{type:"file",accept:"image/*",style:{display:"none"},id:"image-input",onChange:async e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s){I(!0);try{const e=await new Promise((e=>{const t=new FileReader;t.onloadend=()=>e(t.result),t.readAsDataURL(s)})),t=await n.files.recognizeText({imageBase64:e,mode:"text"});t?await F(t,e):E(d("taskForm.ai.errors.noTextRecognized"))}catch(a){E(d("taskForm.ai.errors.imageProcessing"))}finally{I(!1)}}}})]})]}),De.jsx(ot,{anchorEl:g,open:Boolean(g),onClose:O,children:De.jsxs(Me,{onClick:()=>{v&&(u(v.message),r((e=>({...e,text:v.text}))),e.current&&(e.current.setMarkdown(v.text||""),e.current.focus()),f((e=>{const t=e.findIndex((e=>e.id===v.id));return-1===t?e:e.slice(t+1)}))),O()},children:[De.jsx(C,{fontSize:"small",sx:{mr:1}}),d("taskForm.ai.rollback")]})})]})},fn=({title:e,text:t,url:a,tagIds:n,tags:r,teacherId:i,onClose:o,onFullscreen:l,onValidateAnswers:d,hasQuizzes:c})=>{const{t:u}=s();return De.jsxs(qe,{id:"preview-panel-paper",sx:{width:"350px",display:"flex",flexDirection:"column",height:"100%"},children:[De.jsx(Ue,{sx:{width:"100%",display:"flex",flexDirection:"column",gap:2,p:2,flex:"flex-start"},children:De.jsxs(Ue,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[De.jsx(at,{variant:"h5",component:"div",children:u("common.dialog.preview.title")}),De.jsxs(Ue,{sx:{display:"flex",gap:1},children:[De.jsx(Xe,{size:"small",onClick:l,children:De.jsx(S,{})}),De.jsx(Xe,{size:"small",onClick:o,children:De.jsx(_,{})})]})]})}),De.jsxs(Ue,{sx:{overflow:"auto",flex:"flex",px:2,height:"100%"},children:[De.jsx(Ue,{sx:{mb:2},children:De.jsx(at,{variant:"h3",children:e})}),De.jsx(T,{task:{id:"preview",title:e,text:t,url:a||"",tags:r.filter((e=>n.includes(e.id))),teacher_id:i},isSaveAnswer:!1,workId:"preview"})]}),c&&De.jsx(Ue,{sx:{p:2,borderTop:1,borderColor:"divider",display:"flex",justifyContent:"center",mt:"auto",flex:"flex-end"},children:De.jsx(Ke,{variant:"contained",color:"primary",onClick:d,startIcon:De.jsx(j,{}),children:u("common.actions.checkAnswers")})})]})},xn=()=>{const{t:e}=s(),t=I(Z),[a,n]=$e.useState(null),[r,i]=$e.useState(null),o=()=>{n(null)},l=Boolean(a),d=(e,t)=>{const s=!!r&&((null==r?void 0:r.row)>=e&&(null==r?void 0:r.col)>=t);return{minWidth:"40px",height:"40px",backgroundColor:s?"primary.main":"transparent",color:s?"primary.contrastText":"primary.main","&:hover":{backgroundColor:"primary.main"},transition:"all 0.5s ease"}};return De.jsxs(De.Fragment,{children:[De.jsx(A,{title:e("taskForm.table.title"),children:De.jsx("span",{onClick:e=>{n(e.currentTarget)},children:De.jsx(E,{})})}),De.jsx(pt,{open:l,anchorEl:a,onClose:o,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:De.jsx(Ue,{sx:{p:2},children:De.jsx(Ue,{sx:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:1,width:200},children:Array.from({length:4},((e,t)=>t+1)).map((e=>Array.from({length:4},((e,t)=>t+1)).map((s=>De.jsxs(Ke,{variant:"outlined",size:"small",onClick:()=>(t({rows:e,columns:s}),void o()),onMouseEnter:()=>i({row:e,col:s}),onMouseLeave:()=>i(null),sx:d(e,s),children:[e,"x",s]},`${e}-${s}`)))))})})})]})},gn=({editorRef:e,formData:t,setFormData:a,setInitText:n,setGeneratedImage:r,onClose:i})=>{const{t:o}=s(),l=[{icon:De.jsx(O,{}),title:o("components.hiddenText.title"),description:o("components.hiddenText.hint"),image:null},{icon:De.jsx(F,{}),title:o("components.multipleChoice.title"),description:o("components.multipleChoice.hint"),image:null},{icon:De.jsx(P,{}),title:o("components.draggableAnswers.title"),description:o("components.draggableAnswers.hint"),image:null},{icon:De.jsx(N,{}),title:o("components.sortingOrdering.title"),description:o("components.sortingOrdering.hint"),image:null},{icon:De.jsx(R,{}),title:o("components.studentsSection.title"),description:o("components.studentsSection.hint"),image:null},{icon:De.jsx(b,{}),title:o("components.image.title"),description:o("components.image.hint"),image:null},{icon:De.jsx(z,{}),title:o("components.audio.title"),description:o("components.audio.hint"),image:null},{icon:De.jsx($,{}),title:o("components.embed.title"),description:o("components.embed.hint"),image:null}];return De.jsx(Ue,{children:De.jsx(Ue,{sx:{display:"flex",flexWrap:"wrap",gap:2,"& > *":{flex:"1 1 calc(50% - 16px)",minWidth:"200px"}},children:l.map(((e,t)=>De.jsx(Ue,{children:De.jsx(nt,{sx:{height:"100%"},children:De.jsxs(rt,{children:[De.jsxs(Ue,{sx:{display:"flex",alignItems:"center",mb:2},children:[De.jsx(Le,{sx:{minWidth:40},children:e.icon}),De.jsx(We,{primary:e.title,primaryTypographyProps:{variant:"subtitle1",sx:{fontWeight:500}}})]}),De.jsx(at,{variant:"body2",color:"text.secondary",children:e.description})]})})},t)))})})},yn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const r=Re(),{taskId:i}=ft(),[o]=ze(),l=o.get("return_to")||"/tasks",d=o.get("copy_task_id"),c=o.get("work_id"),u=o.get("sharingKey"),{user:m}=e(),{showErrorToast:h}=t(),{mode:f}=D(),x=$e.useRef(null),[y,v]=$e.useState(null),[_,j]=$e.useState(!0),[k,b]=$e.useState(!1),[w,C]=$e.useState([]),[S,T]=$e.useState({title:"",text:"",url:"",tag_ids:[]}),[I,Z]=$e.useState(null),[A,E]=$e.useState({}),[O,F]=$e.useState(!1),[P,N]=$e.useState((()=>localStorage.getItem("taskForm_sidePanelMode")||"live-preview"));$e.useEffect((()=>{P?localStorage.setItem("taskForm_sidePanelMode",P):localStorage.removeItem("taskForm_sidePanelMode")}),[P]);const[R,z]=$e.useState(""),[$,be]=$e.useState(null),[we,Ce]=$e.useState(!1),[Se,Te]=$e.useState(""),[Ie,Ze]=$e.useState(!1),[Ae,Ee]=$e.useState(!1),[Oe,Fe]=$e.useState(null),[Pe,Ne]=$e.useState(null),Me=(null==m?void 0:m.role)===a.ADMIN,Le=(null==m?void 0:m.role)===a.TEACHER||Me,We=Boolean(i),[Be,Ve]=$e.useState(!1),He=xt(),Qe=gt(He.breakpoints.down("md")),{t:Xe}=s(),et=$e.useRef(S);$e.useEffect((()=>{if(!Ae)return;const e=i?`task_${i}`:"new_task";Te(e);const t=localStorage.getItem(e);t&&(be(t),Ce(!0))}),[i,Ae]);const tt=e=>{if(Ce(!1),e&&$)try{const e=JSON.parse($);et.current={...et.current,...e},T({...et.current});const t=document.querySelector('input[name="title"]');t&&(t.value=e.title||""),x.current&&(x.current.setMarkdown(e.text||""),x.current.focus())}catch(t){}else localStorage.removeItem(Se),be(null)},st=$e.useCallback(yt((()=>{T({...et.current}),E((e=>{const t={...e};return et.current.title&&t.title&&delete t.title,et.current.text&&t.text&&delete t.text,et.current.tag_ids.length>0&&t.tag_ids&&delete t.tag_ids,t})),Se&&localStorage.setItem(Se,JSON.stringify(et.current))}),500),[Se]),nt=e=>{if(!e)return!1;return e.includes(":hidden")||e.includes(":essay")||e.includes(":sort")||e.includes(":select")},rt=()=>{window.dispatchEvent(new CustomEvent("validateAllQuizzes",{detail:{taskId:"preview"}}))},it=e=>{e?(be(null),localStorage.removeItem(Se),Ze(!1),r(l)):Ze(!1)};if($e.useEffect((()=>{const e=setTimeout((()=>{x.current&&Ee(!0)}),500);return()=>clearTimeout(e)}),[]),$e.useEffect((()=>{let e=!0;return(async()=>{if(e){j(!0);try{const t=await n.tags.getAll();if(!e)return;if(C(t),i){const t=await n.tasks.getById(i);if(!e)return;v(t),z(t.text||"");const s={title:t.title,text:t.text||"",tag_ids:t.tags.map((e=>e.id))};et.current=s,T(s)}else if(d){const t=await n.tasks.getById(d);if(!e)return;v(t),z(t.text||"");const s={title:`Copy of ${t.title}`,text:t.text||"",tag_ids:t.tags.map((e=>e.id))};et.current=s,T(s)}else if(u){const t=await n.tasks.getBySharingKey(u);if(!e)return;v(t),z(t.text||"");const s={title:t.title,text:t.text||"",tag_ids:t.tags.map((e=>e.id))};et.current=s,T(s)}c&&Z(await n.works.getById(c))}catch(t){const s=t instanceof Error?t.message:"Failed to load data. Please try again.";if(!e)return;h(s),r(l)}finally{if(!e)return;j(!1)}}})(),()=>{e=!1}}),[i,d,r,l]),!Le)return r(l),null;function ot(e=!1){return De.jsxs(De.Fragment,{children:[De.jsx(de,{options:["Bold","Italic"]}),De.jsx(ce,{options:["bullet","number"]}),De.jsx(xn,{}),De.jsx(ue,{}),De.jsx(me,{}),De.jsx(he,{editorRef:x}),De.jsx(pe,{editorRef:x}),De.jsx(me,{}),De.jsx(fe,{editorRef:x}),De.jsx(xe,{editorRef:x}),De.jsx(me,{}),De.jsx(ge,{editorRef:x}),De.jsx(ye,{}),De.jsx(ve,{}),De.jsx(_e,{}),De.jsx(je,{}),De.jsx(me,{}),De.jsx(ke,{})]})}return De.jsxs(Ue,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[_?De.jsx(p,{message:Xe(We?"taskForm.loading.task":"taskForm.loading.default")}):De.jsxs(Ue,{sx:{display:"flex",gap:2,height:"100%",overflow:"hidden",justifyContent:"center",alignItems:"center"},children:[De.jsxs(Ue,{sx:{display:"flex",flex:"3 1",flexDirection:"column",width:"100%",maxWidth:"800px",height:"100%",position:"relative",overflow:"hidden"},children:[De.jsx(Ue,{sx:{flex:1,overflow:"auto",p:1,pt:0},children:De.jsx(Ue,{width:"100%",sx:{display:"flex",justifyContent:"space-between"},children:De.jsx(Ue,{sx:{flex:1,display:"flex",flexDirection:"column",width:"100%",position:"relative"},children:De.jsxs(Ue,{component:"form",noValidate:!0,sx:{display:"flex",flexDirection:"column",height:"100%",minHeight:0,flex:1},children:[De.jsxs(qe,{sx:{p:2,pt:0,pb:1},children:[I&&De.jsx(Ue,{sx:{my:2},children:De.jsx(Je,{label:I.name,onDelete:()=>r(l),color:"primary"})}),De.jsx(Ye,{autoFocus:!0,margin:"normal",name:"title",label:Xe("taskForm.title.label"),type:"text",fullWidth:!0,variant:"outlined",defaultValue:S.title,onChange:e=>{et.current.title=e.target.value,st()},error:!!A.title,helperText:A.title,inputProps:{autoComplete:"off"}}),De.jsx(Ge,{multiple:!0,options:w,getOptionLabel:e=>e.name,value:w.filter((e=>et.current.tag_ids.includes(e.id))),onChange:(e,t)=>{const s=t.map((e=>e.id));et.current.tag_ids=s,T({...et.current}),st()},disabled:Be,disableCloseOnSelect:!0,renderInput:e=>De.jsxs(Ue,{sx:{position:"relative"},children:[De.jsx(Ye,{...e,label:Xe("taskForm.tags.label"),margin:"normal",error:!!A.tag_ids}),Be&&De.jsx(vt,{sx:{position:"absolute",bottom:0,left:0,right:0,height:2}})]}),filterOptions:(e,{inputValue:t})=>{const s=e.filter((e=>e.name.toLowerCase().includes(t.toLowerCase())));return t&&!s.length?[{id:"new",name:t,creator_id:(null==m?void 0:m.id)||""}]:s},renderOption:(e,t)=>"new"===t.id?De.jsx("li",{...e,onClick:async e=>{e.stopPropagation(),Ve(!0);try{const e=await n.tags.create({name:t.name});C((t=>[...t,e])),et.current.tag_ids=[...et.current.tag_ids,e.id],T({...et.current})}catch(s){const e=s instanceof Error?s.message:"Failed to create tag. Please try again.";h(e)}finally{Ve(!1)}},children:Xe("taskForm.tags.create",{name:t.name})}):De.jsx("li",{...e,children:t.name})}),A.tag_ids&&De.jsx(_t,{error:!0,children:A.tag_ids})]}),De.jsx(qe,{sx:{flex:1,display:"flex",flexDirection:"column",minHeight:0,position:"relative",mt:2,mb:2,border:"1px solid",borderColor:"divider"},children:De.jsx(M,{ref:x,markdown:S.text,autoFocus:!1,onChange:e=>{et.current.text=e,st()},className:"dark"===f?"mdxeditor dark-theme dark-editor":"mdxeditor light-theme light-editor",translation:(e,t,s)=>Xe("editor."+e,{defaultValue:t,...s}),plugins:[L(),W(),B(),U({disableImageResize:!0,disableImageSettingsButton:!0,imageUploadHandler:async e=>{const t=URL.createObjectURL(e);Fe(t);const s=await n.files.uploadImage(e);return s.url?(Fe(null),URL.revokeObjectURL(t),s.url):(h("Failed to upload image. Please try again."),t)},EditImageToolbar:X}),V(),K(),q(),H(),G({viewMode:"rich-text",diffMarkdown:R}),J({escapeUnknownTextDirectives:!0,directiveDescriptors:[ee,te,se,ae,ne,re,ie]}),Y(1e5),Q({toolbarClassName:"mdxeditor-toolbar-full ",toolbarContents:()=>De.jsx(oe,{options:Qe?[]:["source"],children:De.jsx(le,{options:[{when:e=>{var t,s;return"root"!==(null==(t=null==e?void 0:e.rootNode)?void 0:t.getType())&&void 0!==(null==(s=null==e?void 0:e.rootNode)?void 0:s.getType())},contents:()=>De.jsx(at,{children:Xe("taskForm.validation.textOnlyInComponent")})},{when:e=>{var t,s,a,n;return"root"===(null==(t=null==e?void 0:e.rootNode)?void 0:t.getType())&&void 0!==(null==(s=window.document)?void 0:s.getSelection())&&""!==(null==(n=null==(a=window.document)?void 0:a.getSelection())?void 0:n.toString())},contents:()=>ot(!0)},{fallback:()=>ot(!1)}]})})})]})})]})})})}),De.jsxs(Ue,{sx:{width:"100%",p:1,display:"flex",justifyContent:"space-between",position:"sticky",bottom:0,left:0,zIndex:1},children:[De.jsx(Ue,{sx:{display:"flex-start",gap:2},children:De.jsx(Ke,{variant:"outlined",color:"inherit",onClick:()=>{null!==localStorage.getItem(Se)?Ze(!0):r(l)},children:Xe("taskForm.buttons.cancel")})}),De.jsx(Ue,{sx:{display:{xs:"none",lg:"flex",gap:2}},children:De.jsxs(jt,{color:"primary",value:P,exclusive:!0,onChange:(e,t)=>{N(t)},size:"small",sx:{"& .MuiToggleButtonGroup-firstButton":{borderRadius:"10px 0 0 10px"},"& .MuiToggleButtonGroup-lastButton":{borderRadius:"0 10px 10px 0"}},children:[De.jsx(kt,{value:"components-help",children:Xe("taskForm.buttons.quickHelp")}),De.jsx(kt,{value:"live-preview",children:Xe("taskForm.buttons.livePreview")}),De.jsx(kt,{value:"ai-chat",children:Xe("taskForm.buttons.aiAssistant")})]})}),De.jsxs(Ue,{sx:{display:"flex-end",gap:2},children:[De.jsx(bt,{title:Xe("taskForm.buttons.preview"),children:De.jsx(Ke,{variant:"outlined",color:"info",onClick:()=>F(!0),sx:{mr:1},children:Xe("taskForm.buttons.preview")})}),De.jsx(bt,{title:k?Xe("taskForm.loading.saving"):S.title.trim()?S.text.trim()?"":Xe("taskForm.content.error.required"):Xe("taskForm.title.error.required"),children:De.jsx("span",{children:De.jsx(Ke,{variant:"contained",color:"primary",onClick:async()=>{const{isValid:e,errors:t}=un(rn,S);if(e){b(!0);try{if(We&&i)await n.tasks.update(i,S);else{const e=await n.tasks.create(S);c&&await n.works.addTask(c,e.id)}be(null),localStorage.removeItem(Se),r(l)}catch(s){const e=s instanceof Error?s.message:"Failed to save task. Please try again.";h(e)}finally{b(!1)}}else E(t)},disabled:k||!S.title.trim()||!S.text.trim(),children:Xe(k?"taskForm.loading.saving":We?"taskForm.buttons.update":"taskForm.buttons.create")})})})]})]})]}),De.jsxs(Ue,{sx:{display:{xs:"none",lg:P?"flex":"none"},flex:"1",height:"100%",width:"auto",minWidth:"350px",maxWidth:"600px",overflow:"auto",p:2,pt:0,flexDirection:"column",alignItems:"center"},children:["live-preview"===P&&De.jsx(fn,{title:S.title||"",text:S.text||"",tagIds:S.tag_ids,tags:w,teacherId:(null==m?void 0:m.id)||"",onClose:()=>N(null),onFullscreen:()=>F(!0),onValidateAnswers:rt,hasQuizzes:nt(S.text||"")}),"ai-chat"===P&&De.jsx(pn,{editorRef:x,formData:S,setFormData:T,setInitText:z,setGeneratedImage:Ne,onClose:()=>N(null)}),"components-help"===P&&De.jsx(gn,{editorRef:x,formData:S,setFormData:T,setInitText:z,setGeneratedImage:Ne,onClose:()=>N(null)})]})]}),De.jsx(g,{open:O,onClose:()=>F(!1),task:{id:"preview",title:S.title||"",text:S.text||"",tags:w.filter((e=>S.tag_ids.includes(e.id))),teacher_id:(null==m?void 0:m.id)||""},hasQuizzes:nt(S.text),onValidateAnswers:rt}),De.jsxs(lt,{open:we,onClose:()=>Ce(!1),children:[De.jsx(dt,{children:Xe("taskForm.dialog.unsavedChanges.title")}),De.jsx(ct,{children:De.jsx(at,{children:Xe("taskForm.dialog.unsavedChanges.message")})}),De.jsxs(ut,{children:[De.jsx(Ke,{onClick:()=>tt(!1),color:"error",children:Xe("taskForm.dialog.unsavedChanges.discard")}),De.jsx(Ke,{onClick:()=>tt(!0),variant:"contained",children:Xe("taskForm.dialog.unsavedChanges.restore")})]})]}),De.jsxs(lt,{open:Ie,onClose:()=>Ze(!1),children:[De.jsx(dt,{children:Xe("taskForm.dialog.cancel.title")}),De.jsx(ct,{children:De.jsx(at,{children:Xe("taskForm.dialog.cancel.message")})}),De.jsxs(ut,{children:[De.jsx(Ke,{onClick:()=>it(!1),children:Xe("taskForm.dialog.cancel.keep")}),De.jsx(Ke,{onClick:()=>it(!0),variant:"contained",color:"error",children:Xe("taskForm.dialog.cancel.confirm")})]})]}),De.jsxs(lt,{open:!!Oe,onClose:()=>Fe(null),maxWidth:"sm",fullWidth:!0,children:[De.jsx(dt,{children:Xe("taskForm.dialog.image.title")}),De.jsxs(ct,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:[De.jsx(Ue,{component:"img",src:Oe||"",alt:"Preview",sx:{maxWidth:"100%",maxHeight:"300px",objectFit:"contain"}}),De.jsx(p,{message:Xe("taskForm.loading.image")})]})]}),De.jsxs(lt,{open:!!Pe,onClose:()=>Ne(null),maxWidth:"sm",fullWidth:!0,children:[De.jsx(dt,{children:Xe("taskForm.dialog.generatedImage.title")}),De.jsx(ct,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:De.jsx(Ue,{component:"img",src:(mt=Pe,mt?mt.startsWith("data:image")?mt:`data:image/jpeg;base64,${mt}`:""),alt:"Generated",sx:{maxWidth:"100%",maxHeight:"300px",objectFit:"contain"}})}),De.jsx(ut,{children:De.jsx(Ke,{onClick:()=>Ne(null),children:Xe("taskForm.dialog.image.close")})})]})]});var mt}},Symbol.toStringTag,{value:"Module"})),vn=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{var r;const{t:i}=s(),{user:o}=e(),l=Re(),[d]=ze(),u=d.get("return_to")||null,h=d.get("studentId"),x=d.get("work_id"),v="true"===d.get("edit"),_="true"===d.get("copy"),j="true"===d.get("template"),k=d.get("folder"),[b,w]=$e.useState([]),[C,S]=$e.useState(null),[T,I]=$e.useState([]),[Z,A]=$e.useState(null),[E,O]=$e.useState(""),[F,P]=$e.useState(!1),[N,z]=$e.useState(null),[$,D]=$e.useState(0),[M,L]=$e.useState([]),[W,B]=$e.useState(!0),[U,V]=$e.useState(!1),[K,q]=$e.useState(null),[H,G]=$e.useState({}),[J,Y]=$e.useState(v||j?1:0),[Q,X]=$e.useState(!1),ee=(null==o?void 0:o.role)===a.TEACHER||(null==o?void 0:o.role)===a.ADMIN,{showErrorToast:te,showToast:se}=t(),[ae,ne]=$e.useState(null),[re,ie]=$e.useState(!1),[oe,le]=$e.useState(0),[de,ce]=$e.useState(0),[ue,me]=$e.useState(null),[he,pe]=$e.useState([]);$e.useEffect((()=>{(async()=>{try{const e=await n.folders.getAll(0,100);if(pe(e),k){const t=e.find((e=>e.id===k));if(t)me(t);else{const e=await n.folders.getById(k);e&&me(e)}}}catch(e){te(y(e))}})()}),[k]);const[fe,xe]=$e.useState(!k);$e.useEffect((()=>{(async()=>{B(!0),q(null);try{const e=await n.contracts.getAll(0,100),t=e.filter((e=>e.status===be.AGREED||e.status===be.PENDING));L(t);const s=new Map;e.forEach((e=>{e.student&&!s.has(e.student_id)&&s.set(e.student_id,e.student)}));const a=Array.from(s.values()).sort(((e,t)=>{const s=`${e.first_name||""} ${e.last_name||""}`.trim().toLowerCase(),a=`${t.first_name||""} ${t.last_name||""}`.trim().toLowerCase();return s.localeCompare(a)}));if(ee&&o){const e={id:o.id,first_name:"Template",last_name:null,photo_url:null};a.unshift(e)}if(w(a),q(null),j&&ee&&o){const e=a.find((e=>e.id===o.id&&"Template"===e.first_name));if(e){S(e);const t=new Date,s=t.getDate().toString().padStart(2,"0"),a=(t.getMonth()+1).toString().padStart(2,"0"),n=t.getFullYear();O(`Template - ${`${s}.${a}.${n}`}`)}}else if(h){const e=a.find((e=>e.id===h));if(e){S(e);const t=new Date,s=t.getDate().toString().padStart(2,"0"),a=(t.getMonth()+1).toString().padStart(2,"0"),n=`${s}.${a}.${t.getFullYear()}`;O(`Work for ${e.first_name||e.last_name||e.id} - ${n}`)}}x&&(v||_)&&await ge(x)}catch(e){const t=y(e);q(t),te(t)}finally{B(!1)}})()}),[h,x,v,_,oe,j]);const ge=async e=>{try{const t=await n.works.getById(e);A(t),O(_?`Copy of ${t.name}`:t.name);const s=(await Promise.all(t.task_states.sort(((e,t)=>(e.order||0)-(t.order||0))).map((async e=>{if(!e.task)try{return await n.tasks.getById(e.task_id)}catch(t){return null}return e.task})))).filter((e=>null!==e));I(s)}catch(t){const e=t instanceof Error?t.message:"Failed to load work data. Please try again.";q(e),te(e)}};$e.useEffect((()=>{if(Z&&b.length>0&&v){const e=b.find((e=>e.id===Z.student_id));e?S(e):te("Student for this work could not be found. Please select a student manually.")}}),[Z,b,v]),$e.useEffect((()=>{if(C&&"Template"!==C.first_name){const e=M.find((e=>e.student_id===C.id&&e.teacher_id===(null==o?void 0:o.id)&&e.status===be.AGREED)),t=M.find((e=>e.student_id===C.id&&e.teacher_id===(null==o?void 0:o.id)&&e.status===be.PENDING)),s=e||t;z(s||null),s?(D(s.balance),s.balance>0?P(!0):P(!1)):(D(0),P(!1))}else z(null),D(0),P(!1)}),[C,M,null==o?void 0:o.id]);const ye=e=>{I((t=>t.some((t=>t.id===e.id))?t.filter((t=>t.id!==e.id)):[...t,e]))},ve=async(e=!0)=>{if(!C)return void q("Please select a student");const t={name:E,student_id:C.id,task_ids:T.map((e=>e.id)),contract_id:F&&N?N.id:void 0,folder_id:null==ue?void 0:ue.id},{isValid:s,errors:a}=un(dn,t);if(!s)return void G(a);V(!0),q(null);let r=null;try{if(v&&Z){r=(await n.works.update(Z.id,t)).id}else{r=(await n.works.create(t)).id}if(!e)return r;u?l(u):"Template"===(null==C?void 0:C.first_name)?l("/templates"):l("/works")}catch(i){const e=i instanceof Error?i.message:`Failed to ${v?"update":"create"} work. Please try again.`;q(e),te(e),V(!1)}},_e=e=>{ne(e),ie(!0)},je=()=>{ie(!1)},ke=$e.useCallback((()=>{le((e=>e+1))}),[]),Fe=()=>{X(!1)},[Pe,Ne]=$e.useState(!1),Me=()=>{Ne(!1)};return W?De.jsx(p,{message:i("common.loading")}):De.jsxs(Ue,{sx:{mx:"auto",pb:1,height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",width:"100%",".sortable-list":{position:"relative","& .item":{transition:"background-color 0.2s, box-shadow 0.2s, transform 0.1s","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"},userSelect:"none",cursor:"default"},"& .dragged-item":{backgroundColor:"primary.main!important",color:"white!important",boxShadow:"0 10px 20px rgba(0, 0, 0, 0.3)!important",opacity:.95,zIndex:1e3,transform:"scale(1.03)",borderRadius:"4px",pointerEvents:"none",cursor:"grabbing","& .MuiTypography-root":{color:"white!important"},"& svg":{color:"white!important"}}}},children:[De.jsx("style",{children:`\n          .dragged-item {\n            background-color: ${we.palette.primary.main} !important;\n          }\n        `}),K&&De.jsx(Ve,{severity:"error",sx:{mb:2},action:De.jsx(Ke,{color:"inherit",size:"small",onClick:ke,disabled:U,children:i(U?"common.status.loading":"common.actions.retry")}),children:K}),De.jsx(Ue,{sx:{p:0,mx:"auto",width:"100%",maxWidth:"800px",flexShrink:0},children:De.jsxs(wt,{value:J,onChange:(e,t)=>{C&&Y(t)},centered:!0,variant:"fullWidth",sx:{mx:2},children:[De.jsx(Ct,{label:i(v?"works.tabs.step1.edit":_?"works.tabs.step1.copy":"works.tabs.step1.create"),disabled:v}),De.jsx(Ct,{label:i("works.tabs.step2")})]})}),0===J&&De.jsx(Ue,{sx:{width:"100%",maxWidth:"800px",mx:"auto",flex:1,display:"flex",flexDirection:"column",overflow:"hidden",height:"100%"},children:De.jsxs(qe,{sx:{p:2,mb:1,display:"flex",flexDirection:"column",overflow:"hidden",height:"100%"},children:[0===b.length&&De.jsxs(Ue,{sx:{textAlign:"center",py:3},children:[De.jsx(at,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:i("contracts.empty.noContracts")}),De.jsx(at,{variant:"body2",color:"text.secondary",sx:{mb:2},children:i("contracts.empty.hint")}),De.jsx(Ke,{variant:"outlined",color:"primary",startIcon:De.jsx(c,{}),onClick:()=>l("/contracts/new"),children:i("contracts.actions.create")})]}),De.jsx(Ue,{sx:{mt:1,mb:2},children:De.jsx(Ge,{value:C,onChange:(e,t)=>(e=>{if(S(e),e){const t=new Date,s=`${t.getDate().toString().padStart(2,"0")}.${(t.getMonth()+1).toString().padStart(2,"0")}.${t.getFullYear()}`;"Template"===e.first_name?O(`Template Work - ${s}`):O(`Work for ${e.first_name||e.last_name||e.id} - ${s}`)}else O("")})(t),options:b,getOptionLabel:e=>`${e.first_name||""} ${e.last_name||""}`.trim(),renderInput:e=>{var t;return De.jsx(Ye,{...e,label:i("works.creator.forStudent"),placeholder:i("works.creator.selectStudent"),required:!0,error:!!H.student_id,helperText:H.student_id,InputProps:{...e.InputProps,startAdornment:De.jsxs(De.Fragment,{children:[C&&("Template"===C.first_name?De.jsx(Ce,{sx:{mr:1,color:"primary.main"}}):De.jsx(St,{src:C.photo_url||void 0,sx:{width:24,height:24,mr:1},children:((null==(t=C.first_name)?void 0:t[0])||"?").toUpperCase()})),e.InputProps.startAdornment]})}})},renderOption:(e,t)=>{var s;return De.jsx(Ue,{component:"li",...e,children:De.jsxs(Ue,{sx:{display:"flex",alignItems:"center"},children:["Template"===t.first_name?De.jsx(Ce,{sx:{mr:1,color:"primary.main"}}):De.jsx(St,{src:t.photo_url||void 0,sx:{width:24,height:24,mr:1},children:((null==(s=t.first_name)?void 0:s[0])||"?").toUpperCase()}),De.jsxs(at,{sx:{fontWeight:"Template"===t.first_name?500:400,color:"Template"===t.first_name?"primary.main":"inherit"},children:[t.first_name||t.id,t.last_name&&` ${t.last_name}`]})]})})}})}),De.jsx(Ue,{sx:{mt:1,mb:2},children:"Template"===(null==C?void 0:C.first_name)?De.jsx(at,{variant:"body1",color:"primary",sx:{mt:1},children:i("works.creator.templateHint")}):C&&De.jsx(at,{variant:"body1",color:"warning",sx:{mt:1},children:i("works.creator.studentHint")})}),"Template"===(null==C?void 0:C.first_name)&&he.length>0&&De.jsx(De.Fragment,{children:v?De.jsx(De.Fragment,{children:null==Z?void 0:Z.folders.map((e=>De.jsx(Ye,{fullWidth:!0,disabled:!0,label:i("templates.actions.currentFolder"),placeholder:i("templates.actions.currentFolder"),value:e.title,InputProps:{readOnly:!0,startAdornment:De.jsx(Qe,{position:"start",children:De.jsx(Se,{color:"primary"})})}})))}):De.jsx(De.Fragment,{children:ue&&!fe?De.jsx(Ye,{fullWidth:!0,label:i("templates.actions.folder"),placeholder:i("templates.actions.selectFolder"),value:ue.title,InputProps:{readOnly:!0,startAdornment:De.jsx(Qe,{position:"start",children:De.jsx(Se,{color:"primary"})}),endAdornment:De.jsx(Qe,{position:"end",children:De.jsx(Ke,{variant:"contained",color:"primary",onClick:()=>{me(null),xe(!0)},size:"small",children:i("common.actions.change")})})}}):fe&&De.jsxs(De.Fragment,{children:[De.jsxs(at,{variant:"body2",sx:{mb:2},children:[i("templates.actions.selectFolder")," (",i("common.optional"),"):"]}),De.jsx(Ue,{sx:{backgroundColor:"background.paper",flex:1,overflow:"auto",display:"flex",flexDirection:"column",borderRadius:3},children:De.jsx(Ue,{sx:{flex:1,overflow:"auto"},children:De.jsx(Te,{onFolderSelect:e=>{me(e),xe(!1)}})})})]})})})]})}),1===J&&De.jsxs(Ue,{sx:{width:"100%",maxWidth:"800px",mx:"auto",flex:1,display:"flex",flexDirection:"column",overflow:"hidden",height:"100%"},children:[De.jsxs(qe,{sx:{p:2,mb:2,flexShrink:0},children:[De.jsxs(Ue,{sx:{display:"flex",alignItems:"center",gap:1},children:[!v&&De.jsx(bt,{title:i("common.actions.edit"),children:De.jsx(Xe,{onClick:()=>Y(0),size:"small",children:De.jsx(R,{fontSize:"small"})})}),"Template"===(null==C?void 0:C.first_name)?De.jsx(at,{variant:"body1",color:"primary",children:i("works.creator.templateHint")}):De.jsxs(De.Fragment,{children:[De.jsx(St,{src:(null==C?void 0:C.photo_url)||void 0,sx:{width:32,height:32,mr:1},children:((null==(r=null==C?void 0:C.first_name)?void 0:r[0])||"?").toUpperCase()}),De.jsxs(at,{children:[(null==C?void 0:C.first_name)||(null==C?void 0:C.id),(null==C?void 0:C.last_name)&&` ${C.last_name}`]})]})]}),De.jsx(Ye,{fullWidth:!0,label:"Template"===(null==C?void 0:C.first_name)?i("templates.actions.templateName"):i("templates.actions.workName"),value:E,onChange:e=>O(e.target.value),margin:"normal",required:!0,error:!!H.name,helperText:H.name}),"Template"!==(null==C?void 0:C.first_name)&&!v&&De.jsx(qe,{elevation:0,variant:"outlined",sx:{p:2,mt:2,borderColor:F?"primary.main":"divider"},children:De.jsxs(Ue,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[De.jsx(st,{checked:F,onChange:e=>P(e.target.checked),color:"primary",disabled:!!N&&$<=0||!N}),De.jsxs(Ue,{sx:{flex:1},children:[De.jsx(at,{variant:"h6",color:"primary",gutterBottom:!0,children:i("works.creator.redeemLesson")}),N&&De.jsx(at,{variant:"body2",children:i("works.creator.availableLessons",{count:$})}),N&&$<=0&&De.jsx(at,{variant:"body2",color:"error",children:i("works.creator.noLessonsAvailable")}),!N&&De.jsx(at,{variant:"body2",color:"error",children:i("works.creator.noActiveContract")})]})]})})]}),De.jsxs(qe,{variant:"outlined",sx:{height:"100%",overflow:"auto",mb:1,display:"flex",flexDirection:"column"},children:[0===T.length&&De.jsx(Ue,{sx:{p:2,textAlign:"center"},children:De.jsx(at,{variant:"body2",color:"text.secondary",children:i("works.empty.noTasks")})}),De.jsxs(Ie,{onSortEnd:(e,t)=>{e<0||t<0||e>=T.length||t>=T.length||e===t||(I((s=>{const a=[...s],[n]=a.splice(e,1);return a.splice(t,0,n),a})),ce((e=>e+1)))},lockAxis:"y",className:"sortable-list",draggedItemClassName:"dragged-item",allowDrag:!0,as:"div",style:{overflowY:"auto",overflowX:"hidden",padding:0,minHeight:"100px",position:"relative"},children:[T.map(((e,t)=>De.jsx(Ze,{children:De.jsxs(Ue,{sx:{display:"flex",alignItems:"center",p:1,borderBottom:1,borderColor:"divider","&:last-child":{borderBottom:0},cursor:"pointer","&:hover":{backgroundColor:"action.hover"}},children:[De.jsxs(Ue,{sx:{display:"flex",alignItems:"center",flex:1},children:[De.jsx(Ae,{children:De.jsx(Ee,{sx:{mr:1,color:"primary.main",cursor:"grab"}})}),De.jsx(Ue,{sx:{flex:1},onClick:()=>_e(e),children:De.jsx(at,{variant:"body1",sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"},children:`${t+1}. ${e.title}`})})]}),De.jsx(Ue,{sx:{display:"flex",alignItems:"center"},children:De.jsx(bt,{title:i("common.actions.remove"),children:De.jsx(Xe,{edge:"end",onClick:t=>{t.stopPropagation(),ye(e)},size:"small",children:De.jsx(m,{})})})})]})},`task-${e.id}-pos-${t}`))),De.jsxs(Ue,{sx:{p:2,display:"flex",justifyContent:"center",gap:2},children:[C&&"Template"===(null==C?void 0:C.first_name)&&De.jsx(bt,{title:i("works.creator.autoSaveHint"),children:De.jsx(Ke,{variant:"outlined",color:"primary",onClick:()=>{ve(!1).then((e=>{e&&l(`/tasks/new?work_id=${e}&return_to=/works/assign/%3Fwork_id=${e}%26edit=true%26return_to=${u}`)}))},disabled:U||!C||!E.trim(),sx:{wordWrap:"nowrap"},children:i("tasks.actions.createTask")})}),De.jsx(Ke,{variant:"contained",color:"primary",onClick:()=>{Ne(!0)},children:i("works.creator.addExistingTask")})]}),!C||!E.trim()&&De.jsx(at,{variant:"body2",color:"error.main",sx:{p:2,textAlign:"center"},children:C?E.trim()?"":i("works.creator.enterWorkName"):i("works.creator.selectStudent")})]},`sortable-list-${de}`)]}),H.task_ids&&De.jsx(_t,{error:!0,children:H.task_ids})]}),De.jsxs(Ue,{sx:{mt:1,display:"flex",justifyContent:"space-between",mx:"auto",width:"100%",maxWidth:"800px",flexShrink:0},children:[De.jsx(Ke,{variant:"outlined",color:"inherit",onClick:()=>{J>=1?X(!0):u?l(u):"Template"===(null==C?void 0:C.first_name)?l("/templates"):l("/works")},sx:{mr:2},children:i("common.actions.cancel")}),De.jsxs(Ue,{sx:{display:"flex",gap:2},children:[J>0&&!v&&De.jsx(Ke,{variant:"outlined",onClick:()=>Y(0),children:i("common.actions.back")}),J<1?De.jsx(Ke,{variant:"contained",color:"primary",onClick:()=>Y(1),disabled:!C,children:i("common.actions.next")}):De.jsx(Ke,{variant:"contained",color:"primary",onClick:()=>ve(!0),disabled:U||!C||!E.trim(),sx:{wordWrap:"nowrap"},children:U?i("common.status.saving"):v?i("common.actions.save"):"Template"===(null==C?void 0:C.first_name)?i("templates.actions.createTemplate"):i("templates.actions.sendToStudent")})]})]}),De.jsx(g,{open:re,onClose:je,task:ae,hasQuizzes:!1,onValidateAnswers:()=>{},actionButtons:De.jsxs(Ue,{sx:{display:"flex",gap:1,width:"100%",justifyContent:"space-between"},children:[De.jsx(Ue,{sx:{display:"flex",gap:1},children:ae&&De.jsxs(De.Fragment,{children:[De.jsx(bt,{title:i("works.creator.autoSaveHint"),children:De.jsx(Ke,{size:"small",variant:"outlined",startIcon:De.jsx(f,{}),onClick:()=>{ve(!1).then((e=>{e&&(l(`/tasks/${ae.id}/edit?return_to=/works/assign/%3Fwork_id=${e}%26edit=true`),je())}))},children:i("common.actions.edit")})}),De.jsx(Ke,{size:"small",onClick:e=>{e.stopPropagation(),ye(ae),je()},startIcon:T.some((e=>e.id===ae.id))?De.jsx(m,{}):De.jsx(c,{}),children:T.some((e=>e.id===ae.id))?i("common.actions.remove"):i("common.actions.add")})]})}),De.jsx(Ke,{onClick:je,children:i("common.actions.close")})]})}),De.jsxs(lt,{open:Q,onClose:Fe,maxWidth:"xs",fullWidth:!0,children:[De.jsx(dt,{children:i("common.dialog.cancel.title")}),De.jsx(ct,{children:De.jsx(at,{children:i("common.dialog.cancel.message")})}),De.jsxs(ut,{children:[De.jsx(Ke,{onClick:Fe,children:i("common.actions.no")}),De.jsx(Ke,{onClick:()=>{X(!1),u?l(u):"Template"===(null==C?void 0:C.first_name)?l("/templates"):l("/works")},color:"error",children:i("common.actions.yes")})]})]}),De.jsxs(Tt,{anchor:"right",open:Pe,onClose:Me,sx:{"& .MuiDrawer-paper":{width:"100%",maxWidth:"800px",height:"100%",display:"flex",flexDirection:"column",borderRadius:0}},children:[De.jsxs(Ue,{sx:{px:2,py:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[De.jsx(at,{variant:"h6",children:i("works.creator.addTasks")}),De.jsx(Ke,{onClick:Me,size:"small",variant:"contained",color:"primary",children:i("common.actions.done")})]}),De.jsx(Ue,{sx:{flex:1,overflow:"auto",px:2},children:De.jsx(Oe,{selectedTasks:T,onTaskToggle:ye,onPreviewTask:_e})})]})]})}},Symbol.toStringTag,{value:"Module"})),_n=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const{t:r}=s(),{user:i}=e(),{showErrorToast:o}=t(),c=$e.useRef(null),[u,h]=$e.useState([]),[x,g]=$e.useState(!0),[v,_]=$e.useState(null),[j,k]=$e.useState(0),[b,w]=$e.useState(""),[C,S]=$e.useState(!1),[T,I]=$e.useState({}),[Z,A]=$e.useState(null),[E,O]=$e.useState(null),[F,P]=$e.useState(!1),[N,R]=$e.useState(""),[z,$]=$e.useState(!1),D=Re(),M=(null==i?void 0:i.role)===a.ADMIN,L=(null==i?void 0:i.role)===a.TEACHER||M;$e.useEffect((()=>{(async()=>{g(!0),_(null);try{const e=await n.tags.getAll();h(e),_(null)}catch(e){const t=y(e);_(t),o(t)}finally{g(!1)}})()}),[j]),$e.useCallback((()=>{k((e=>e+1))}),[]);const W=async()=>{var e;const{isValid:t,errors:s}=un(nn,{name:b});if(t){S(!0);try{const t=await n.tags.create({name:b.trim()});h((e=>[t,...e])),w(""),I({}),null==(e=c.current)||e.focus()}catch(a){const e=a instanceof Error?a.message:"Failed to create tag. Please try again.";o(e)}finally{S(!1)}}else I(s)},B=()=>{A(null)},U=()=>{P(!1),R("")},V=()=>{$(!1)};return De.jsxs(Ue,{children:[De.jsx(d,{title:r("navigation.tags")}),x?De.jsx(p,{message:r(x?"common.loading":"tags.loading.tags")}):De.jsxs(De.Fragment,{children:[De.jsx(qe,{sx:{p:3,mb:3,mx:"auto",maxWidth:"1200px"},children:De.jsxs(Ue,{sx:{display:"flex",gap:1,alignItems:"center"},children:[De.jsx(Ye,{inputRef:c,fullWidth:!0,autoComplete:"off",autoCapitalize:"off",size:"small",placeholder:r("tags.input.placeholder"),value:b,onChange:e=>{w(e.target.value),T.name&&I((e=>({...e,name:""})))},onKeyPress:e=>{"Enter"===e.key&&b.trim()&&W()},error:!!T.name,helperText:T.name,InputProps:{endAdornment:b?De.jsx(Qe,{position:"end",children:De.jsx(Xe,{size:"small",onClick:()=>{w(""),I({})},edge:"end",children:De.jsx(m,{})})}):null}}),b.trim()&&De.jsx(Ke,{size:"small",startIcon:De.jsx(Fe,{}),onClick:W,disabled:C,children:r(C?"common.status.saving":"common.actions.create")})]})}),v||0!==u.length?De.jsx(qe,{sx:{p:3,mx:"auto",maxWidth:"1200px"},children:De.jsx(Ue,{sx:{display:"flex",flexWrap:"wrap",gap:1,mt:1},children:u.map((e=>De.jsx(Ue,{children:De.jsx(Je,{onClick:t=>((e,t)=>{e.stopPropagation(),O(t),A(e.currentTarget)})(t,e),label:e.name,sx:{m:.5,height:"auto",borderRadius:"16px","& .MuiChip-label":{px:1.5,py:.5}},variant:"outlined"})},e.id)))})}):De.jsx(Ue,{sx:{textAlign:"center",py:4},children:De.jsx(at,{variant:"h6",color:"text.secondary",sx:{mb:1},children:r(L?"tags.empty.teacher":"tags.empty.default")})})]}),De.jsxs(ot,{anchorEl:Z,open:Boolean(Z),onClose:B,onClick:e=>e.stopPropagation(),children:[De.jsxs(Me,{onClick:()=>{B(),D(`/tasks?tag_id=${null==E?void 0:E.id}`)},children:[De.jsx(Le,{children:De.jsx(Pe,{fontSize:"small"})}),De.jsx(We,{children:r("tags.actions.showTasks")})]}),De.jsxs(Me,{onClick:()=>{E&&(R(E.name),P(!0)),B()},children:[De.jsx(Le,{children:De.jsx(f,{fontSize:"small"})}),De.jsx(We,{children:r("common.actions.rename")})]}),De.jsxs(Me,{onClick:()=>{B(),$(!0)},sx:{color:"error.main"},children:[De.jsx(Le,{sx:{color:"error.main"},children:De.jsx(l,{fontSize:"small"})}),De.jsx(We,{children:r("common.actions.delete")})]})]}),De.jsxs(lt,{open:F,onClose:U,maxWidth:"xs",fullWidth:!0,children:[De.jsx(dt,{children:r("tags.dialog.rename.title")}),De.jsx(ct,{children:De.jsx(Ye,{autoFocus:!0,margin:"dense",label:r("tags.input.label"),type:"text",fullWidth:!0,value:N,onChange:e=>R(e.target.value),variant:"outlined"})}),De.jsxs(ut,{children:[De.jsx(Ke,{onClick:U,children:r("common.actions.cancel")}),De.jsx(Ke,{onClick:async()=>{if(!E||!N.trim())return;const{isValid:e,errors:t}=un(nn,{name:N});if(e)try{const e=await n.tags.update(E.id,{name:N.trim()});h((t=>t.map((t=>t.id===E.id?e:t)))),P(!1),R(""),O(null)}catch(s){const e=s instanceof Error?s.message:"Failed to rename tag. Please try again.";o(e)}else o(t.name)},variant:"contained",disabled:!N.trim()||N===(null==E?void 0:E.name),children:r("common.actions.rename")})]})]}),De.jsxs(lt,{open:z,onClose:V,maxWidth:"xs",fullWidth:!0,children:[De.jsx(dt,{children:r("tags.dialog.delete.title")}),De.jsx(ct,{children:De.jsx(at,{children:r("tags.dialog.delete.message",{name:null==E?void 0:E.name})})}),De.jsxs(ut,{children:[De.jsx(Ke,{onClick:V,children:r("common.actions.cancel")}),De.jsx(Ke,{onClick:async()=>{E&&(await(async e=>{try{await n.tags.delete(e),h((t=>t.filter((t=>t.id!==e))))}catch(t){const e=t instanceof Error?t.message:"Failed to delete tag. Please try again.";o(e)}})(E.id),$(!1))},color:"error",variant:"contained",children:r("common.actions.delete")})]})]})]})}},Symbol.toStringTag,{value:"Module"})),jn=()=>{var r,i,o,l,d;const{t:c}=s(),u=Re(),{contractId:m}=ft(),[h]=ze(),f=h.get("return_to")||"/contracts",{user:x}=e(),{showErrorToast:g,showToast:y}=t(),[v,_]=$e.useState(!0),[j,k]=$e.useState(!1),[b,w]=$e.useState(null),[C,S]=$e.useState([]),[T,I]=$e.useState({username:"",price:"",currency:null,balance:null,description:""}),[Z,A]=$e.useState({}),[E,O]=$e.useState(null),[F,P]=$e.useState(!1),[N,R]=$e.useState(!1),z=(null==x?void 0:x.role)===a.ADMIN,$=(null==x?void 0:x.role)===a.TEACHER||z,D=Boolean(m);$e.useEffect((()=>{(async()=>{_(!0);try{const e=await n.contracts.getCurrencies();if(S(e),e.length>0&&!T.currency&&I((t=>({...t,currency:e[0].code}))),m){const t=await n.contracts.getById(m);w(t);let s=null;t.currency?s=t.currency:e.length>0&&(s=e[0].code),I({username:t.student_id,price:t.price,currency:s,balance:t.balance,description:t.description||""})}}catch(e){const t=e instanceof Error?e.message:"Failed to load data. Please try again.";g(t),u("/contracts")}finally{_(!1)}})()}),[m,u,g]);return $?De.jsxs(Ue,{sx:{display:"flex",flexDirection:"column",overflowX:"hidden",overflowY:"auto"},children:[v?De.jsx(p,{message:c(D?"contracts.status.loadingContract":"common.loading")}):De.jsx(De.Fragment,{children:De.jsxs(Ue,{sx:{flex:1,display:"flex",flexDirection:"column",mx:"auto",width:"100%",maxWidth:"800px",pb:1},children:[De.jsxs(qe,{sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",p:2,py:1},children:[De.jsx(Ue,{sx:{mt:2,mb:3},children:De.jsx(at,{variant:"h4",children:c(D?"contracts.actions.edit":"contracts.actions.create")})}),De.jsxs(Ue,{component:"form",noValidate:!0,children:[D?De.jsxs(Ue,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[De.jsx(St,{src:(null==(r=null==b?void 0:b.student)?void 0:r.photo_url)||void 0,sx:{width:48,height:48},children:((null==(o=null==(i=null==b?void 0:b.student)?void 0:i.first_name)?void 0:o[0])||"?").toUpperCase()}),De.jsxs(Ue,{children:[De.jsxs(at,{variant:"h6",children:[null==(l=null==b?void 0:b.student)?void 0:l.first_name," ",null==(d=null==b?void 0:b.student)?void 0:d.last_name]}),De.jsx(at,{variant:"body2",color:"text.secondary",children:c("common.student.one")})]})]}):De.jsx(Ye,{autoFocus:!0,margin:"normal",name:"username",label:c("contracts.form.studentUsername"),type:"text",fullWidth:!0,variant:"outlined",value:T.username,onChange:e=>{const t=e.target.value.replace("@","");I((e=>({...e,username:t}))),Z.username&&A((e=>{const t={...e};return delete t.username,t}))},error:!!Z.username,helperText:Z.username||c("contracts.form.telegramUsername"),placeholder:c("contracts.form.usernamePlaceholder"),InputProps:{startAdornment:De.jsx(at,{sx:{mr:.5},children:"@"})}}),De.jsxs(Ue,{sx:{display:"flex",gap:2,alignItems:"flex-start"},children:[De.jsx(Ye,{margin:"normal",name:"price",label:c("contracts.form.pricePerLesson"),type:"number",sx:{flex:1},variant:"outlined",value:0===T.price?"":T.price,onChange:e=>{const t=e.target.value,s=""===t?0:Number(t.replace(/^0+/,""));I((e=>({...e,price:s}))),Z.price&&A((e=>{const t={...e};return delete t.price,t}))},error:!!Z.price,helperText:Z.price}),De.jsxs(It,{margin:"normal",sx:{minWidth:120},error:!!Z.currency,children:[De.jsx(Zt,{id:"currency-label",children:c("contracts.form.currency")}),De.jsx(At,{labelId:"currency-label",name:"currency",value:T.currency||"",label:c("contracts.form.currency"),onChange:e=>{const{name:t,value:s}=e.target;I((e=>({...e,[t]:s}))),Z[t]&&A((e=>{const s={...e};return delete s[t],s}))},children:C.map((e=>De.jsxs(Me,{value:e.code,children:[e.emoji,"  ",e.code]},e.code)))})]})]}),D?De.jsxs(at,{variant:"body1",color:"text.secondary",sx:{mt:1},children:[c("contracts.form.currentBalance"),": ",T.balance]}):De.jsx(Ye,{margin:"normal",name:"balance",label:c("contracts.form.balanceLabel"),type:"number",fullWidth:!0,variant:"outlined",value:null===T.balance?"":T.balance,onChange:e=>{const t=e.target.value,s=""===t?null:Number(t.replace(/^0+/,""));I((e=>({...e,balance:s}))),Z.balance&&A((e=>{const t={...e};return delete t.balance,t}))},error:!!Z.balance,helperText:Z.balance||c("contracts.form.balanceHint")}),De.jsx(Ye,{margin:"normal",name:"description",label:c("contracts.form.description"),type:"text",fullWidth:!0,variant:"outlined",value:T.description,onChange:e=>{const{name:t,value:s}=e.target;I((e=>({...e,[t]:"price"===t||"balance"===t?Number(s):s}))),Z[t]&&A((e=>{const s={...e};return delete s[t],s}))},multiline:!0,rows:3,error:!!Z.description,helperText:Z.description||c("contracts.form.descriptionHint")})]})]}),De.jsxs(Ue,{sx:{mt:2,display:"flex",justifyContent:"space-between",flexShrink:0},children:[De.jsx(Ue,{sx:{display:"flex",alignItems:"center"},children:De.jsx(Ke,{variant:"outlined",color:"inherit",sx:{mr:2},onClick:()=>u(f),children:c("common.actions.cancel")})}),De.jsx(Ue,{children:De.jsx(Ke,{variant:"contained",color:"primary",onClick:async()=>{const{isValid:e,errors:t}=un(D?ln:on,T);if(e){k(!0);try{if(D&&m)await n.contracts.update(m,{price:T.price,currency:T.currency,balance:T.balance??0,description:T.description}),u(f);else{const e=await n.contracts.create({...T,balance:T.balance??0});"new_user_created"===e.create_code?(O(e.id),P(!0),y(c("contracts.status.contractCreated"),"success")):"already_exists"===e.create_code?(O(e.id),R(!0)):(O(null),P(!1),R(!1),u(f))}}catch(s){const e=s instanceof Error?s.message:c("contracts.status.errorCreating");if(e.includes("student_is_self"))return void g(c("contracts.status.studentIsSelf"));if(e.includes("student_is_teacher"))return void g(c("contracts.status.studentIsTeacher"));g(e)}finally{k(!1)}}else A(t)},disabled:j||!D&&!T.username.trim(),children:c(j?"common.status.saving":D?"contracts.actions.update":"contracts.actions.create")})})]})]})}),De.jsx(Ne,{open:F,onClose:()=>P(!1),onCancel:()=>u(f),botUrl:"https://t.me/teachair_bot",cancelButtonText:c("common.actions.done")}),De.jsxs(lt,{open:N,onClose:()=>R(!1),maxWidth:"xs",fullWidth:!0,children:[De.jsx(dt,{children:c("contracts.dialog.existingContract.title")}),De.jsx(ct,{children:De.jsx(at,{children:c("contracts.dialog.existingContract.message")})}),De.jsxs(ut,{children:[De.jsx(Ke,{onClick:()=>R(!1),children:c("common.actions.cancel")}),De.jsx(Ke,{onClick:()=>{R(!1),E&&u(`/contracts/${E}/edit`)},color:"primary",variant:"contained",children:c("contracts.actions.editExisting")})]})]})]}):(u("/contracts"),null)},kn=Object.freeze(Object.defineProperty({__proto__:null,ContractFormPage:jn,default:jn},Symbol.toStringTag,{value:"Module"}));export{xn as A,kn as C,fn as P,hn as T,yn as a,vn as b,_n as c,cn as f,un as v,an as z};
