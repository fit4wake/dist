import{a7 as e,a8 as t,r as s,j as n,d as a,e as i,L as r,B as o,v as l,o as c,y as d,x,a1 as m,w as u,h,I as p,i as g,ai as f,aj as j,C as y,b as k,a2 as b,a3 as v,a5 as w,N as C,M as S,D as I,l as _,m as F,n as z,X as $,Y as T,U as D,E as P,Q as A,G as E,af as W,K as R,O as B,f as M,ae as O,ak as L,z as N,al as q,am as H,A as V,F as U,W as J,H as Q,an as K,J as G}from"./vendor-VHbKv6Ho.js";import{u as Y,a as X,b as Z,U as ee,c as te,S as se,C as ne,D as ae,P as ie,A as re,T as oe,d as le,e as ce,F as de,L as xe,E as me,M as ue,f as he,g as pe,h as ge,i as fe,j as je,k as ye,I as ke,l as be,R as ve,m as we,n as Ce,o as Se,p as Ie,q as _e,B as Fe,W as ze,r as $e,s as Te,t as De,v as Pe,O as Ae,w as Ee,x as We,y as Re,z as Be,G as Me,H as Oe,J as Le,K as Ne,N as qe,Q as He,V as Ve,X as Ue,Y as Je,Z as Qe,_ as Ke,$ as Ge,a0 as Ye,a1 as Xe,a2 as Ze,a3 as et,a4 as tt,a5 as st,a6 as nt,a7 as at,a8 as it,a9 as rt,aa as ot,ab as lt,ac as ct,ad as dt,ae as xt,af as mt,ag as ut,ah as ht,ai as pt,aj as gt,ak as ft,al as jt,am as yt,an as kt,ao as bt,ap as vt,aq as wt,ar as Ct,as as St,at as It,au as _t,av as Ft,aw as zt,ax as $t,ay as Tt,az as Dt,aA as Pt,aB as At,aC as Et,aD as Wt,aE as Rt,aF as Bt,aG as Mt,aH as Ot,aI as Lt,aJ as Nt,aK as qt,aL as Ht,aM as Vt,aN as Ut,aO as Jt,aP as Qt,aQ as Kt,aR as Gt}from"./main-d-KpagPl.js";const Yt="tasksPageFilters",Xt=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const $=e(),[T]=t(),{user:D}=Y(),{showErrorToast:P}=X(),[A,E]=s.useState([]),[W,R]=s.useState([]),[B,M]=s.useState(!0),[O,L]=s.useState(!1),[N,q]=s.useState(null),[H,V]=s.useState(0),[U,J]=s.useState([]),[Q,K]=s.useState(""),[G,ge]=s.useState(""),[fe,je]=s.useState(null),[ye,ke]=s.useState(!1),[be,ve]=s.useState(null),[we,Ce]=s.useState(null),[Se,Ie]=s.useState(!1),[_e,Fe]=s.useState(new Set),[ze,$e]=s.useState(!1),[Te,De]=s.useState(!1),Pe=s.useRef(!0),Ae=Boolean(be),[Ee,We]=s.useState(0),[Re,Be]=s.useState(!0),Me=30,Oe=s.useRef(null),{t:Le}=Z(),Ne=(null==D?void 0:D.role)===ee.ADMIN,qe=(null==D?void 0:D.role)===ee.TEACHER||Ne,He=s.useCallback((()=>{try{const e=localStorage.getItem(Yt);if(e){return JSON.parse(e)}}catch(e){}return{searchTerm:"",filterTagIds:[]}}),[]),Ve=s.useCallback((()=>{const e={searchTerm:Q,filterTagIds:U.map((e=>e.id))};localStorage.setItem(Yt,JSON.stringify(e))}),[Q,U]);s.useEffect((()=>{const e=setTimeout((()=>{K(G)}),500);return()=>clearTimeout(e)}),[G]),s.useEffect((()=>{Pe.current||Ve()}),[Q,U,Ve]),s.useEffect((()=>{(async()=>{if(Pe.current){M(!0),q(null);try{const e=He(),t=T.get("tag_id"),s=await te.tags.getAll();R(s);let n=[];if(t){const e=s.find((e=>e.id===t));e&&(J([e]),n=[t])}else if(e.filterTagIds.length>0){const t=e.filterTagIds.map((e=>s.find((t=>t.id===e)))).filter((e=>void 0!==e));t.length>0&&(J(t),n=e.filterTagIds)}e.searchTerm&&(K(e.searchTerm),ge(e.searchTerm));const a=e.searchTerm||"",i=await te.tasks.getAll(0,Me,a,n.join(","));E(i),We(0),Be(i.length===Me),Pe.current=!1,q(null)}catch(e){const t=pe(e);q(t),P(t)}finally{M(!1)}}})()}),[H,T,He]),s.useEffect((()=>{if(Pe.current)return;(async()=>{M(!0),q(null);try{const e=await te.tasks.getAll(0,Me,Q,U.map((e=>e.id)).join(","));E(e),We(0),Be(e.length===Me)}catch(e){q("Failed to search tasks. Please try again.")}finally{M(!1)}})()}),[Q,U]),s.useEffect((()=>{const e=new IntersectionObserver((e=>{const[t]=e;t.isIntersecting&&Re&&!B&&!O&&Ue()}),{threshold:.5}),t=Oe.current;return t&&e.observe(t),()=>{t&&e.unobserve(t)}}),[Re,B,O]);const Ue=async()=>{if(!Re||O)return;L(!0);const e=Ee+1;try{const t=await te.tasks.getAll(e*Me,Me,Q,U.map((e=>e.id)).join(","));if(t.length>0){const s=t.filter((e=>!A.some((t=>t.id===e.id))));E((e=>[...e,...s])),We(e),Be(t.length===Me)}else Be(!1)}catch(t){P("Failed to load more tasks. Please try again.")}finally{L(!1)}},Je=s.useCallback((()=>{V((e=>e+1))}),[]),Qe=()=>{localStorage.removeItem(Yt),K(""),ge(""),J([])},Ke=()=>{ke(!1)},Ge=(e,t)=>{e.stopPropagation(),ve(e.currentTarget),Ce(t)},Ye=()=>{ve(null)},Xe=()=>{Ie(!1),Ce(null)},Ze=e=>{Fe((t=>{const s=new Set(t);return s.has(e.id)?s.delete(e.id):s.add(e.id),s})),$e(!0),ke(!1)},et=()=>{De(!1)},tt=[n.jsxs(a,{onClick:e=>{e.stopPropagation(),Ze(we),Ye()},children:[n.jsx(i,{children:n.jsx(se,{fontSize:"small"})}),n.jsx(r,{children:Le("common.actions.select")})]},"select"),n.jsxs(a,{onClick:()=>{we&&($(`/tasks/new?copy_task_id=${we.id}`),Ye())},children:[n.jsx(i,{children:n.jsx(ne,{fontSize:"small"})}),n.jsx(r,{children:Le("common.actions.copy")})]},"copy"),n.jsxs(a,{onClick:()=>{Ye(),Ie(!0)},sx:{color:"error.main"},children:[n.jsx(i,{children:n.jsx(ae,{fontSize:"small",color:"error"})}),n.jsx(r,{children:Le("common.actions.delete")})]},"delete")];return n.jsxs(o,{children:[n.jsx(ie,{title:Le("tasks.title"),actionButton:qe?[{label:Le("tasks.actions.createTask"),icon:n.jsx(re,{}),onClick:()=>$("/tasks/new")}]:void 0}),N&&n.jsx(l,{severity:"error",sx:{mb:2},action:n.jsx(c,{color:"inherit",size:"small",onClick:Je,disabled:B,children:B?"Loading...":"Retry"}),children:N}),n.jsx(d,{sx:{p:2,mb:2},children:n.jsxs(x,{spacing:2,children:[n.jsxs(o,{sx:{display:"flex",flexDirection:"column",gap:2},children:[n.jsx(m,{multiple:!0,size:"small",options:W,getOptionLabel:e=>e.name,value:U,onChange:(e,t)=>J(t),renderInput:e=>n.jsx(h,{...e,label:Le("tasks.actions.filterByTags"),placeholder:Le("filters.selectTags"),variant:"outlined",InputProps:{...e.InputProps,startAdornment:n.jsxs(n.Fragment,{children:[n.jsx(oe,{sx:{ml:1,color:"text.secondary"},fontSize:"small"}),e.InputProps.startAdornment]})}}),renderTags:(e,t)=>e.map(((e,n)=>s.createElement(u,{color:"primary",label:e.name,...t({index:n}),key:e.id})))}),n.jsx(o,{sx:{display:"flex",gap:2},children:n.jsx(h,{label:Le("tasks.actions.searchByTitle"),placeholder:Le("filters.enterTitle"),variant:"outlined",fullWidth:!0,size:"small",value:G,onChange:e=>{const t=e.target.value;ge(t)},InputProps:{startAdornment:n.jsx(ce,{sx:{mr:1,color:"text.secondary"},fontSize:"small"}),endAdornment:G?n.jsx(p,{position:"end",children:n.jsx(g,{"aria-label":"clear search",onClick:()=>{ge(""),K("")},edge:"end",size:"small",children:n.jsx(le,{fontSize:"small"})})}):null}})})]}),(U.length>0||G)&&n.jsx(o,{sx:{display:"flex",justifyContent:"center"},children:n.jsx(c,{variant:"outlined",startIcon:n.jsx(de,{}),onClick:Qe,children:Le("common.actions.clear")})})]})}),ze&&n.jsx(f,{position:"static",color:"default",elevation:1,sx:{mb:2},children:n.jsxs(j,{variant:"dense",children:[n.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1,flex:1},children:[n.jsx(y,{edge:"start",checked:_e.size===A.length,indeterminate:_e.size>0&&_e.size<A.length,onChange:()=>{_e.size===A.length?Fe(new Set):Fe(new Set(A.map((e=>e.id))))}}),n.jsx(k,{variant:"body2",children:Le("tasks.selection.selected",{count:_e.size})})]}),n.jsxs(o,{sx:{display:"flex"},children:[qe&&n.jsx(c,{color:"error",startIcon:n.jsx(ae,{}),onClick:()=>{De(!0)},disabled:0===_e.size,children:Le("tasks.selection.deleteCount",{count:_e.size||0})}),n.jsx(c,{onClick:()=>{Fe(new Set),$e(!1)},children:Le("common.actions.cancel")})]})]})}),B?n.jsx(xe,{message:Le("common.loading")}):n.jsxs(n.Fragment,{children:[N||0!==A.length?n.jsxs(n.Fragment,{children:[n.jsx(o,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)",lg:"repeat(3, 1fr)"},gap:2},children:A.map((e=>n.jsxs(b,{sx:{height:"100%",cursor:"pointer",position:"relative","&:hover":{boxShadow:6}},onClick:()=>!ze&&(e=>{je(e),ke(!0)})(e),children:[ze&&n.jsx(y,{edge:"start",checked:_e.has(e.id),onChange:t=>{t.stopPropagation(),Ze(e)},sx:{position:"absolute",top:8,right:8,zIndex:1}}),n.jsx(v,{sx:{p:2,"&:last-child":{paddingBottom:2}},children:n.jsxs(o,{sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:1},children:[n.jsx(k,{sx:{flex:1,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:1.2},children:e.title}),n.jsx(o,{sx:{display:"flex",flexDirection:"row",gap:1,flexShrink:0},children:!ze&&n.jsxs(n.Fragment,{children:[n.jsx(g,{size:"small",onClick:t=>{t.stopPropagation(),$(`/tasks/${e.id}/edit`)},children:n.jsx(me,{})}),n.jsx(g,{size:"small",onClick:t=>Ge(t,e),children:n.jsx(ue,{})})]})})]})}),e.tags.length>0&&n.jsx(w,{sx:{pt:0,px:2,pb:2},children:n.jsx(o,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.tags.map((e=>n.jsx(u,{label:e.name,size:"small",variant:"outlined",onClick:t=>{t.stopPropagation(),U.some((t=>t.id===e.id))||J([...U,e])},sx:{cursor:"pointer","&:hover":{backgroundColor:"action.hover"}}},e.id)))})})]},e.id)))}),n.jsx(o,{ref:Oe,sx:{display:"flex",justifyContent:"center",p:2,visibility:Re?"visible":"hidden"},children:O&&n.jsx(C,{size:24})})]}):n.jsxs(o,{sx:{textAlign:"center",py:4},children:[n.jsx(k,{variant:"h6",color:"text.secondary",sx:{mb:1},children:Q.length<1&&U.length<1?Le(qe?"tasks.empty.teacher":"tasks.empty.student"):Le("tasks.empty.noMatch")}),qe&&Q.length<1&&U.length<1&&n.jsx(c,{variant:"outlined",startIcon:n.jsx(re,{}),onClick:()=>$("/tasks/new"),sx:{mt:2},children:Le("tasks.actions.createFirst")}),(Q.length>0||U.length>0)&&n.jsx(c,{variant:"outlined",startIcon:n.jsx(de,{}),onClick:Qe,sx:{borderRadius:2,textTransform:"none"},children:Le("common.actions.clear")})]}),n.jsx(he,{open:ye,onClose:Ke,task:fe,hasQuizzes:!1,onValidateAnswers:()=>{},actionButtons:n.jsxs(o,{sx:{display:"flex",gap:1,width:"100%",justifyContent:"space-between"},children:[n.jsx(o,{sx:{display:"flex",gap:1},children:fe&&n.jsxs(n.Fragment,{children:[n.jsx(c,{size:"small",onClick:e=>Ge(e,fe),startIcon:n.jsx(ue,{}),children:Le("common.actions.actions")}),n.jsx(c,{size:"small",onClick:e=>{e.stopPropagation(),$(`/tasks/${fe.id}/edit`)},startIcon:n.jsx(me,{}),children:Le("common.actions.edit")})]})}),n.jsx(c,{onClick:Ke,children:Le("common.actions.close")})]})}),n.jsx(S,{anchorEl:be,open:Ae,onClose:Ye,onClick:e=>e.stopPropagation(),children:tt}),n.jsxs(I,{open:Se,onClose:Xe,maxWidth:"xs",fullWidth:!0,children:[n.jsx(_,{children:Le("common.dialog.delete.title",{item:"Task"})}),n.jsx(F,{children:n.jsx(k,{children:Le("common.dialog.delete.message",{name:null==we?void 0:we.title})})}),n.jsxs(z,{children:[n.jsx(c,{onClick:Xe,children:Le("common.actions.cancel")}),n.jsx(c,{onClick:async()=>{if(we)try{await te.tasks.delete(we.id),E(A.filter((e=>e.id!==we.id)))}catch(e){const t=e instanceof Error?e.message:"Failed to delete task. Please try again.";P(t)}finally{Ie(!1),Ce(null)}},color:"error",variant:"contained",startIcon:n.jsx(ae,{}),children:Le("common.actions.delete")})]})]}),n.jsxs(I,{open:Te,onClose:et,maxWidth:"xs",fullWidth:!0,children:[n.jsx(_,{children:Le("common.dialog.delete.title",{item:"Tasks"})}),n.jsx(F,{children:n.jsx(k,{children:Le("common.dialog.delete.messageBulk",{count:_e.size,item:1===_e.size?"task":"tasks"})})}),n.jsxs(z,{children:[n.jsx(c,{onClick:et,children:Le("common.actions.cancel")}),n.jsxs(c,{onClick:async()=>{try{await te.tasks.batchDelete(Array.from(_e));E(A.filter((e=>!_e.has(e.id)))),Fe(new Set),$e(!1)}catch(e){const t=e instanceof Error?e.message:"Failed to delete tasks. Please try again.";P(t)}finally{De(!1)}},color:"error",variant:"contained",startIcon:n.jsx(ae,{}),children:[Le("common.actions.delete")," ",_e.size," ",1===_e.size?"task":"tasks"]})]})]})]})]})}},Symbol.toStringTag,{value:"Module"})),Zt=({aiChatMessage:e,setAIChatMessage:t,isSendingAIMessage:i,aiChatHistory:l,isProcessingAttachment:x,setIsProcessingAttachment:m,aiChatMode:u,setAIChatMode:p,handleSendAIMessage:f,handleImprove:j,handleRestoreHistoryItem:y,handleRecognizedText:b})=>{const{t:v}=Z(),{showErrorToast:w}=X(),[I,_]=s.useState(null),[F,z]=s.useState(null),[D,P]=s.useState(!0);s.useEffect((()=>{const e=localStorage.getItem("aiChatHelpVisible");null!==e&&P(JSON.parse(e))}),[]);const A=()=>{_(null),z(null)};return n.jsxs(o,{sx:{display:"flex",flexDirection:"column",overflow:"hidden",borderRadius:2,p:1,...(i||x)&&{position:"relative","&::before":{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(45deg, transparent 30%, rgba(25, 118, 210, 0.08) 50%, transparent 70%)",backgroundSize:"400% 400%",borderRadius:"inherit",zIndex:1,pointerEvents:"none",animation:"shimmer 2s ease-in-out infinite"},"&::after":{content:'""',position:"absolute",top:-2,left:-2,right:-2,bottom:-2,background:"linear-gradient(45deg, rgba(25, 118, 210, 0.3), rgba(25, 118, 210, 0.1), rgba(25, 118, 210, 0.3))",backgroundSize:"400% 400%",borderRadius:"inherit",zIndex:-1,animation:"shimmer 3s ease-in-out infinite reverse"},animation:"pulse 2s ease-in-out infinite","& > *":{position:"relative",zIndex:2}},"@keyframes shimmer":{"0%":{backgroundPosition:"100% 0%"},"100%":{backgroundPosition:"-100% 0%"}},"@keyframes pulse":{"0%, 100%":{opacity:1,transform:"scale(1)"},"50%":{opacity:.95,transform:"scale(1.005)"}}},children:[n.jsxs(o,{sx:{flex:1,overflow:"auto"},children:[D&&n.jsxs(d,{sx:{p:2,backgroundColor:"background.default",position:"relative",borderColor:"divider",borderWidth:1,borderStyle:"solid",mb:2},children:[n.jsx(g,{onClick:()=>{const e=!D;P(e),localStorage.setItem("aiChatHelpVisible",JSON.stringify(e))},sx:{position:"absolute",top:8,right:8,zIndex:1},size:"small",children:n.jsx(ge,{})}),n.jsxs(k,{variant:"body2",sx:{pr:3},children:["✍️  ",v("taskForm.ai.placeholder")]})]}),l.length>0&&n.jsxs(o,{sx:{mb:2},children:[n.jsxs(k,{variant:"subtitle2",sx:{mb:1},children:[v("taskForm.ai.history"),":"]}),n.jsx($,{dense:!0,sx:{bgcolor:"background.paper",borderRadius:1,border:"1px solid",borderColor:"divider"},children:l.slice().reverse().map((e=>n.jsxs(T,{onClick:t=>((e,t)=>{_(e.currentTarget),z(t)})(t,e),sx:{cursor:"pointer","&:hover":{bgcolor:"action.hover"}},secondaryAction:n.jsx(n.Fragment,{children:n.jsx(g,{size:"small",sx:{ml:1},children:n.jsx(ue,{fontSize:"small"})})}),children:[n.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:"50px",height:"50px",mr:1,overflow:"hidden"},children:["processing"===e.status&&n.jsx(C,{size:16}),"done"===e.status&&!e.image&&n.jsx(fe,{fontSize:"small",color:"success"}),"done"===e.status&&e.image&&n.jsx("img",{src:e.image,style:{width:"100%"}}),"error"===e.status&&n.jsx(je,{fontSize:"small",color:"error"})]}),n.jsx(r,{sx:{textAlign:"left",width:"100%"},primary:e.message||v("taskForm.ai.imageRecognizedText"),secondary:e.timestamp.toLocaleTimeString(v("locale"),{timeStyle:"short"})})]},e.id)))})]}),!1,n.jsx(h,{fullWidth:!0,multiline:!0,minRows:3,maxRows:20,variant:"outlined",placeholder:v("taskForm.ai.messageInputPlaceholder"),value:e,onChange:e=>t(e.target.value),disabled:i,onKeyDown:t=>{"Enter"!==t.key||t.shiftKey||(t.preventDefault(),e.trim()&&!i&&f())},onPaste:async e=>{const t=e.clipboardData.items;for(const n of t)if(n.type.startsWith("image/")){e.preventDefault();const t=n.getAsFile();if(t){m(!0);try{const e=await new Promise((e=>{const s=new FileReader;s.onloadend=()=>e(s.result),s.readAsDataURL(t)})),s=await te.files.recognizeText({imageBase64:e,mode:"text"});s&&await b(s,e)}catch(s){w(v("taskForm.ai.errors.imageProcessing"))}finally{m(!1)}}}else if("text/plain"===n.type){const t=await new Promise((e=>n.getAsString(e)));if(t.match(/^https?:\/\/.+\.(jpg|jpeg|png|gif|webp)$/i)){e.preventDefault(),m(!0);try{const e=await fetch(t),s=await e.blob(),n=await new Promise((e=>{const t=new FileReader;t.onloadend=()=>e(t.result),t.readAsDataURL(s)})),a=await te.files.recognizeText({imageBase64:n,mode:"text"});a&&await b(a,n)}catch(s){w(v("taskForm.ai.errors.imageURLProcessing"))}finally{m(!1)}}}},sx:{mb:2},inputProps:{maxLength:1e3}}),n.jsx(o,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:n.jsx(g,{title:v("taskForm.ai.send"),onClick:()=>f(),disabled:i||!e.trim(),sx:{backgroundColor:"primary.main",color:"white","&:hover":{backgroundColor:"primary.dark",color:"white"}},children:n.jsx(ye,{})})}),n.jsxs(o,{sx:{display:"flex",flexDirection:"column",gap:1,justifyContent:"flex-end"},children:[n.jsx(c,{onClick:()=>{var e;return null==(e=document.getElementById("image-input"))?void 0:e.click()},disabled:x,startIcon:n.jsx(ke,{}),children:v("taskForm.ai.recognize")}),n.jsx(c,{onClick:j,disabled:i,startIcon:n.jsx(be,{}),children:v("taskForm.ai.improve")})]}),n.jsx("input",{type:"file",accept:"image/*",style:{display:"none"},id:"image-input",onChange:async e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s){m(!0);try{const e=await new Promise((e=>{const t=new FileReader;t.onloadend=()=>e(t.result),t.readAsDataURL(s)})),t=await te.files.recognizeText({imageBase64:e,mode:"text"});t?await b(t,e):w(v("taskForm.ai.errors.noTextRecognized"))}catch(n){w(v("taskForm.ai.errors.imageProcessing"))}finally{m(!1)}}}})]}),n.jsx(S,{anchorEl:I,open:Boolean(I),onClose:A,children:n.jsxs(a,{onClick:()=>{F&&(y(F),A())},children:[n.jsx(ve,{fontSize:"small",sx:{mr:1}}),v("taskForm.ai.rollback")]})})]})},es=({title:e,text:t,url:s,tagIds:a,tags:i,teacherId:r,onFullscreen:l,onValidateAnswers:d,hasQuizzes:x})=>{const{t:m}=Z();return n.jsxs(o,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[n.jsxs(o,{sx:{display:"flex",gap:1,alignItems:"center"},children:[n.jsx(k,{variant:"h4",sx:{flex:1},children:e||m("common.actions.preview")}),n.jsx(g,{sx:{marginLeft:"auto",display:{xs:"none",sm:"block"}},size:"small",onClick:l,children:n.jsx(we,{})})]}),n.jsx(Ce,{task:{id:"preview",title:e,text:t,url:s||"",tags:i.filter((e=>a.includes(e.id))),teacher_id:r},isSaveAnswer:!1,workId:"preview",isTeacher:!1}),x&&n.jsx(o,{sx:{p:2,borderTop:1,borderColor:"divider",display:"flex",justifyContent:"center",mt:"auto",flex:"flex-end"},children:n.jsx(c,{variant:"contained",color:"primary",onClick:d,startIcon:n.jsx(fe,{}),children:m("common.actions.checkAnswers")})})]})},ts=()=>{const{t:e}=Z(),t=Se(Ie),a=Se(_e),[i,r]=s.useState(null),[l,d]=s.useState(null),[x,m]=s.useState(!1),[u,p]=s.useState([{question:"",answer:""}]),[f,j]=s.useState("multiple"),y=()=>{r(null)},k=()=>{m(!1),p([{question:"",answer:""}])},b=()=>{p([...u,{question:"",answer:""}])},v=Boolean(i),w=(e,t)=>{const s=!!l&&((null==l?void 0:l.row)>=e&&(null==l?void 0:l.col)>=t);return{minWidth:"40px",height:"40px",backgroundColor:s?"primary.main":"transparent",color:s?"primary.contrastText":"primary.main","&:hover":{backgroundColor:"primary.main"},transition:"all 0.5s ease"}};return n.jsxs(n.Fragment,{children:[n.jsx(Fe,{title:e("taskForm.table.title"),children:n.jsx("span",{onClick:e=>{r(e.currentTarget)},children:n.jsx(ze,{fontSize:"small"})})}),n.jsx(D,{open:v,anchorEl:i,onClose:y,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:n.jsxs(o,{sx:{p:2},children:[n.jsx(o,{sx:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:1,width:140},children:Array.from({length:3},((e,t)=>t+1)).map((e=>Array.from({length:3},((e,t)=>t+1)).map((s=>n.jsxs(c,{variant:"outlined",size:"small",onClick:()=>(t({rows:e,columns:s}),void y()),onMouseEnter:()=>d({row:e,col:s}),onMouseLeave:()=>d(null),sx:w(e,s),children:[e,"x",s]},`${e}-${s}`)))))}),n.jsx(c,{variant:"contained",size:"small",fullWidth:!0,onClick:()=>(m(!0),y(),void setTimeout((()=>{const e=document.querySelector('[data-question-field="0"]');e&&e.focus()}),100)),sx:{mt:2},children:e("taskForm.table.answersTable")})]})}),n.jsxs(I,{open:x,onClose:k,maxWidth:"md",fullWidth:!0,children:[n.jsx(_,{children:e("taskForm.table.answersDialog.title")}),n.jsxs(F,{children:[u.map(((t,s)=>n.jsxs(o,{sx:{mb:2,display:"flex",alignItems:"center",gap:2},children:[n.jsx(h,{label:e("components.defaults.question")+" "+(s+1),placeholder:e("taskForm.table.answersDialog.questionPlaceholder"),value:t.question,onChange:e=>((e,t)=>{const s=[...u];s[e].question=t,p(s)})(s,e.target.value),onKeyDown:e=>((e,t)=>{if("Enter"===t.key){t.preventDefault();const s=document.querySelector(`[data-answer-field="${e}"]`);s&&s.focus()}})(s,e),inputProps:{"data-question-field":s},sx:{flex:1},size:"small"}),n.jsx(h,{label:e("components.defaults.answer")+" "+(s+1),placeholder:e("taskForm.table.answersDialog.answerPlaceholder"),value:t.answer,onChange:e=>((e,t)=>{const s=[...u];s[e].answer=t,p(s)})(s,e.target.value),onKeyDown:e=>((e,t)=>{if("Enter"===t.key)if(t.preventDefault(),e===u.length-1)b(),setTimeout((()=>{const t=document.querySelector(`[data-question-field="${e+1}"]`);t&&t.focus()}),100);else if(e<u.length-1){const t=document.querySelector(`[data-question-field="${e+1}"]`);t&&t.focus()}})(s,e),inputProps:{"data-answer-field":s},sx:{flex:1},size:"small"}),u.length>1&&n.jsx(g,{size:"small",onClick:()=>(e=>{if(u.length>1){const t=u.filter(((t,s)=>s!==e));p(t)}})(s),sx:{color:"text.secondary"},children:n.jsx(ae,{})})]},s))),n.jsxs(o,{sx:{display:"flex",flexDirection:"row",justifyContent:"space-between",gap:2,mt:2,width:"100%"},children:[n.jsxs(P,{value:f,exclusive:!0,onChange:(e,t)=>{null!==t&&j(t)},size:"small",children:[n.jsx(A,{title:e("taskForm.table.answersDialog.multipleChoice"),children:n.jsx(E,{value:"multiple",children:n.jsx($e,{fontSize:"small"})})}),n.jsx(A,{title:e("taskForm.table.answersDialog.input"),children:n.jsx(E,{value:"input",children:n.jsx(Te,{fontSize:"small"})})}),n.jsx(A,{title:e("taskForm.table.answersDialog.palette"),children:n.jsx(E,{value:"palette",children:n.jsx(De,{fontSize:"small"})})})]}),n.jsx(c,{startIcon:n.jsx(re,{}),onClick:b,variant:"text",children:e("taskForm.table.answersDialog.addQuestion")})]})]}),n.jsxs(z,{children:[n.jsx(c,{onClick:k,children:e("common.actions.cancel")}),n.jsx(c,{onClick:()=>{const t=e("components.defaults.question"),s=e("components.defaults.answer"),n=[...u].sort(((e,t)=>e.answer.localeCompare(t.answer))).map((e=>e.answer)).join(";");let i="palette"===f?`\n&nbsp;\n ::answers{sticky="true" alt="${n}" ordered="true"} `:"";i+=`\n&nbsp;\n|  ${t}  |  ${s}  |\n`,i+="| :------: | :------: |\n",u.forEach(((e,t)=>{const s=e.question,a=e.answer;s&&s.length>0&&a&&a.length>0&&(i+="multiple"===f?`| ${s} |  :select[${a}]{alt="${n}" ordered="true"}  |\n`:`| ${s} |  :hidden[${a}]  |\n`)})),i+="\n&nbsp;\n",a(i),k()},variant:"contained",disabled:u.every((e=>!e.question.trim()||!e.answer.trim())),children:e("taskForm.table.answersDialog.createTable")})]})]})]})},ss=({onChange:e})=>{const{t:t}=Z(),[a,l]=s.useState(!0);s.useEffect((()=>{const e=localStorage.getItem("componentsHelpVisible");null!==e&&l(JSON.parse(e))}),[]);const c=[{icon:n.jsx(Te,{}),title:t("components.hiddenText.title"),description:t("components.hiddenText.hint"),isInline:!0,mdText:` ${t("components.defaults.question")} 1 :hidden[${t("components.defaults.answer")} 1] , ${t("components.defaults.question")} 2 :hidden[${t("components.defaults.answer")} 2] `},{icon:n.jsx(De,{}),title:t("components.draggableAnswers.title"),description:t("components.draggableAnswers.hint"),isInline:!1,mdText:` ::answers{sticky="true"} \n${t("components.defaults.question")} 1 :hidden[${t("components.defaults.answer")} 1]\n${t("components.defaults.question")} 2 :hidden[${t("components.defaults.answer")} 2] \n`},{icon:n.jsx($e,{}),title:t("components.multipleChoice.title"),description:t("components.multipleChoice.hint"),isInline:!0,mdText:` ${t("components.defaults.question")} :select[${t("components.defaults.option")} 1]{alt="${t("components.defaults.option")} 1;${t("components.defaults.option")} 2;${t("components.defaults.option")} 3" ordered="false"} `},{icon:n.jsx(Pe,{}),title:t("components.checklist.title"),description:t("components.checklist.hint"),isInline:!1,mdText:`${t("components.defaults.question")}\n* [x] ${t("components.defaults.option")} 1\n* [ ] ${t("components.defaults.option")} 2\n* [ ] ${t("components.defaults.option")} 3\n`},{icon:n.jsx(Ae,{}),title:t("components.sortingOrdering.title"),description:t("components.sortingOrdering.hint"),isInline:!1,mdText:` :::sort\n- ${t("components.defaults.part.one")} 1\n- ${t("components.defaults.part.one")} 2\n- ${t("components.defaults.part.hintAdd")}\n- ${t("components.defaults.part.hintDelete")}\n:::\n`}],x=[{icon:n.jsx(ke,{}),title:t("components.image.title"),description:t("components.image.hint"),isInline:!1,mdText:"![](https://teachair.app/apple-touch-icon.png)"},{icon:n.jsx(Ee,{}),title:t("components.audio.title"),description:t("components.audio.hint"),isInline:!1,mdText:` :audio[${t("components.defaults.audio")}]{src="https://teachair.app/assets/audio/w-${t("locale")}.mp3"} `},{icon:n.jsx(We,{}),title:t("components.embed.title"),description:t("components.embed.hint"),isInline:!1,mdText:' :iframe[]{src="https://www.youtube.com/watch?v=mvhmCKNQfu8" } '}],m=[{icon:n.jsx(ze,{}),title:t("components.table.title"),description:t("components.table.hint"),isInline:!1,mdText:`\n|  ${t("components.defaults.question")}  |             |\n| :------: | :---------------------------------------: |\n| ${t("components.defaults.question")} 1 |  :select[A]{alt="A;B;C" ordered="false"}  |\n| ${t("components.defaults.question")} 2 |  :select[B]{alt="A;B;C" ordered="false"}  |\n| ${t("components.defaults.question")} 3 |  :select[C]{alt="A;B;C" ordered="false"}  |\n      `},{icon:n.jsx(Re,{}),title:t("components.tip.title"),description:t("components.tip.hint"),isInline:!1,mdText:`\n:::tip\n${t("components.tip.hint")}\n:::\n      `}];return n.jsx(o,{children:n.jsxs(o,{sx:{display:"flex",flexDirection:"column",width:"100%",gap:2},children:[a&&n.jsxs(d,{sx:{px:3,py:2,backgroundColor:"background.default",position:"relative",borderColor:"divider",borderWidth:1,borderStyle:"solid"},children:[n.jsx(g,{onClick:()=>{const e=!a;l(e),localStorage.setItem("componentsHelpVisible",JSON.stringify(e))},sx:{position:"absolute",top:8,right:8,zIndex:1},size:"small",children:n.jsx(ge,{})}),n.jsx(k,{variant:"body2",sx:{mb:2},children:t("components.help.title")}),n.jsx(o,{sx:{display:"flex",justifyContent:"center",borderRadius:"10px",border:"1px solid",borderColor:"divider",overflow:"hidden"},children:n.jsx("img",{style:{height:"27px",width:"320px",marginTop:"-2px"},src:"/icon-elements.gif"})})]}),n.jsx(b,{sx:{height:"100%",cursor:"pointer",borderColor:"primary.main",borderWidth:1,borderStyle:"solid","&:hover":{backgroundColor:"action.hover"}},onClick:()=>e(!1,`${t("components.defaults.task")}\n&nbsp;\n::essay`),children:n.jsxs(v,{children:[n.jsxs(o,{sx:{display:"flex",alignItems:"center",mb:2},children:[n.jsx(i,{sx:{minWidth:40},children:n.jsx(Be,{})}),n.jsx(r,{primary:t("components.studentsSection.title"),primaryTypographyProps:{variant:"subtitle1",sx:{fontWeight:500}}}),n.jsxs(i,{sx:{minWidth:40,color:"primary.main",fontSize:16,display:"flex",alignItems:"center",justifyContent:"center"},children:[n.jsx(be,{sx:{mr:1}}),"  AI"]})]}),n.jsx(k,{variant:"body2",color:"text.secondary",sx:{mb:1},children:t("components.studentsSection.hint")}),n.jsx(k,{variant:"body2",color:"text.secondary",sx:{mb:1},children:t("components.studentsSection.hint2")})]})}),n.jsx(k,{variant:"h6",sx:{mt:1,textAlign:"center"},children:t("components.help.text.title")}),c.map(((t,s)=>n.jsx(b,{sx:{height:"100%",cursor:"pointer",borderColor:"divider",borderWidth:1,borderStyle:"solid","&:hover":{backgroundColor:"action.hover"}},onClick:()=>e(t.isInline,t.mdText),children:n.jsxs(v,{children:[n.jsxs(o,{sx:{display:"flex",alignItems:"center",mb:2},children:[n.jsx(i,{sx:{minWidth:40},children:t.icon}),n.jsx(r,{primary:t.title,primaryTypographyProps:{variant:"subtitle1",sx:{fontWeight:500}}})]}),n.jsx(k,{variant:"body2",color:"text.secondary",children:t.description})]})},`text-component-${s}`))),n.jsx(k,{variant:"h6",sx:{mt:1,textAlign:"center"},children:t("components.help.media.title")}),[...x,...m].map(((t,s)=>n.jsx(b,{sx:{height:"100%",cursor:"pointer",borderColor:"divider",borderWidth:1,borderStyle:"solid","&:hover":{backgroundColor:"action.hover"}},onClick:()=>e(t.isInline,t.mdText),children:n.jsxs(v,{children:[n.jsxs(o,{sx:{display:"flex",alignItems:"center",mb:2},children:[n.jsx(i,{sx:{minWidth:40},children:t.icon}),n.jsx(r,{primary:t.title,primaryTypographyProps:{variant:"subtitle1",sx:{fontWeight:500}}})]}),n.jsx(k,{variant:"body2",color:"text.secondary",children:t.description})]})},`media-other-component-${s}`)))]})})},ns=()=>{const e=Se(Me),{t:t}=Z();return n.jsx(Fe,{title:t("taskForm.admonition.add"),children:n.jsx("span",{onClick:()=>{e({type:"containerDirective",name:"tip"})},children:n.jsx(Re,{fontSize:"small"})})})},as=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{var a;const i=e(),{taskId:r}=W(),[l]=t(),x=l.get("return_to")||"/tasks",u=l.get("copy_task_id"),p=l.get("work_id"),f=l.get("sharingKey"),j=l.get("title"),{user:y}=Y(),{showErrorToast:b}=X(),{mode:v}=Oe(),w=s.useRef(null),[C,S]=s.useState(null),[$,T]=s.useState(!0),[D,P]=s.useState(!1),[E,V]=s.useState([]),[U,J]=s.useState({title:j||"",text:"",url:"",tag_ids:[]}),[Q,K]=s.useState(null),[G,se]=s.useState({}),[ne,ae]=s.useState(!1),[ie,le]=s.useState(!1),[ce,de]=s.useState(0),[me,ue]=s.useState((()=>localStorage.getItem("taskForm_sidePanelMode")||"components-help")),[pe,fe]=s.useState(""),[je,ye]=s.useState(!1),[ke,ve]=s.useState([]),[we,Ce]=s.useState(!1),[Se,Ie]=s.useState("text");s.useEffect((()=>{me?localStorage.setItem("taskForm_sidePanelMode",me):localStorage.removeItem("taskForm_sidePanelMode")}),[me]),s.useEffect((()=>{const e=["live-preview","ai-chat","components-help"].indexOf(me||"live-preview");-1!==e&&e!==ce&&de(e)}),[me,ce]);const[_e,Fe]=s.useState(""),[ze,$e]=s.useState(null),[Te,De]=s.useState(!1),[Pe,Ae]=s.useState(""),[Ee,We]=s.useState(!1);s.useEffect((()=>{if(Pe){const t=`ai_${Pe}`,s=localStorage.getItem(t);if(s)try{const e=JSON.parse(s).map((e=>({...e,timestamp:new Date(e.timestamp)})));ve(e)}catch(e){}}}),[Pe]),s.useEffect((()=>{if(Pe){const e=`ai_${Pe}`;ke.length>0?localStorage.setItem(e,JSON.stringify(ke)):localStorage.removeItem(e)}}),[ke,Pe]);const[Re,Be]=s.useState(!1),[Me,zt]=s.useState(null),[$t,Tt]=s.useState(null),Dt=(null==y?void 0:y.role)===ee.ADMIN,Pt=(null==y?void 0:y.role)===ee.TEACHER||Dt,At=Boolean(r),[Et,Wt]=s.useState(!1),Rt=R(),Bt=B(Rt.breakpoints.only("xs")),Mt=B(Rt.breakpoints.down("md")),Ot=B(Rt.breakpoints.up("lg")),{t:Lt}=Z(),Nt=s.useRef({title:j||"",text:"",url:"",tag_ids:[]});s.useEffect((()=>{Be(!0)}),[]),s.useEffect((()=>{if(!Re)return;const e=r?`task_${r}`:"new_task";Ae(e);const t=localStorage.getItem(e);t&&($e(t),De(!0))}),[r,Re]);const qt=e=>{if(De(!1),e&&ze)try{const e=JSON.parse(ze);Nt.current={...Nt.current,...e},J({...Nt.current});const s=document.querySelector('input[name="title"]');if(s&&(s.value=e.title||""),w.current&&(w.current.setMarkdown(e.text||""),w.current.focus()),Pe){const e=`ai_${Pe}`,s=localStorage.getItem(e);if(s)try{const e=JSON.parse(s).map((e=>({...e,timestamp:new Date(e.timestamp)})));ve(e)}catch(t){}}}catch(t){}else if(localStorage.removeItem(Pe),$e(null),Pe){const e=`ai_${Pe}`;localStorage.removeItem(e),ve([])}},Ht=s.useCallback(M((()=>{J({...Nt.current}),se((e=>{const t={...e};return Nt.current.title&&t.title&&delete t.title,Nt.current.text&&t.text&&delete t.text,Nt.current.tag_ids.length>0&&t.tag_ids&&delete t.tag_ids,t})),Pe&&localStorage.setItem(Pe,JSON.stringify(Nt.current))}),500),[Pe]),Vt=e=>{if(!e)return!1;const t=e.includes(":hidden")||e.includes(":essay")||e.includes(":sort")||e.includes(":select"),s=e.includes("[ ]")||e.includes("[x]");return t||s},Ut=()=>{window.dispatchEvent(new CustomEvent("validateAllQuizzes",{detail:{taskId:"preview"}}))},Jt=(e,t)=>{de(t);ue(["live-preview","ai-chat","components-help"][t])},Qt=()=>{le(!ie)},Kt=async e=>{const t=e||pe;if(!t||"string"!=typeof t||!t.trim())return;const s={id:Date.now().toString(),message:t,text:U.text||"",timestamp:new Date,status:"processing",type:Se};ve((e=>[s,...e])),fe(""),ye(!0);try{const e=await te.tasks.chat({text:U.text,message:s.message,type:s.type});ve((e=>e.map((e=>e.id===s.id?{...e,status:"done"}:e)))),"text"===Se&&e&&(Fe(U.text),Nt.current.text=e,J({...Nt.current}),w.current&&(w.current.setMarkdown(e||""),w.current.focus()),Ht())}catch(n){ve((e=>e.map((e=>e.id===s.id?{...e,status:"error"}:e)))),b("Failed to get AI response. "+n)}finally{ye(!1)}},Gt=()=>{null!==localStorage.getItem(Pe)?We(!0):i(x)},Yt=e=>{e?($e(null),localStorage.removeItem(Pe),ve([]),We(!1),i(x)):We(!1)};if(s.useEffect((()=>{let e=!0;return(async()=>{if(e){T(!0);try{const t=await te.tags.getAll();if(!e)return;if(V(t),r){const t=await te.tasks.getById(r);if(!e)return;S(t),Fe(t.text||"");const s={title:t.title,text:t.text||"",tag_ids:t.tags.map((e=>e.id))};Nt.current=s,J(s)}else if(u){const t=await te.tasks.getById(u);if(!e)return;S(t),Fe(t.text||"");const s={title:`Copy of ${t.title}`,text:t.text||"",tag_ids:t.tags.map((e=>e.id))};Nt.current=s,J(s)}else if(f){const t=await te.tasks.getBySharingKey(f);if(!e)return;S(t),Fe(t.text||"");const s={title:t.title,text:t.text||"",tag_ids:t.tags.map((e=>e.id))};Nt.current=s,J(s)}else if(j&&!r&&!u&&!f){const e={title:j,text:"",tag_ids:[]};Nt.current=e,J(e)}p&&K(await te.works.getById(p))}catch(t){const s=t instanceof Error?t.message:"Failed to load data. Please try again.";if(!e)return;b(s),i(x)}finally{if(!e)return;T(!1)}}})(),()=>{e=!1}}),[r,u,f,j,i,x]),!Pt)return i(x),null;function Xt(e=!1){return n.jsxs(o,{sx:{display:"flex",gap:0,opacity:e?1:.5,pointerEvents:e?"auto":"none"},children:[n.jsx(pt,{options:["Bold","Italic"]}),n.jsx(gt,{options:["bullet","number"]}),n.jsx(ft,{}),n.jsx(jt,{editorRef:w}),n.jsx(yt,{editorRef:w}),n.jsx(kt,{editorRef:w}),n.jsx(bt,{editorRef:w}),n.jsx(vt,{editorRef:w}),n.jsx(wt,{editorRef:w}),n.jsx(Ct,{}),n.jsx(St,{}),n.jsx(It,{}),n.jsx(ts,{}),n.jsx(ns,{})]})}return n.jsxs(o,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[$?n.jsx(xe,{message:Lt(At?"taskForm.loading.task":"taskForm.loading.default")}):n.jsxs(o,{sx:{display:{xs:"block",lg:"flex"},gap:2,height:"100%",overflow:"hidden",justifyContent:"center",alignItems:"center"},children:[n.jsxs(o,{sx:{display:"flex",flex:"3 1",flexDirection:"column",width:"100%",maxWidth:"800px",height:"100%",position:"relative",overflow:"hidden",margin:"0 auto"},children:[n.jsx(o,{sx:{flex:1,overflow:"auto",p:1,pt:0},children:n.jsx(o,{width:"100%",sx:{display:"flex",justifyContent:"space-between"},children:n.jsx(o,{sx:{flex:1,display:"flex",flexDirection:"column",width:"100%",position:"relative"},children:n.jsxs(o,{component:"form",noValidate:!0,sx:{display:"flex",flexDirection:"column",height:"100%",minHeight:0,flex:1},children:[Q&&n.jsx(o,{sx:{mb:1},children:n.jsx(c,{variant:"text",color:"primary",size:"small",startIcon:n.jsx(Le,{}),onClick:Gt,children:Q.name})}),n.jsxs(d,{sx:{p:2,pt:0,pb:1},children:[n.jsx(h,{margin:"normal",name:"title",label:Lt("taskForm.title.label"),type:"text",size:"small",fullWidth:!0,variant:"outlined",defaultValue:U.title,onChange:e=>{Nt.current.title=e.target.value,Ht()},error:!!G.title,helperText:G.title,inputProps:{autoComplete:"off",maxLength:100},InputProps:{startAdornment:n.jsx(Ne,{sx:{mr:1,color:"text.secondary"},fontSize:"small"})}}),n.jsx(m,{multiple:!0,size:"small",options:E,getOptionLabel:e=>e.name,value:E.filter((e=>Nt.current.tag_ids.includes(e.id))),onChange:(e,t)=>{const s=t.map((e=>e.id));Nt.current.tag_ids=s,J({...Nt.current}),Ht()},disabled:Et,disableCloseOnSelect:!0,renderInput:e=>n.jsxs(o,{sx:{position:"relative"},children:[n.jsx(h,{...e,label:Lt("taskForm.tags.label"),margin:"normal",error:!!G.tag_ids,InputProps:{...e.InputProps,startAdornment:n.jsxs(n.Fragment,{children:[n.jsx(oe,{sx:{m:.25,ml:1,color:"text.secondary"},fontSize:"small"}),e.InputProps.startAdornment]})}}),Et&&n.jsx(O,{sx:{position:"absolute",bottom:0,left:0,right:0,height:2}})]}),filterOptions:(e,{inputValue:t})=>{const s=e.filter((e=>e.name.toLowerCase().includes(t.toLowerCase())));return t&&!s.length?[{id:"new",name:t,creator_id:(null==y?void 0:y.id)||""}]:s},renderOption:(e,t)=>"new"===t.id?n.jsx("li",{...e,onClick:async e=>{e.stopPropagation(),Wt(!0);try{const e=await te.tags.create({name:t.name});V((t=>[...t,e])),Nt.current.tag_ids=[...Nt.current.tag_ids,e.id],J({...Nt.current})}catch(s){const e=s instanceof Error?s.message:"Failed to create tag. Please try again.";b(e)}finally{Wt(!1)}},children:Lt("taskForm.tags.create",{name:t.name})}):n.jsx("li",{...e,children:t.name})}),G.tag_ids&&n.jsx(L,{error:!0,children:G.tag_ids}),n.jsxs(o,{sx:{display:"flex",flexDirection:"row",gap:1,justifyContent:"flex-end",mt:1},children:[n.jsxs(c,{size:"small",onClick:()=>{Jt(0,2),Qt()},children:[n.jsx(re,{sx:{mr:1}}),Lt("taskForm.buttons.addElement")]}),n.jsxs(c,{size:"small",onClick:()=>{Jt(0,1),Qt()},children:[n.jsx(be,{sx:{mr:1}}),Lt("taskForm.ai.title")]})]})]}),n.jsx(d,{id:"task-form-editor-paper",sx:{flex:1,display:"flex",flexDirection:"column",minHeight:0,position:"relative",mt:2,mb:2,border:"1px solid",borderColor:"divider"},children:n.jsx(qe,{ref:w,markdown:U.text,autoFocus:!0,onChange:e=>{Nt.current.text=e,Ht()},placeholder:Lt("taskForm.editor.placeholder"),className:"dark"===v?"mdxeditor dark-theme dark-editor":"mdxeditor light-theme light-editor",translation:(e,t,s)=>Lt("editor."+e,{defaultValue:t,...s}),suppressHtmlProcessing:!0,plugins:[He(),Ve(),Ue(),Je({disableImageResize:!0,disableImageSettingsButton:!0,imageUploadHandler:async e=>{const t=URL.createObjectURL(e);zt(t);const s=await te.files.uploadImage(e);return s.url?(zt(null),URL.revokeObjectURL(t),s.url):(b("Failed to upload image. Please try again."),t)},EditImageToolbar:nt}),Qe(),Ke(),Ge(),Ye({disableAutoLink:!0}),Xe(),Ze({viewMode:"rich-text",diffMarkdown:_e}),et({escapeUnknownTextDirectives:!0,directiveDescriptors:[at,it,rt,ot,lt,ct,dt,xt]}),tt(1e5),st({toolbarClassName:"mdxeditor-toolbar-full ",toolbarContents:()=>n.jsx(mt,{options:Mt?[]:["source"],children:n.jsx(ut,{options:[{when:e=>{var t;return"root"!==(null==(t=null==e?void 0:e.rootNode)?void 0:t.getType())},contents:()=>Xt(!1)},{fallback:()=>Xt(!0)}]})})})]})})]})})})}),n.jsxs(o,{sx:{width:"100%",p:1,display:"flex",justifyContent:"space-between",position:"sticky",bottom:0,left:0,zIndex:1},children:[n.jsx(o,{sx:{display:"flex-start",gap:2},children:n.jsx(c,{size:Mt?"small":"medium",variant:"outlined",color:"inherit",onClick:Gt,children:Lt("taskForm.buttons.cancel")})}),n.jsxs(o,{sx:{display:"flex",gap:2,alignItems:"center"},children:[n.jsx(A,{title:Lt("taskForm.buttons.preview"),children:n.jsx(c,{size:Mt?"small":"medium",variant:"outlined",startIcon:n.jsx(ht,{}),onClick:()=>{Jt(0,0),Qt()},children:Lt("taskForm.buttons.preview")})}),n.jsx(A,{title:D?Lt("taskForm.loading.saving"):U.title.trim()?U.text.trim()?"":Lt("taskForm.content.error.required"):Lt("taskForm.title.error.required"),children:n.jsx("span",{children:n.jsx(c,{size:Mt?"small":"medium",variant:"contained",color:"primary",onClick:async()=>{const{isValid:e,errors:t}=_t(Ft,U);if(e){P(!0);try{if(At&&r)await te.tasks.update(r,U);else{const e=await te.tasks.create(U);p&&await te.works.addTask(p,e.id)}$e(null),localStorage.removeItem(Pe),ve([]),i(x)}catch(s){const e=s instanceof Error?s.message:"Failed to save task. Please try again.";b(e)}finally{P(!1)}}else se(t)},disabled:D||!U.title.trim()||!U.text.trim(),children:Lt(D?"taskForm.loading.saving":At?"common.actions.save":"taskForm.buttons.create")})})})]})]})]}),n.jsx(N,{anchor:"right",open:ie,onClose:Qt,variant:Ot?"permanent":"temporary",sx:{width:"93%",maxWidth:"400px",flexShrink:0,"& .MuiDrawer-paper":{width:"93%",maxWidth:"400px"}},children:n.jsxs(o,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[n.jsxs(o,{sx:{borderBottom:1,borderColor:"divider",display:"flex",alignItems:"center",px:1},children:[!Ot&&n.jsx(g,{onClick:()=>le(!1),sx:{mr:1},children:Bt?n.jsx(Le,{}):n.jsx(ge,{})}),n.jsxs(q,{value:ce,onChange:Jt,variant:"fullWidth",sx:{flex:1,"& .MuiTab-root":{minHeight:48,fontSize:"0.875rem"}},children:[n.jsx(H,{value:2,label:Lt("taskForm.buttons.elements"),iconPosition:"start"}),n.jsx(H,{icon:n.jsx(be,{}),value:1,label:Lt("taskForm.ai.titleShort"),iconPosition:"start"}),n.jsx(H,{icon:n.jsx(ht,{}),value:0,label:Lt("taskForm.buttons.preview"),iconPosition:"start"})]})]}),n.jsxs(o,{sx:{flex:1,overflow:"auto",p:2},children:[0===ce&&n.jsx(n.Fragment,{children:(null==(a=null==U?void 0:U.text)?void 0:a.length)>0?n.jsx(es,{title:U.title||"",text:U.text||"",tagIds:U.tag_ids,tags:E,teacherId:(null==y?void 0:y.id)||"",onClose:()=>le(!1),onFullscreen:()=>ae(!0),onValidateAnswers:Ut,hasQuizzes:Vt(U.text||"")}):n.jsx(k,{variant:"body1",sx:{textAlign:"center",mt:2},children:Lt("taskForm.preview.empty")})}),1===ce&&n.jsx(Zt,{aiChatMessage:pe,setAIChatMessage:fe,isSendingAIMessage:je,aiChatHistory:ke,isProcessingAttachment:we,setIsProcessingAttachment:Ce,aiChatMode:Se,setAIChatMode:Ie,handleSendAIMessage:Kt,handleImprove:async()=>{if(!U.text)return void b(Lt("taskForm.preview.empty"));const e="✨ "+Lt("taskForm.ai.improve");fe(e),Kt(e)},handleRestoreHistoryItem:e=>{fe(e.message),Nt.current.text=e.text,J({...Nt.current}),w.current&&(w.current.setMarkdown(e.text||""),w.current.focus()),Ht(),ve((t=>{const s=t.findIndex((t=>t.id===e.id));return-1===s?t:t.slice(s+1)}))},handleRecognizedText:async(e,t)=>{const s={id:Date.now().toString(),message:"",text:U.text,timestamp:new Date,status:"done",image:void 0,type:Se};ve((e=>[s,...e]));const n=`\n${e}\n`,a=U.text+n;Nt.current.text=a,J({...Nt.current}),w.current&&(w.current.setMarkdown(a),w.current.focus()),Ht()}}),2===ce&&n.jsx(ss,{onChange:(e,t="")=>{if(!w.current)return;const s=e?`&nbsp;${t}&nbsp;`:`&nbsp;\n${t}\n&nbsp;`;w.current&&w.current.focus((()=>{var e;null==(e=w.current)||e.insertMarkdown(s)}),{defaultSelection:"rootEnd"}),le(!1)}})]})]})})]}),n.jsx(he,{open:ne,onClose:()=>ae(!1),task:{id:"preview",title:U.title||"",text:U.text||"",tags:E.filter((e=>U.tag_ids.includes(e.id))),teacher_id:(null==y?void 0:y.id)||""},hasQuizzes:Vt(U.text),onValidateAnswers:Ut}),n.jsxs(I,{open:Te,onClose:()=>De(!1),children:[n.jsx(_,{children:Lt("taskForm.dialog.unsavedChanges.title")}),n.jsx(F,{children:n.jsx(k,{children:Lt("taskForm.dialog.unsavedChanges.message")})}),n.jsxs(z,{children:[n.jsx(c,{onClick:()=>qt(!1),color:"error",children:Lt("taskForm.dialog.unsavedChanges.discard")}),n.jsx(c,{onClick:()=>qt(!0),variant:"contained",children:Lt("taskForm.dialog.unsavedChanges.restore")})]})]}),n.jsxs(I,{open:Ee,onClose:()=>We(!1),children:[n.jsx(_,{children:Lt("taskForm.dialog.cancel.title")}),n.jsx(F,{children:n.jsx(k,{children:Lt("taskForm.dialog.cancel.message")})}),n.jsxs(z,{children:[n.jsx(c,{onClick:()=>Yt(!1),children:Lt("taskForm.dialog.cancel.keep")}),n.jsx(c,{onClick:()=>Yt(!0),variant:"contained",color:"error",children:Lt("taskForm.dialog.cancel.confirm")})]})]}),n.jsxs(I,{open:!!Me,onClose:()=>zt(null),maxWidth:"sm",fullWidth:!0,children:[n.jsx(_,{children:Lt("taskForm.dialog.image.title")}),n.jsxs(F,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:[n.jsx(o,{component:"img",src:Me||"",alt:"Preview",sx:{maxWidth:"100%",maxHeight:"300px",objectFit:"contain"}}),n.jsx(xe,{message:Lt("taskForm.loading.image")})]})]}),n.jsxs(I,{open:!!$t,onClose:()=>Tt(null),maxWidth:"sm",fullWidth:!0,children:[n.jsx(_,{children:Lt("taskForm.dialog.generatedImage.title")}),n.jsx(F,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:n.jsx(o,{component:"img",src:(as=$t,as?as.startsWith("data:image")?as:`data:image/jpeg;base64,${as}`:""),alt:"Generated",sx:{maxWidth:"100%",maxHeight:"300px",objectFit:"contain"}})}),n.jsx(z,{children:n.jsx(c,{onClick:()=>Tt(null),children:Lt("taskForm.dialog.image.close")})})]})]});var as}},Symbol.toStringTag,{value:"Module"})),is=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const{t:l}=Z(),{user:x}=Y(),u=e(),[p]=t(),f=p.get("return_to")||"",j=p.get("studentId"),b=p.get("work_id"),v="true"===p.get("edit"),w="true"===p.get("copy"),C="true"===p.get("send"),$="true"===p.get("onboarding"),T="true"===p.get("template"),D=p.get("folder"),[P,E]=s.useState([]),[W,M]=s.useState(null),[O,L]=s.useState([]),[J,Q]=s.useState(null),[K,G]=s.useState(""),[se,ne]=s.useState(!1),[ae,ie]=s.useState(null),[oe,ce]=s.useState(0),[de,fe]=s.useState([]),[je,ye]=s.useState(!0),[ke,be]=s.useState(!1),[ve,we]=s.useState(null),[Ce,Se]=s.useState({}),[Ie,_e]=s.useState(v||T?1:0),[Fe,ze]=s.useState(!1),$e=(null==x?void 0:x.role)===ee.TEACHER||(null==x?void 0:x.role)===ee.ADMIN,{showErrorToast:Te,showToast:De}=X(),[Pe,Ae]=s.useState(null),[Ee,We]=s.useState(!1),[Re,Be]=s.useState(0),[Me,Oe]=s.useState(0),[Ne,qe]=s.useState(null),[He,Ve]=s.useState([]),[Ue,Je]=s.useState(null),[Qe,Ke]=s.useState(null),[Ge,Ye]=s.useState(!1),[Xe,Ze]=s.useState(null),[et,tt]=s.useState(0),st=R(),nt=B(st.breakpoints.up("lg")),at=B(st.breakpoints.only("xs")),it=J&&J.student_id===J.teacher_id;s.useEffect((()=>{(async()=>{try{const e=await te.folders.getAll(0,100);if(Ve(e),D){const t=e.find((e=>e.id===D));if(t)qe(t);else{const e=await te.folders.getById(D);e&&qe(e)}}}catch(e){Te(pe(e))}})()}),[D]),s.useEffect((()=>{(async()=>{ye(!0),we(null);try{const e=await te.contracts.getAll(0,100),t=e.filter((e=>e.status===zt.AGREED||e.status===zt.PENDING));fe(t);const s=new Map;e.forEach((e=>{e.student&&!s.has(e.student_id)&&s.set(e.student_id,e.student)}));const n=Array.from(s.values()).sort(((e,t)=>{const s=$t(e).toLowerCase(),n=$t(t).toLowerCase();return s.localeCompare(n)}));if($e&&!C){const e={id:x.id,first_name:l("templates.titleSingle"),last_name:null,photo_url:null,is_template:!0};n.unshift(e)}if(E(n),we(null),T&&$e&&x){const e=n.find((e=>e.id===x.id&&e.is_template));if(e){M(e);const t=new Date,s=t.getDate().toString().padStart(2,"0"),n=(t.getMonth()+1).toString().padStart(2,"0"),a=`${s}.${n}.${t.getFullYear()}`;G(`${l("templates.titleSingle")} - ${a}`)}}else if(j){const e=n.find((e=>e.id===j));if(e){M(e);const t=new Date,s=t.getDate().toString().padStart(2,"0"),n=(t.getMonth()+1).toString().padStart(2,"0"),a=`${s}.${n}.${t.getFullYear()}`;G(`${l("works.creator.forStudent")} ${$t(e)||e.id} - ${a}`),qe(null),_e(1)}}b&&(v||w)&&await rt(b)}catch(e){const t=pe(e);we(t),Te(t)}finally{ye(!1)}})()}),[j,b,v,w,Re,T]);const rt=async e=>{try{const t=await te.works.getById(e);Q(t),G(w&&!C?`Copy of ${t.name}`:t.name);const s=(await Promise.all(t.task_states.sort(((e,t)=>(e.order||0)-(t.order||0))).map((async e=>{if(!e.task)try{return await te.tasks.getById(e.task_id)}catch(t){return null}return e.task})))).filter((e=>null!==e));L(s)}catch(t){const e=t instanceof Error?t.message:"Failed to load work data. Please try again.";we(e),Te(e)}};s.useEffect((()=>{if(J&&P.length>0&&v){const e=P.find((e=>e.id===J.student_id));e?M(e):Te("Student for this work could not be found. Please select a student manually.")}}),[J,P,v]),s.useEffect((()=>{if(W&&!W.is_template){const e=de.find((e=>e.student_id===W.id&&e.teacher_id===(null==x?void 0:x.id)&&e.status===zt.AGREED)),t=de.find((e=>e.student_id===W.id&&e.teacher_id===(null==x?void 0:x.id)&&e.status===zt.PENDING)),s=e||t;ie(s||null),s?(ce(s.balance),s.balance>0?ne(!0):ne(!1)):(ce(0),ne(!1))}else ie(null),ce(0),ne(!1)}),[W,de,null==x?void 0:x.id]);const ot=e=>{if(M(e),e){const t=new Date,s=`${t.getDate().toString().padStart(2,"0")}.${(t.getMonth()+1).toString().padStart(2,"0")}.${t.getFullYear()}`;e.is_template?G(`${l("templates.titleSingle")} - ${s}`):G(`${l("works.creator.forStudent")} ${$t(e)||e.id} - ${s}`)}else G("")},lt=e=>{L((t=>t.some((t=>t.id===e.id))?t.filter((t=>t.id!==e.id)):[...t,e]))},ct=async(e=!0)=>{if(!W)return void we("Please select a student");const t={name:K,student_id:W.id,task_ids:O.map((e=>e.id)),contract_id:se&&ae?ae.id:void 0,folder_id:null==Ne?void 0:Ne.id,is_draft:!e},{isValid:s,errors:n}=_t(Ht,t);if(!s)return void Se(n);be(!0),we(null);let a=null;try{if(v&&J){a=(await te.works.update(J.id,t)).id}else{a=(await te.works.create(t)).id}if(e){if(De(l(v&&J?"templates.message.workSuccessfullyUpdated":"templates.message.workSuccessfullyCreated"),"success"),f&&"null"!=f){const e=f+(f.includes("?")?"&":"?")+"new_work_id="+a;return void u(e)}return(null==W?void 0:W.is_template)?void u("/templates?new_work_id="+a):void u("/works?new_work_id="+a)}return a}catch(i){const e=i instanceof Error?i.message:`Failed to ${v?"update":"create"} work. Please try again.`;we(e),Te(e),be(!1)}},dt=e=>{Ae(e),We(!0)},xt=()=>{We(!1)};s.useCallback((()=>{Be((e=>e+1))}),[]);const mt=()=>{if(Ie>=1)ze(!0);else if(f){const e=f+(f.includes("?")?"&":"?")+"share_key="+(null==J?void 0:J.share_key);u(e)}else(null==W?void 0:W.is_template)?u("/templates?share_key="+(null==J?void 0:J.share_key)):u("/works?share_key="+(null==J?void 0:J.share_key))},ut=()=>{ze(!1)},ht=()=>{Je(null),Ke(null)},pt=e=>{Ze(e),Ye(!0),tt(0)};if(je)return n.jsx(xe,{message:l("common.loading")});const gt=Ge&&(!!Xe||0!==et);return n.jsxs(o,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[je?n.jsx(xe,{message:l(v?"taskForm.loading.task":"taskForm.loading.default")}):n.jsxs(o,{sx:{display:gt?{xs:"block",lg:"flex"}:"block",gap:2,height:"100%",overflow:"hidden",justifyContent:"center",alignItems:"center"},children:[n.jsxs(o,{sx:{display:"flex",flex:"3 1",flexDirection:"column",width:"100%",maxWidth:"800px",height:"100%",position:"relative",overflow:"hidden",margin:"0 auto"},children:[n.jsx("style",{children:`\n          .dragged-item {\n            background-color: ${st.palette.primary.main} !important;\n          }\n        `}),n.jsxs(o,{sx:{display:"flex",flexDirection:"column",flex:1,overflow:"auto",p:1,pt:0,height:"100%",".sortable-list":{position:"relative","& .item":{transition:"background-color 0.2s, box-shadow 0.2s, transform 0.1s","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"},userSelect:"none",cursor:"default"},"& .dragged-item":{backgroundColor:"primary.main!important",color:"white!important",boxShadow:"0 10px 20px rgba(0, 0, 0, 0.3)!important",opacity:.95,zIndex:1e3,transform:"scale(1.03)",borderRadius:"4px",pointerEvents:"none",cursor:"grabbing","& .MuiTypography-root":{color:"white!important"},"& svg":{color:"white!important"}}}},children:[n.jsx(o,{sx:{mb:2,ml:1,flexShrink:0,display:w||C||v?"flex":"none"},children:n.jsxs(k,{variant:"body2",children:[l(v?"works.tabs.step1.edit":w?C?"works.tabs.step1.send":"works.tabs.step1.copy":"works.tabs.step1.create"),' "',null==J?void 0:J.name,'"']})}),0===Ie&&n.jsxs(n.Fragment,{children:[n.jsxs(d,{sx:{py:1,px:3,mb:1,display:"flex",flexDirection:"column"},children:[n.jsx(o,{sx:{mt:1},children:(null==W?void 0:W.is_template)?n.jsxs(k,{variant:"h6",gutterBottom:!0,sx:{my:1},children:[l("works.creator.templateHint"),Ne?` ${l("works.creator.inFolder")} "${null==Ne?void 0:Ne.title}"`:""]}):n.jsx(k,{variant:"h6",gutterBottom:!0,sx:{my:1},children:l("templates.createForStudent.title")})}),n.jsx(o,{sx:{mt:1,mb:1},children:P.length>0?n.jsxs(n.Fragment,{children:[it&&n.jsx(k,{variant:"body2",color:"text.secondary",sx:{mb:3},children:l("templates.createForStudent.description")}),n.jsx(m,{value:W,onChange:(e,t)=>ot(t),options:P,getOptionLabel:e=>$t(e),renderInput:e=>n.jsx(h,{...e,placeholder:l("works.creator.selectStudent"),required:!0,autoFocus:!0,error:!!Ce.student_id,helperText:Ce.student_id,InputProps:{...e.InputProps,startAdornment:n.jsxs(n.Fragment,{children:[W&&(W.is_template?n.jsx(Tt,{sx:{mr:1,color:"primary.main"}}):n.jsx(V,{src:W.photo_url||void 0,sx:{width:24,height:24,mr:1},children:Dt(W)})),e.InputProps.startAdornment]})}}),renderOption:(e,t)=>n.jsx(o,{component:"li",...e,sx:{display:"flex",alignItems:"center",borderBottom:t.is_template?"1px solid":"none",borderColor:t.is_template?"divider":"transparent"},children:n.jsxs(o,{sx:{display:"flex",alignItems:"center",p:1},onClick:()=>ot(t),children:[t.is_template?n.jsx(Tt,{sx:{mr:1,color:"primary.main"}}):n.jsx(V,{src:t.photo_url||void 0,sx:{width:24,height:24,mr:1},children:Dt(t)}),n.jsx(k,{sx:{fontWeight:t.is_template?500:400,color:t.is_template?"primary.main":"inherit"},children:t.is_template?l("templates.titleSingle"):$t(t)||t.id})]})})}),n.jsx(c,{variant:W?"contained":"text",color:"primary",fullWidth:!0,onClick:()=>_e(1),disabled:!W,endIcon:n.jsx(Pt,{}),sx:{mt:2},children:l("works.actions.continue")})]}):n.jsx(n.Fragment,{children:it&&n.jsx(k,{variant:"body2",color:"text.secondary",children:l("templates.addFirstStudentDescription")})})}),W&&n.jsx(n.Fragment,{children:n.jsx(c,{variant:"text",color:"secondary",size:"small",onClick:()=>M(null),disabled:!W,children:l("common.actions.change")})})]}),!W&&n.jsxs(d,{sx:{p:3,pt:1,mt:3,display:"flex",flexDirection:"column"},children:[n.jsx(k,{variant:"h6",gutterBottom:!0,sx:{my:2},children:l("templates.templateLinks.title")}),C&&J&&!(null==J?void 0:J.share_key)&&n.jsx(n.Fragment,{children:n.jsx(k,{variant:"body1",color:"text.secondary",sx:{mb:1},children:l("templates.templateLinks.description")})}),C&&J&&n.jsx(n.Fragment,{children:n.jsx(k,{variant:"body2",color:"text.secondary",sx:{mb:3},children:l("templates.templateLinks.description2")})}),!C&&n.jsx(n.Fragment,{children:n.jsxs(o,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:1},children:[n.jsx(k,{variant:"body1",color:"text.secondary",sx:{mb:1},children:l("templates.createNewTemplate.description")}),n.jsxs(o,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",gap:2,width:"100%",mt:1},children:[n.jsx(c,{variant:"outlined",fullWidth:!0,color:"primary",onClick:()=>{ot(P[0])},children:l("templates.createNewTemplate.title")}),n.jsxs(c,{variant:"text",fullWidth:!0,color:"secondary",onClick:()=>{u("/templates")},children:[l("common.my.many")," ",l("navigation.templates")]})]})]})}),w&&it&&J&&n.jsx(At,{work:J,onCreate:e=>{Q((t=>t?{...t,share_key:e}:t))},onDelete:()=>{Q((e=>e?{...e,share_key:null}:e))},onDone:()=>mt()})]})]}),1===Ie&&n.jsxs(d,{sx:{py:1,px:3,display:"flex",flexDirection:"column",overflow:"hidden",height:"100%"},children:[n.jsx(o,{sx:{mt:1,mb:0,display:"flex",alignItems:"center",gap:1},children:n.jsxs(o,{sx:{flex:1,display:"flex",alignItems:"center",borderBottom:1,borderColor:"divider",pb:1},children:[!0===(null==W?void 0:W.is_template)&&n.jsx(n.Fragment,{children:n.jsxs(k,{variant:"h6",gutterBottom:!0,sx:{my:1},children:[l(v?"works.creator.templateHintEditing":"works.creator.templateHint"),"  ",Ne?`${l("works.creator.inFolder")} "${null==Ne?void 0:Ne.title}"`:""]})}),W&&!W.is_template&&n.jsxs(o,{sx:{flex:1,display:"flex",justifyContent:"space-between"},children:[n.jsxs(o,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:1},children:[n.jsx(k,{variant:"body2",sx:{mb:.5},children:l("works.creator.byStudent")}),n.jsxs(o,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:[n.jsx(V,{src:(null==W?void 0:W.photo_url)||void 0,sx:{width:32,height:32,mr:1},children:Dt(W)}),n.jsx(k,{variant:"h6",sx:{flex:1,overflow:"hidden"},children:$t(W)})]})]}),v?null:n.jsxs(o,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:1},children:[ae&&oe>0&&n.jsx(k,{variant:"body2",children:l("works.creator.availableLessons",{count:oe})}),ae&&oe<=0&&n.jsx(k,{variant:"body2",children:l("works.creator.noLessonsAvailable")}),ae&&oe>0&&n.jsx(U,{control:n.jsx(y,{checked:se,onChange:e=>ne(e.target.checked),color:"primary"}),label:n.jsx(k,{sx:{whiteSpace:"nowrap"},color:se?"primary":"default",children:l("works.creator.redeemLesson")})})]})]})]})}),n.jsxs(o,{sx:{my:1},children:[n.jsx(h,{fullWidth:!0,autoFocus:!0,label:(null==W?void 0:W.is_template)?l("templates.actions.templateName"):l("templates.actions.workName"),value:K,onChange:e=>G(e.target.value),margin:"normal",required:!0,error:!!Ce.name,helperText:Ce.name}),!W||!K.trim()&&n.jsx(k,{variant:"body2",color:"error.main",sx:{p:1,textAlign:"center"},children:W?K.trim()?"":l("works.creator.enterWorkName"):l("works.creator.selectStudent")})]}),n.jsxs(n.Fragment,{children:[n.jsxs(d,{id:"tasks-list-paper",variant:"outlined",sx:{mt:1,mb:1,overflow:"hidden",maxHeight:"100%",overflowY:"auto",overflowX:"hidden",position:"relative",...$&&{animation:"pulse 3s ease-in-out","@keyframes pulse":{"0%":{boxShadow:"0 0 0 0 rgba(25, 118, 210, 0.7)",transform:"scale(1)"},"50%":{boxShadow:"0 0 0 10px rgba(25, 118, 210, 0)",transform:"scale(1.02)"},"100%":{boxShadow:"0 0 0 0 rgba(25, 118, 210, 0)",transform:"scale(1)"}}}},children:[O.length>0?n.jsx(Et,{onSortEnd:(e,t)=>{e<0||t<0||e>=O.length||t>=O.length||e===t||(L((s=>{const n=[...s],[a]=n.splice(e,1);return n.splice(t,0,a),n})),Oe((e=>e+1)))},lockAxis:"y",className:"sortable-list",draggedItemClassName:"dragged-item",allowDrag:!0,as:"div",children:O.map(((e,t)=>n.jsx(Wt,{children:n.jsxs(o,{sx:{display:"flex",alignItems:"center",px:2,py:1,borderBottom:1,borderColor:"divider",cursor:"pointer","&:hover":{backgroundColor:"action.hover"}},children:[n.jsxs(o,{sx:{display:"flex",alignItems:"center",flex:1},children:[n.jsx(Rt,{children:n.jsx(Bt,{sx:{mr:1,color:"primary.main",cursor:"grab"}})}),n.jsx(o,{sx:{flex:1},onClick:()=>pt(e),children:n.jsx(k,{variant:"body1",sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"},children:`${t+1}. ${e.title}`})})]}),n.jsx(o,{sx:{display:"flex",alignItems:"center"},children:n.jsx(A,{title:l("common.actions.actions"),children:n.jsx(g,{edge:"end",onClick:t=>((e,t)=>{e.preventDefault(),e.stopPropagation(),Je(e.currentTarget),Ke(t)})(t,e),size:"small",children:n.jsx(ue,{})})})})]})},`task-${e.id}-pos-${t}`)))},`sortable-list-${Me}`):null,n.jsx(o,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},justifyContent:"flex-end",gap:0,width:"100%",p:1},children:W&&n.jsxs(n.Fragment,{children:[n.jsx(c,{variant:"text",color:"primary",onClick:()=>{ct(!1).then((e=>{e&&u(`/tasks/new?work_id=${e}&return_to=/works/assign/%3Fwork_id=${e}%26folder_id=${null==Ne?void 0:Ne.id}%26edit=true%26return_to=${f}`)}))},startIcon:n.jsx(re,{}),disabled:ke||!W||!K.trim(),children:l("tasks.actions.createTask")}),n.jsx(c,{variant:"text",color:"primary",onClick:()=>{tt(1),Ye(!0)},startIcon:n.jsx(Mt,{}),children:l("works.creator.addExistingTask")})]})})]}),n.jsxs(S,{anchorEl:Ue,open:Boolean(Ue),onClose:ht,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[n.jsxs(a,{onClick:()=>{Qe&&pt(Qe),ht()},sx:{borderBottom:1,borderColor:"divider"},children:[n.jsx(i,{children:n.jsx(Ot,{fontSize:"small"})}),n.jsx(r,{primary:l("common.actions.preview")})]}),n.jsxs(a,{onClick:()=>{Qe&&lt(Qe),ht()},children:[n.jsx(i,{children:n.jsx(le,{fontSize:"small"})}),n.jsx(r,{primary:l("common.actions.remove")})]}),n.jsxs(a,{onClick:()=>{Qe&&ct(!1).then((e=>{e&&u(`/tasks/${Qe.id}/edit?work_id=${e}&return_to=/works/assign/%3Fwork_id=${e}%26folder_id=${null==Ne?void 0:Ne.id}%26edit=true%26return_to=${f}`)})),ht()},children:[n.jsx(i,{children:n.jsx(me,{fontSize:"small"})}),n.jsx(r,{primary:l("common.actions.edit")})]}),n.jsxs(a,{onClick:()=>{Qe&&ct(!1).then((e=>{e&&u(`/tasks/new?work_id=${e}&copy_task_id=${Qe.id}&return_to=/works/assign/%3Fwork_id=${e}%26folder_id=${null==Ne?void 0:Ne.id}%26edit=true%26return_to=${f}`)})),ht()},children:[n.jsx(i,{children:n.jsx(Lt,{fontSize:"small"})}),n.jsx(r,{primary:l("common.actions.copy")})]})]})]})]})]}),n.jsxs(o,{sx:{width:"100%",p:1,display:"flex",justifyContent:"space-between",position:"sticky",bottom:0,left:0,zIndex:1,flexShrink:0},children:[n.jsx(o,{sx:{display:"flex-start",gap:2},children:n.jsx(c,{variant:"outlined",size:"small",color:"inherit",onClick:mt,children:l("common.actions.cancel")})}),n.jsx(o,{sx:{display:"flex",gap:2,alignItems:"center"},children:Ie<1?n.jsx(c,{variant:"contained",color:"primary",size:"small",onClick:()=>_e(1),disabled:!W,children:l("common.actions.next")}):n.jsxs(n.Fragment,{children:[!v&&n.jsx(c,{variant:"outlined",color:"primary",size:"small",onClick:()=>_e(0),sx:{ml:1},children:l("common.actions.back")}),n.jsx(c,{variant:"contained",color:"primary",onClick:()=>ct(!0),disabled:ke||!W||!K.trim()||0===O.length,children:ke?l("common.status.loading"):v?(null==J?void 0:J.status)===Nt.DRAFT?(null==W?void 0:W.is_template)?l("templates.actions.createTemplate"):l("templates.actions.sendToStudent"):l("common.actions.save"):(null==W?void 0:W.is_template)?l("templates.actions.createTemplate"):l(v?"common.actions.save":"templates.actions.sendToStudent")})]})})]})]}),n.jsx(N,{anchor:"right",open:gt,onClose:()=>{Ge&&Ze(null),Ye(!Ge)},variant:nt?"persistent":"temporary",sx:{width:"93%",maxWidth:"400px",flexShrink:0,"& .MuiDrawer-paper":{width:"93%",maxWidth:"400px"}},children:n.jsxs(o,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[n.jsxs(o,{sx:{borderBottom:1,borderColor:"divider",display:"flex",alignItems:"center",px:1},children:[n.jsx(g,{onClick:()=>Ye(!1),sx:{mr:1},children:at?n.jsx(Le,{}):n.jsx(ge,{})}),n.jsxs(q,{value:et,onChange:(e,t)=>{tt(t)},variant:"fullWidth",sx:{flex:1,"& .MuiTab-root":{minHeight:48,fontSize:"0.875rem"}},children:[Xe&&n.jsx(H,{value:0,label:l("taskForm.buttons.preview")}),n.jsx(H,{value:1,label:l("works.creator.addTasks")})]})]}),n.jsxs(o,{sx:{flex:1,overflow:"auto",p:2},children:[0===et&&n.jsx(n.Fragment,{children:Xe?n.jsx(es,{title:Xe.title||"",text:Xe.text||"",tagIds:[],tags:[],teacherId:"",onClose:()=>Ye(!1),onFullscreen:()=>{dt(Xe)},onValidateAnswers:()=>{},hasQuizzes:!1}):null}),1===et&&n.jsx(qt,{selectedTasks:O,onTaskToggle:lt,onPreviewTask:e=>{dt(e)}})]})]})})]}),n.jsx(he,{open:Ee,onClose:xt,task:Pe,hasQuizzes:!1,onValidateAnswers:()=>{},actionButtons:n.jsxs(o,{sx:{display:"flex",gap:1,width:"100%",justifyContent:"space-between"},children:[n.jsx(o,{sx:{display:"flex",gap:1},children:Pe&&n.jsxs(n.Fragment,{children:[n.jsx(A,{title:l("works.creator.autoSaveHint"),children:n.jsx(c,{size:"small",variant:"text",startIcon:n.jsx(me,{}),onClick:()=>{ct(!1).then((e=>{e&&(u(`/tasks/${Pe.id}/edit?return_to=/works/assign/%3Fwork_id=${e}%26edit=true`),xt())}))},children:l("common.actions.edit")})}),n.jsx(c,{size:"small",onClick:e=>{e.stopPropagation(),lt(Pe),xt()},startIcon:O.some((e=>e.id===Pe.id))?n.jsx(le,{}):n.jsx(re,{}),children:O.some((e=>e.id===Pe.id))?l("common.actions.remove"):l("common.actions.add")})]})}),n.jsx(c,{onClick:xt,children:l("common.actions.close")})]})}),n.jsxs(I,{open:Fe,onClose:ut,maxWidth:"xs",fullWidth:!0,children:[n.jsx(_,{children:l("common.dialog.cancel.title")}),n.jsx(F,{children:n.jsx(k,{children:l("common.dialog.cancel.message")})}),n.jsxs(z,{children:[n.jsx(c,{onClick:ut,children:l("common.actions.no")}),n.jsx(c,{onClick:()=>{ze(!1),f?u(f):(null==W?void 0:W.is_template)?u("/templates"):u("/works")},color:"error",children:l("common.actions.yes")})]})]})]})}},Symbol.toStringTag,{value:"Module"})),rs=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const{t:t}=Z(),{user:l}=Y(),{showErrorToast:x}=X(),m=s.useRef(null),[f,j]=s.useState([]),[y,b]=s.useState(!0),[v,w]=s.useState(null),[C,$]=s.useState(0),[T,D]=s.useState(""),[P,A]=s.useState(!1),[E,W]=s.useState({}),[R,B]=s.useState(null),[M,O]=s.useState(null),[L,N]=s.useState(!1),[q,H]=s.useState(""),[V,U]=s.useState(!1),J=e(),Q=(null==l?void 0:l.role)===ee.ADMIN,K=(null==l?void 0:l.role)===ee.TEACHER||Q;s.useEffect((()=>{(async()=>{b(!0),w(null);try{const e=await te.tags.getAll();j(e),w(null)}catch(e){const t=pe(e);w(t),x(t)}finally{b(!1)}})()}),[C]),s.useCallback((()=>{$((e=>e+1))}),[]);const G=async()=>{var e;const{isValid:t,errors:s}=_t(Jt,{name:T});if(t){A(!0);try{const t=await te.tags.create({name:T.trim()});j((e=>[t,...e])),D(""),W({}),null==(e=m.current)||e.focus()}catch(n){const e=n instanceof Error?n.message:"Failed to create tag. Please try again.";x(e)}finally{A(!1)}}else W(s)},se=()=>{B(null)},ne=()=>{N(!1),H("")},re=()=>{U(!1)};return n.jsxs(o,{children:[n.jsx(ie,{title:t("navigation.tags")}),y?n.jsx(xe,{message:t(y?"common.loading":"tags.loading.tags")}):n.jsxs(n.Fragment,{children:[n.jsx(d,{sx:{p:3,mb:3,mx:"auto",maxWidth:"1200px"},children:n.jsxs(o,{sx:{display:"flex",gap:1,alignItems:"center"},children:[n.jsx(h,{inputRef:m,fullWidth:!0,autoComplete:"off",autoCapitalize:"off",size:"small",placeholder:t("tags.input.placeholder"),value:T,onChange:e=>{D(e.target.value),E.name&&W((e=>({...e,name:""})))},onKeyPress:e=>{"Enter"===e.key&&T.trim()&&G()},error:!!E.name,helperText:E.name,InputProps:{endAdornment:T?n.jsx(p,{position:"end",children:n.jsx(g,{size:"small",onClick:()=>{D(""),W({})},edge:"end",children:n.jsx(le,{})})}):null}}),T.trim()&&n.jsx(c,{size:"small",startIcon:n.jsx(Vt,{}),onClick:G,disabled:P,children:t(P?"common.status.saving":"common.actions.create")})]})}),v||0!==f.length?n.jsx(d,{sx:{p:3,mx:"auto",maxWidth:"1200px"},children:n.jsx(o,{sx:{display:"flex",flexWrap:"wrap",gap:1,mt:1},children:f.map((e=>n.jsx(o,{children:n.jsx(u,{onClick:t=>((e,t)=>{e.stopPropagation(),O(t),B(e.currentTarget)})(t,e),label:e.name,sx:{m:.5,height:"auto",borderRadius:"16px","& .MuiChip-label":{px:1.5,py:.5}},variant:"outlined"})},e.id)))})}):n.jsx(o,{sx:{textAlign:"center",py:4},children:n.jsx(k,{variant:"h6",color:"text.secondary",sx:{mb:1},children:t(K?"tags.empty.teacher":"tags.empty.default")})})]}),n.jsxs(S,{anchorEl:R,open:Boolean(R),onClose:se,onClick:e=>e.stopPropagation(),children:[n.jsxs(a,{onClick:()=>{se(),J(`/tasks?tag_id=${null==M?void 0:M.id}`)},children:[n.jsx(i,{children:n.jsx(Ut,{fontSize:"small"})}),n.jsx(r,{children:t("tags.actions.showTasks")})]}),n.jsxs(a,{onClick:()=>{M&&(H(M.name),N(!0)),se()},children:[n.jsx(i,{children:n.jsx(me,{fontSize:"small"})}),n.jsx(r,{children:t("common.actions.rename")})]}),n.jsxs(a,{onClick:()=>{se(),U(!0)},sx:{color:"error.main"},children:[n.jsx(i,{sx:{color:"error.main"},children:n.jsx(ae,{fontSize:"small"})}),n.jsx(r,{children:t("common.actions.delete")})]})]}),n.jsxs(I,{open:L,onClose:ne,maxWidth:"xs",fullWidth:!0,children:[n.jsx(_,{children:t("tags.dialog.rename.title")}),n.jsx(F,{children:n.jsx(h,{autoFocus:!0,margin:"dense",label:t("tags.input.label"),type:"text",fullWidth:!0,value:q,onChange:e=>H(e.target.value),variant:"outlined"})}),n.jsxs(z,{children:[n.jsx(c,{onClick:ne,children:t("common.actions.cancel")}),n.jsx(c,{onClick:async()=>{if(!M||!q.trim())return;const{isValid:e,errors:t}=_t(Jt,{name:q});if(e)try{const e=await te.tags.update(M.id,{name:q.trim()});j((t=>t.map((t=>t.id===M.id?e:t)))),N(!1),H(""),O(null)}catch(s){const e=s instanceof Error?s.message:"Failed to rename tag. Please try again.";x(e)}else x(t.name)},variant:"contained",disabled:!q.trim()||q===(null==M?void 0:M.name),children:t("common.actions.rename")})]})]}),n.jsxs(I,{open:V,onClose:re,maxWidth:"xs",fullWidth:!0,children:[n.jsx(_,{children:t("tags.dialog.delete.title")}),n.jsx(F,{children:n.jsx(k,{children:t("tags.dialog.delete.message",{name:null==M?void 0:M.name})})}),n.jsxs(z,{children:[n.jsx(c,{onClick:re,children:t("common.actions.cancel")}),n.jsx(c,{onClick:async()=>{M&&(await(async e=>{try{await te.tags.delete(e),j((t=>t.filter((t=>t.id!==e))))}catch(t){const e=t instanceof Error?t.message:"Failed to delete tag. Please try again.";x(e)}})(M.id),U(!1))},color:"error",variant:"contained",children:t("common.actions.delete")})]})]})]})}},Symbol.toStringTag,{value:"Module"})),os=()=>{var i;const{t:r}=Z(),l=e(),{contractId:x}=W(),[m]=t(),u=m.get("return_to")||"/contracts",{user:p}=Y(),{showErrorToast:g,showToast:f}=X(),j="true"===m.get("testStudent"),y="teachair_test_student",[b,v]=s.useState(!0),[w,C]=s.useState(!1),[S,$]=s.useState(null),[T,D]=s.useState([]),[P,A]=s.useState({username:"",price:"",currency:null,balance:null,description:""}),[E,R]=s.useState({}),[B,M]=s.useState(null),[O,L]=s.useState(null),[N,q]=s.useState(!1),[H,se]=s.useState(!1),[ne,ae]=s.useState(!0),ie=(null==p?void 0:p.role)===ee.ADMIN,re=(null==p?void 0:p.role)===ee.TEACHER||ie,oe=Boolean(x);s.useEffect((()=>{(async()=>{v(!0);try{const e=await te.contracts.getCurrencies();D(e);const t=e.find((e=>"RUR"===e.code))||e[0];if(x){const t=await te.contracts.getById(x);$(t);let s=null;t.currency?s=t.currency:e.length>0&&(s=e[0].code),A({username:t.student_id,price:t.price,currency:s,balance:t.balance,description:t.description||""})}else j?(A((e=>({...e,username:y||"",price:1e3,currency:"RUR",balance:10,description:r("contracts.form.testStudentDescription")}))),ae(!0)):t&&!P.currency&&A((e=>({...e,currency:t.code})))}catch(e){const t=e instanceof Error?e.message:"Failed to load data. Please try again.";g(t),l("/contracts")}finally{v(!1)}})()}),[x,l,g,j,y,r]);return re?n.jsxs(o,{sx:{display:"flex",flexDirection:"column",overflowX:"hidden",overflowY:"auto"},children:[b?n.jsx(xe,{message:r(oe?"contracts.status.loadingContract":"common.loading")}):n.jsx(n.Fragment,{children:n.jsxs(o,{sx:{flex:1,display:"flex",flexDirection:"column",mx:"auto",width:"100%",maxWidth:"800px",pb:1},children:[n.jsxs(d,{sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",p:2,py:1},children:[n.jsx(k,{variant:"h6",gutterBottom:!0,sx:{my:1},children:r(oe?"contracts.actions.edit":"contracts.actions.create")}),n.jsxs(o,{component:"form",noValidate:!0,children:[oe?n.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[n.jsx(V,{src:(null==(i=null==S?void 0:S.student)?void 0:i.photo_url)||void 0,sx:{width:48,height:48},children:Dt(null==S?void 0:S.student)}),n.jsxs(o,{children:[n.jsx(k,{variant:"h6",children:$t(null==S?void 0:S.student)}),n.jsx(k,{variant:"body2",color:"text.secondary",children:r("common.student.one")})]})]}):n.jsx(h,{autoFocus:!0,margin:"normal",name:"username",label:r("contracts.form.studentUsername"),type:"text",fullWidth:!0,variant:"outlined",value:P.username,onChange:e=>{const t=e.target.value;let s;s=t.includes("@")&&t.indexOf("@")>0?t.split("@")[0]:t.replace(/^@/,""),A((e=>({...e,username:s}))),E.username&&R((e=>{const t={...e};return delete t.username,t}))},error:!!E.username,helperText:E.username||r("contracts.form.telegramUsername"),placeholder:r("contracts.form.usernamePlaceholder"),InputProps:{startAdornment:n.jsx(k,{sx:{mr:.5},children:"@"})}}),!oe&&n.jsx(U,{control:n.jsx(J,{checked:ne,onChange:e=>{ae(e.target.checked),e.target.checked||A((e=>({...e,price:0,balance:null})))}}),label:r("contracts.form.trackLessonsLabel"),sx:{my:1}}),ne&&n.jsxs(o,{sx:{display:"flex",gap:2,alignItems:"flex-start"},children:[n.jsx(h,{margin:"normal",name:"price",label:r("contracts.form.pricePerLesson"),type:"number",sx:{flex:1},variant:"outlined",value:0===P.price?"":P.price,onChange:e=>{const t=e.target.value,s=""===t?0:Number(t.replace(/^0+/,""));A((e=>({...e,price:s}))),E.price&&R((e=>{const t={...e};return delete t.price,t}))},error:!!E.price,helperText:E.price}),n.jsxs(Q,{margin:"normal",sx:{minWidth:120},error:!!E.currency,children:[n.jsx(K,{id:"currency-label",children:r("contracts.form.currency")}),n.jsx(G,{labelId:"currency-label",name:"currency",value:P.currency||"",label:r("contracts.form.currency"),onChange:e=>{const{name:t,value:s}=e.target;A((e=>({...e,[t]:s}))),E[t]&&R((e=>{const s={...e};return delete s[t],s}))},children:T.map((e=>n.jsxs(a,{value:e.code,children:[e.emoji,"   ",e.code]},e.code)))})]})]}),!oe&&ne?n.jsx(h,{margin:"normal",name:"balance",label:r("contracts.form.balanceLabel"),type:"number",fullWidth:!0,variant:"outlined",value:null===P.balance?"":P.balance,onChange:e=>{const t=e.target.value,s=""===t?null:Number(t.replace(/^0+/,""));A((e=>({...e,balance:s}))),E.balance&&R((e=>{const t={...e};return delete t.balance,t}))},error:!!E.balance,helperText:E.balance||r("contracts.form.balanceHint")}):oe?n.jsxs(k,{variant:"body1",color:"text.secondary",sx:{mt:1},children:[r("contracts.form.currentBalance"),": ",P.balance]}):null,n.jsx(h,{margin:"normal",name:"description",label:r("contracts.form.description"),type:"text",fullWidth:!0,variant:"outlined",value:P.description,onChange:e=>{const{name:t,value:s}=e.target;A((e=>({...e,[t]:"price"===t||"balance"===t?Number(s):s}))),E[t]&&R((e=>{const s={...e};return delete s[t],s}))},multiline:!0,rows:3,error:!!E.description,helperText:E.description||r("contracts.form.descriptionHint")})]})]}),n.jsxs(o,{sx:{mt:2,display:"flex",justifyContent:"space-between",flexShrink:0},children:[n.jsx(o,{sx:{display:"flex",alignItems:"center"},children:n.jsx(c,{variant:"outlined",color:"inherit",sx:{mr:2},onClick:()=>{l(u)},children:r("common.actions.cancel")})}),n.jsx(o,{children:n.jsx(c,{variant:"contained",color:"primary",onClick:async()=>{const e={...P,price:ne?P.price:0,balance:ne?P.balance??0:0},{isValid:t,errors:s}=_t(oe?Kt:Gt,e);if(t){C(!0);try{if(oe&&x)await te.contracts.update(x,{price:e.price,currency:e.currency,balance:e.balance,description:e.description}),l(u);else{const t=await te.contracts.create({...e});if("new_user_created"===t.create_code)M(t.id),L(t.student_id),q(!0),f(r("contracts.status.contractCreatedShort"),"info");else if("already_exists"===t.create_code)M(t.id),L(t.student_id),se(!0);else{M(t.id),L(t.student_id),q(!1),se(!1),f(r("contracts.status.contractCreatedShort"),"success");const e=u.includes("?")?`${u}&studentId=${t.student_id}`:`${u}?studentId=${t.student_id}`;l(e)}}}catch(n){const e=n instanceof Error?n.message:r("contracts.status.errorCreating");if(e.includes("student_is_self"))return void g(r("contracts.status.studentIsSelf"));if(e.includes("student_is_teacher"))return void g(r("contracts.status.studentIsTeacher"));g(e)}finally{C(!1)}}else R(s)},disabled:w||!oe&&!P.username.trim(),children:r(w?"common.status.saving":oe?"contracts.actions.update":"contracts.actions.create")})})]})]})}),n.jsx(Qt,{open:N,onClose:()=>q(!1),onCancel:()=>{q(!1);const e=u.includes("?")?`${u}&studentId=${O}`:`${u}?studentId=${O}`;l(e)},botUrl:"https://t.me/teachair_bot",cancelButtonText:r("common.actions.done")}),n.jsxs(I,{open:H,onClose:()=>se(!1),maxWidth:"xs",fullWidth:!0,children:[n.jsx(_,{children:r("contracts.dialog.existingContract.title")}),n.jsx(F,{children:n.jsx(k,{children:r("contracts.dialog.existingContract.message")})}),n.jsxs(z,{children:[n.jsx(c,{onClick:()=>se(!1),children:r("common.actions.cancel")}),n.jsx(c,{onClick:()=>{se(!1),B&&l(`/contracts/${B}/edit`)},color:"primary",variant:"contained",children:r("contracts.actions.editExisting")})]})]})]}):(l("/contracts"),null)},ls=Object.freeze(Object.defineProperty({__proto__:null,ContractFormPage:os,default:os},Symbol.toStringTag,{value:"Module"}));export{ts as A,ls as C,es as P,Xt as T,as as a,is as b,rs as c};
