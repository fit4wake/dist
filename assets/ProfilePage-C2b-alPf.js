import{r as e,j as i,B as l,u as n,x as o,A as s,b as a,n as r,v as t,h as c,D as d,i as x,l as g,f as u,m,ax as p}from"./vendor-CLrGhTW1.js";import{b as f,u as h,a as j,L as y,az as b,aU as v,aZ as C,E as w,a_ as S,c as D}from"./main-D4KbzdYK.js";import{T as I,G as T}from"./GoogleButton-B-wUDRLZ.js";import"./index-fueEnxW-.js";const _=()=>{const{t:_}=f(),{user:k,isLoading:G,fetchUserData:E,logout:z}=h(),{showErrorToast:A,showToast:F}=j(),[W,O]=e.useState(!1),[B,U]=e.useState(!1),M=h().telegramWebApp,[N,L]=e.useState(!1),[P,R]=e.useState(!1),[Z,q]=e.useState(!1),[H,J]=e.useState(!1),[K,Q]=e.useState(""),[V,X]=e.useState(""),[Y,$]=e.useState(!1);return k||G?i.jsxs(l,{sx:{display:"flex",flexDirection:"column",height:"100%",bgcolor:"background.default"},children:[G?i.jsx(y,{message:_("common.loading")}):i.jsx(l,{sx:{display:"flex",flexDirection:"column",mx:"auto",width:"100%",maxWidth:"800px",p:2},children:i.jsxs(o,{sx:{display:"flex",flexDirection:"column",p:0,borderRadius:2},children:[i.jsx(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:3},children:i.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[i.jsx(s,{src:(null==k?void 0:k.photo_url)||void 0,sx:{width:60,height:60,mr:2,bgcolor:"primary.light",fontSize:"1.5rem"},children:b(k)}),i.jsxs(l,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(null==k?void 0:k.first_name)&&i.jsx(l,{children:i.jsx(a,{variant:"h6",sx:{color:"inherit",fontWeight:600},children:null==k?void 0:k.first_name})}),(null==k?void 0:k.last_name)&&i.jsx(l,{children:i.jsx(a,{variant:"h6",sx:{color:"inherit",fontWeight:600},children:null==k?void 0:k.last_name})})]})]})}),i.jsxs(l,{sx:{p:3,pt:0},children:[i.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1},children:[i.jsx(l,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:i.jsx(a,{variant:"body1",children:_("profile.username","Username")})}),i.jsx(l,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:i.jsx(r,{variant:"text",endIcon:i.jsx(v,{}),onClick:async()=>{try{await navigator.clipboard.writeText((null==k?void 0:k.username)||""),F(_("profile.usernameCopied","Username copied to clipboard"),"success")}catch(e){A(_("profile.usernameCopyError","Failed to copy username"))}},sx:{color:"primary.main"},children:null==k?void 0:k.username})})]}),i.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:2,borderBottom:"1px solid",borderColor:"divider"},children:[i.jsx(l,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:i.jsx(a,{variant:"body1",children:_("profile.role","Role")})}),i.jsx(l,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:i.jsx(t,{color:"admin"===(null==k?void 0:k.role)?"error":"teacher"===(null==k?void 0:k.role)?"primary":"success",label:null==k?void 0:k.role})})]}),M&&!M.initData&&i.jsxs(i.Fragment,{children:[i.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:2,borderBottom:"1px solid",borderColor:"divider"},children:[i.jsx(l,{sx:{display:"flex",alignItems:"center"},children:i.jsx(a,{variant:"body1",children:_("profile.telegram","Telegram")})}),(null==k?void 0:k.telegram_user_id)?i.jsxs(l,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:[i.jsxs(a,{variant:"body1",children:["@",k.username]}),(null==k?void 0:k.email)&&i.jsx(c,{size:"small",onClick:()=>R(!0),children:i.jsx(C,{fontSize:"small"})})]}):i.jsx(l,{children:W?i.jsx(a,{variant:"body2",color:"text.secondary",children:_("profile.connecting","Connecting...")}):i.jsx(I,{botName:"teachair_bot",onAuth:async e=>{if(e&&e.id){O(!0);try{await D.users.connectTelegram(e)?(await E(),F(_("profile.telegramConnectSuccess","Telegram account connected successfully"),"success")):A(_("profile.telegramConnectError","Failed to connect Telegram account"))}catch(i){let e=_("profile.telegramConnectError","Failed to connect Telegram account");(null==i?void 0:i.message.includes("409"))?e=_("profile.telegramAlreadyConnected","This Telegram account is already connected to another user"):i.message&&(e=i.message),A(e)}finally{O(!1)}}else A(_("profile.invalidTelegramData","Invalid Telegram user data"))}})})]}),i.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:2,borderBottom:"1px solid",borderColor:"divider"},children:[i.jsx(l,{sx:{display:"flex",alignItems:"center"},children:i.jsx(a,{variant:"body1",children:_("profile.google","Google")})}),(null==k?void 0:k.email)?i.jsxs(l,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1},children:[i.jsx(a,{variant:"body1",children:k.email}),(null==k?void 0:k.telegram_user_id)&&i.jsx(c,{size:"small",onClick:()=>q(!0),children:i.jsx(C,{fontSize:"small"})})]}):i.jsx(l,{children:B?i.jsx(a,{variant:"body2",color:"text.secondary",children:_("profile.connecting","Connecting...")}):i.jsx(T,{text:_("profile.connectGoogle","Connect Google"),size:"small",onSuccess:async e=>{if(e&&""!==e.trim()){U(!0);try{const i={access_token:e};await D.users.connectGoogle(i)?(await E(),F(_("profile.googleConnectSuccess","Google account connected successfully"),"success")):A(_("profile.googleConnectError","Failed to connect Google account"))}catch(i){let e=_("profile.googleConnectError","Failed to connect Google account");(null==i?void 0:i.message.includes("409"))?e=_("profile.googleAlreadyConnected","This Google account is already connected to another user"):i.message&&(e=i.message),A(e)}finally{U(!1)}}else A(_("profile.invalidGoogleToken","Invalid Google access token"))}})})]})]}),(null==k?void 0:k.created_at)&&i.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:2,borderBottom:"1px solid",borderColor:"divider"},children:[i.jsx(a,{variant:"body1",children:_("profile.memberSince","Member since")}),i.jsx(a,{variant:"body2",color:"text.secondary",children:new Date(k.created_at).toLocaleDateString(_("locale"),{dateStyle:"medium"})})]})]}),i.jsxs(l,{sx:{p:3,pt:0,display:"flex",justifyContent:"space-between",alignItems:"center",gap:2},children:[i.jsx(r,{variant:"outlined",startIcon:i.jsx(w,{}),onClick:()=>{Q((null==k?void 0:k.first_name)||""),X((null==k?void 0:k.last_name)||""),J(!0)},size:"small",children:_("profile.edit","Edit")}),i.jsx(r,{variant:"outlined",startIcon:i.jsx(S,{}),onClick:()=>L(!0),color:"error",size:"small",children:_("auth.signOut","Sign Out")})]})]})}),i.jsxs(d,{open:H,onClose:()=>!Y&&J(!1),"aria-labelledby":"edit-dialog-title",maxWidth:"sm",fullWidth:!0,children:[i.jsx(x,{id:"edit-dialog-title",children:_("profile.editProfile","Edit Profile")}),i.jsx(g,{children:i.jsxs(l,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[i.jsx(u,{label:_("profile.firstName","First Name"),value:K,onChange:e=>Q(e.target.value),fullWidth:!0,disabled:Y}),i.jsx(u,{label:_("profile.lastName","Last Name"),value:V,onChange:e=>X(e.target.value),fullWidth:!0,disabled:Y})]})}),i.jsxs(m,{children:[i.jsx(r,{onClick:()=>J(!1),disabled:Y,children:_("profile.cancel","Cancel")}),i.jsx(r,{onClick:async()=>{$(!0);try{const e={first_name:K.trim()||null,last_name:V.trim()||null};await D.users.updateMe(e),await E(),J(!1),F(_("profile.updateSuccess","Profile updated successfully"),"success")}catch(e){A(_("profile.updateError","Failed to update profile"))}finally{$(!1)}},variant:"contained",disabled:Y,children:Y?_("profile.saving","Saving..."):_("profile.save","Save")})]})]}),i.jsxs(d,{open:N,onClose:()=>L(!1),"aria-labelledby":"logout-dialog-title","aria-describedby":"logout-dialog-description",children:[i.jsx(x,{id:"logout-dialog-title",children:_("auth.confirmSignOut","Confirm Sign Out")}),i.jsx(g,{children:i.jsx(p,{id:"logout-dialog-description",children:_("auth.confirmSignOutMessage","Are you sure you want to sign out?")})}),i.jsxs(m,{children:[i.jsx(r,{onClick:()=>L(!1),color:"primary",children:_("auth.cancel","Cancel")}),i.jsx(r,{onClick:()=>{L(!1),z()},color:"error",variant:"contained",children:_("auth.signOut","Sign Out")})]})]}),i.jsxs(d,{open:P,onClose:()=>R(!1),"aria-labelledby":"telegram-disconnect-dialog-title","aria-describedby":"telegram-disconnect-dialog-description",children:[i.jsx(x,{id:"telegram-disconnect-dialog-title",children:_("profile.confirmTelegramDisconnect","Confirm Telegram Disconnect")}),i.jsx(g,{children:i.jsx(p,{id:"telegram-disconnect-dialog-description",children:_("profile.confirmTelegramDisconnectMessage","Are you sure you want to disconnect your Telegram account?")})}),i.jsxs(m,{children:[i.jsx(r,{onClick:()=>R(!1),color:"primary",children:_("profile.cancel","Cancel")}),i.jsx(r,{onClick:async()=>{R(!1),await(async()=>{await D.users.disconnectTelegram(),await E()})()},color:"error",variant:"contained",children:_("profile.disconnect","Disconnect")})]})]}),i.jsxs(d,{open:Z,onClose:()=>q(!1),"aria-labelledby":"google-disconnect-dialog-title","aria-describedby":"google-disconnect-dialog-description",children:[i.jsx(x,{id:"google-disconnect-dialog-title",children:_("profile.confirmGoogleDisconnect","Confirm Google Disconnect")}),i.jsx(g,{children:i.jsx(p,{id:"google-disconnect-dialog-description",children:_("profile.confirmGoogleDisconnectMessage","Are you sure you want to disconnect your Google account?")})}),i.jsxs(m,{children:[i.jsx(r,{onClick:()=>q(!1),color:"primary",children:_("profile.cancel","Cancel")}),i.jsx(r,{onClick:async()=>{q(!1),await(async()=>{await D.users.disconnectGoogle(),await E()})()},color:"error",variant:"contained",children:_("profile.disconnect","Disconnect")})]})]})]}):i.jsx(l,{sx:{p:3},children:i.jsx(n,{severity:"error",children:_("profile.noUser","User not found")})})};export{_ as default};
